---
title: "Физический и канальный уровень: Ethernet, WiFi, MAC"
created: 2025-01-15
modified: 2026-02-13
tags:
  - topic/networking
  - ethernet
  - wifi
  - mac
  - physical-layer
  - layer2
  - type/concept
  - level/intermediate
related:
  - [networking-overview]]
  - "[[network-ip-routing]]"
  - "[[network-cloud-modern]"
prerequisites:
  - "[[network-fundamentals-for-developers]]"
status: published
reading_time: 146
difficulty: 5
study_status: not_started
mastery: 0
last_reviewed:
next_review:
---

# Физический и канальный уровень: Ethernet, WiFi, MAC

> Основы L1/L2: как биты превращаются в кадры, почему WiFi медленнее Ethernet, и что делать, когда "сеть не работает".

---

## Prerequisites

| Тема | Зачем нужно | Где изучить |
|------|-------------|-------------|
| **Базовая физика** | Сигналы, частоты (опционально) | School physics |
| **Командная строка** | ifconfig, ip link | Bash basics |

### Для кого этот материал

| Уровень | Подходит? | Рекомендация |
|---------|-----------|--------------|
| **Новичок** | ✅ Да | Полезно знать основы |
| **Intermediate** | ✅ Да | VLAN, MTU важны |
| **Advanced** | ⏭️ Опционально | Если работаешь с инфраструктурой |

### Терминология для новичков

> 💡 **Физический уровень** = "провода и радиоволны". Это то, по чему реально передаются биты — электричество в кабеле или радио в воздухе.

| Термин | Значение | Аналогия для новичка |
|--------|----------|---------------------|
| **MAC-адрес** | Физический адрес сетевой карты | **Серийный номер** — уникален для каждого устройства |
| **Ethernet** | Стандарт проводной сети | **Почтовая система района** — провода между домами |
| **WiFi** | Беспроводная сеть | **Радиостанция** — данные по воздуху |
| **Frame (Кадр)** | Единица данных на L2 | **Конверт с адресом** — данные + MAC-адреса |
| **Switch** | Устройство для соединения устройств в сети | **Почтовый ящик подъезда** — знает кто где живёт |
| **VLAN** | Виртуальная изоляция сети | **Разные подъезды** — не видят друг друга |
| **MTU** | Maximum Transmission Unit | **Максимальный размер письма** |
| **Duplex** | Full/Half — одновременная передача | **Рация vs телефон** — один говорит или оба сразу |
| **CRC** | Проверка целостности кадра | **Контрольная сумма** — не повредилось ли в пути |
| **Collision** | Столкновение данных (WiFi) | **Два говорят одновременно** — никто не слышит |

---

## Часть 1: Интуиция без кода

### 5 аналогий для глубокого понимания

---

### Аналогия 1: MAC-адрес как серийный номер паспорта

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    MAC-АДРЕС = СЕРИЙНЫЙ НОМЕР ПАСПОРТА                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ПАСПОРТ:                          СЕТЕВАЯ КАРТА:                          │
│   ┌────────────────────────┐        ┌────────────────────────┐              │
│   │ Серия: 45 06           │        │ OUI: 00:1A:2B          │              │
│   │ (где выдан)            │        │ (производитель)        │              │
│   │                        │        │                        │              │
│   │ Номер: 123456          │        │ NIC: 3C:4D:5E          │              │
│   │ (уникальный)           │        │ (уникальный ID)        │              │
│   └────────────────────────┘        └────────────────────────┘              │
│                                                                             │
│   MAC: 00:1A:2B:3C:4D:5E                                                    │
│         └──┬───┘ └──┬───┘                                                   │
│            │        │                                                       │
│            │        └─── "Номер" — уникальный для устройства                │
│            │                                                                │
│            └──────────── "Серия" — кто выдал (производитель)                │
│                          00:00:0C = Cisco                                   │
│                          DC:A6:32 = Raspberry Pi                            │
│                          3C:22:FB = Apple                                   │
│                                                                             │
│   КЛЮЧЕВОЕ ОТЛИЧИЕ:                                                         │
│   • IP-адрес = почтовый адрес (можно переехать и сменить)                   │
│   • MAC-адрес = серийный номер паспорта (прошит навсегда*)                  │
│                                                                             │
│   *Технически MAC можно подменить (MAC spoofing), но физически он "прошит"  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**Три типа "писем" по MAC:**
- **Unicast** (личное письмо): одному конкретному получателю
- **Broadcast** (объявление на весь подъезд): FF:FF:FF:FF:FF:FF — всем устройствам
- **Multicast** (рассылка подписчикам): 01:xx:xx:xx:xx:xx — группе устройств

---

### Аналогия 2: Switch как умный почтальон подъезда

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     SWITCH = ПОЧТАЛЬОН ПОДЪЕЗДА                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ОБЫЧНЫЙ HUB (устаревший) — ГЛУПЫЙ ПОЧТАЛЬОН:                              │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                                                                   │     │
│   │   Получил письмо для квартиры 5                                   │     │
│   │   → Кричит на весь подъезд: "ПИСЬМО ДЛЯ КВ. 5!!!"                │     │
│   │   → ВСЕ слышат содержимое                                         │     │
│   │   → Только кв. 5 берёт, остальные игнорируют                      │     │
│   │                                                                   │     │
│   │   Проблемы: трафик, коллизии, безопасность                        │     │
│   │                                                                   │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   SWITCH — УМНЫЙ ПОЧТАЛЬОН:                                                 │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                                                                   │     │
│   │   У почтальона есть ЗАПИСНАЯ КНИЖКА (CAM/MAC table):              │     │
│   │                                                                   │     │
│   │   ┌─────────────────────────┬────────────────┐                    │     │
│   │   │ MAC-адрес               │ Порт (дверь)   │                    │     │
│   │   ├─────────────────────────┼────────────────┤                    │     │
│   │   │ 00:1A:2B:3C:4D:5E       │ Порт 1 (кв.1)  │                    │     │
│   │   │ AA:BB:CC:DD:EE:FF       │ Порт 3 (кв.3)  │                    │     │
│   │   │ 11:22:33:44:55:66       │ Порт 5 (кв.5)  │                    │     │
│   │   └─────────────────────────┴────────────────┘                    │     │
│   │                                                                   │     │
│   │   Как он учится:                                                  │     │
│   │   1. Получил кадр от порта 1 с src MAC 00:1A:2B:3C:4D:5E          │     │
│   │   2. Записал: "00:1A:2B... живёт в порту 1"                       │     │
│   │   3. Ищет dst MAC в таблице                                       │     │
│   │      • Нашёл → отправляет только туда                             │     │
│   │      • Не нашёл → flood (но запомнит при ответе!)                 │     │
│   │                                                                   │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   BROADCAST по-прежнему идёт ВСЕМ — почтальон обязан доставить              │
│   "объявление на весь подъезд" (ARP, DHCP Discover)                         │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Аналогия 3: VLAN как разные подъезды в одном доме

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    VLAN = РАЗНЫЕ ПОДЪЕЗДЫ В ОДНОМ ДОМЕ                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   БЕЗ VLAN — ОДИН БОЛЬШОЙ ПОДЪЕЗД:                                          │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                           Один дом                                │     │
│   │   ┌─────────────────────────────────────────────────────────────┐ │     │
│   │   │  Бухгалтерия  │  Разработчики  │  Гости  │  Камеры          │ │     │
│   │   │     ПК        │      ПК        │   ПК    │  IP-камеры       │ │     │
│   │   └─────────────────────────────────────────────────────────────┘ │     │
│   │   Все видят всех, broadcast от камер мешает бухгалтерии          │     │
│   │   Гость может попасть к финансовым данным                        │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   С VLAN — ОТДЕЛЬНЫЕ ПОДЪЕЗДЫ (ЛОГИЧЕСКИ):                                  │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                         Тот же дом                                │     │
│   │   ┌───────────────┐  ┌───────────────┐  ┌───────────────┐        │     │
│   │   │ Подъезд 1     │  │ Подъезд 2     │  │ Подъезд 3     │        │     │
│   │   │ VLAN 10       │  │ VLAN 20       │  │ VLAN 30       │        │     │
│   │   │ (Финансы)     │  │ (Разработка)  │  │ (Гости)       │        │     │
│   │   │               │  │               │  │               │        │     │
│   │   │ Бухгалтерия   │  │ Разработчики  │  │ Гости WiFi    │        │     │
│   │   │ Своя сеть     │  │ Своя сеть     │  │ Только интер. │        │     │
│   │   └───────────────┘  └───────────────┘  └───────────────┘        │     │
│   │                                                                   │     │
│   │   • Гости НЕ видят бухгалтерию (изоляция)                         │     │
│   │   • Broadcast от камер не мешает разработчикам                   │     │
│   │   • Чтобы попасть из VLAN в VLAN — нужен Router (Layer 3)        │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   ТИПЫ ПОРТОВ:                                                              │
│   • Access port = "Обычная дверь" — один VLAN, без тегов                    │
│   • Trunk port = "Коридор между подъездами" — несколько VLAN, с тегами      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Аналогия 4: WiFi CSMA/CA как вежливый разговор в комнате

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                WiFi CSMA/CA = ВЕЖЛИВЫЙ РАЗГОВОР В КОМНАТЕ                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ETHERNET (CSMA/CD) = ПРОВОД, МОЖНО ОБНАРУЖИТЬ КОЛЛИЗИЮ:                   │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │   • Говоришь и слушаешь одновременно                              │     │
│   │   • Если услышал чужой голос пока говоришь → коллизия!            │     │
│   │   • Останавливаешься, ждёшь случайное время, пробуешь снова       │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   WiFi (CSMA/CA) = РАДИО, НЕЛЬЗЯ ОБНАРУЖИТЬ КОЛЛИЗИЮ:                       │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                                                                   │     │
│   │   Проблема: когда говоришь по рации, не слышишь других!           │     │
│   │   Решение: ИЗБЕГАТЬ коллизий, а не обнаруживать                   │     │
│   │                                                                   │     │
│   │   Алгоритм "вежливого разговора":                                 │     │
│   │                                                                   │     │
│   │   ┌─────────────────────────────────────────────────────────────┐ │     │
│   │   │                                                             │ │     │
│   │   │   1. Хочешь сказать что-то                                  │ │     │
│   │   │      │                                                      │ │     │
│   │   │      ▼                                                      │ │     │
│   │   │   2. Слушаешь комнату... кто-то говорит?                    │ │     │
│   │   │      │                                                      │ │     │
│   │   │      ├─── Да → Молча ждёшь, пока закончит                   │ │     │
│   │   │      │                                                      │ │     │
│   │   │      └─── Нет → Подожди ещё чуть-чуть (DIFS)                │ │     │
│   │   │              │                                              │ │     │
│   │   │              ▼                                              │ │     │
│   │   │   3. Тянешь случайную "соломинку" (backoff)                 │ │     │
│   │   │      Чем короче — тем раньше говоришь                       │ │     │
│   │   │      │                                                      │ │     │
│   │   │      ▼                                                      │ │     │
│   │   │   4. Твоя очередь! Говоришь                                 │ │     │
│   │   │      │                                                      │ │     │
│   │   │      ▼                                                      │ │     │
│   │   │   5. Ждёшь подтверждение: "Понял тебя" (ACK)                │ │     │
│   │   │      │                                                      │ │     │
│   │   │      ├─── Получил ACK → Успех!                              │ │     │
│   │   │      │                                                      │ │     │
│   │   │      └─── Нет ACK → Повторяю (увеличиваю backoff)           │ │     │
│   │   │                                                             │ │     │
│   │   └─────────────────────────────────────────────────────────────┘ │     │
│   │                                                                   │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   ПОЧЕМУ WiFi МЕДЛЕННЕЕ ETHERNET:                                           │
│   • Overhead на ACK (каждый кадр требует подтверждения)                     │
│   • Время ожидания (DIFS, backoff)                                          │
│   • Помехи от соседей (все на одном канале = толкаются)                     │
│   • Half-duplex (нельзя говорить и слушать одновременно)                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Аналогия 5: Ethernet-кадр как конверт с наклейками

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                   ETHERNET-КАДР = КОНВЕРТ С НАКЛЕЙКАМИ                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                                                                     │   │
│   │   ┌───────────────────────────────────────────────────────────────┐ │   │
│   │   │                      ETHERNET FRAME                           │ │   │
│   │   │                                                               │ │   │
│   │   │  ┌─────────────┐                                              │ │   │
│   │   │  │  PREAMBLE   │  "Внимание! Сейчас будет письмо!"            │ │   │
│   │   │  │  (7 bytes)  │  101010101010... — синхронизация часов       │ │   │
│   │   │  └─────────────┘                                              │ │   │
│   │   │                                                               │ │   │
│   │   │  ┌─────────────┐                                              │ │   │
│   │   │  │    SFD      │  "Письмо начинается ЗДЕСЬ!"                  │ │   │
│   │   │  │  (1 byte)   │  10101011 — конец преамбулы                  │ │   │
│   │   │  └─────────────┘                                              │ │   │
│   │   │                                                               │ │   │
│   │   │  ┌─────────────────────────────────────────────────────────┐  │ │   │
│   │   │  │  КОМУ: AA:BB:CC:DD:EE:FF (Destination MAC)              │  │ │   │
│   │   │  │  ОТ КОГО: 00:1A:2B:3C:4D:5E (Source MAC)                │  │ │   │
│   │   │  └─────────────────────────────────────────────────────────┘  │ │   │
│   │   │                                                               │ │   │
│   │   │  ┌─────────────┐                                              │ │   │
│   │   │  │  EtherType  │  "Что внутри?"                               │ │   │
│   │   │  │  (2 bytes)  │  0x0800 = IPv4                               │ │   │
│   │   │  │             │  0x0806 = ARP                                │ │   │
│   │   │  │             │  0x86DD = IPv6                               │ │   │
│   │   │  │             │  0x8100 = VLAN tag follows                   │ │   │
│   │   │  └─────────────┘                                              │ │   │
│   │   │                                                               │ │   │
│   │   │  ┌─────────────────────────────────────────────────────────┐  │ │   │
│   │   │  │                                                         │  │ │   │
│   │   │  │                      PAYLOAD                            │  │ │   │
│   │   │  │                    (само письмо)                        │  │ │   │
│   │   │  │                   46-1500 bytes                         │  │ │   │
│   │   │  │            (MTU = Maximum Transmission Unit)            │  │ │   │
│   │   │  │                                                         │  │ │   │
│   │   │  └─────────────────────────────────────────────────────────┘  │ │   │
│   │   │                                                               │ │   │
│   │   │  ┌─────────────┐                                              │ │   │
│   │   │  │    FCS      │  "Проверочный код"                           │ │   │
│   │   │  │  (4 bytes)  │  CRC-32 — не повредилось ли в пути?          │ │   │
│   │   │  │             │  Если не сходится — кадр отбрасывается       │ │   │
│   │   │  └─────────────┘                                              │ │   │
│   │   │                                                               │ │   │
│   │   └───────────────────────────────────────────────────────────────┘ │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   MTU 1500 = "максимальный размер письма"                                   │
│   • Больше 1500 байт? → Разрезаем на части (фрагментация на L3)             │
│   • Jumbo frames (9000 байт) — только если ВСЁ оборудование поддерживает    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Часть 2: Почему это сложно

### 6 типичных ошибок на физическом/канальном уровне

---

### Ошибка 1: "Сеть не работает" — ищу проблему не на том уровне

**СИМПТОМ:**
```
Пользователь: "Интернета нет!"
Разработчик: *проверяет DNS, IP, настройки приложения*
             *2 часа ищет проблему в конфигах*

А на самом деле: кабель выдернут или WiFi отключён
```

**РЕШЕНИЕ:**
```
ПРАВИЛО: ВСЕГДА начинай с L1/L2!

□ Уровень 1 — Физический:
  └─ Горит ли лампочка на сетевой карте?
  └─ Кабель подключён? Не повреждён?
  └─ WiFi включён? Подключён к SSID?

  Linux: ip link show
  → "state DOWN" = физически отключено!
  → "state UP" = физически ок, ищи выше

□ Уровень 2 — Канальный:
  └─ Есть ли MAC-адреса в ARP?
  └─ ethtool eth0 → Link detected: yes/no?
  └─ WiFi: iwconfig → Associated?

□ Только потом L3+:
  └─ ping gateway (IP связность)
  └─ ping 8.8.8.8 (интернет связность)
  └─ ping google.com (DNS)

СТАТИСТИКА: 40% сетевых проблем — на L1/L2!
```

---

### Ошибка 2: Duplex mismatch — соединение есть, но всё тормозит

**СИМПТОМ:**
```
• Ping работает, но очень медленный
• При нагрузке появляются "Late collisions"
• Загрузка файлов обрывается или очень медленная
• ethtool показывает "Half duplex" на одном конце
```

**РЕШЕНИЕ:**
```
ПРОБЛЕМА: Одна сторона думает "full duplex", другая "half duplex"

Full duplex: могу говорить и слушать ОДНОВРЕМЕННО (телефон)
Half duplex: или говорю, или слушаю (рация)

┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   ПК (Full)  ←────────────────────────→  Switch (Half)          │
│                                                                 │
│   ПК думает: "Могу передавать данные пока получаю"              │
│   Switch думает: "Он же передаёт! Это коллизия!"                │
│                                                                 │
│   Результат: потери пакетов, ретрансмиссии, ТОРМОЗА             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

ДИАГНОСТИКА:
$ ethtool eth0
  Speed: 1000Mb/s
  Duplex: Full          ← должно быть Full!
  Auto-negotiation: on  ← если off — проблема возможна

РЕШЕНИЕ:
• Включить auto-negotiation на ОБОИХ концах
• Или вручную установить одинаковые настройки:
  $ ethtool -s eth0 speed 1000 duplex full autoneg off
  (и то же на switch)
```

---

### Ошибка 3: MTU mismatch — "Ping работает, но приложение нет"

**СИМПТОМ:**
```
$ ping 10.0.0.5
PING 10.0.0.5: 64 bytes — OK

$ curl http://10.0.0.5/api
timeout... timeout... FAIL

Причина: маленькие ICMP-пакеты проходят,
         большие HTTP-пакеты не проходят
```

**РЕШЕНИЕ:**
```
ПРОБЛЕМА: MTU (Maximum Transmission Unit) разный на маршруте

┌────────────┐     MTU 1500     ┌────────────┐     MTU 1400     ┌────────────┐
│   Твой ПК  │─────────────────►│   Туннель  │─────────────────►│   Сервер   │
│  MTU 1500  │                  │  (VPN/GRE) │                  │  MTU 1500  │
└────────────┘                  └────────────┘                  └────────────┘

Пакет 1500 байт не влезает в туннель (1400) → ОТБРАСЫВАЕТСЯ

ДИАГНОСТИКА:
$ ping -M do -s 1472 10.0.0.5    # Linux (-M do = don't fragment)
$ ping -D -s 1472 10.0.0.5       # macOS

Если не проходит — уменьшай размер пока не пройдёт:
$ ping -M do -s 1400 10.0.0.5    # пробуем меньше

РЕШЕНИЕ:
1. Найти минимальный MTU на маршруте
2. Установить на своём интерфейсе:
   $ ip link set eth0 mtu 1400

ЧАСТЫЕ СЛУЧАИ:
• VPN туннели: MTU 1400-1420
• PPPoE (DSL): MTU 1492
• Docker overlay: MTU 1450
• Kubernetes: MTU варьируется
```

---

### Ошибка 4: VLAN изоляция — "В офисе работает, дома нет"

**СИМПТОМ:**
```
Приложение работает в офисной сети (10.0.10.x)
Дома подключился к VPN, получил IP 10.0.20.x — НЕ РАБОТАЕТ

"Но я же в той же сети!"
```

**РЕШЕНИЕ:**
```
ПРОБЛЕМА: 10.0.10.x и 10.0.20.x — это РАЗНЫЕ VLAN

┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   VLAN 10 (Офис)               VLAN 20 (VPN/Гости)              │
│   ┌─────────────────┐          ┌─────────────────┐              │
│   │ 10.0.10.0/24    │          │ 10.0.20.0/24    │              │
│   │                 │          │                 │              │
│   │ Сервер API      │    ✗     │ Твой ноутбук    │              │
│   │ 10.0.10.50      │◄────────►│ 10.0.20.15      │              │
│   │                 │          │                 │              │
│   └─────────────────┘          └─────────────────┘              │
│            │                            │                       │
│            │         ┌──────────┐       │                       │
│            └─────────│  Router  │───────┘                       │
│                      │  (L3)    │                               │
│                      └──────────┘                               │
│                                                                 │
│   Для связи между VLAN нужен Router (L3 маршрутизация)          │
│   Если роутер не настроен или есть firewall → НЕТ СВЯЗИ         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

ДИАГНОСТИКА:
$ ip route show
  → Есть ли маршрут до 10.0.10.0/24?

$ traceroute 10.0.10.50
  → Пакеты доходят до роутера? Дальше теряются?

РЕШЕНИЕ:
• Попросить сетевого админа добавить маршрутизацию между VLAN
• Или firewall правило для твоей подсети
• Или использовать IP из нужного VLAN (если возможно)
```

---

### Ошибка 5: WiFi интерференция — "То работает, то нет"

**СИМПТОМ:**
```
• WiFi "скачет" — то 100 Mbps, то 10 Mbps
• Периодически отваливается
• В офисе хуже, чем дома
• На 2.4 GHz хуже, чем на 5 GHz
```

**РЕШЕНИЕ:**
```
ПРОБЛЕМА: Слишком много устройств на одном канале

2.4 GHz ДИАПАЗОН:
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   Канал:  1    2    3    4    5    6    7    8    9   10   11   │
│           ├────────────────┤                                    │
│           Твой роутер (ch 1, width 40MHz)                       │
│                ├────────────────┤                               │
│                Сосед 1 (ch 3)                                   │
│                          ├────────────────┤                     │
│                          Сосед 2 (ch 6)                         │
│   + Микроволновка + Bluetooth + другие роутеры                  │
│                                                                 │
│   2.4 GHz = ОЧЕНЬ ПЕРЕГРУЖЕН в городах                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

5 GHz ДИАПАЗОН:
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   • Больше каналов (36, 40, 44, 48, 52, 56, 60, 64, 100-144)   │
│   • Меньше помех от бытовых устройств                          │
│   • Но хуже проходит через стены!                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

ДИАГНОСТИКА:
# macOS:
/System/Library/.../airport -s    # сканирование сетей
# → смотри на каких каналах соседи

# Linux:
sudo iwlist wlan0 scan | grep -E "Channel:|ESSID:"

# Windows:
netsh wlan show networks mode=bssid

РЕШЕНИЕ:
1. Переключись на 5 GHz если есть
2. Выбери менее загруженный канал (1, 6 или 11 для 2.4GHz)
3. Используй WiFi Analyzer app для визуализации
4. Для критичных задач — Ethernet кабель!
```

---

### Ошибка 6: STP блокировка — "Порт включён, но трафик не идёт"

**СИМПТОМ:**
```
• Новое устройство подключено, лампочка горит
• Но трафик не идёт ~30-50 секунд
• Или порт вообще "молчит" навсегда

В логах switch: "Port Gi0/1 moved to Blocking state"
```

**РЕШЕНИЕ:**
```
ПРОБЛЕМА: STP (Spanning Tree Protocol) блокирует порт

STP ЗАЧЕМ:
• Предотвращает петли в сети (broadcast storm)
• При обнаружении петли — блокирует один из портов

┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   Switch A ─────────── Switch B                                 │
│       │                   │                                     │
│       │   ┌─────────┐     │                                     │
│       └───│Switch C │─────┘  ← STP блокирует один линк!         │
│           └─────────┘                                           │
│                 │                                               │
│            [BLOCKED]                                            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

ПРОБЛЕМА МЕДЛЕННОЙ СХОДИМОСТИ:
• Classic STP: 30-50 секунд на переход в Forwarding
• Порт проходит: Blocking → Listening → Learning → Forwarding

РЕШЕНИЕ ДЛЯ КОНЕЧНЫХ УСТРОЙСТВ (не свитчей):
• PortFast — мгновенный переход в Forwarding
  (настраивается на switch для access-портов)

# Cisco:
interface GigabitEthernet0/1
  spanning-tree portfast

РЕШЕНИЕ ДЛЯ СВИТЧЕЙ:
• RSTP (Rapid STP) — сходимость за секунды
• Правильный дизайн топологии без лишних петель

ПРЕДУПРЕЖДЕНИЕ:
PortFast + петля = broadcast storm!
Используй только для конечных устройств (ПК, серверы), не для switch-to-switch!
```

---

## Часть 3: Ментальные модели

### 5 способов думать о физическом и канальном уровне

---

### Модель 1: L1/L2 как "местная почта" vs L3+ как "междугородняя"

```
┌─────────────────────────────────────────────────────────────────────────────┐
│           МЕСТНАЯ ПОЧТА (L2) vs МЕЖДУГОРОДНЯЯ (L3)                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   L2 (MAC) = ДОСТАВКА ВНУТРИ РАЙОНА                                         │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                                                                   │     │
│   │   • "Доставить в квартиру 5E:4D:3C:2B:1A:00"                      │     │
│   │   • Почтальон (switch) знает всех в районе                        │     │
│   │   • Нет маршрутов — только локальная доставка                     │     │
│   │   • Broadcast = объявление на весь район                          │     │
│   │                                                                   │     │
│   │   Пример: ARP "Кто 192.168.1.5?" → broadcast всем в L2 сегменте   │     │
│   │                                                                   │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   L3 (IP) = ДОСТАВКА МЕЖДУ ГОРОДАМИ                                         │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                                                                   │     │
│   │   • "Доставить в город 93.184.216.34"                             │     │
│   │   • Маршрутизаторы знают пути между городами                      │     │
│   │   • Пакет проходит через много "перевалочных пунктов" (hops)      │     │
│   │   • На каждом hop меняется L2 адрес, но L3 остаётся!              │     │
│   │                                                                   │     │
│   │   Путь пакета:                                                    │     │
│   │   [Твой MAC → Router1 MAC] → [Router1 MAC → Router2 MAC] → ...   │     │
│   │   IP src/dst остаются неизменными весь путь!                      │     │
│   │                                                                   │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   КЛЮЧЕВОЙ ИНСАЙТ:                                                          │
│   • MAC = "hop-to-hop" (от соседа к соседу)                                 │
│   • IP = "end-to-end" (от источника до назначения)                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Модель 2: Провода и радио — разные среды, разные правила

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                   ПРОВОД vs РАДИО — РАЗНЫЕ ФИЗИКИ                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ETHERNET (ПРОВОД):                                                        │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                                                                   │     │
│   │   • Dedicated medium — провод только для тебя                     │     │
│   │   • Full duplex — говорю и слушаю одновременно                    │     │
│   │   • Детерминированная скорость (1G = 1G всегда)                   │     │
│   │   • Нет помех от соседей                                          │     │
│   │   • Безопасность: нужен физический доступ к кабелю                │     │
│   │                                                                   │     │
│   │   Физика: электрические сигналы по меди                           │     │
│   │           или свет по оптоволокну                                 │     │
│   │                                                                   │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   WiFi (РАДИО):                                                             │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                                                                   │     │
│   │   • Shared medium — воздух общий для всех!                        │     │
│   │   • Half duplex — или говорю, или слушаю                          │     │
│   │   • Скорость "плавает" (зависит от помех, расстояния)             │     │
│   │   • Соседские WiFi, Bluetooth, микроволновки мешают               │     │
│   │   • Безопасность: любой в радиусе может слушать (нужен WPA3!)     │     │
│   │                                                                   │     │
│   │   Физика: электромагнитные волны в воздухе                        │     │
│   │           2.4 GHz: дальше, но больше помех                        │     │
│   │           5 GHz: быстрее, но хуже через стены                     │     │
│   │                                                                   │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   ВЫВОД ДЛЯ РАЗРАБОТЧИКА:                                                   │
│   • Критичные сервисы? → Ethernet                                           │
│   • Мобильность важнее? → WiFi, но учитывай нестабильность                  │
│   • Тестируй на WiFi! (latency spikes, packet loss)                         │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Модель 3: Кадр как "матрёшка" на L2

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      КАДР = МАТРЁШКА НА L2                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Твои данные → HTTP → TCP → IP → Ethernet                                  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │ Ethernet Frame (L2)                                                 │   │
│   │ ┌─────────────────────────────────────────────────────────────────┐ │   │
│   │ │ dst MAC │ src MAC │ type │                                      │ │   │
│   │ │                           │ IP Packet (L3)                      │ │   │
│   │ │                           │ ┌─────────────────────────────────┐ │ │   │
│   │ │                           │ │ src IP │ dst IP │               │ │ │   │
│   │ │                           │ │                 │ TCP Segment   │ │ │   │
│   │ │                           │ │                 │ ┌───────────┐ │ │ │   │
│   │ │                           │ │                 │ │ ports, seq│ │ │ │   │
│   │ │                           │ │                 │ │           │ │ │ │   │
│   │ │                           │ │                 │ │ HTTP data │ │ │ │   │
│   │ │                           │ │                 │ │ ┌───────┐ │ │ │ │   │
│   │ │                           │ │                 │ │ │ JSON  │ │ │ │ │   │
│   │ │                           │ │                 │ │ └───────┘ │ │ │ │   │
│   │ │                           │ │                 │ └───────────┘ │ │ │   │
│   │ │                           │ └─────────────────────────────────┘ │ │   │
│   │ │                                                                 │ │   │
│   │ │ FCS (CRC)                                                       │ │   │
│   │ └─────────────────────────────────────────────────────────────────┘ │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   НА КАЖДОМ HOP:                                                            │
│   • Ethernet header СНИМАЕТСЯ и ЗАМЕНЯЕТСЯ новым                            │
│   • IP header остаётся (NAT может изменить src IP)                          │
│   • TCP/HTTP — без изменений                                                │
│                                                                             │
│   ПК → Switch: MAC ПК → MAC роутера                                         │
│   Router → ISP: MAC роутера → MAC ISP                                       │
│   ... и так до сервера                                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Модель 4: Broadcast domain как "зона слышимости"

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                 BROADCAST DOMAIN = ЗОНА СЛЫШИМОСТИ                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ВСЕ В ОДНОМ BROADCAST DOMAIN:                                             │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                                                                   │     │
│   │                        📢 BROADCAST!                              │     │
│   │                             │                                     │     │
│   │      ┌──────────────────────┼──────────────────────┐              │     │
│   │      │                      │                      │              │     │
│   │      ▼                      ▼                      ▼              │     │
│   │   [PC1] ◄─────────────► [PC2] ◄──────────────► [PC3]             │     │
│   │      │                      │                      │              │     │
│   │      └──────────────────────┴──────────────────────┘              │     │
│   │                         [SWITCH]                                  │     │
│   │                                                                   │     │
│   │   Все слышат все broadcast (ARP, DHCP, NetBIOS...)               │     │
│   │   100 устройств = 100 получателей каждого broadcast              │     │
│   │                                                                   │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   РАЗДЕЛЕНИЕ НА VLAN (разные broadcast domains):                            │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                                                                   │     │
│   │   📢 VLAN 10                        📢 VLAN 20                    │     │
│   │       │                                 │                         │     │
│   │   ┌───┴───┐                         ┌───┴───┐                     │     │
│   │   ▼       ▼                         ▼       ▼                     │     │
│   │ [PC1]   [PC2]                     [PC3]   [PC4]                   │     │
│   │                                                                   │     │
│   │   PC1 broadcast → только PC2 слышит                              │     │
│   │   PC3 broadcast → только PC4 слышит                              │     │
│   │                                                                   │     │
│   │   Изоляция: меньше шума, лучше безопасность                      │     │
│   │                                                                   │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   ПРАВИЛО:                                                                  │
│   • Switch НЕ разделяет broadcast domains                                   │
│   • Router/L3 Switch РАЗДЕЛЯЕТ broadcast domains                            │
│   • VLAN = логическое разделение на одном физическом switch                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Модель 5: CAM table как "память почтальона"

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                  CAM TABLE = ПАМЯТЬ ПОЧТАЛЬОНА                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Switch как почтальон, который УЧИТСЯ:                                     │
│                                                                             │
│   ┌───────────────────────────────────────────────────────────────────┐     │
│   │                                                                   │     │
│   │   День 1: Новый почтальон, записная книжка пуста                  │     │
│   │                                                                   │     │
│   │   ┌────────────────────────┬────────────────┬─────────────┐       │     │
│   │   │ MAC Address            │ Port           │ Timer       │       │     │
│   │   ├────────────────────────┼────────────────┼─────────────┤       │     │
│   │   │        (пусто)         │                │             │       │     │
│   │   └────────────────────────┴────────────────┴─────────────┘       │     │
│   │                                                                   │     │
│   │   Получил письмо от AA:BB:CC:DD:EE:FF на порту 1                  │     │
│   │   → Записал: "AA:BB... живёт в порту 1, запомню на 5 минут"       │     │
│   │                                                                   │     │
│   │   Куда доставить? Получатель 11:22:33:44:55:66                    │     │
│   │   → Не знаю! Flood на все порты (кроме 1)                         │     │
│   │   → Кто-то ответил с порта 3 → записал!                           │     │
│   │                                                                   │     │
│   │   ┌────────────────────────┬────────────────┬─────────────┐       │     │
│   │   │ MAC Address            │ Port           │ Timer       │       │     │
│   │   ├────────────────────────┼────────────────┼─────────────┤       │     │
│   │   │ AA:BB:CC:DD:EE:FF      │ Port 1         │ 300 sec     │       │     │
│   │   │ 11:22:33:44:55:66      │ Port 3         │ 300 sec     │       │     │
│   │   └────────────────────────┴────────────────┴─────────────┘       │     │
│   │                                                                   │     │
│   │   Теперь письма между ними идут НАПРЯМУЮ!                         │     │
│   │                                                                   │     │
│   └───────────────────────────────────────────────────────────────────┘     │
│                                                                             │
│   AGING (старение):                                                         │
│   • Если MAC не виден 5 минут → удаляется из таблицы                        │
│   • Защита от переполнения памяти                                           │
│   • При следующем пакете — выучится заново                                  │
│                                                                             │
│   CAM TABLE OVERFLOW ATTACK:                                                │
│   • Атакующий отправляет миллионы фейковых MAC                              │
│   • Таблица переполняется                                                   │
│   • Switch начинает flood ВСЁ (как hub)                                     │
│   • Решение: port security, ограничение MAC на порт                         │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Зачем это нужно

**Для разработчика:** Понимание L1/L2 помогает диагностировать "сеть не работает" — 40% сетевых проблем находятся на нижних уровнях (кабель, VLAN, WiFi interference).

**Практические ситуации:**
- Приложение работает на 10.0.0.x, но не на 192.168.x.x → VLAN изоляция
- Пинг есть, но приложение не подключается → MTU mismatch
- WiFi работает, но latency скачет → channel congestion
- Порт "вроде подключён", но данные не идут → duplex mismatch

**Что вы узнаете:**
1. MAC-адреса: структура, unicast/broadcast/multicast
2. Ethernet: кадры, стандарты (1G/10G/100G), MTU
3. VLAN: изоляция трафика, trunk ports, 802.1Q
4. Коммутация: CAM table, STP, broadcast domains
5. WiFi: стандарты (WiFi 6/7), CSMA/CA, безопасность (WPA2/WPA3)
6. Кабели: UTP categories, fiber (SMF/MMF)

---

## Обзор

Нижние уровни модели OSI отвечают за физическую передачу данных:

- **Физический уровень (L1)** — передача битов по среде (кабель, радио, оптика)
- **Канальный уровень (L2)** — кадры, MAC-адреса, доступ к среде

```
┌─────────────────────────────────────────────────────────────────┐
│                    Lower Layer Overview                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Layer 3 (Network)                                              │
│       │  IP Packets                                             │
│       ▼                                                         │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  Layer 2 (Data Link)                                        ││
│  │                                                             ││
│  │  ┌──────────────┐  ┌──────────────┐                         ││
│  │  │     LLC      │  │     MAC      │                         ││
│  │  │(Logical Link │  │ (Media Access│                         ││
│  │  │   Control)   │  │   Control)   │                         ││
│  │  └──────────────┘  └──────────────┘                         ││
│  │                                                             ││
│  │  • Framing (инкапсуляция в кадры)                           ││
│  │  • MAC addressing (физические адреса)                       ││
│  │  • Error detection (CRC)                                    ││
│  │  • Flow control                                             ││
│  │                                                             ││
│  └─────────────────────────────────────────────────────────────┘│
│       │  Frames                                                 │
│       ▼                                                         │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  Layer 1 (Physical)                                         ││
│  │                                                             ││
│  │  • Electrical signals (copper)                              ││
│  │  • Light pulses (fiber)                                     ││
│  │  • Radio waves (wireless)                                   ││
│  │  • Encoding (Manchester, 4B/5B, 8B/10B)                     ││
│  │  • Bit timing, synchronization                              ││
│  │                                                             ││
│  └─────────────────────────────────────────────────────────────┘│
│       │  Bits                                                   │
│       ▼                                                         │
│     Physical Medium (cable, air, fiber)                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## MAC-адреса

### Структура

MAC (Media Access Control) адрес — уникальный идентификатор сетевого интерфейса.

```
┌─────────────────────────────────────────────────────────────────┐
│                    MAC Address Format                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  48 бит (6 байт), записывается в hex:                           │
│                                                                 │
│  00:1A:2B:3C:4D:5E  или  00-1A-2B-3C-4D-5E  или  001A.2B3C.4D5E │
│                                                                 │
│  Структура:                                                     │
│  ┌────────────────────────┬────────────────────────┐            │
│  │        OUI             │        NIC             │            │
│  │  (Organizationally     │  (Network Interface    │            │
│  │   Unique Identifier)   │   Controller specific) │            │
│  │      24 bits           │       24 bits          │            │
│  └────────────────────────┴────────────────────────┘            │
│  │                                                  │           │
│  00:1A:2B                 :   3C:4D:5E                          │
│  Производитель               Уникальный номер                   │
│  (назначается IEEE)          (назначается производителем)       │
│                                                                 │
│  Специальные биты в первом октете:                              │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                                                           │  │
│  │  Бит 0 (LSB): Unicast (0) vs Multicast (1)                │  │
│  │  Бит 1: Globally unique (0) vs Locally administered (1)   │  │
│  │                                                           │  │
│  │  00:xx:xx = Unicast, globally unique (обычный MAC)        │  │
│  │  01:xx:xx = Multicast                                     │  │
│  │  02:xx:xx = Unicast, locally administered                 │  │
│  │  FF:FF:FF:FF:FF:FF = Broadcast (все устройства)           │  │
│  │                                                           │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  Примеры OUI:                                                   │
│  ┌────────────────┬────────────────────────────────────────────┐│
│  │ 00:00:0C       │ Cisco                                      ││
│  │ 00:50:56       │ VMware                                     ││
│  │ 08:00:27       │ VirtualBox                                 ││
│  │ DC:A6:32       │ Raspberry Pi                               ││
│  │ 00:1A:11       │ Google                                     ││
│  │ 3C:22:FB       │ Apple                                      ││
│  └────────────────┴────────────────────────────────────────────┘│
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Типы адресов

```
┌─────────────────────────────────────────────────────────────────┐
│                    MAC Address Types                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Unicast (одному получателю)                                    │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                                                           │  │
│  │  Sender ────────────────────────────────────> Receiver    │  │
│  │         00:1A:2B:3C:4D:5E                                 │  │
│  │                                                           │  │
│  │  Бит 0 первого октета = 0                                 │  │
│  │                                                           │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  Broadcast (всем в сегменте)                                    │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                                                           │  │
│  │  Sender ─────┬────────────────────> Device 1              │  │
│  │              ├────────────────────> Device 2              │  │
│  │              └────────────────────> Device 3              │  │
│  │         FF:FF:FF:FF:FF:FF                                 │  │
│  │                                                           │  │
│  │  Все устройства в L2 домене получают кадр                 │  │
│  │  Используется для ARP, DHCP discover                      │  │
│  │                                                           │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  Multicast (группе получателей)                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                                                           │  │
│  │  Sender ─────┬────────────────────> Subscribed 1          │  │
│  │              └────────────────────> Subscribed 2          │  │
│  │                      ✗             Not subscribed         │  │
│  │         01:00:5E:xx:xx:xx (IPv4 multicast)                │  │
│  │         33:33:xx:xx:xx:xx (IPv6 multicast)                │  │
│  │                                                           │  │
│  │  Бит 0 первого октета = 1                                 │  │
│  │  Используется для OSPF, VRRP, mDNS                        │  │
│  │                                                           │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Ethernet

### История и стандарты

```
┌─────────────────────────────────────────────────────────────────┐
│                   Ethernet Evolution                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┬────────────┬──────────────┬──────────────────┐│
│  │ Standard     │ Speed      │ Cable        │ Max Distance     ││
│  ├──────────────┼────────────┼──────────────┼──────────────────┤│
│  │ 10BASE-T     │ 10 Mbps    │ Cat3 UTP     │ 100m             ││
│  │ 100BASE-TX   │ 100 Mbps   │ Cat5 UTP     │ 100m             ││
│  │ 1000BASE-T   │ 1 Gbps     │ Cat5e/Cat6   │ 100m             ││
│  │ 2.5GBASE-T   │ 2.5 Gbps   │ Cat5e/Cat6   │ 100m             ││
│  │ 5GBASE-T     │ 5 Gbps     │ Cat6         │ 100m             ││
│  │ 10GBASE-T    │ 10 Gbps    │ Cat6a/Cat7   │ 100m             ││
│  │ 25GBASE-T    │ 25 Gbps    │ Cat8         │ 30m              ││
│  │ 40GBASE-T    │ 40 Gbps    │ Cat8         │ 30m              ││
│  │──────────────┼────────────┼──────────────┼──────────────────┤│
│  │ 1000BASE-SX  │ 1 Gbps     │ MMF fiber    │ 550m             ││
│  │ 1000BASE-LX  │ 1 Gbps     │ SMF fiber    │ 5km              ││
│  │ 10GBASE-SR   │ 10 Gbps    │ MMF fiber    │ 400m             ││
│  │ 10GBASE-LR   │ 10 Gbps    │ SMF fiber    │ 10km             ││
│  │ 100GBASE-SR4 │ 100 Gbps   │ MMF fiber    │ 100m             ││
│  │ 400GBASE-SR8 │ 400 Gbps   │ MMF fiber    │ 100m             ││
│  └──────────────┴────────────┴──────────────┴──────────────────┘│
│                                                                 │
│  UTP = Unshielded Twisted Pair                                  │
│  MMF = Multi-Mode Fiber                                         │
│  SMF = Single-Mode Fiber                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Структура Ethernet-кадра

```
┌─────────────────────────────────────────────────────────────────┐
│                   Ethernet Frame Format                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  IEEE 802.3 Ethernet II Frame:                                  │
│                                                                 │
│  ┌─────────┬────────┬─────────┬─────────┬──────────┬──────────┐ │
│  │Preamble │  SFD   │  Dest   │ Source  │  Type/   │  Payload │ │
│  │         │        │  MAC    │  MAC    │  Length  │  (Data)  │ │
│  │ 7 bytes │1 byte  │6 bytes  │6 bytes  │ 2 bytes  │46-1500 B │ │
│  └─────────┴────────┴─────────┴─────────┴──────────┴──────────┘ │
│  │         │        │         │         │          │          │ │
│  │         │        │         │         │          └──────┐   │ │
│  │         │        │         │         │                 │   │ │
│  │         │        │         │         │          ┌──────┴───┐│ │
│  │         │        │         │         │          │   FCS    ││ │
│  │         │        │         │         │          │ 4 bytes  ││ │
│  │         │        │         │         │          │  (CRC32) ││ │
│  │         │        │         │         │          └──────────┘│ │
│                                                                 │
│  Preamble (7 bytes): 10101010... для синхронизации              │
│  SFD (1 byte): 10101011 — Start Frame Delimiter                 │
│  Destination MAC (6 bytes): адрес получателя                    │
│  Source MAC (6 bytes): адрес отправителя                        │
│  Type/Length (2 bytes):                                         │
│    • > 1536 (0x0600): EtherType                                 │
│    • ≤ 1500: Length (802.3)                                     │
│  Payload (46-1500 bytes): данные + padding если < 46            │
│  FCS (4 bytes): Frame Check Sequence (CRC-32)                   │
│                                                                 │
│  Common EtherTypes:                                             │
│  ┌──────────┬───────────────────────────────────────────────┐   │
│  │ 0x0800   │ IPv4                                          │   │
│  │ 0x0806   │ ARP                                           │   │
│  │ 0x86DD   │ IPv6                                          │   │
│  │ 0x8100   │ VLAN tagged frame (802.1Q)                    │   │
│  │ 0x88CC   │ LLDP                                          │   │
│  └──────────┴───────────────────────────────────────────────┘   │
│                                                                 │
│  MTU (Maximum Transmission Unit):                               │
│  • Standard: 1500 bytes (payload)                               │
│  • Jumbo frames: до 9000 bytes                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### VLAN (802.1Q)

```
┌─────────────────────────────────────────────────────────────────┐
│                        VLAN Tagging                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  VLAN позволяет разделить физическую сеть на логические:        │
│                                                                 │
│  Без VLAN:                                                      │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                       Switch                                ││
│  │  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐                  ││
│  │  │PC A│ │PC B│ │PC C│ │PC D│ │PC E│ │PC F│                  ││
│  │  └────┘ └────┘ └────┘ └────┘ └────┘ └────┘                  ││
│  │  Все устройства в одном broadcast домене                    ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                 │
│  С VLAN:                                                        │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                       Switch                                ││
│  │  ┌─────────────────────┐  ┌─────────────────────┐           ││
│  │  │      VLAN 10        │  │      VLAN 20        │           ││
│  │  │  ┌────┐ ┌────┐ ┌────┐  │  ┌────┐ ┌────┐ ┌────┐           ││
│  │  │  │PC A│ │PC B│ │PC C│  │  │PC D│ │PC E│ │PC F│           ││
│  │  │  └────┘ └────┘ └────┘  │  └────┘ └────┘ └────┘           ││
│  │  └─────────────────────┘  └─────────────────────┘           ││
│  │  Изолированные broadcast домены                             ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                 │
│  802.1Q Tag (4 bytes):                                          │
│  ┌─────────┬─────────┬───────────────┐                          │
│  │  TPID   │   TCI   │               │                          │
│  │(2 bytes)│(2 bytes)│               │                          │
│  │ 0x8100  │         │               │                          │
│  └─────────┼─────────┴───────────────┘                          │
│            │                                                    │
│            ├─ PCP (3 bits): Priority (QoS)                      │
│            ├─ DEI (1 bit): Drop Eligible                        │
│            └─ VID (12 bits): VLAN ID (0-4095)                   │
│               • 0: Priority tagged                              │
│               • 1: Default VLAN                                 │
│               • 2-4094: User VLANs                              │
│               • 4095: Reserved                                  │
│                                                                 │
│  Tagged Frame:                                                  │
│  ┌──────┬──────┬──────────┬──────┬─────────┬─────┐              │
│  │ Dest │ Src  │ 802.1Q   │Type/ │ Payload │ FCS │              │
│  │ MAC  │ MAC  │   Tag    │Length│         │     │              │
│  └──────┴──────┴──────────┴──────┴─────────┴─────┘              │
│                                                                 │
│  Port Types:                                                    │
│  • Access port: один VLAN, untagged frames                      │
│  • Trunk port: несколько VLAN, tagged frames                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Коммутация (Switching)

### Как работает Switch

```
┌─────────────────────────────────────────────────────────────────┐
│                   Switch Operation                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Switch строит MAC Address Table (CAM table):                   │
│                                                                 │
│  ┌────────────────────────┬────────────────┐                    │
│  │ MAC Address            │ Port           │                    │
│  ├────────────────────────┼────────────────┤                    │
│  │ 00:1A:2B:3C:4D:5E      │ Port 1         │                    │
│  │ AA:BB:CC:DD:EE:FF      │ Port 3         │                    │
│  │ 11:22:33:44:55:66      │ Port 5         │                    │
│  └────────────────────────┴────────────────┘                    │
│                                                                 │
│  Алгоритм обработки кадра:                                      │
│                                                                 │
│  1. Frame arrives on port                                       │
│     │                                                           │
│     ▼                                                           │
│  2. Learn: Add source MAC + port to table                       │
│     │                                                           │
│     ▼                                                           │
│  3. Look up destination MAC in table                            │
│     │                                                           │
│     ├──> Found: Forward to specific port (unicast)              │
│     │                                                           │
│     └──> Not found: Flood to all ports except source            │
│          (unknown unicast flooding)                             │
│                                                                 │
│  Broadcast/Multicast: всегда flood на все порты VLAN            │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  Store-and-Forward vs Cut-Through:                              │
│                                                                 │
│  Store-and-Forward:                                             │
│  • Получить весь кадр                                           │
│  • Проверить FCS (CRC)                                          │
│  • Если OK — отправить                                          │
│  • Выше latency, но надёжнее                                    │
│                                                                 │
│  Cut-Through:                                                   │
│  • Начать отправку после получения destination MAC              │
│  • Не проверяет FCS                                             │
│  • Ниже latency, но может передать битые кадры                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### STP (Spanning Tree Protocol)

```
┌─────────────────────────────────────────────────────────────────┐
│                 Spanning Tree Protocol                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Проблема: петли в сети L2 → broadcast storm                    │
│                                                                 │
│  Без STP:                                                       │
│  ┌─────────┐           ┌─────────┐                              │
│  │Switch A │───────────│Switch B │                              │
│  └────┬────┘           └────┬────┘                              │
│       │                     │                                   │
│       │    ┌─────────┐      │                                   │
│       └────│Switch C │──────┘   ← Петля!                        │
│            └─────────┘                                          │
│                                                                 │
│  Broadcast будет бесконечно циркулировать                       │
│                                                                 │
│  STP решение:                                                   │
│  1. Выбрать Root Bridge (lowest Bridge ID)                      │
│  2. Каждый switch определяет Root Port (ближайший к root)       │
│  3. Каждый сегмент определяет Designated Port                   │
│  4. Остальные порты — Blocked (не передают data frames)         │
│                                                                 │
│  С STP:                                                         │
│  ┌─────────┐           ┌─────────┐                              │
│  │Switch A │───────────│Switch B │                              │
│  │ (Root)  │    DP     │   RP    │                              │
│  └────┬────┘           └────┬────┘                              │
│       │ DP                  │ DP                                │
│       │    ┌─────────┐      │                                   │
│       └────│Switch C │──────┘                                   │
│            │RP    BLK│  ← Заблокирован!                         │
│            └─────────┘                                          │
│                                                                 │
│  Port States:                                                   │
│  • Blocking: не передаёт данные, слушает BPDU                   │
│  • Listening: готовится к forwarding                            │
│  • Learning: учит MAC адреса, не передаёт данные                │
│  • Forwarding: нормальная работа                                │
│  • Disabled: административно выключен                           │
│                                                                 │
│  Современные версии:                                            │
│  • RSTP (Rapid STP, 802.1w): сходимость за секунды              │
│  • MSTP (Multiple STP, 802.1s): разные деревья для разных VLAN  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## WiFi (802.11)

### Стандарты WiFi

```
┌─────────────────────────────────────────────────────────────────┐
│                     WiFi Standards                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┬───────────┬──────────────┬───────────────────┐│
│  │ Standard     │ Name      │ Max Speed    │ Frequency         ││
│  ├──────────────┼───────────┼──────────────┼───────────────────┤│
│  │ 802.11b      │ —         │ 11 Mbps      │ 2.4 GHz           ││
│  │ 802.11a      │ —         │ 54 Mbps      │ 5 GHz             ││
│  │ 802.11g      │ —         │ 54 Mbps      │ 2.4 GHz           ││
│  │ 802.11n      │ WiFi 4    │ 600 Mbps     │ 2.4/5 GHz         ││
│  │ 802.11ac     │ WiFi 5    │ 6.9 Gbps     │ 5 GHz             ││
│  │ 802.11ax     │ WiFi 6    │ 9.6 Gbps     │ 2.4/5 GHz         ││
│  │ 802.11ax     │ WiFi 6E   │ 9.6 Gbps     │ 2.4/5/6 GHz       ││
│  │ 802.11be     │ WiFi 7    │ 46 Gbps      │ 2.4/5/6 GHz       ││
│  └──────────────┴───────────┴──────────────┴───────────────────┘│
│                                                                 │
│  Ключевые технологии:                                           │
│                                                                 │
│  MIMO (Multiple Input Multiple Output):                         │
│  • Несколько антенн для параллельной передачи                   │
│  • 4x4 MIMO = 4 потока одновременно                             │
│                                                                 │
│  MU-MIMO (Multi-User MIMO):                                     │
│  • Обслуживание нескольких клиентов одновременно                │
│  • WiFi 5: только downlink, WiFi 6: uplink + downlink           │
│                                                                 │
│  OFDMA (WiFi 6):                                                │
│  • Разделение канала на подканалы для разных клиентов           │
│  • Снижает latency в dense environments                         │
│                                                                 │
│  Channel Bonding:                                               │
│  • 20 MHz (базовый), 40 MHz, 80 MHz, 160 MHz                    │
│  • Шире канал = больше throughput                               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### WiFi кадр

```
┌─────────────────────────────────────────────────────────────────┐
│                    802.11 Frame Format                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────┬─────────┬─────────┬─────────┬─────────┬──────────┐ │
│  │ Frame   │Duration/│Address 1│Address 2│Address 3│ Seq      │ │
│  │ Control │   ID    │ (DA)    │ (SA)    │ (BSSID) │ Control  │ │
│  │ 2 bytes │ 2 bytes │ 6 bytes │ 6 bytes │ 6 bytes │ 2 bytes  │ │
│  └─────────┴─────────┴─────────┴─────────┴─────────┴──────────┘ │
│  ┌─────────┬──────────────────────────────┬────────┐            │
│  │Address 4│           Body               │  FCS   │            │
│  │ 6 bytes │        0-2304 bytes          │4 bytes │            │
│  │(optional)│                              │        │            │
│  └─────────┴──────────────────────────────┴────────┘            │
│                                                                 │
│  Address fields (зависят от To DS / From DS битов):             │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ To DS │ From DS │ Address 1 │ Address 2 │ Address 3         ││
│  ├───────┼─────────┼───────────┼───────────┼───────────────────┤│
│  │   0   │    0    │ DA        │ SA        │ BSSID   (ad-hoc)  ││
│  │   0   │    1    │ DA        │ BSSID     │ SA      (from AP) ││
│  │   1   │    0    │ BSSID     │ SA        │ DA      (to AP)   ││
│  │   1   │    1    │ RA        │ TA        │ DA      (WDS)     ││
│  └───────┴─────────┴───────────┴───────────┴───────────────────┘│
│                                                                 │
│  DA = Destination Address                                       │
│  SA = Source Address                                            │
│  BSSID = Basic Service Set ID (обычно MAC точки доступа)        │
│  RA = Receiver Address                                          │
│  TA = Transmitter Address                                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Механизм доступа к среде (CSMA/CA)

```
┌─────────────────────────────────────────────────────────────────┐
│               CSMA/CA (Carrier Sense Multiple Access            │
│                  with Collision Avoidance)                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  WiFi использует CSMA/CA, так как коллизии нельзя обнаружить    │
│  (в отличие от Ethernet CSMA/CD)                                │
│                                                                 │
│  Базовый алгоритм:                                              │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                                                          │   │
│  │  1. Станция хочет передать                               │   │
│  │            │                                             │   │
│  │            ▼                                             │   │
│  │  2. Слушает канал (Carrier Sense)                        │   │
│  │            │                                             │   │
│  │     ┌──────┴──────┐                                      │   │
│  │     │             │                                      │   │
│  │   Busy         Idle                                      │   │
│  │     │             │                                      │   │
│  │     ▼             ▼                                      │   │
│  │  Wait          3. Ждать DIFS (DCF Interframe Space)      │   │
│  │     │             │                                      │   │
│  │     │             ▼                                      │   │
│  │     │          4. Случайный backoff (0 to CW)            │   │
│  │     │             │                                      │   │
│  │     │             ▼                                      │   │
│  │     │          5. Передать кадр                          │   │
│  │     │             │                                      │   │
│  │     │             ▼                                      │   │
│  │     │          6. Ждать ACK                              │   │
│  │     │             │                                      │   │
│  │     │      ┌──────┴──────┐                               │   │
│  │     │      │             │                               │   │
│  │     │   No ACK       ACK received                        │   │
│  │     │      │             │                               │   │
│  │     │      ▼             ▼                               │   │
│  │     └──> Retry        Done                               │   │
│  │         (increase CW)                                    │   │
│  │                                                          │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
│  DIFS = DCF Interframe Space (приоритет обычного трафика)       │
│  SIFS = Short IFS (для ACK, высший приоритет)                   │
│  CW = Contention Window (окно случайного ожидания)              │
│                                                                 │
│  RTS/CTS (опционально, для скрытых узлов):                      │
│                                                                 │
│  Station A         AP          Station B                        │
│      │             │              │                             │
│      │──RTS──────>│              │                              │
│      │             │──CTS──────>│                               │
│      │<───CTS─────│              │  (B knows to wait)           │
│      │══DATA═════>│              │                              │
│      │<───ACK─────│              │                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Безопасность WiFi

```
┌─────────────────────────────────────────────────────────────────┐
│                    WiFi Security                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Эволюция безопасности:                                         │
│                                                                 │
│  WEP (Wired Equivalent Privacy) — УСТАРЕЛ                       │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │ • RC4 encryption, 40/104-bit keys                         │  │
│  │ • Взламывается за минуты                                  │  │
│  │ • НИКОГДА не использовать                                 │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  WPA (WiFi Protected Access) — УСТАРЕЛ                          │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │ • TKIP (Temporal Key Integrity Protocol)                  │  │
│  │ • Переходный стандарт после WEP                           │  │
│  │ • Уязвим к атакам                                         │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  WPA2 (802.11i) — минимально приемлемый                         │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │ • AES-CCMP encryption (обязательный)                      │  │
│  │ • Personal (PSK) или Enterprise (802.1X/RADIUS)           │  │
│  │ • Уязвим к KRACK атаке (требует патчи)                    │  │
│  │ • Уязвим к offline dictionary attack на PSK               │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  WPA3 — рекомендуемый                                           │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │ • SAE (Simultaneous Authentication of Equals)             │  │
│  │   → Защита от offline dictionary attacks                  │  │
│  │ • Forward secrecy (прошлый трафик нельзя расшифровать)    │  │
│  │ • 192-bit security mode для Enterprise                    │  │
│  │ • PMF (Protected Management Frames) обязателен            │  │
│  │ • Easy Connect (QR codes для IoT)                         │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  Режимы аутентификации:                                         │
│                                                                 │
│  Personal (PSK):                                                │
│  • Общий пароль для всех                                        │
│  • Простая настройка                                            │
│  • Для дома и малого бизнеса                                    │
│                                                                 │
│  Enterprise (802.1X):                                           │
│  • Индивидуальные учётные записи                                │
│  • RADIUS сервер                                                │
│  • EAP методы (EAP-TLS, PEAP, EAP-TTLS)                         │
│  • Для организаций                                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Кабельная инфраструктура

### Витая пара (Twisted Pair)

```
┌─────────────────────────────────────────────────────────────────┐
│                   Twisted Pair Categories                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────┬────────────┬────────────────┬────────────────────┐│
│  │ Category │ Bandwidth  │ Max Speed      │ Use Case           ││
│  ├──────────┼────────────┼────────────────┼────────────────────┤│
│  │ Cat 5    │ 100 MHz    │ 100 Mbps       │ Legacy             ││
│  │ Cat 5e   │ 100 MHz    │ 1 Gbps         │ Still common       ││
│  │ Cat 6    │ 250 MHz    │ 10 Gbps (55m)  │ Modern standard    ││
│  │ Cat 6a   │ 500 MHz    │ 10 Gbps (100m) │ Data centers       ││
│  │ Cat 7    │ 600 MHz    │ 10 Gbps        │ Shielded           ││
│  │ Cat 8    │ 2000 MHz   │ 40 Gbps (30m)  │ Data centers       ││
│  └──────────┴────────────┴────────────────┴────────────────────┘│
│                                                                 │
│  Типы экранирования:                                            │
│  • UTP (Unshielded Twisted Pair) — без экрана                   │
│  • FTP (Foiled TP) — общий экран из фольги                      │
│  • STP (Shielded TP) — экран на каждой паре                     │
│  • S/FTP — и общий экран, и на каждой паре                      │
│                                                                 │
│  Расположение пар в разъёме (T568B):                            │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  Pin 1: White/Orange                                     │   │
│  │  Pin 2: Orange                                           │   │
│  │  Pin 3: White/Green                                      │   │
│  │  Pin 4: Blue                                             │   │
│  │  Pin 5: White/Blue                                       │   │
│  │  Pin 6: Green                                            │   │
│  │  Pin 7: White/Brown                                      │   │
│  │  Pin 8: Brown                                            │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
│  • Straight-through: оба конца одинаковые (T568B-T568B)         │
│  • Crossover: разные (T568A-T568B) — для прямого PC-PC          │
│    (современные устройства имеют Auto-MDI/MDIX)                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Оптоволокно (Fiber Optic)

```
┌─────────────────────────────────────────────────────────────────┐
│                      Fiber Optic Types                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Single-Mode Fiber (SMF)                                        │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                                                           │  │
│  │  Core diameter: 8-10 μm                                   │  │
│  │  Один луч света (один mode)                               │  │
│  │  Дальность: до 100+ км                                    │  │
│  │  Использует лазерный источник                             │  │
│  │  Дороже, но лучше для дальних расстояний                  │  │
│  │                                                           │  │
│  │      ═══════════════════════════════════►                 │  │
│  │           (один прямой луч)                               │  │
│  │                                                           │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  Multi-Mode Fiber (MMF)                                         │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                                                           │  │
│  │  Core diameter: 50 или 62.5 μm                            │  │
│  │  Несколько лучей (modes)                                  │  │
│  │  Дальность: до 550м (OM4) при 10G                         │  │
│  │  Использует LED или VCSEL                                 │  │
│  │  Дешевле, для коротких расстояний (здания, ЦОД)           │  │
│  │                                                           │  │
│  │      ═══╲═══╱═══╲═══╱═══╲═══►                             │  │
│  │           (несколько лучей, отражение)                    │  │
│  │                                                           │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  MMF Classifications:                                           │
│  ┌──────────┬────────────────┬────────────────────────────────┐ │
│  │ Type     │ Core/Cladding  │ 10G Distance                   │ │
│  ├──────────┼────────────────┼────────────────────────────────┤ │
│  │ OM1      │ 62.5/125 μm    │ 33m                            │ │
│  │ OM2      │ 50/125 μm      │ 82m                            │ │
│  │ OM3      │ 50/125 μm      │ 300m (laser optimized)         │ │
│  │ OM4      │ 50/125 μm      │ 400m                           │ │
│  │ OM5      │ 50/125 μm      │ 400m (wideband, 400G ready)    │ │
│  └──────────┴────────────────┴────────────────────────────────┘ │
│                                                                 │
│  Connectors:                                                    │
│  • LC (Lucent Connector) — маленький, популярный                │
│  • SC (Subscriber Connector) — квадратный, push-pull            │
│  • ST (Straight Tip) — bayonet style, устаревший                │
│  • MPO/MTP — multi-fiber (12/24 волокна), для 40G/100G/400G     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Практические команды

### Диагностика L2

```bash
# MAC адрес интерфейса
ip link show                    # Linux
ifconfig                        # macOS

# ARP table
ip neigh show                   # Linux
arp -a                          # macOS/Windows

# Bridge/switch table (Linux bridge)
bridge fdb show

# VLAN info (Linux)
ip -d link show
cat /proc/net/vlan/config

# WiFi info (Linux)
iwconfig
iw dev wlan0 info
iw dev wlan0 scan               # Scan networks

# WiFi info (macOS)
/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -I
/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -s

# Cable testing
ethtool eth0                    # Speed, duplex, link status
ethtool -p eth0                 # Blink LED
mii-tool eth0                   # Legacy

# Network interfaces statistics
ip -s link show eth0
netstat -i
```

### Настройка VLAN (Linux)

```bash
# Создать VLAN интерфейс
ip link add link eth0 name eth0.100 type vlan id 100
ip link set eth0.100 up
ip addr add 192.168.100.1/24 dev eth0.100

# Или через vconfig (legacy)
vconfig add eth0 100

# Проверить
cat /proc/net/vlan/eth0.100
```

### WiFi из командной строки (Linux)

```bash
# Подключение к WPA2 сети
wpa_passphrase "SSID" "password" | sudo tee /etc/wpa_supplicant.conf
sudo wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant.conf
sudo dhclient wlan0

# NetworkManager
nmcli device wifi list
nmcli device wifi connect "SSID" password "password"
nmcli connection show
```

---

## Связанные темы

- [[networking-overview]] — обзор сетевых моделей
- [[network-ip-routing]] — IP-адресация и маршрутизация
- [[network-dns-tls]] — DNS и TLS
- [[network-cloud-modern]] — SDN, Service Mesh
- [[os-networking]] — сетевой стек ОС

---

## Источники

- [IEEE 802.3 Ethernet Standard](https://standards.ieee.org/standard/802_3-2018.html)
- [IEEE 802.11 WiFi Standards](https://standards.ieee.org/standard/802_11-2020.html)
- [WiFi Alliance](https://www.wi-fi.org/)
- [TIA/EIA Cabling Standards](https://www.tiaonline.org/)

---

## Связь с другими темами

**[[networking-overview]]** — Обзор сетевых технологий показывает место физического и канального уровней (L1/L2) в модели OSI и TCP/IP. Ethernet, WiFi и MAC-адресация — это фундамент, на котором строятся все вышестоящие протоколы. Без понимания того, как биты превращаются в кадры и как коммутаторы обеспечивают доставку внутри сегмента, невозможно осознать, зачем нужна IP-маршрутизация на L3. Начните с обзора для понимания общей картины.

**[[network-ip-routing]]** — IP-маршрутизация (L3) является прямым продолжением канального уровня (L2): если L2-коммутация доставляет кадры внутри одного сегмента по MAC-адресам, то IP-маршрутизация обеспечивает доставку пакетов между сегментами. ARP-протокол связывает эти два уровня, преобразуя IP-адреса в MAC-адреса. Понимание физического уровня необходимо для диагностики проблем, когда пакеты теряются до того, как достигнут маршрутизатора. Изучайте L1/L2 перед L3.

**[[network-cloud-modern]]** — Облачные сети (SDN, VPC, Service Mesh) абстрагируют физический и канальный уровни, но понимание этих уровней критично для диагностики проблем производительности в облаке. VLAN, STP и jumbo frames используются в datacenter networking, а overlay-сети (VXLAN) инкапсулируют L2-кадры в UDP-пакеты для создания виртуальных сегментов поверх L3. Знание L1/L2 помогает понять, почему облачные сети имеют определённые ограничения.

---

## Источники и дальнейшее чтение

- **Tanenbaum, Wetherall (2011).** *Computer Networks.* — наиболее глубокое описание физического и канального уровней: кодирование сигналов, Ethernet, WiFi, MAC-протоколы, коммутация и VLAN; обязательный учебник для понимания L1/L2.
- **Kurose, Ross (2021).** *Computer Networking: A Top-Down Approach.* — доступное объяснение канального уровня с акцентом на Ethernet и WiFi, включая CSMA/CD и CSMA/CA; хорош для первого знакомства с темой.
- **Peterson, Davie (2011).** *Computer Networks: A Systems Approach.* — системный взгляд на физические среды передачи данных и канальные протоколы, включая современные высокоскоростные технологии (10GbE, 100GbE).

---

---

## Проверь себя

> [!question]- Почему switch эффективнее hub, и как именно switch "учится" MAC-адресам?
> Hub пересылает кадр на все порты (broadcast), создавая лишний трафик и коллизии. Switch ведёт CAM-таблицу: при получении кадра записывает source MAC и порт, откуда пришёл. При отправке ищет destination MAC в таблице --- если нашёл, отправляет только в нужный порт. Если не нашёл --- flood, но запоминает при ответе.

> [!question]- В офисе бухгалтерия и разработчики в одной сети. Бухгалтерия жалуется на медленную сеть из-за broadcast-трафика. Какое решение и почему?
> Разделить сеть на VLAN. VLAN создаёт логическую изоляцию на одном физическом оборудовании: broadcast-трафик не выходит за пределы VLAN, устройства из разных VLAN не видят друг друга без маршрутизатора (L3). Это повышает и производительность, и безопасность.

> [!question]- Чем отличается WiFi (CSMA/CA) от Ethernet (CSMA/CD) в обработке коллизий?
> Ethernet (CSMA/CD) --- обнаруживает коллизию в момент передачи и немедленно прекращает. WiFi (CSMA/CA) --- не может обнаружить коллизию во время передачи (из-за радио), поэтому старается её избежать: слушает эфир, ждёт случайный backoff, и использует RTS/CTS для резервирования канала.

> [!question]- Что произойдёт с пакетом размером 4000 байт при MTU 1500, и почему это важно?
> Пакет будет фрагментирован на уровне IP (3 фрагмента) или отброшен, если стоит флаг DF (Don't Fragment). Фрагментация снижает производительность и увеличивает вероятность потери. В современных сетях используют PMTUD для определения минимального MTU на пути и избегают фрагментации.

---

## Ключевые карточки

Что такое MAC-адрес и чем он отличается от IP?
?
MAC-адрес --- 48-битный физический идентификатор сетевой карты (00:1A:2B:3C:4D:5E), прошитый производителем. IP --- логический адрес, назначаемый в сети. MAC работает на L2 (локальная сеть), IP на L3 (маршрутизация между сетями).

Что такое VLAN и зачем он нужен?
?
VLAN --- виртуальная изоляция сети на одном физическом оборудовании. Создаёт логически отдельные широковещательные домены. Повышает безопасность (изоляция), производительность (меньше broadcast) и управляемость.

Чем отличаются access и trunk порты?
?
Access port --- подключение конечного устройства к одному VLAN, без тегирования. Trunk port --- соединение между коммутаторами, пропускает трафик нескольких VLAN с тегами 802.1Q (4 байта с VLAN ID).

Что такое MTU и почему его значение важно?
?
MTU (Maximum Transmission Unit) --- максимальный размер кадра на уровне L2. Стандартное значение Ethernet --- 1500 байт. Если пакет больше MTU, он фрагментируется или отбрасывается. Jumbo Frames (9000 байт) используют внутри дата-центров.

Как работает ARP?
?
ARP (Address Resolution Protocol) переводит IP-адрес в MAC-адрес в локальной сети. Отправляет broadcast "кто имеет IP X?" (FF:FF:FF:FF:FF:FF), владелец IP отвечает unicast со своим MAC. Результат кэшируется в ARP-таблице.

Чем отличаются unicast, broadcast и multicast на L2?
?
Unicast --- одному конкретному MAC-адресу. Broadcast (FF:FF:FF:FF:FF:FF) --- всем устройствам в сегменте. Multicast (01:xx:xx:xx:xx:xx) --- группе подписчиков. Switch пересылает broadcast на все порты, unicast --- только на порт получателя.

Почему WiFi медленнее Ethernet при одинаковой номинальной скорости?
?
WiFi --- shared medium (все устройства делят канал), half-duplex (нельзя передавать и принимать одновременно), подвержен интерференции, использует CSMA/CA с overhead. Ethernet --- полный duplex, выделенные линии, CSMA/CD только для устаревших hub-сетей.

---

## Куда дальше

| Направление | Куда | Зачем |
|-------------|------|-------|
| Следующий шаг | [[network-ip-routing]] | Перейти на сетевой уровень: IP, маршрутизация, NAT |
| Углубиться | [[network-docker-deep-dive]] | Как L2 концепции используются в контейнерных сетях |
| Смежная тема | [[network-wireless-iot]] | Беспроводные протоколы IoT: Zigbee, Thread, LoRa |
| Обзор | [[networking-overview]] | Вернуться к карте раздела |

---

*Последнее обновление: 2026-01-09 --- Добавлены педагогические секции: 5 аналогий (MAC-паспорт, Switch-почтальон, VLAN-подъезды, WiFi CSMA/CA, Ethernet-конверт), 6 типичных ошибок L1/L2 уровня, 5 ментальных моделей для понимания физической сети*
