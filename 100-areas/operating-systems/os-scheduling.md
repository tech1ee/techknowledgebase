---
title: "ะะปะฐะฝะธัะพะฒะฐะฝะธะต ะฟัะพัะตััะพะฒ: ะบะฐะบ ะะก ัะฐัะฟัะตะดะตะปัะตั CPU"
created: 2025-12-02
modified: 2025-12-02
type: deep-dive
status: published
area: operating-systems
confidence: high
tags:
  - topic/os
  - scheduling
  - cpu
  - concurrency
  - type/deep-dive
  - level/intermediate
related:
  - "[[os-overview]]"
  - "[[os-processes-threads]]"
  - "[[os-synchronization]]"
  - "[[jvm-executors-futures]]"
prerequisites:
  - "[[os-processes-threads]]"
---

# ะะปะฐะฝะธัะพะฒะฐะฝะธะต ะฟัะพัะตััะพะฒ: ะบะฐะบ ะะก ัะฐัะฟัะตะดะตะปัะตั CPU

ะะปะฐะฝะธัะพะฒัะธะบ (scheduler) โ ะบะพะผะฟะพะฝะตะฝั ัะดัะฐ, ัะตัะฐััะธะน ะบะฐะบะพะน ะฟัะพัะตัั ะฟะพะปััะธั CPU ะฒ ัะปะตะดัััะธะน ะผะพะผะตะฝั. ะะฐ ะพะดะฝะพะผ CPU ะผะพะถะตั ะฒัะฟะพะปะฝััััั ัะพะปัะบะพ ะพะดะธะฝ ะฟัะพัะตัั, ะฟะพััะพะผั ะฟะปะฐะฝะธัะพะฒัะธะบ ัะพะทะดะฐัั ะธะปะปัะทะธั ะฟะฐัะฐะปะปะตะปัะฝะพะณะพ ะฒัะฟะพะปะฝะตะฝะธั, ะฑััััะพ ะฟะตัะตะบะปััะฐััั ะผะตะถะดั ะฟัะพัะตััะฐะผะธ. ะัะฑะพั ะฐะปะณะพัะธัะผะฐ ะฟะปะฐะฝะธัะพะฒะฐะฝะธั ะพะฟัะตะดะตะปัะตั ัะฐัะฐะบัะตัะธััะธะบะธ ัะธััะตะผั: throughput, latency, fairness.

---

## TL;DR

> **ะงัะพ:** ะะปะฐะฝะธัะพะฒัะธะบ โ "ะดะธัะฟะตััะตั ะฐััะพะฟะพััะฐ", ัะตัะฐััะธะน ะบะฐะบะพะน ัะฐะผะพะปัั (ะฟัะพัะตัั) ะฒะทะปะตัะธั ัะปะตะดัััะธะผ ั ะตะดะธะฝััะฒะตะฝะฝะพะน ะฒะทะปััะฝะพะน ะฟะพะปะพัั (CPU).
>
> **ะะปะฐะฒะฝัะต ะฐะปะณะพัะธัะผั:**
> - **FIFO** โ ะบัะพ ะฟะตัะฒัะน ะฟัะธััะป, ัะพั ะธ ัะฐะฑะพัะฐะตั (ะฟัะพััะพะน, ะฝะพ convoy effect)
> - **Round Robin** โ ะบะฐะถะดะพะผั ะฟะพ 10ms, ะฟะพัะพะผ ัะปะตะดัััะธะน (fair, ะฝะพ overhead)
> - **SJF** โ ะบะพัะพัะบะธะต ะทะฐะดะฐัะธ ะฟะตัะฒัะผะธ (ะพะฟัะธะผะฐะปัะฝัะน avg wait, ะฝะพ starvation ะดะปะธะฝะฝัั)
> - **CFS (Linux)** โ "ัะฟัะฐะฒะตะดะปะธะฒัะน" scheduler ะฝะฐ ะพัะฝะพะฒะต vruntime ะฒ red-black tree
>
> **Context switch:** 1-3ยตs ะฟััะผัั ะทะฐััะฐั + 10-30ยตs ะบะพัะฒะตะฝะฝัั (TLB/cache miss).
>
> **ะะปััะตะฒะพะต:** ะกะปะธัะบะพะผ ะผะฝะพะณะพ ะฟะพัะพะบะพะฒ ะฝะฐ 4 ัะดัะฐั = overhead ะฝะฐ ะฟะตัะตะบะปััะตะฝะธะต > ะฟะพะปะตะทะฝะฐั ัะฐะฑะพัะฐ.

---

## ะงะฐััั 1: ะะฝััะธัะธั ะฑะตะท ะบะพะดะฐ

### ๐ซ ะะฝะฐะปะพะณะธั 1: ะะธัะฟะตััะตั ะฐััะพะฟะพััะฐ

**ะะปะฐะฝะธัะพะฒัะธะบ โ ััะพ ะดะธัะฟะตััะตั ะฐััะพะฟะพััะฐ** ั ะพะดะฝะพะน ะฒะทะปััะฝะพะน ะฟะพะปะพัะพะน (CPU):

- **ะกะฐะผะพะปััั (ะฟัะพัะตััั)** ะถะดัั ะฒ ะพัะตัะตะดะธ ะฝะฐ ะฒะทะปัั
- **ะะทะปััะฝะฐั ะฟะพะปะพัะฐ (CPU)** โ ัะพะปัะบะพ ะพะดะธะฝ ัะฐะผะพะปัั ะผะพะถะตั ะฒะทะปะตัะฐัั ะฒ ะผะพะผะตะฝั ะฒัะตะผะตะฝะธ
- **ะะธัะฟะตััะตั (scheduler)** ัะตัะฐะตั ะบัะพ ะฒะทะปะตัะธั ัะปะตะดัััะธะผ

```
ะัะตัะตะดั ะฝะฐ ะฒะทะปัั:          ะะทะปััะฝะฐั ะฟะพะปะพัะฐ:
โโโโโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ๏ธ Boeing 747   โ        โ                         โ
โ โ๏ธ Airbus A320  โ   โ    โ    โ๏ธ โ ะกะตะนัะฐั ะฒะทะปะตัะฐะตั โ
โ โ๏ธ Cessna       โ        โ                         โ
โ โ๏ธ Boeing 777   โ        โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโ
```

**ะะฐะทะฝัะต ัััะฐัะตะณะธะธ ะดะธัะฟะตััะตัะฐ:**
- **FIFO:** ะัะพ ะฟะตัะฒัะน ะฟะพะดัะตัะฐะป ะบ ะฟะพะปะพัะต โ ัะพั ะธ ะฒะทะปะตัะฐะตั. ะัะพััะพะน, ะฝะพ ะผะตะปะบะฐั Cessna ะถะดัั ะทะฐ ะพะณัะพะผะฝัะผ Boeing.
- **SJF:** ะกะฝะฐัะฐะปะฐ ะผะฐะปะตะฝัะบะธะต ัะฐะผะพะปััั (ะฑััััะพ ะพัะฒะพะฑะพะดัั ะฟะพะปะพัั). ะญััะตะบัะธะฒะฝะพ, ะฝะพ Boeing ะผะพะถะตั ะถะดะฐัั ะฒะตัะฝะพ.
- **Priority:** VIP-ัะตะนัั ะฟะตัะฒัะผะธ. ะััััะพ ะดะปั VIP, ะฝะพ ะพะฑััะฝัะต ัะตะนัั ะณะพะปะพะดะฐัั.
- **Round Robin:** ะะฐะถะดัะน ัะฐะผะพะปัั ะฟะพะปััะฐะตั 5 ะผะธะฝัั ะฝะฐ ะฟะพะปะพัะต, ะฟะพัะพะผ ััััะฟะฐะตั. ะกะฟัะฐะฒะตะดะปะธะฒะพ, ะฝะพ ัััะฐะฝะฝะพ ะดะปั ะฐะฒะธะฐัะธะธ!

### ๐ฝ๏ธ ะะฝะฐะปะพะณะธั 2: ะัะธัะธะฐะฝั ะฒ ัะตััะพัะฐะฝะต

ะัะตะดััะฐะฒั **ะพะดะฝะพะณะพ ะพัะธัะธะฐะฝัะฐ** (CPU) ะฝะฐ **10 ััะพะปะธะบะพะฒ** (ะฟัะพัะตััั):

**FIFO-ะพัะธัะธะฐะฝั:** ะะฑัะปัะถะธะฒะฐะตั ััะพะปะธะบ ะฟะพะบะฐ ะฟะพะปะฝะพัััั ะฝะต ะทะฐะบะพะฝัะธั (ะฟัะธะฝัะป ะทะฐะบะฐะท, ะฟัะธะฝัั ะตะดั, ะดะตัะตัั, ัััั). ะััะณะธะต ััะพะปะธะบะธ ะถะดัั.
```
ะกัะพะปะธะบ 1: "ะฏ ัะพัั ะฟะพะปะฝัะน ัะถะธะฝ ะธะท 5 ะฑะปัะด" โ 2 ัะฐัะฐ
ะกัะพะปะธะบ 2-10: ะะดัั... ะถะดัั... ะณะพะปะพะดะฐัั...

โ Convoy Effect: ะัะต ะทะฐััััะปะธ ะทะฐ ะพะดะฝะธะผ ะดะพะปะณะธะผ ะทะฐะบะฐะทะพะผ
```

**Round Robin ะพัะธัะธะฐะฝั:** ะะฐะถะดะพะผั ััะพะปะธะบั ะฟะพ 2 ะผะธะฝััั ะฒะฝะธะผะฐะฝะธั, ะฟะพัะพะผ โ ัะปะตะดัััะธะน.
```
ะกัะพะปะธะบ 1: ะฟัะธะฝะธะผะฐะตั ะทะฐะบะฐะท (2 ะผะธะฝ) โ ะฟะตัะตะบะปััะตะฝะธะต
ะกัะพะปะธะบ 2: ะฟัะธะฝะธะผะฐะตั ะทะฐะบะฐะท (2 ะผะธะฝ) โ ะฟะตัะตะบะปััะตะฝะธะต
...
ะกัะพะปะธะบ 1: ะพัะฝะพัะธั ะฝะฐะฟะธัะบะธ (2 ะผะธะฝ) โ ะฟะตัะตะบะปััะตะฝะธะต

โ ะัะต ะฟะพะปััะฐัั ะฒะฝะธะผะฐะฝะธะต, ะฝะพ ะผะฝะพะณะพ "ัะพะดัะฑั" (context switch)
```

**ะฃะผะฝัะน (CFS) ะพัะธัะธะฐะฝั:** ะกะผะพััะธั ะบัะพ ะดะพะปััะต ะฒัะตั ะถะดะฐะป ะธ ะธะดัั ะบ ะฝะตะผั.
```
vruntime = ัะบะพะปัะบะพ ะฒะฝะธะผะฐะฝะธั ัะถะต ะฟะพะปััะธะป ััะพะปะธะบ
ะัะธัะธะฐะฝั ะธะดัั ะบ ััะพะปะธะบั ั ะผะธะฝะธะผะฐะปัะฝัะผ vruntime
โ ะกะฟัะฐะฒะตะดะปะธะฒะพ + ัััะตะบัะธะฒะฝะพ
```

### ๐ค ะะฝะฐะปะพะณะธั 3: ะะฐัะฐะพะบะต ะธ quantum

**Time quantum** โ ััะพ ะบะฐะบ ะพะณัะฐะฝะธัะตะฝะธะต ะฝะฐ ะบะฐัะฐะพะบะต: 3 ะผะธะฝััั, ะฟะพัะพะผ ะผะธะบัะพัะพะฝ ั ัะปะตะดัััะตะณะพ.

```
Quantum ัะปะธัะบะพะผ ะะะะะะฌะะะ (10ms):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โA โโB โโA โโB โโA โโB โโA โโB โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  ^ context switch ะบะฐะถะดัะต 10ms
  ะกะปะธัะบะพะผ ะผะฝะพะณะพ ะฟะตัะตะบะปััะตะฝะธะน! Overhead 10-30%

Quantum ัะปะธัะบะพะผ ะะะะฌะจะะ (500ms):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           A             โโ           B             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  Process B ะถะดัั 500ms โ ะฟะปะพัะพะน response time

Quantum ะพะฟัะธะผะฐะปัะฝัะน (10-100ms):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      A       โโ      B       โโ      A       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  ะะฐะปะฐะฝั ะผะตะถะดั overhead ะธ responsiveness
```

**ะัะฐะฒะธะปะพ ะฑะพะปััะพะณะพ ะฟะฐะปััะฐ:**
- Interactive systems (UI): quantum = 10-20ms (ะฑัััััะน ะพัะบะปะธะบ)
- Batch systems (ัะตัะฒะตัั): quantum = 100-200ms (ะผะตะฝััะต overhead)
- Linux CFS: ะดะธะฝะฐะผะธัะตัะบะธะน quantum, ะทะฐะฒะธัะธั ะพั ะฝะฐะณััะทะบะธ

### โ๏ธ ะะฝะฐะปะพะณะธั 4: SJF ะบะฐะบ ัะบัะฟัะตัั-ะบะฐััะฐ ะฒ ััะฟะตัะผะฐัะบะตัะต

**SJF (Shortest Job First)** โ ะบะฐะบ ัะบัะฟัะตัั-ะบะฐััะฐ "ะดะพ 10 ัะพะฒะฐัะพะฒ":

```
ะะฑััะฝะฐั ะบะฐััะฐ (FIFO):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐(100)  ๐(50)  ๐(3)  ๐(2)  ๐(5)             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
3 ัะพะฒะฐัะฐ ะถะดัั ะทะฐ 150 ัะพะฒะฐัะฐะผะธ = ะดะพะปะณะพ!

ะญะบัะฟัะตัั-ะบะฐััะฐ (SJF):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐(2)  ๐(3)  ๐(5)  ๐(50)  ๐(100)             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ะะตะปะบะธะต ะฟะพะบัะฟะบะธ ะฟะตัะฒัะผะธ = ะผะธะฝะธะผัะผ ะพะฑัะตะณะพ ะพะถะธะดะฐะฝะธั

Average waiting time:
FIFO: (0 + 100 + 150 + 153 + 155) / 5 = 111.6
SJF:  (0 + 2 + 5 + 10 + 60) / 5 = 15.4  โ ะ 7 ัะฐะท ะปัััะต!
```

**ะัะพะฑะปะตะผะฐ SJF:** ะะฐะบ ัะทะฝะฐัั "ัะฐะทะผะตั ะบะพัะทะธะฝั" ะฟัะพัะตััะฐ ะทะฐัะฐะฝะตะต? ะ ัะตะฐะปัะฝัั ะะก ะธัะฟะพะปัะทััั ะฟัะตะดัะบะฐะทะฐะฝะธะต ะฝะฐ ะพัะฝะพะฒะต ะธััะพัะธะธ.

### ๐ณ ะะฝะฐะปะพะณะธั 5: CFS ะบะฐะบ ะบัะฐัะฝะพ-ัััะฝะพะต ะดะตัะตะฒะพ ัะฟัะฐะฒะตะดะปะธะฒะพััะธ

**Linux CFS (Completely Fair Scheduler)** ััะฐะฝะธั ะฟัะพัะตััั ะฒ ะบัะฐัะฝะพ-ัััะฝะพะผ ะดะตัะตะฒะต, ะพััะพััะธัะพะฒะฐะฝะฝะพะผ ะฟะพ `vruntime` (ะฒะธัััะฐะปัะฝะพะต ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั):

```
          vruntime = ัะบะพะปัะบะพ CPU ะฒัะตะผะตะฝะธ ะฟัะพัะตัั ะฃะะ ะฟะพะปััะธะป

                    โโโโโโโโโโโโโโโโโ
                    โ   vruntime=50  โ
                    โ   Process C    โ
                    โโโโโโโโโฌโโโโโโโโ
                   โฑ                 โฒ
          โโโโโโโโโโโโโ         โโโโโโโโโโโโโ
          โ vruntime=20โ         โ vruntime=80โ
          โ Process A  โ         โ Process D  โ
          โโโโโโโโโโโโโ         โโโโโโโโโโโโโ
              โ
         LEFTMOST
         (ะผะธะฝะธะผัะผ vruntime)
         = ัะปะตะดัััะธะน ะฝะฐ ะฒัะฟะพะปะฝะตะฝะธะต!

CFS ะฒัะตะณะดะฐ ะฒัะฑะธัะฐะตั ัะฐะผัะน "ะพะฑะดะตะปัะฝะฝัะน" ะฟัะพัะตัั
(leftmost node = ะผะธะฝะธะผะฐะปัะฝัะน vruntime)
```

**ะะพัะตะผั ััะพ ัะฟัะฐะฒะตะดะปะธะฒะพ:**
- ะะพะฒัะน ะฟัะพัะตัั: vruntime = ะผะธะฝะธะผัะผ ะธะท ะฒัะตั โ ััะฐะทั ะฟะพะปััะธั CPU
- ะัะพัะตัั ัะฐะฑะพัะฐะป ะดะพะปะณะพ: vruntime ัะฐัััั โ ััััะฟะฐะตั ะดััะณะธะผ
- I/O-bound ะฟัะพัะตัั: ะผะฐะปะพ ะธัะฟะพะปัะทัะตั CPU โ ะฝะธะทะบะธะน vruntime โ ะฟัะธะพัะธัะตั

### ๐ข ะงะธัะปะตะฝะฝะฐั ะธะฝััะธัะธั

| ะะตััะธะบะฐ | ะะฝะฐัะตะฝะธะต | ะงัะพ ััะพ ะทะฝะฐัะธั |
|---------|----------|----------------|
| Context switch (ะฟััะผะพะน) | 1-3 ยตs | ะกะพััะฐะฝะธัั/ะฒะพัััะฐะฝะพะฒะธัั ัะตะณะธัััั |
| Context switch (ะบะพัะฒะตะฝะฝัะน) | 10-30 ยตs | TLB miss, cache miss ะฟะพัะปะต switch |
| ะขะธะฟะธัะฝัะน quantum | 10-100 ms | 1000-10000x ะดะพะปััะต context switch |
| Linux CFS minimum granularity | 0.75 ms | ะะธะฝะธะผะฐะปัะฝัะน timeslice |
| Linux CFS latency target | 6 ms | ะะฐะถะดัะน ะฟัะพัะตัั ะฟะพะปััะธั CPU ะทะฐ ััะพ ะฒัะตะผั |

**ะัะธะผะตั: overhead ะพั context switch**
```
4 ัะดัะฐ, 100 ะฟะพัะพะบะพะฒ, quantum = 10ms, switch = 30ยตs

ะะตัะตะบะปััะตะฝะธะน ะฒ ัะตะบัะฝะดั = 100 threads ร (1000ms / 10ms) = 10,000 switches
Overhead = 10,000 ร 30ยตs = 300ms = 30% ะฒัะตะผะตะฝะธ!

ะะตัะตะฝะธะต: ัะผะตะฝััะธัั ะฟะพัะพะบะธ ะดะพ ~4-8 ะฝะฐ ัะดัะพ
4 ัะดัะฐ ร 8 = 32 ะฟะพัะพะบะฐ
ะะตัะตะบะปััะตะฝะธะน = 32 ร 100 = 3,200 switches
Overhead = 3,200 ร 30ยตs = 96ms โ 10%
```

---

## ะงะฐััั 2: ะะพัะตะผั ััะพ ัะปะพะถะฝะพ

### โ ะัะธะฑะบะฐ 1: "ะะพะปััะต ะฟะพัะพะบะพะฒ = ะฑััััะตะต"

**ะกะะะะขะะ:** 4-ัะดะตัะฝัะน ัะตัะฒะตั ั 1000 ะฟะพัะพะบะฐะผะธ ัะฐะฑะพัะฐะตั ะผะตะดะปะตะฝะฝะตะต, ัะตะผ ั 16.

**ะะะงะะะฃ ะะะะะะะะะข:** ะะฝััะธัะธั "ะฟะฐัะฐะปะปะตะปัะฝะพััั = ัะบะพัะพััั" ะฑะตะท ััััะฐ overhead.

**ะะะะะฌะะะกะขะฌ:**
```
4 ัะดัะฐ, N ะฟะพัะพะบะพะฒ:

N = 4:   ะะฐะถะดัะน ะฟะพัะพะบ ะฝะฐ ัะฒะพัะผ ัะดัะต, 0 context switches
         โ ะะดะตะฐะปัะฝะพ ะดะปั CPU-bound

N = 8:   2 ะฟะพัะพะบะฐ ะฝะฐ ัะดัะพ, ะผะธะฝะธะผะฐะปัะฝัะต switches
         โ ะฅะพัะพัะพ ะดะปั ัะผะตัะฐะฝะฝะพะน ะฝะฐะณััะทะบะธ

N = 100: 25 ะฟะพัะพะบะพะฒ ะฝะฐ ัะดัะพ
         Context switch ะบะฐะถะดัะต quantum / 25 โ ะบะฐะถะดัะต 4ms
         ะะฝะพะณะพ TLB/cache misses
         โ๏ธ Overhead ัะฐัััั

N = 1000: 250 ะฟะพัะพะบะพะฒ ะฝะฐ ัะดัะพ
          ะะฐะผััั: 1000 ร 2MB stack = 2GB ัะพะปัะบะพ ะฝะฐ ััะตะบะธ!
          Context switch overhead: 30-50%
          โ ะกะธััะตะผะฐ ะทะฐัะปะตะฑะฝัะปะฐัั
```

**ะะะจะะะะ:**
```
ะัะฐะฒะธะปะพ: #threads = #cores ร (1 + I/O_ratio)

CPU-bound: threads = cores (4 ะฟะพัะพะบะฐ ะฝะฐ 4 ัะดัะฐั)
I/O-bound: threads = cores ร 2-4 (8-16 ะฟะพัะพะบะพะฒ ะฝะฐ 4 ัะดัะฐั)
Mixed:     threads = cores ร 1.5-2

ะัััะต: thread pool ัะธะบัะธัะพะฒะฐะฝะฝะพะณะพ ัะฐะทะผะตัะฐ
```

---

### โ ะัะธะฑะบะฐ 2: ะะณะฝะพัะธัะพะฒะฐะฝะธะต ัะธะฟะฐ ะฝะฐะณััะทะบะธ (CPU-bound vs I/O-bound)

**ะกะะะะขะะ:** "ะะดะธะฝ ะฐะปะณะพัะธัะผ ะฟะปะฐะฝะธัะพะฒะฐะฝะธั ะดะปั ะฒัะตั ะทะฐะดะฐั"

**ะะะงะะะฃ ะะะะะะะะะข:** ะะตะฟะพะฝะธะผะฐะฝะธะต ัะฐะทะฝะธัั ะผะตะถะดั CPU-bound ะธ I/O-bound.

**ะะะะะะ:**
```java
// CPU-bound: ะบะพะผะฟัะตััะธั ะฒะธะดะตะพ
// ะัะฟะพะปัะทัะตั CPU ะฝะฐ 100%, ัะตะดะบะพ ะดะตะปะฐะตั I/O
void compressVideo() {
    for (frame in video) {
        // ะขัะถัะปัะต ะฒััะธัะปะตะฝะธั
        compress(frame);
    }
}

// I/O-bound: ะฒะตะฑ-ัะตัะฒะตั
// 99% ะฒัะตะผะตะฝะธ ะถะดัั ัะตัั, 1% โ ะพะฑัะฐะฑะพัะบะฐ
void handleRequest() {
    data = waitForNetwork();  // 99% ะฒัะตะผะตะฝะธ ะทะดะตัั
    response = process(data);  // 1% CPU
    sendResponse(response);
}
```

**ะขะะะะะฆะ ะะซะะะะ:**

| ะขะธะฟ ะทะฐะดะฐัะธ | ะฅะฐัะฐะบัะตัะธััะธะบะธ | ะะฟัะธะผะฐะปัะฝัะน scheduler | ะะฐัััะพะนะบะธ |
|------------|----------------|----------------------|-----------|
| CPU-bound | 100% CPU, ัะตะดะบะพ I/O | FIFO ะธะปะธ ะฑะพะปััะพะน quantum | nice +19 (ะฝะธะทะบะธะน ะฟัะธะพัะธัะตั) |
| I/O-bound | ะะฝะพะณะพ I/O wait | Preemptive, ะผะฐะปัะน quantum | nice -20 (ะฒััะพะบะธะน ะฟัะธะพัะธัะตั) |
| Interactive | ะะดัั ะฒะฒะพะด ะฟะพะปัะทะพะฒะฐัะตะปั | CFS ั ะฝะธะทะบะธะผ latency | ะะพ ัะผะพะปัะฐะฝะธั |
| Real-time | ะัััะบะธะต ะดะตะดะปะฐะนะฝั | SCHED_FIFO ะธะปะธ SCHED_RR | Real-time priority |

---

### โ ะัะธะฑะบะฐ 3: Priority inversion (ะธะฝะฒะตััะธั ะฟัะธะพัะธัะตัะพะฒ)

**ะกะะะะขะะ:** ะััะพะบะพะฟัะธะพัะธัะตัะฝะฐั ะทะฐะดะฐัะฐ ะถะดัั ะฝะธะทะบะพะฟัะธะพัะธัะตัะฝัั.

**ะะะงะะะฃ ะะะะะะะะะข:** ะะธะทะบะพะฟัะธะพัะธัะตัะฝัะน ะฟัะพัะตัั ะดะตัะถะธั lock, ะบะพัะพััะน ะฝัะถะตะฝ ะฒััะพะบะพะฟัะธะพัะธัะตัะฝะพะผั.

**ะะะะกะกะะงะะกะะะ ะะะะะะ (Mars Pathfinder, 1997):**
```
ะัะธะพัะธัะตัั: High (ะผะตัะตะพะดะฐะฝะฝัะต) > Medium (ะบะพะผะผัะฝะธะบะฐัะธั) > Low (ัะฑะพั ะดะฐะฝะฝัั)

1. Low ะทะฐัะฒะฐััะฒะฐะตั mutex ะดะปั ะดะฐะฝะฝัั
2. High ะฟัะพััะฟะฐะตััั, ัะพัะตั ะดะฐะฝะฝัะต โ ะถะดัั mutex
3. Medium ะทะฐะฟััะบะฐะตััั (ะฒััะต Low, ะฝะธะถะต High)
4. Medium ัะฐะฑะพัะฐะตั ะฑะตัะบะพะฝะตัะฝะพ, ะฑะปะพะบะธััั Low
5. High ะฝะธะบะพะณะดะฐ ะฝะต ะฟะพะปััะธั mutex โ DEADLOCK!

Timeline:
Low:    [====LOCK====|---blocked by Medium---]
Medium: [------------|============ัะฐะฑะพัะฐะตั============]
High:   [            |ะะะะข lock...ะะะะข...ะฝะฐะฒัะตะณะดะฐ    ]
                     ^ priority inversion!
```

**ะะะจะะะะ โ Priority Inheritance:**
```
ะะพะณะดะฐ High ะถะดัั lock, ะบะพัะพััะน ะดะตัะถะธั Low:
โ ะัะตะผะตะฝะฝะพ ะฟะพะฒััะธัั ะฟัะธะพัะธัะตั Low ะดะพ ััะพะฒะฝั High
โ Low ะฑััััะพ ะทะฐะฒะตััะธั, ะพัะดะฐัั lock
โ ะะตัะฝััั Low ะธััะพะดะฝัะน ะฟัะธะพัะธัะตั

Low:    [====LOCK(priority boost)====][done]
High:   [                            ][ะะะะะขะะะข]
```

---

### โ ะัะธะฑะบะฐ 4: ะะตะฟะพะฝะธะผะฐะฝะธะต starvation (ะณะพะปะพะดะฐะฝะธะต)

**ะกะะะะขะะ:** ะะตะบะพัะพััะต ะฟัะพัะตััั ะฝะธะบะพะณะดะฐ ะฝะต ะฟะพะปััะฐัั CPU.

**ะะะงะะะฃ ะะะะะะะะะข:** ะะปะณะพัะธัะผั ั ัะธะบัะธัะพะฒะฐะฝะฝัะผะธ ะฟัะธะพัะธัะตัะฐะผะธ.

**ะะะะะะ:**
```
Priority scheduler (ะฑะตะท aging):

High priority:   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Medium priority: |waiting...|waiting...|waiting...|
Low priority:    |never runs|never runs|never runs| โ STARVATION!

ะะพััะพัะฝะฝัะน ะฟะพัะพะบ high-priority ะทะฐะดะฐั โ low ะฝะธะบะพะณะดะฐ ะฝะต ะทะฐะฟัััะธััั
```

**ะะะจะะะะฏ:**

1. **Aging (ััะฐัะตะฝะธะต):** ะงะตะผ ะดะพะปััะต ะถะดัั ะฟัะพัะตัั, ัะตะผ ะฒััะต ะตะณะพ ะฟัะธะพัะธัะตั
```
Initial priority = 10
After 1 sec waiting: priority = 11
After 2 sec waiting: priority = 12
...
Eventually: priority > high-priority โ ะฟะพะปััะธั CPU
```

2. **CFS (Linux):** ะะฒัะพะผะฐัะธัะตัะบะธ ัะฟัะฐะฒะตะดะปะธะฒ โ ะฟัะพัะตัั ั ะผะธะฝะธะผะฐะปัะฝัะผ vruntime ะฒัะตะณะดะฐ ะฟะพะปััะธั ัะฐะฝั

3. **Multilevel Feedback Queue:** ะัะพัะตััั ะฟะตัะตะผะตัะฐัััั ะผะตะถะดั ะพัะตัะตะดัะผะธ ะฝะฐ ะพัะฝะพะฒะต ะฟะพะฒะตะดะตะฝะธั

---

### โ ะัะธะฑะบะฐ 5: ะะตะฟัะฐะฒะธะปัะฝัะน quantum ะดะปั real-time ะทะฐะดะฐั

**ะกะะะะขะะ:** Real-time ะทะฐะดะฐัะฐ ะฟัะพะฟััะบะฐะตั ะดะตะดะปะฐะนะฝั.

**ะะะงะะะฃ ะะะะะะะะะข:** ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะพะฑััะฝะพะณะพ scheduler ะดะปั ะทะฐะดะฐั ั ะถัััะบะธะผะธ ะฒัะตะผะตะฝะฝัะผะธ ััะตะฑะพะฒะฐะฝะธัะผะธ.

**ะะะะะะ:**
```
ะะฐะดะฐัะฐ: ะพะฑัะฐะฑะพัะฐัั ะฐัะดะธะพ ะบะฐะถะดัะต 10ms (ะธะฝะฐัะต ะทะฐะธะบะฐะฝะธะต)

Round Robin ั quantum = 100ms:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      Process A                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                            ^ Audio ะทะฐะดะฐัะฐ
                                              ะฟัะพะฟัััะธะปะฐ 9 ะดะตะดะปะฐะนะฝะพะฒ!
```

**ะะะจะะะะ โ Linux Real-Time Scheduler:**
```bash
# SCHED_FIFO: run until voluntarily yield
chrt -f 99 ./audio_processor

# SCHED_RR: round-robin ััะตะดะธ real-time ะทะฐะดะฐั
chrt -r 50 ./video_decoder

# SCHED_DEADLINE: ะดะปั ะทะฐะดะฐั ั ัะฒะฝัะผะธ ะดะตะดะปะฐะนะฝะฐะผะธ
# runtime=5ms, deadline=10ms, period=10ms
chrt -d --sched-runtime 5000000 --sched-deadline 10000000 --sched-period 10000000 ./task
```

---

### โ ะัะธะฑะบะฐ 6: Convoy Effect ะฒ I/O-bound ัะธััะตะผะฐั

**ะกะะะะขะะ:** ะัะต I/O-bound ะฟัะพัะตััั ะถะดัั ะทะฐ ะพะดะฝะธะผ CPU-bound.

**ะะะงะะะฃ ะะะะะะะะะข:** FIFO scheduling ะฑะตะท preemption.

**ะะะะะะ:**
```
FIFO scheduler:

CPU-bound (ะบะพะผะฟะธะปััะธั):  [โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ]
I/O-bound (web server):  |waiting...|waiting...|waiting...|waiting|
I/O-bound (database):    |waiting...|waiting...|waiting...|waiting|
I/O-bound (logging):     |waiting...|waiting...|waiting...|waiting|

CPU-bound ะฑะปะพะบะธััะตั ะฒัะตั!
ะะฐะถะต ะบะพะณะดะฐ I/O-bound ะฝัะถะฝั ะฒัะตะณะพ 1ms CPU.
```

**ะะะจะะะะ:**
1. Preemptive scheduler (Round Robin, CFS)
2. ะะพะฒััะธัั ะฟัะธะพัะธัะตั I/O-bound ะทะฐะดะฐั (ะพะฝะธ ะฑััััะพ ะพัะดะฐัั CPU)
3. ะะฐะทะดะตะปะธัั ะฝะฐ ัะฐะทะฝัะต CPU (affinity)

---

## ะงะฐััั 3: ะะตะฝัะฐะปัะฝัะต ะผะพะดะตะปะธ

### ๐ง ะะพะดะตะปั 1: "ะขะฐะฑะปะธัะฐ ะฒัะฑะพัะฐ ะฐะปะณะพัะธัะผะฐ"

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ะะซะะะ ะะะะะะะขะะ ะะะะะะะะะะะะฏ                        โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโค
โ ะัะธัะตัะธะน     โ FIFO         โ Round Robin  โ SJF          โ CFS/MLFQ    โ
โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโค
โ Throughput   โ ะััะพะบะธะน      โ ะกัะตะดะฝะธะน      โ ะััะพะบะธะน      โ ะััะพะบะธะน     โ
โ Response     โ ะะปะพัะพะน       โ ะฅะพัะพัะธะน      โ ะัััะธะน*      โ ะฅะพัะพัะธะน     โ
โ Fairness     โ ะะตั          โ ะะฐ           โ ะะตั          โ ะะฐ          โ
โ Starvation   โ ะะฐ           โ ะะตั          โ ะะฐ           โ ะะตั         โ
โ Overhead     โ ะะธะฝะธะผัะผ      โ ะกัะตะดะฝะธะน      โ ะััะพะบะธะน**    โ ะกัะตะดะฝะธะน     โ
โ ะกะปะพะถะฝะพััั    โ ะัะพััะพะน      โ ะัะพััะพะน      โ ะกะปะพะถะฝัะน      โ ะกะปะพะถะฝัะน     โ
โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโค
โ ะัะฟะพะปัะทะพะฒะฐัั โ Batch        โ Time-sharing โ ะขะตะพัะธั       โ ะกะพะฒัะตะผะตะฝะฝัะต โ
โ ะดะปั          โ ัะธััะตะผั      โ Interactive  โ (ัะตะดะบะพ)      โ ะะก (Linux)  โ
โโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโ

* SJF ะพะฟัะธะผะฐะปะตะฝ ะดะปั avg wait time, ะฝะพ ะฝัะถะฝะพ ะทะฝะฐัั burst time ะทะฐัะฐะฝะตะต
** ะัะถะฝะพ ะฟัะตะดัะบะฐะทัะฒะฐัั burst time
```

### ๐ง ะะพะดะตะปั 2: "ะะธะฐะณัะฐะผะผะฐ ัะพััะพัะฝะธะน ะฟัะพัะตััะฐ"

```
                         โโโโโโโโโโโโโโโโโโโโ
                         โ      NEW         โ
                         โ  (ัะพะทะดะฐะฝ)        โ
                         โโโโโโโโโโฌโโโโโโโโโโ
                                  โ admit
                                  โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ                         READY                            โ
    โ  (ะณะพัะพะฒ ะบ ะฒัะฟะพะปะฝะตะฝะธั, ะถะดัั ัะฒะพะตะน ะพัะตัะตะดะธ ะฝะฐ CPU)        โ
    โ                                                          โ
    โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
    โ  โ Ready Queue (ะพัะตัะตะดั ะบ scheduler)                   โ โ
    โ  โ [P1] โ [P2] โ [P3] โ [P4] โ ...                     โ โ
    โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                โ
              scheduler โโโโโโโโโค dispatch
              ะฒัะฑัะฐะป            โ
                                โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ       RUNNING         โ
                    โ  (ะฒัะฟะพะปะฝัะตััั ะฝะฐ CPU) โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ         โ          โ
                     โ         โ          โ
         I/O done    โ    I/O  โ    exit/ โ preempt/
                     โ request โ terminateโ yield
                     โ         โ          โ
    โโโโโโโโโโโโโโโโโโดโโโ              โ
    โ     BLOCKED       โ              โ
    โ  (ะถะดัั I/O)       โ              โ
    โโโโโโโโโโโโโโโโโโโโโ              โ
                                       โ
                           โโโโโโโโโโโโโโโโโโโโโ
                           โ   TERMINATED      โ
                           โ  (ะทะฐะฒะตัััะฝ)       โ
                           โโโโโโโโโโโโโโโโโโโโโ
```

### ๐ง ะะพะดะตะปั 3: "Gantt chart ะดะปั ะฒะธะทัะฐะปะธะทะฐัะธะธ"

```
ะัะพัะตััั: P1(24ms), P2(3ms), P3(3ms)
Arrival time: ะฒัะต ะฒ ะผะพะผะตะฝั 0

FIFO (ะฟะพััะดะพะบ: P1, P2, P3):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโฌโโโโโโโโ
โ                    P1 (24ms)               โP2(3ms)โP3(3ms)โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโดโโโโโโโโ
0                                            24     27     30

Wait time: P1=0, P2=24, P3=27
Average wait = (0 + 24 + 27) / 3 = 17ms

SJF (ะฟะพััะดะพะบ: P2, P3, P1):
โโโโโโโโโฌโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โP2(3ms)โP3(3ms)โ                    P1 (24ms)               โ
โโโโโโโโโดโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
0      3      6                                              30

Wait time: P2=0, P3=3, P1=6
Average wait = (0 + 3 + 6) / 3 = 3ms  โ ะ 5.7x ะปัััะต!
```

### ๐ง ะะพะดะตะปั 4: "CFS ะบะฐะบ ะฒะตัั ัะฟัะฐะฒะตะดะปะธะฒะพััะธ"

```
CFS ะฑะฐะปะฐะฝัะธััะตั CPU ะฒัะตะผั ะผะตะถะดั ะฟัะพัะตััะฐะผะธ

ะะดะตะฐะปัะฝัะน ะผะธั (ะฑะตัะบะพะฝะตัะฝะพ ะดะตะปะธะผัะน CPU):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ P1 โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                     โ 33%
โ P2 โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                     โ 33%
โ P3 โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                     โ 33%
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ะัะต ัะฐะฑะพัะฐัั "ะพะดะฝะพะฒัะตะผะตะฝะฝะพ", ะบะฐะถะดัะน ะฟะพะปััะฐะตั 1/3 CPU

ะะตะฐะปัะฝัะน ะผะธั (CFS ะฐะฟะฟัะพะบัะธะผะฐัะธั):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ P1 โโโโ      โโโโ      โโโโ      โโโโ      โโโโ            โ
โ P2     โโโโ      โโโโ      โโโโ      โโโโ      โโโโ        โ
โ P3         โโโโ      โโโโ      โโโโ      โโโโ      โโโโ    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ะััััะพะต ะฟะตัะตะบะปััะตะฝะธะต ัะพะทะดะฐัั ะธะปะปัะทะธั ะฟะฐัะฐะปะปะตะปัะฝะพััะธ

vruntime ะพััะปะตะถะธะฒะฐะตั "ะดะพะปะณ" ะบะฐะถะดะพะณะพ ะฟัะพัะตััะฐ:
- P1 ะฟะพะปััะธะป ะฑะพะปััะต โ vruntime ะฒััะต โ ะถะดัั
- P2 ะฟะพะปััะธะป ะผะตะฝััะต โ vruntime ะฝะธะถะต โ ัะปะตะดัััะธะน ะฝะฐ CPU
```

### ๐ง ะะพะดะตะปั 5: "Multilevel Feedback Queue"

```
MLFQ: ะัะพัะตััั ะฟะตัะตะผะตัะฐัััั ะผะตะถะดั ะพัะตัะตะดัะผะธ ะฝะฐ ะพัะฝะพะฒะต ะฟะพะฒะตะดะตะฝะธั

        ะััะพะบะธะน ะฟัะธะพัะธัะตั
        (short quantum)
Queue 0: [Interactive] โโโโโ ะะพะฒัะต ะฟัะพัะตััั ะฝะฐัะธะฝะฐัั ะทะดะตัั
             โ
             โ ะัะฟะพะปัะทะพะฒะฐะป ะฒะตัั quantum?
             โ ะะ
Queue 1: [Medium jobs]
             โ
             โ ะัะฟะพะปัะทะพะฒะฐะป ะฒะตัั quantum?
             โ ะะ
Queue 2: [CPU-bound]
        ะะธะทะบะธะน ะฟัะธะพัะธัะตั
        (long quantum)

ะัะฐะฒะธะปะฐ:
1. ะะพะฒัะน ะฟัะพัะตัั โ Queue 0 (ะฒัััะธะน ะฟัะธะพัะธัะตั)
2. ะัะฟะพะปัะทะพะฒะฐะป ะฒะตัั quantum โ ะฟะพะฝะธะถะตะฝะธะต
3. ะัะดะฐะป CPU ะดะพะฑัะพะฒะพะปัะฝะพ (I/O) โ ะพััะฐัััั/ะฟะพะฒััะฐะตััั
4. ะะตัะธะพะดะธัะตัะบะธะน boost: ะฒัะต โ Queue 0 (ะฟัะพัะธะฒ starvation)

ะะตะทัะปััะฐั:
- Interactive (I/O-bound): ะพััะฐัััั ะฒ Queue 0, ะฑัััััะน response
- CPU-bound: ะพะฟััะบะฐัััั ะฒ Queue 2, ะฑะพะปััะพะน quantum (ัััะตะบัะธะฒะฝะพ)
- ะะฒัะพะผะฐัะธัะตัะบะฐั ะฐะดะฐะฟัะฐัะธั ะฑะตะท ัะฒะฝัั ะฟัะธะพัะธัะตัะพะฒ!
```

---

## Prerequisites

| ะขะตะผะฐ | ะะฐัะตะผ ะฝัะถะฝะพ | ะะดะต ะธะทััะธัั |
|------|-------------|-------------|
| [[os-processes-threads]] | ะงัะพ ัะฐะบะพะต ะฟัะพัะตัั/ะฟะพัะพะบ, ัะพััะพัะฝะธั (Ready, Running, Blocked) | ะัะตะดัะดััะธะน ะผะฐัะตัะธะฐะป ัะฐะทะดะตะปะฐ |
| [[os-overview]] | ะะฐะทะพะฒัะต ะบะพะฝัะตะฟัะธะธ ะะก, context switch, kernel mode | ะัะตะดัะดััะธะน ะผะฐัะตัะธะฐะป ัะฐะทะดะตะปะฐ |
| Time-sharing ัะธััะตะผั | ะะพะฝะธะผะฐะฝะธะต ะบะฐะบ ะฝะตัะบะพะปัะบะพ ะฟัะพะณัะฐะผะผ "ะดะตะปัั" ะพะดะธะฝ CPU | [OSTEP: Scheduling Introduction](https://pages.cs.wisc.edu/~remzi/OSTEP/cpu-sched.pdf) |
| ะัะฝะพะฒั ััััะบััั ะดะฐะฝะฝัั | Red-black tree ะดะปั ะฟะพะฝะธะผะฐะฝะธั CFS | ะัะฑะพะน ะบััั ะฟะพ ะฐะปะณะพัะธัะผะฐะผ |

**ะัะตะผั ะฝะฐ ะฟะพะดะณะพัะพะฒะบั:** ~2-3 ะดะฝั ะตัะปะธ ะทะฝะฐะตัะต ะฟัะตะดัะดััะธะต ัะตะผั

---

## ะขะตัะผะธะฝะพะปะพะณะธั ะดะปั ะฝะพะฒะธัะบะพะฒ

| ะขะตัะผะธะฝ | ะงัะพ ััะพ | ะะฝะฐะปะพะณะธั ะธะท ะถะธะทะฝะธ |
|--------|---------|-------------------|
| **Scheduler** | ะะพะผะฟะพะฝะตะฝั ัะดัะฐ, ะฒัะฑะธัะฐััะธะน ะบัะพ ัะฐะฑะพัะฐะตั ัะปะตะดัััะธะผ | ะะธัะฟะตััะตั ะฐััะพะฟะพััะฐ: ัะตัะฐะตั ะบะฐะบะพะน ัะฐะผะพะปัั ะฒะทะปะตัะธั ัะพ ะฒะทะปััะฝะพะน ะฟะพะปะพัั |
| **Context Switch** | ะะตัะตะบะปััะตะฝะธะต CPU ั ะพะดะฝะพะณะพ ะฟัะพัะตััะฐ ะฝะฐ ะดััะณะพะน | ะะตัะตะบะปััะตะฝะธะต ะฒะฝะธะผะฐะฝะธั ะผะตะถะดั ัะฐะทะณะพะฒะพัะฐะผะธ ะฝะฐ ะฒะตัะตัะธะฝะบะต โ ะฝะฐะดะพ "ะฒัะฟะพะผะฝะธัั" ะบะพะฝัะตะบัั |
| **Preemption** | ะัะธะฝัะดะธัะตะปัะฝะพะต ะฟัะตััะฒะฐะฝะธะต ะฟัะพัะตััะฐ | ะฃัะธัะตะปั ะพัะฑะธัะฐะตั ะผัั ั ะพะดะฝะพะณะพ ััะตะฝะธะบะฐ ะธ ะดะฐัั ะดััะณะพะผั |
| **Quantum / Time Slice** | ะะฐะบัะธะผะฐะปัะฝะพะต ะฒัะตะผั ัะฐะฑะพัั ะดะพ preemption (ะพะฑััะฝะพ 10-100ms) | ะะณัะฐะฝะธัะตะฝะฝะพะต ะฒัะตะผั ะฝะฐ ะบะฐัะฐะพะบะต: 3 ะผะธะฝััั ะธ ะผะธะบัะพัะพะฝ ั ะดััะณะพะณะพ |
| **Throughput** | ะะพะปะธัะตััะฒะพ ะทะฐะฒะตัััะฝะฝัั ะทะฐะดะฐั ะฒ ะตะดะธะฝะธัั ะฒัะตะผะตะฝะธ | ะัะพะฟััะบะฝะฐั ัะฟะพัะพะฑะฝะพััั: ัะบะพะปัะบะพ ะฟะพัะตัะธัะตะปะตะน ะพะฑัะปัะถะธะป ัะตััะพัะฐะฝ ะทะฐ ะฒะตัะตั |
| **Turnaround Time** | ะัะตะผั ะพั ะทะฐะฟััะบะฐ ะดะพ ะทะฐะฒะตััะตะฝะธั | ะัะตะผั ะฒ ัะตััะพัะฐะฝะต: ะพั ะฒัะพะดะฐ ะดะพ ะฒััะพะดะฐ (ะฒะบะปััะฐั ะพะถะธะดะฐะฝะธะต) |
| **Response Time** | ะัะตะผั ะดะพ ะฟะตัะฒะพะณะพ ะพัะฒะตัะฐ | ะะฐะบ ะฑััััะพ ะพัะธัะธะฐะฝั ะฟะพะดะพััะป ะฟะพัะปะต ัะพะณะพ, ะบะฐะบ ะฒั ัะตะปะธ |
| **CPU Burst** | ะะตัะธะพะด ะฝะตะฟัะตััะฒะฝัั ะฒััะธัะปะตะฝะธะน | ะัะฒะพะบ ะฑะตะณัะฝะฐ ะผะตะถะดั ะพััะฐะฝะพะฒะบะฐะผะธ |
| **I/O Burst** | ะะตัะธะพะด ะพะถะธะดะฐะฝะธั I/O (ะดะธัะบ, ัะตัั) | ะััะฐะฝะพะฒะบะฐ ะฑะตะณัะฝะฐ โ ะถะดัั ัะธะณะฝะฐะปะฐ ัะฒะตัะพัะพัะฐ |
| **Ready Queue** | ะัะตัะตะดั ะฟัะพัะตััะพะฒ, ะณะพัะพะฒัั ะบ ัะฐะฑะพัะต | ะะฐะป ะพะถะธะดะฐะฝะธั ะฐััะพะฟะพััะฐ โ ะฒัะต ะณะพัะพะฒั ะปะตัะตัั, ะถะดัั ัะฒะพะตะน ะฟะพะปะพัั |
| **Convoy Effect** | ะะพัะพัะบะธะต ะทะฐะดะฐัะธ ะทะฐััััะปะธ ะทะฐ ะดะปะธะฝะฝะพะน | ะัะพะฑะบะฐ ะทะฐ ัััะพะน ะฝะฐ ัะทะบะพะน ะดะพัะพะณะต |
| **Starvation** | ะะฐะดะฐัะฐ ะฝะธะบะพะณะดะฐ ะฝะต ะฟะพะปััะฐะตั CPU | ะะพัะตัะธัะตะปั, ะบะพัะพัะพะณะพ ะฒัั ะฒัะตะผั ะพะฑัะปัะถะธะฒะฐัั ะฟะพัะปะตะดะฝะธะผ |
| **vruntime (CFS)** | ะะธัััะฐะปัะฝะพะต ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ะฒ Linux CFS | "ะกะบะพะปัะบะพ ะฒะฝะธะผะฐะฝะธั" ะฟัะพัะตัั ัะถะต ะฟะพะปััะธะป โ CFS ะดะฐัั CPU ัะตะผ, ะบัะพ ะฟะพะปััะธะป ะผะตะฝััะต |

---

## ะะฐัะตะผ ะฝัะถะตะฝ ะฟะปะฐะฝะธัะพะฒัะธะบ

### ะัะพะฑะปะตะผะฐ: ะพะดะธะฝ CPU, ะผะฝะพะณะพ ะฟัะพัะตััะพะฒ

```
ะคะธะทะธัะตัะบะธะน CPU: 1 ัะดัะพ (ะดะปั ะฟัะพััะพัั)
ะัะพัะตััั: Web server, Database, Logging, Monitoring...

ะะตะท ะฟะปะฐะฝะธัะพะฒัะธะบะฐ:
  Process A ะทะฐะฟััะบะฐะตััั โ ัะฐะฑะพัะฐะตั ะฒะตัะฝะพ โ ะพััะฐะปัะฝัะต ะถะดัั

ะก ะฟะปะฐะฝะธัะพะฒัะธะบะพะผ:
  10ms: Process A
  10ms: Process B
  10ms: Process C
  10ms: Process A
  ...

ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั: ะฒัะต ะฟัะพัะตััั ัะฐะฑะพัะฐัั "ะพะดะฝะพะฒัะตะผะตะฝะฝะพ"
```

### ะขะธะฟั ะฟัะพัะตััะพะฒ

ะะฐะทะฝัะต ะฟัะพัะตััั ะธะผะตัั ัะฐะทะฝัะต ะฟะฐััะตัะฝั ะธัะฟะพะปัะทะพะฒะฐะฝะธั CPU:

**CPU-bound:** ะะฝะพะณะพ ะฒััะธัะปะตะฝะธะน, ะผะฐะปะพ I/O. ะัะธะผะตัั: ะบะพะผะฟะธะปััะธั, ัะตะฝะดะตัะธะฝะณ, ะผะฐัะธะฝะฝะพะต ะพะฑััะตะฝะธะต. ะฅะพััั ะผะฐะบัะธะผัะผ CPU time.

**I/O-bound:** ะะฝะพะณะพ ะพะถะธะดะฐะฝะธั I/O, ะผะฐะปะพ ะฒััะธัะปะตะฝะธะน. ะัะธะผะตัั: web-ัะตัะฒะตั (ะถะดัั ัะตัั), database (ะถะดัั ะดะธัะบ), GUI (ะถะดัั ะฒะฒะพะด). ะฅะพััั ะฑัััััะน response time.

```
CPU-bound ะฟัะพัะตัั:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ CPU burst
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

I/O-bound ะฟัะพัะตัั:
โโโโ    โโโโ    โโโโ    โโโโ    โโโโ
โโโโ    โโโโ    โโโโ    โโโโ    โโโโ     CPU bursts
โโโโ    โโโโ    โโโโ    โโโโ    โโโโ
    ^^^^    ^^^^    ^^^^    ^^^^        I/O wait
```

ะฅะพัะพัะธะน ะฟะปะฐะฝะธัะพะฒัะธะบ ะฑะฐะปะฐะฝัะธััะตั ะผะตะถะดั CPU-bound ะธ I/O-bound ะฟัะพัะตััะฐะผะธ.

---

## Context Switch: ััะพ ะฟัะพะธััะพะดะธั ะฟัะธ ะฟะตัะตะบะปััะตะฝะธะธ

ะะพะณะดะฐ ะฟะปะฐะฝะธัะพะฒัะธะบ ัะตัะฐะตั ะฟะตัะตะบะปััะธัั CPU ะฝะฐ ะดััะณะพะน ะฟัะพัะตัั:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    CONTEXT SWITCH                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  1. Interrupt/Syscall โ CPU ะฟะตัะตัะพะดะธั ะฒ kernel mode             โ
โ                                                                 โ
โ  2. ะกะพััะฐะฝะธัั ะบะพะฝัะตะบัั Process A:                               โ
โ     - ะัะต ัะตะณะธัััั CPU (RAX, RBX, RCX, ...)                    โ
โ     - Program Counter (ะณะดะต ะพััะฐะฝะพะฒะธะปะธัั)                        โ
โ     - Stack Pointer                                             โ
โ     - ะคะปะฐะณะธ ะฟัะพัะตััะพัะฐ                                          โ
โ     โ ะกะพััะฐะฝัะตััั ะฒ PCB (Process Control Block)                 โ
โ                                                                 โ
โ  3. Scheduler ะฒัะฑะธัะฐะตั ัะปะตะดัััะธะน ะฟัะพัะตัั (Process B)            โ
โ                                                                 โ
โ  4. ะะฐะณััะทะธัั ะบะพะฝัะตะบัั Process B:                               โ
โ     - ะะพัััะฐะฝะพะฒะธัั ัะตะณะธัััั ะธะท PCB                              โ
โ     - ะะตัะตะบะปััะธัั Page Table (CR3 ะฝะฐ x86)                       โ
โ     - ะะพะทะผะพะถะฝะพ: TLB flush (ะดะพัะพะณะพ!)                             โ
โ                                                                 โ
โ  5. Return to user mode โ Process B ะฟัะพะดะพะปะถะฐะตั                  โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ะัะตะผั: 1-3 ยตs (ะฟััะผัะต ะทะฐััะฐัั)
      + 10-30 ยตs (ะบะพัะฒะตะฝะฝัะต: TLB miss, cache miss)
```

### ะะพัะฒะตะฝะฝัะต ะทะฐััะฐัั

ะััะผัะต ะทะฐััะฐัั (ัะพััะฐะฝะตะฝะธะต/ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต ัะตะณะธัััะพะฒ) โ ะผะธะบัะพัะตะบัะฝะดั. ะะพ ะบะพัะฒะตะฝะฝัะต ะทะฐััะฐัั ะผะพะณัั ะฑััั ะฑะพะปััะต:

**TLB flush:** ะัะธ ัะผะตะฝะต ะฟัะพัะตััะฐ TLB (ะบัั ััะฐะฝัะปััะธะธ ะฐะดัะตัะพะฒ) ััะฐะฝะพะฒะธััั ะฝะตะฒะฐะปะธะดะฝัะผ. ะะตัะฒัะต ะพะฑัะฐัะตะฝะธั ะบ ะฟะฐะผััะธ โ TLB miss, ะบะฐะถะดัะน ััะพะธั ัะพัะฝะธ ัะธะบะปะพะฒ.

**Cache pollution:** ะัะพัะตัั A ะทะฐะฟะพะปะฝะธะป L1/L2/L3 cache ัะฒะพะธะผะธ ะดะฐะฝะฝัะผะธ. ะะพัะปะต switch ะฟัะพัะตัั B ะฒะธะดะธั ััะถะธะต ะดะฐะฝะฝัะต โ cache miss.

**Branch predictor pollution:** CPU ะฟัะตะดัะบะฐะทัะฒะฐะตั ะฒะตัะฒะปะตะฝะธั ะฝะฐ ะพัะฝะพะฒะต ะธััะพัะธะธ. ะะพัะปะต switch ะธััะพัะธั ะพั ะดััะณะพะณะพ ะฟัะพัะตััะฐ โ ะฝะตะฒะตัะฝัะต ะฟัะตะดัะบะฐะทะฐะฝะธั.

---

## ะะพะณะดะฐ ะฟัะพะธััะพะดะธั ะฟะตัะตะบะปััะตะฝะธะต

### Preemptive vs Non-preemptive

**Non-preemptive (cooperative):** ะัะพัะตัั ัะฐะผ ัะตัะฐะตั ะพัะดะฐัั CPU. ะะพะฑัะพะฒะพะปัะฝะพ ะฒัะทัะฒะฐะตั `yield()` ะธะปะธ ะดะตะปะฐะตั syscall. ะัะพะฑะปะตะผะฐ: ะทะฐะฒะธััะธะน ะฟัะพัะตัั ะฑะปะพะบะธััะตั ะฒัั ัะธััะตะผั.

**Preemptive:** ะะก ะผะพะถะตั ะฟัะตัะฒะฐัั ะฟัะพัะตัั ะฒ ะปัะฑะพะน ะผะพะผะตะฝั. ะัะฟะพะปัะทัะตััั ะฒะพ ะฒัะตั ัะพะฒัะตะผะตะฝะฝัั ะะก.

### ะขะพัะบะธ ะฟะตัะตะบะปััะตะฝะธั

```
1. ะัะพัะตัั ะทะฐะฒะตััะธะปัั (exit)
   โ ะัะฑัะฐัั ัะปะตะดัััะธะน ะธะท ready queue

2. ะัะพัะตัั ะทะฐะฑะปะพะบะธัะพะฒะฐะปัั (I/O, sleep, lock)
   โ ะะตัะตะผะตััะธัั ะฒ blocked queue, ะฒัะฑัะฐัั ะดััะณะพะน

3. Timer interrupt (preemption)
   โ Quantum ะธัััะบ, ะฟัะพัะตัั ะฟัะธะฝัะดะธัะตะปัะฝะพ ะฟัะตััะฒะฐะตััั

4. ะััะพะบะพะฟัะธะพัะธัะตัะฝัะน ะฟัะพัะตัั ััะฐะป ready
   โ ะขะตะบััะธะน preempted, ะฒััะพะบะพะฟัะธะพัะธัะตัะฝัะน ะทะฐะฟััะบะฐะตััั

5. Syscall
   โ ะัะพัะตัั ะฒ kernel mode, ะผะพะถะตั ะฑััั ะฟะตัะตะบะปััะตะฝะธะต
```

### Timer Interrupt

ะะฟะฟะฐัะฐัะฝัะน ัะฐะนะผะตั ะณะตะฝะตัะธััะตั ะฟัะตััะฒะฐะฝะธั (ะพะฑััะฝะพ 100-1000 ัะฐะท ะฒ ัะตะบัะฝะดั):

```
Timer interrupt ะบะฐะถะดัะต 1ms (1000 Hz):

Process A ัะฐะฑะพัะฐะตั
...
[1ms] Timer interrupt โ scheduler โ Process A ะฟัะพะดะพะปะถะฐะตั (quantum ะฝะต ะธัััะบ)
...
[1ms] Timer interrupt โ scheduler โ Process A ะฟัะพะดะพะปะถะฐะตั
...
[1ms] Timer interrupt โ scheduler โ Quantum 10ms ะธัััะบ! โ Process B
```

---

## ะะปะณะพัะธัะผั ะฟะปะฐะฝะธัะพะฒะฐะฝะธั

### FIFO (First In, First Out)

ะัะพััะตะนัะธะน ะฐะปะณะพัะธัะผ: ะบัะพ ะฟะตัะฒัะน ะฟัะธััะป, ัะพั ะฟะตัะฒัะน ะฒัะฟะพะปะฝัะตััั ะดะพ ะบะพะฝัะฐ.

```
Ready Queue: [A(10ms), B(2ms), C(3ms)]

ะัะฟะพะปะฝะตะฝะธะต:
|----A(10ms)----|--B(2ms)--|--C(3ms)--|

Turnaround times:
  A: 10ms
  B: 10 + 2 = 12ms
  C: 10 + 2 + 3 = 15ms
  Average: 12.3ms
```

**ะัะพะฑะปะตะผะฐ โ Convoy Effect:** ะะปะธะฝะฝัะน CPU-bound ะฟัะพัะตัั ะฑะปะพะบะธััะตั ะบะพัะพัะบะธะต I/O-bound ะฟัะพัะตััั. ะัะต ะถะดัั, ะฟะพะบะฐ "ะณััะทะพะฒะธะบ" (convoy) ะฟัะพะตะดะตั.

### SJF (Shortest Job First)

ะัะฟะพะปะฝััั ัะฝะฐัะฐะปะฐ ะฟัะพัะตััั ั ะฝะฐะธะผะตะฝััะธะผ CPU burst.

```
Ready Queue: [A(10ms), B(2ms), C(3ms)]

ะัะฟะพะปะฝะตะฝะธะต (SJF):
|--B(2ms)--|--C(3ms)--|----A(10ms)----|

Turnaround times:
  B: 2ms
  C: 2 + 3 = 5ms
  A: 2 + 3 + 10 = 15ms
  Average: 7.3ms (ะฑัะปะพ 12.3ms!)
```

**ะัะพะฑะปะตะผะฐ:** ะะฐะบ ัะทะฝะฐัั ะดะปะธะฝั ัะปะตะดัััะตะณะพ CPU burst? ะ ัะตะฐะปัะฝะพััะธ โ ะฝะตะฒะพะทะผะพะถะฝะพ. ะะพะถะฝะพ ะฟัะตะดัะบะฐะทัะฒะฐัั ะฝะฐ ะพัะฝะพะฒะต ะธััะพัะธะธ (exponential averaging).

**Starvation:** ะัะปะธ ะฟะพััะพัะฝะฝะพ ะฟัะธัะพะดัั ะบะพัะพัะบะธะต ะฟัะพัะตััั, ะดะปะธะฝะฝัะต ะฝะธะบะพะณะดะฐ ะฝะต ะฒัะฟะพะปะฝัััั.

### Round Robin (RR)

ะะฐะถะดัะน ะฟัะพัะตัั ะฟะพะปััะฐะตั ัะธะบัะธัะพะฒะฐะฝะฝัะน quantum (time slice), ะทะฐัะตะผ preemption.

```
Ready Queue: [A, B, C], Quantum = 4ms

|--A(4)--|--B(4)--|--C(4)--|--A(4)--|--B(2)--|--C(3)--|--A(2)--|

A(10ms): 4 + (ะถะดัั 8) + 4 + (ะถะดัั 5) + 2 = ะฒัะฟะพะปะฝะตะฝ ะทะฐ ~23ms
ะะพ response time ะพัะปะธัะฝัะน โ ะบะฐะถะดัะน ะฟัะพัะตัั ะพัะฒะตัะฐะตั ะทะฐ 4ms!
```

**Trade-off ะฒัะฑะพัะฐ quantum:**
- ะะฐะปัะน quantum (1ms): ะัะปะธัะฝัะน response time, ะฝะพ ะผะฝะพะณะพ context switches (overhead)
- ะะพะปััะพะน quantum (100ms): ะะฐะปะพ overhead, ะฝะพ ะฟะปะพัะพะน response time
- ะขะธะฟะธัะฝะพะต ะทะฝะฐัะตะฝะธะต: 10-100ms

### Priority Scheduling

ะะฐะถะดะพะผั ะฟัะพัะตััั ะฟัะธัะฒะฐะธะฒะฐะตััั ะฟัะธะพัะธัะตั. ะัะฟะพะปะฝััััั ะฒััะพะบะพะฟัะธะพัะธัะตัะฝัะต ัะฝะฐัะฐะปะฐ.

```
Priorities: A(low), B(high), C(medium)

ะะพััะดะพะบ: B โ C โ A

ะัะพะฑะปะตะผะฐ โ Starvation:
  ะััะพะบะพะฟัะธะพัะธัะตัะฝัะต ะฟัะพัะตััั ะฟะพััะพัะฝะฝะพ ะฟัะธัะพะดัั
  โ ะะธะทะบะพะฟัะธะพัะธัะตัะฝัะต ะฝะธะบะพะณะดะฐ ะฝะต ะฒัะฟะพะปะฝััััั
```

**ะะตัะตะฝะธะต โ Aging:** ะกะพ ะฒัะตะผะตะฝะตะผ ะฟัะธะพัะธัะตั ะพะถะธะดะฐััะตะณะพ ะฟัะพัะตััะฐ ัะฒะตะปะธัะธะฒะฐะตััั. ะัะปะธ ะฟัะพัะตัั ะถะดัั ะดะพะปะณะพ, ะพะฝ ััะฐะฝะตั ะฒััะพะบะพะฟัะธะพัะธัะตัะฝัะผ.

### Multi-Level Feedback Queue (MLFQ)

ะะพะผะฑะธะฝะฐัะธั ะฟะพะดัะพะดะพะฒ. ะะตัะบะพะปัะบะพ ะพัะตัะตะดะตะน ั ัะฐะทะฝัะผะธ ะฟัะธะพัะธัะตัะฐะผะธ:

```
Queue 0 (ะฒัััะธะน ะฟัะธะพัะธัะตั): Round Robin, quantum = 8ms
Queue 1 (ััะตะดะฝะธะน):         Round Robin, quantum = 16ms
Queue 2 (ะฝะธะทัะธะน):          FIFO

ะัะฐะฒะธะปะฐ:
1. ะะพะฒัะน ะฟัะพัะตัั โ Queue 0
2. ะัะฟะพะปัะทะพะฒะฐะป ะฒะตัั quantum โ ะฟะพะฝะธะถะตะฝะธะต ะฒ ัะปะตะดััััั ะพัะตัะตะดั
3. ะัะฒะพะฑะพะดะธะป CPU ะดะพ quantum (I/O) โ ะพััะฐัััั ะฒ ัะตะบััะตะน ะพัะตัะตะดะธ
4. ะะตัะธะพะดะธัะตัะบะธ ะฒัะต ะฟัะพัะตััั ะฟะพะดะฝะธะผะฐัััั ะฒ Queue 0 (anti-starvation)

ะญััะตะบั:
- I/O-bound ะฟัะพัะตััั ะพััะฐัััั ะฒ Queue 0 (ะฒััะพะบะธะน ะฟัะธะพัะธัะตั, ะฑัััััะน response)
- CPU-bound ะฟัะพัะตััั ัะฟััะบะฐัััั ะฒ Queue 2 (ะฝะธะทะบะธะน ะฟัะธะพัะธัะตั, ะดะปะธะฝะฝัะน quantum)
```

---

## Linux CFS (Completely Fair Scheduler)

Linux ั 2007 ะณะพะดะฐ ะธัะฟะพะปัะทัะตั CFS โ ะฟะปะฐะฝะธัะพะฒัะธะบ ะฝะฐ ะพัะฝะพะฒะต "ัะฟัะฐะฒะตะดะปะธะฒะพััะธ".

### ะะดะตั: ะฒะธัััะฐะปัะฝะพะต ะฒัะตะผั

CFS ะพััะปะตะถะธะฒะฐะตั "ะฒะธัััะฐะปัะฝะพะต ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั" (vruntime) ะบะฐะถะดะพะณะพ ะฟัะพัะตััะฐ. ะะปะฐะฝะธัะพะฒัะธะบ ะฒัะตะณะดะฐ ะฒัะฑะธัะฐะตั ะฟัะพัะตัั ั ะฝะฐะธะผะตะฝััะธะผ vruntime.

```
vruntime = ัะธะทะธัะตัะบะพะต ะฒัะตะผั ร (ะฑะฐะทะพะฒัะน ะฟัะธะพัะธัะตั / nice)

ะัะพัะตัั ั nice=-20 (ะฒััะพะบะธะน ะฟัะธะพัะธัะตั):
  1 ัะตะบัะฝะดะฐ ัะธะทะธัะตัะบะพะณะพ ะฒัะตะผะตะฝะธ = ะผะตะฝััะต vruntime
  โ ะะพะถะตั ัะฐะฑะพัะฐัั ะดะพะปััะต ะดะพ ะฟะตัะตะบะปััะตะฝะธั

ะัะพัะตัั ั nice=19 (ะฝะธะทะบะธะน ะฟัะธะพัะธัะตั):
  1 ัะตะบัะฝะดะฐ ัะธะทะธัะตัะบะพะณะพ ะฒัะตะผะตะฝะธ = ะฑะพะปััะต vruntime
  โ ะััััะตะต ะฝะฐะบะฐะฟะปะธะฒะฐะตั vruntime, ัะฐัะต ะฟัะตััะฒะฐะตััั
```

### Red-Black Tree

CFS ััะฐะฝะธั ะฟัะพัะตััั ะฒ ะบัะฐัะฝะพ-ัััะฝะพะผ ะดะตัะตะฒะต, ะพััะพััะธัะพะฒะฐะฝะฝะพะผ ะฟะพ vruntime:

```
              (P3: vruntime=50)
              /               \
    (P1: vruntime=30)    (P5: vruntime=70)
    /            \                    \
(P2: 20)      (P4: 40)             (P6: 90)

ะัะฑะพั ัะปะตะดัััะตะณะพ ะฟัะพัะตััะฐ: O(1) โ ัะฐะผัะน ะปะตะฒัะน ัะทะตะป (P2)
ะััะฐะฒะบะฐ/ัะดะฐะปะตะฝะธะต: O(log n)
```

### Targeted Latency

CFS ะณะฐัะฐะฝัะธััะตั, ััะพ ะบะฐะถะดัะน ะฟัะพัะตัั ะฟะพะปััะธั CPU ัะพัั ะฑั ัะฐะท ะทะฐ "targeted latency" (ะพะฑััะฝะพ 20ms).

```
10 ะฟัะพัะตััะพะฒ, targeted latency = 20ms:
  ะะฐะถะดัะน ะฟัะพัะตัั ะฟะพะปััะฐะตั ~2ms ะผะธะฝะธะผัะผ

100 ะฟัะพัะตััะพะฒ, targeted latency = 20ms:
  ะะฐะถะดัะน ะฟัะพัะตัั ะฟะพะปััะฐะตั ~0.2ms ะผะธะฝะธะผัะผ
  (ะฝะพ ะตััั min_granularity ~1ms, ััะพะฑั context switch ะฝะต ััะตะป ะฒัั ะฒัะตะผั)
```

### Nice Values

```bash
# ะะฐะฟัััะธัั ั ะฝะธะทะบะธะผ ะฟัะธะพัะธัะตัะพะผ (ะฑะพะปััะต nice = ะฝะธะถะต ะฟัะธะพัะธัะตั)
nice -n 19 ./cpu_intensive_task

# ะะทะผะตะฝะธัั ะฟัะธะพัะธัะตั ัะฐะฑะพัะฐััะตะณะพ ะฟัะพัะตััะฐ
renice -n 10 -p <pid>

# ะะธะฐะฟะฐะทะพะฝ nice: -20 (ะฒัััะธะน ะฟัะธะพัะธัะตั) ะดะพ 19 (ะฝะธะทัะธะน)
# ะขะพะปัะบะพ root ะผะพะถะตั ัััะฐะฝะฐะฒะปะธะฒะฐัั ะพััะธัะฐัะตะปัะฝัะต ะทะฝะฐัะตะฝะธั
```

---

## Real-Time Scheduling

ะะปั ะทะฐะดะฐั ั ะถัััะบะธะผะธ ััะตะฑะพะฒะฐะฝะธัะผะธ ะบ latency (ะฐัะดะธะพ, ะฒะธะดะตะพ, ะฟัะพะผััะปะตะฝะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต):

### SCHED_FIFO

Real-time FIFO. ะัะพัะตัั ัะฐะฑะพัะฐะตั ะฟะพะบะฐ ะฝะต ะทะฐะฑะปะพะบะธััะตััั ะธะปะธ ะฝะต ััััะฟะธั ะดะพะฑัะพะฒะพะปัะฝะพ. Preemption ัะพะปัะบะพ ะพั ะฟัะพัะตััะฐ ั ะฑะพะปะตะต ะฒััะพะบะธะผ RT-ะฟัะธะพัะธัะตัะพะผ.

### SCHED_RR

Real-time Round Robin. ะะฐะบ SCHED_FIFO, ะฝะพ ั quantum ะดะปั ะฟัะพัะตััะพะฒ ะพะดะฝะพะณะพ ะฟัะธะพัะธัะตัะฐ.

```bash
# ะะฐะฟัััะธัั ั real-time ะฟัะธะพัะธัะตัะพะผ
chrt -f 50 ./realtime_task   # SCHED_FIFO, priority 50
chrt -r 50 ./realtime_task   # SCHED_RR, priority 50

# ะัะพะฒะตัะธัั policy ะฟัะพัะตััะฐ
chrt -p <pid>
```

### ะัะธะพัะธัะตัั

```
Real-time ะฟัะธะพัะธัะตัั (1-99): ะัะตะณะดะฐ ะฒััะต ะพะฑััะฝัั ะฟัะพัะตััะพะฒ
ะะฑััะฝัะต ะฟัะพัะตััั (nice -20 ะดะพ 19): SCHED_OTHER/SCHED_NORMAL

RT ะฟัะพัะตัั ั ะฟัะธะพัะธัะตัะพะผ 1 > ะปัะฑะพะน ะพะฑััะฝัะน ะฟัะพัะตัั
RT ะฟัะพัะตัั ั ะฟัะธะพัะธัะตัะพะผ 99 > RT ั ะฟัะธะพัะธัะตัะพะผ 1
```

**ะะฟะฐัะฝะพััั:** Real-time ะฟัะพัะตัั ะผะพะถะตั ะทะฐะฑะปะพะบะธัะพะฒะฐัั ัะธััะตะผั. ะะดะธะฝ busy-loop ะฒ SCHED_FIFO โ ะธ ัะธััะตะผะฐ ะฝะต ะพัะฒะตัะฐะตั.

---

## ะะฝะพะณะพะฟัะพัะตััะพัะฝะพะต ะฟะปะฐะฝะธัะพะฒะฐะฝะธะต

### SMP (Symmetric Multiprocessing)

ะะตัะบะพะปัะบะพ CPU, ะพะฑัะฐั ะฟะฐะผััั. ะะปะฐะฝะธัะพะฒัะธะบ ะดะพะปะถะตะฝ ัะตัะฐัั:
- ะะฐ ะบะฐะบะพะผ CPU ะทะฐะฟัััะธัั ะฟัะพัะตัั?
- ะะฐะบ ะฑะฐะปะฐะฝัะธัะพะฒะฐัั ะฝะฐะณััะทะบั?
- ะฃัะธััะฒะฐัั ะปะธ cache affinity?

### Cache Affinity

ะัะปะธ ะฟัะพัะตัั ัะฐะฑะพัะฐะป ะฝะฐ CPU0, ะตะณะพ ะดะฐะฝะฝัะต ะฒ ะบััะต CPU0. ะะตัะตะฝะพั ะฝะฐ CPU1 = cache miss.

```
Process A ัะฐะฑะพัะฐะตั ะฝะฐ CPU0:
  - L1/L2 cache CPU0 ะทะฐะฟะพะปะฝะตะฝ ะดะฐะฝะฝัะผะธ A
  - ะกะปะตะดัััะธะน ะทะฐะฟััะบ ะฝะฐ CPU0 โ cache hit โ ะฑััััะพ
  - ะะตัะตะฝะพั ะฝะฐ CPU1 โ cache miss โ ะผะตะดะปะตะฝะฝะพ

ะะตัะตะฝะธะต: "ะผัะณะบะฐั" ะฟัะธะฒัะทะบะฐ (soft affinity)
  - ะะปะฐะฝะธัะพะฒัะธะบ ะฟัะตะดะฟะพัะธัะฐะตั ัะพั ะถะต CPU
  - ะะพ ะฟะตัะตะฝะพัะธั ะฟัะธ ะดะธัะฑะฐะปะฐะฝัะต
```

### NUMA (Non-Uniform Memory Access)

ะ ะฑะพะปััะธั ัะธััะตะผะฐั ะฟะฐะผััั "ะฑะปะธะถะต" ะบ ะฝะตะบะพัะพััะผ CPU:

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ     Node 0      โ    โ     Node 1      โ
โ  โโโโโ  โโโโโ  โ    โ  โโโโโ  โโโโโ  โ
โ  โCPUโ  โCPUโ  โ    โ  โCPUโ  โCPUโ  โ
โ  โโโโโ  โโโโโ  โ    โ  โโโโโ  โโโโโ  โ
โ       โ        โ    โ       โ        โ
โ   โโโโโโโโโ    โ    โ   โโโโโโโโโ    โ
โ   โ RAM   โ    โโโโโโ   โ RAM   โ    โ
โ   โ Local โ    โslowโ   โ Local โ    โ
โ   โโโโโโโโโ    โ    โ   โโโโโโโโโ    โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ

CPU ะฝะฐ Node 0 โ RAM Node 0: ะฑััััะพ (~100 cycles)
CPU ะฝะฐ Node 0 โ RAM Node 1: ะผะตะดะปะตะฝะฝะพ (~200 cycles)
```

ะะปะฐะฝะธัะพะฒัะธะบ ััะธััะฒะฐะตั NUMA: ะดะตัะถะธั ะฟัะพัะตัั ะฝะฐ CPU ััะดะพะผ ั ะตะณะพ ะฟะฐะผัััั.

```bash
# ะัะธะฒัะทะฐัั ะฟัะพัะตัั ะบ CPU
taskset -c 0,1 ./process    # ะขะพะปัะบะพ CPU 0 ะธ 1

# ะัะธะฒัะทะฐัั ะบ NUMA node
numactl --cpunodebind=0 --membind=0 ./process
```

---

## ะัะฐะฝะธัั ะฟัะธะผะตะฝะธะผะพััะธ ะฐะปะณะพัะธัะผะพะฒ ะฟะปะฐะฝะธัะพะฒะฐะฝะธั

### ะะพะณะดะฐ ะบะฐะบะพะน ะฐะปะณะพัะธัะผ ะะ ะฟะพะดัะพะดะธั

**FIFO/FCFS:**
- โ ะะฝัะตัะฐะบัะธะฒะฝัะต ัะธััะตะผั โ ะดะปะธะฝะฝะฐั ะทะฐะดะฐัะฐ ะฑะปะพะบะธััะตั ะฒัะต
- โ Real-time โ ะฝะตั ะณะฐัะฐะฝัะธะน ะฒัะตะผะตะฝะธ ะพัะบะปะธะบะฐ
- โ Batch processing ั ะฟะพัะพะถะธะผะธ ะทะฐะดะฐัะฐะผะธ

**Round Robin:**
- โ ะะฝะพะณะพ CPU-bound ะทะฐะดะฐั โ ะฒััะพะบะธะน overhead ะพั context switches
- โ Time quantum ัะปะธัะบะพะผ ะผะฐะปะตะฝัะบะธะน โ ะฑะพะปััะต switching ัะตะผ ัะฐะฑะพัั
- โ ะะฝัะตัะฐะบัะธะฒะฝัะต ัะธััะตะผั, time-sharing

**Priority Scheduling:**
- โ ะะตะท aging โ starvation ะฝะธะทะบะพะฟัะธะพัะธัะตัะฝัั ะทะฐะดะฐั
- โ Priority inversion ะฑะตะท mitigation
- โ ะกะธััะตะผั ั ัััะบะธะผ ัะฐะทะดะตะปะตะฝะธะตะผ ะฒะฐะถะฝะพััะธ ะทะฐะดะฐั

**CFS (Linux):**
- โ Hard real-time โ ะฝะต ะณะฐัะฐะฝัะธััะตั deadlines
- โ ะัะตะฝั ะบะพัะพัะบะธะต ะทะฐะดะฐัะธ โ overhead ะบัะฐัะฝะพ-ัััะฝะพะณะพ ะดะตัะตะฒะฐ
- โ General-purpose workloads, ัะตัะฒะตัั

---

## ะะปะธัะฝะธะต ะฝะฐ ะฟัะธะปะพะถะตะฝะธั

### Thread Pools

ะกะพะทะดะฐะฝะธะต ะฟะพัะพะบะฐ ะดะพัะพะณะพ. Thread pool ะฟะตัะตะธัะฟะพะปัะทัะตั ะฟะพัะพะบะธ:

```java
// ะะปะพัะพ: ัะพะทะดะฐะฒะฐัั ะฟะพัะพะบ ะฝะฐ ะบะฐะถะดัะน ะทะฐะฟัะพั
new Thread(() -> handleRequest(request)).start();

// ะฅะพัะพัะพ: thread pool
ExecutorService executor = Executors.newFixedThreadPool(100);
executor.submit(() -> handleRequest(request));
```

**ะะฐะทะผะตั pool:** ะะฐะฒะธัะธั ะพั ัะฐัะฐะบัะตัะฐ ะฝะฐะณััะทะบะธ.
- CPU-bound: ~ะบะพะปะธัะตััะฒะพ ัะดะตั
- I/O-bound: ะฑะพะปััะต (ะฟะพัะพะบะธ ะถะดัั I/O, CPU ะฟัะพััะฐะธะฒะฐะตั)

### Async I/O ะธ Event Loop

ะะผะตััะพ ะฟะพัะพะบะฐ ะฝะฐ ะบะฐะถะดะพะต ัะพะตะดะธะฝะตะฝะธะต โ ะพะดะธะฝ ะฟะพัะพะบ ะพะฑัะฐะฑะฐััะฒะฐะตั ะผะฝะพะณะพ ัะพะตะดะธะฝะตะฝะธะน:

```
Thread-per-request (ััะฐะดะธัะธะพะฝะฝัะน):
  10,000 ัะพะตะดะธะฝะตะฝะธะน = 10,000 ะฟะพัะพะบะพะฒ = ะผะฝะพะณะพ context switches

Event loop (Node.js, Netty):
  10,000 ัะพะตะดะธะฝะตะฝะธะน = 1-few ะฟะพัะพะบะพะฒ = ะผะธะฝะธะผัะผ context switches
```

ะะพะดัะพะฑะฝะตะต โ ะฒ [[jvm-executors-futures]] ะธ [[kotlin-coroutines]].

---

## ะัะฐะบัะธัะตัะบะธะต ะบะพะผะฐะฝะดั

```bash
# ะะพัะผะพััะตัั scheduling policy ะธ ะฟัะธะพัะธัะตั
ps -o pid,ni,pri,policy,comm

# ะกัะฐัะธััะธะบะฐ ะฟะปะฐะฝะธัะพะฒัะธะบะฐ
cat /proc/schedstat

# ะะฝัะพัะผะฐัะธั ะพ ะฟัะพัะตััะต
cat /proc/<pid>/sched

# CPU affinity
taskset -p <pid>              # ะะพะบะฐะทะฐัั ะผะฐัะบั
taskset -pc 0,1 <pid>         # ะฃััะฐะฝะพะฒะธัั

# ะะทะผะตะฝะธัั nice
nice -n 10 ./command          # ะะฐะฟัััะธัั ั nice=10
renice -n 5 -p <pid>          # ะะทะผะตะฝะธัั ะดะปั ัะฐะฑะพัะฐััะตะณะพ

# ะะพะฝะธัะพัะธะฝะณ context switches
vmstat 1 | awk '{print $12}'  # ะะพะปะพะฝะบะฐ cs
pidstat -w 1                   # ะะพ ะฟัะพัะตััะฐะผ
```

---

## ะัะพ ะธัะฟะพะปัะทัะตั ะธ ัะตะฐะปัะฝัะต ะฟัะธะผะตัั

### Linux CFS ะฒ ะฟัะพะดะฐะบัะตะฝะต

| ะะพะผะฟะฐะฝะธั | Scheduler | ะัะพะฑะตะฝะฝะพััะธ |
|----------|-----------|-------------|
| **Meta (2025)** | SCX-LAVD (ะฟะพะฒะตัั CFS) | ะะตะฟะปะพัั ะฝะฐ production ัะตัะฒะตัะฐั. ะะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปัะตั latency-sensitive ะทะฐะดะฐัะธ ะธ ะฟะพะฒััะฐะตั ะธะผ ะฟัะธะพัะธัะตั. ะกะฝะธะถะตะฝะธะต variance latency |
| **AWS Lambda** | CFS ั cgroups | 2,500+ ะบะพะฝัะตะนะฝะตัะพะฒ ะฟะพ 128MB ะฝะฐ ะฝะพะดะต. CFS group scheduling = 5-20% CPU ะฝะฐ context switching ะฒ dense packed ััะตะฝะฐัะธัั |
| **Android** | CFS + ะฟัะธะพัะธัะตัั | Foreground app ะฟะพะปััะฐะตั ะฑะพะปััะต CPU, background apps โ ะผะตะฝััะต. ะะปะฐะฒะฝัะน UI |
| **Steam Deck** | SCX-LAVD | ะะณัั ะฟะพะปััะฐัั ะฟัะธะพัะธัะตั, ัะพะฝะพะฒัะต ะทะฐะณััะทะบะธ โ ะฝะตั |

### ะญะฒะพะปััะธั Linux Scheduler

| ะะพะด | Scheduler | ะะทะผะตะฝะตะฝะธะต |
|-----|-----------|-----------|
| ะะพ 2007 | O(1) Scheduler | ะกะปะพะถะฝัะต ัะฒัะธััะธะบะธ, ะฟัะพะฑะปะตะผั ั fairness |
| 2007 | **CFS** (Linux 2.6.23) | Red-black tree, vruntime, "completely fair" |
| 2023 | **EEVDF** (Linux 6.6) | Earliest Eligible Virtual Deadline First โ ะปัััะต ะดะปั latency-sensitive ะทะฐะดะฐั |
| 2025 | SCX (Extensible Scheduler) | Pluggable schedulers ะธะท userspace โ ะผะพะถะฝะพ ะฟะพะดะบะปััะธัั ัะฒะพะน! |

### ะะฐัััะพะนะบะฐ ะดะปั ัะฐะทะฝัั workloads

| Workload | ะัะพะฑะปะตะผะฐ | ะะตัะตะฝะธะต |
|----------|----------|---------|
| **ะะตะฑ-ัะตัะฒะตั (I/O-bound)** | ะัะถะตะฝ ะฑัััััะน response time | Default CFS ัะพัะพัะพ ัะฟัะฐะฒะปัะตััั. Nice-ะทะฝะฐัะตะฝะธั ะดะปั ัะพะฝะพะฒัั ะทะฐะดะฐั |
| **ML Training (CPU-bound)** | ะัะถะตะฝ ะผะฐะบัะธะผัะผ throughput | `taskset` ะดะปั ะฟัะธะฒัะทะบะธ ะบ ัะดัะฐะผ, ะธะทะฑะตะณะฐัั context switches |
| **Realtime Audio/Video** | ะัะถะฝั deadline ะณะฐัะฐะฝัะธะธ | SCHED_FIFO ะธะปะธ SCHED_RR, PREEMPT_RT ะฟะฐัั |
| **ะะพะฝัะตะนะฝะตัั (mixed)** | Fair distribution ะผะตะถะดั ะบะพะฝัะตะนะฝะตัะฐะผะธ | cgroups cpu.shares, cpu.cfs_quota |

### ะัะฐะบัะธัะตัะบะธะต ัะธัะปะฐ

| ะะตััะธะบะฐ | ะะฝะฐัะตะฝะธะต | ะััะพัะฝะธะบ |
|---------|----------|----------|
| CFS targeted latency | ~20ms (default) | Linux kernel docs |
| CFS min_granularity | ~1ms | ะะธะฝะธะผะฐะปัะฝัะน timeslice |
| Context switch (ะฟััะผะพะน) | 1-3ยตs | Benchmarks |
| Context switch (ะฟะพะปะฝัะน, ั cache miss) | 10-30ยตs | Production measurements |
| CFS overhead ะฟัะธ 100 ะฟัะพัะตััะฐั | <1% CPU | ะขะธะฟะธัะฝัะน ัะตัะฒะตั |
| CFS overhead ะฟัะธ 2500+ ะบะพะฝัะตะนะฝะตัะพะฒ | 5-20% CPU | AWS Lambda research |

### Thread Pool sizing โ ะฟัะฐะฒะธะปะฐ

| ะขะธะฟ ะฝะฐะณััะทะบะธ | ะะตะบะพะผะตะฝะดะฐัะธั | ะะพัะตะผั |
|--------------|--------------|--------|
| **CPU-bound** | `threads = num_cores` | ะะพะปััะต ะฟะพัะพะบะพะฒ = ัะพะปัะบะพ overhead ะฝะฐ switch |
| **I/O-bound** | `threads = num_cores * (1 + wait_time/compute_time)` | ะะพัะพะบะธ ะถะดัั I/O, ะฝัะถะฝะพ ะฑะพะปััะต |
| **Mixed** | ะัะดะตะปัะฝัะต pools ะดะปั CPU ะธ I/O | ะะทะพะปััะธั workloads |

**ะัะธะผะตั:**
- 4 ัะดัะฐ, CPU-bound ะทะฐะดะฐัะธ โ 4 ะฟะพัะพะบะฐ
- 4 ัะดัะฐ, ะทะฐะดะฐัะธ 80% ะถะดัั I/O โ 4 * (1 + 4) = 20 ะฟะพัะพะบะพะฒ

---

## ะัะพะฒะตัั ัะตะฑั

<details>
<summary>1. ะะพัะตะผั Round Robin ั time quantum 1ms ััะถะต ัะตะผ ั 10ms?</summary>

**ะัะฒะตั:** Context switch ะทะฐะฝะธะผะฐะตั ~1-3ยตs ะฟััะผัั ะทะฐััะฐั + ะบะพัะฒะตะฝะฝัะต (TLB/cache invalidation). ะัะธ quantum 1ms ะธ switch 3ยตs โ 0.3% ะฒัะตะผะตะฝะธ ะฝะฐ switching. ะัะธ quantum 10ยตs โ ัะต ะถะต 0.3% ะฝะฐ 1000 switches/sec ะฒะผะตััะพ 100. ะกะปะธัะบะพะผ ัะฐัััะต switches = ะฑะพะปััะต overhead, ะผะตะฝััะต ะฟะพะปะตะทะฝะพะน ัะฐะฑะพัั. ะะพ ัะปะธัะบะพะผ ะฑะพะปััะพะน quantum = ะฟะปะพัะฐั ะพัะทัะฒัะธะฒะพััั ะดะปั ะธะฝัะตัะฐะบัะธะฒะฝัั ะทะฐะดะฐั.

</details>

<details>
<summary>2. ะงัะพ ัะฐะบะพะต convoy effect ะธ ะบะพะณะดะฐ ะพะฝ ะฒะพะทะฝะธะบะฐะตั?</summary>

**ะัะฒะตั:** Convoy effect โ ัะธััะฐัะธั ะบะพะณะดะฐ ะบะพัะพัะบะธะต I/O-bound ะฟัะพัะตััั ะฒััััะฐะธะฒะฐัััั ะทะฐ ะดะปะธะฝะฝัะผ CPU-bound ะฟัะพัะตััะพะผ. ะะพะทะฝะธะบะฐะตั ะฟัะธ FIFO scheduling. ะะปะธะฝะฝัะน ะฟัะพัะตัั ะทะฐะฝะธะผะฐะตั CPU, ะบะพัะพัะบะธะต ะถะดัั, CPU utilization ะฟะฐะดะฐะตั (ะบะพัะพัะบะธะต ะฟัะพัะตััั ะฑััััะพ ะพัะฒะพะฑะพะดะธะปะธ ะฑั CPU). ะะตัะตะฝะธะต: preemptive scheduling.

</details>

<details>
<summary>3. ะะฐะบ CFS ะพะฑะตัะฟะตัะธะฒะฐะตั "ัะฟัะฐะฒะตะดะปะธะฒะพััั"?</summary>

**ะัะฒะตั:** CFS ะพััะปะตะถะธะฒะฐะตั virtual runtime (vruntime) ะบะฐะถะดะพะณะพ ะฟัะพัะตััะฐ โ ัะบะพะปัะบะพ "ัะฟัะฐะฒะตะดะปะธะฒะพะณะพ" ะฒัะตะผะตะฝะธ ะพะฝ ะฟะพะปััะธะป. ะะปะฐะฝะธัะพะฒัะธะบ ะฒัะตะณะดะฐ ะฒัะฑะธัะฐะตั ะฟัะพัะตัั ั ะฝะฐะธะผะตะฝััะธะผ vruntime. ะัะพัะตััั ััะฐะฝัััั ะฒ ะบัะฐัะฝะพ-ัััะฝะพะผ ะดะตัะตะฒะต, ะพััะพััะธัะพะฒะฐะฝะฝะพะผ ะฟะพ vruntime. ะัะฑะพั ัะปะตะดัััะตะณะพ ะฟัะพัะตััะฐ โ O(1), ะฒััะฐะฒะบะฐ/ัะดะฐะปะตะฝะธะต โ O(log N). Nice value ะฒะปะธัะตั ะฝะฐ ัะบะพัะพััั ัะพััะฐ vruntime.

</details>

<details>
<summary>4. ะ ััะผ ัะฐะทะฝะธัะฐ ะผะตะถะดั preemptive ะธ cooperative scheduling?</summary>

**ะัะฒะตั:**
- **Preemptive:** ะะก ะผะพะถะตั ะฟัะตัะฒะฐัั ะฟัะพัะตัั ะฒ ะปัะฑะพะน ะผะพะผะตะฝั (ะฟะพ ัะฐะนะผะตัั ะธะปะธ ัะพะฑััะธั). ะัะพัะตัั ะฝะต ะบะพะฝััะพะปะธััะตั ะบะพะณะดะฐ ะตะณะพ ะฟัะตัะฒัั.
- **Cooperative:** ะัะพัะตัั ัะฐะผ ะพัะดะฐัั CPU (yield). ะัะปะธ ะฝะต ะพัะดะฐัั โ ะดััะณะธะต ะถะดัั.

ะกะพะฒัะตะผะตะฝะฝัะต ะะก ะธัะฟะพะปัะทััั preemptive. Cooperative ะพััะฐะปัั ะฒ ะฝะตะบะพัะพััั embedded ัะธััะตะผะฐั ะธ green threads (goroutines ัะฐััะธัะฝะพ cooperative).

</details>

---

## ะกะฒัะทั ั ะดััะณะธะผะธ ัะตะผะฐะผะธ

**[[os-overview]]** โ ะะฑะทะพั ะะก ะพะฑัััะฝัะตั ะผะตัะฐะฝะธะทะผ context switch, ะบะพัะพััะน ะฟะปะฐะฝะธัะพะฒัะธะบ ะธะฝะธัะธะธััะตั ะฟัะธ ะบะฐะถะดะพะผ ะฟะตัะตะบะปััะตะฝะธะธ ะทะฐะดะฐัะธ: ัะพััะฐะฝะตะฝะธะต ัะตะณะธัััะพะฒ ัะตะบััะตะณะพ ะฟะพัะพะบะฐ, ะทะฐะณััะทะบะฐ ัะตะณะธัััะพะฒ ัะปะตะดัััะตะณะพ, ะฟะตัะตะบะปััะตะฝะธะต ััะตะบะฐ. ะะตะท ะฟะพะฝะธะผะฐะฝะธั ัะฐะทะดะตะปะตะฝะธั kernel/user mode ะฝะตะฒะพะทะผะพะถะฝะพ ะพัะพะทะฝะฐัั, ะฟะพัะตะผั timer interrupt โ ะพัะฝะพะฒะฐ preemptive scheduling: hardware ัะฐะนะผะตั ะณะตะฝะตัะธััะตั ะฟัะตััะฒะฐะฝะธะต, CPU ะฟะตัะตัะพะดะธั ะฒ kernel mode, ะธ ะฟะปะฐะฝะธัะพะฒัะธะบ ะฟะพะปััะฐะตั ะฒะพะทะผะพะถะฝะพััั ัะตัะธัั, ะบะฐะบะพะน ะฟะพัะพะบ ะทะฐะฟััะบะฐัั ัะปะตะดัััะธะผ. ะะพะฝัะตะฟัะธั ัะธััะตะผะฝัั ะฒัะทะพะฒะพะฒ ัะฐะบะถะต ัะฒัะทะฐะฝะฐ ั ะฟะปะฐะฝะธัะพะฒะฐะฝะธะตะผ: ะปัะฑะพะน ะฑะปะพะบะธััััะธะน syscall (read, wait) ะฟะตัะตะฒะพะดะธั ะฟะพัะพะบ ะฒ ัะพััะพัะฝะธะต Blocked, ะธ ะฟะปะฐะฝะธัะพะฒัะธะบ ะฒัะฑะธัะฐะตั ะดััะณะพะน Ready-ะฟะพัะพะบ.

**[[os-processes-threads]]** โ ะัะพัะตััั ะธ ะฟะพัะพะบะธ โ ััะพ ะธะผะตะฝะฝะพ ัะต ัััะฝะพััะธ, ะบะพัะพััะต ะฟะปะฐะฝะธัะพะฒัะธะบ ัะฐัะฟัะตะดะตะปัะตั ะฟะพ CPU. ะกะพััะพัะฝะธั ะฟัะพัะตััะฐ (New, Ready, Running, Blocked, Terminated) ัะพัะผะธัััั ะพัะฝะพะฒั ัะฐะฑะพัั scheduling: ะฟะปะฐะฝะธัะพะฒัะธะบ ะฑะตััั ะฟะพัะพะบะธ ะธะท Ready-ะพัะตัะตะดะธ ะธ ะฟะตัะตะฒะพะดะธั ะธั ะฒ Running, ะฐ ะฟัะธ ะฑะปะพะบะธััััะตะน ะพะฟะตัะฐัะธะธ ะธะปะธ ะธััะตัะตะฝะธะธ ะบะฒะฐะฝัะฐ โ ะพะฑัะฐัะฝะพ ะฒ Ready ะธะปะธ Blocked. ะ Linux ะฟะปะฐะฝะธัะพะฒัะธะบ CFS ัะฐะฑะพัะฐะตั ั task_struct, ะบะพัะพัะฐั ะฟัะตะดััะฐะฒะปัะตั ะบะฐะบ ะฟัะพัะตััั, ัะฐะบ ะธ ะฟะพัะพะบะธ (ัะตัะตะท clone()), ะธ ะธัะฟะพะปัะทัะตั vruntime ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั ยซัะฟัะฐะฒะตะดะปะธะฒะพััะธยป ัะฐัะฟัะตะดะตะปะตะฝะธั CPU. ะะพะฝะธะผะฐะฝะธะต ัะฐะทะฝะธัั ะผะตะถะดั user-level ะธ kernel-level threads ะบัะธัะธัะฝะพ: 1:1 ะผะพะดะตะปั ะพะทะฝะฐัะฐะตั, ััะพ ะะก ะฒะธะดะธั ะธ ะฟะปะฐะฝะธััะตั ะบะฐะถะดัะน ะฟะพัะพะบ, ัะพะณะดะฐ ะบะฐะบ ะฒ M:N ะผะพะดะตะปะธ ะฟะพะปัะทะพะฒะฐัะตะปััะบะธะน runtime ะฒัะฟะพะปะฝัะตั ัะพะฑััะฒะตะฝะฝะพะต ะฟะปะฐะฝะธัะพะฒะฐะฝะธะต ะฟะพะฒะตัั ะฝะตัะบะพะปัะบะธั OS threads.

**[[os-synchronization]]** โ ะกะธะฝััะพะฝะธะทะฐัะธั ะธ ะฟะปะฐะฝะธัะพะฒะฐะฝะธะต ะฒะทะฐะธะผะพะดะตะนััะฒััั ัะตัะตะท ะฟัะพะฑะปะตะผั priority inversion: ะบะพะณะดะฐ ะฒััะพะบะพะฟัะธะพัะธัะตัะฝัะน ะฟะพัะพะบ ะพะถะธะดะฐะตั mutex, ะทะฐัะฒะฐัะตะฝะฝัะน ะฝะธะทะบะพะฟัะธะพัะธัะตัะฝัะผ ะฟะพัะพะบะพะผ, ะฐ ััะตะดะฝะตะฟัะธะพัะธัะตัะฝัะน ะฟะพัะพะบ ะทะฐะฝะธะผะฐะตั CPU โ ะฒััะพะบะพะฟัะธะพัะธัะตัะฝัะน ะฑะปะพะบะธััะตััั ะฝะฐ ะฝะตะพะฟัะตะดะตะปัะฝะฝะพะต ะฒัะตะผั. ะะตัะตะฝะธั (priority inheritance, priority ceiling) ััะตะฑััั ะบะพะพัะดะธะฝะฐัะธะธ ะผะตะถะดั ะฟะปะฐะฝะธัะพะฒัะธะบะพะผ ะธ ะผะตัะฐะฝะธะทะผะพะผ ะฑะปะพะบะธัะพะฒะพะบ: ะฟะปะฐะฝะธัะพะฒัะธะบ ะฒัะตะผะตะฝะฝะพ ะฟะพะฒััะฐะตั ะฟัะธะพัะธัะตั ะฒะปะฐะดะตะปััะฐ mutex ะดะพ ััะพะฒะฝั ะพะถะธะดะฐััะตะณะพ ะฟะพัะพะบะฐ. Spinlocks ัะฐะบะถะต ัะฒัะทะฐะฝั ั scheduling: ะตัะปะธ ะฟะพัะพะบ, ะดะตัะถะฐัะธะน spinlock, ะฒััะตัะฝัะตััั ะฟะปะฐะฝะธัะพะฒัะธะบะพะผ, ะฒัะต ะพะถะธะดะฐััะธะต ะฟะพัะพะบะธ ััะฐััั ัะฒะพะธ ะบะฒะฐะฝัั ะฝะฐ ะฑะตัะฟะพะปะตะทะฝะพะต ะฒัะฐัะตะฝะธะต. ะัะฑะพั ะผะตะถะดั mutex (ะฑะปะพะบะธััััะธะน, ะฒัะทัะฒะฐะตั ะฟะตัะตะฟะปะฐะฝะธัะพะฒะฐะฝะธะต) ะธ spinlock (ะฝะต ะฑะปะพะบะธััััะธะน, ะฟะพััะตะฑะปัะตั CPU) ะทะฐะฒะธัะธั ะพั ะพะถะธะดะฐะตะผะพะณะพ ะฒัะตะผะตะฝะธ ะพะถะธะดะฐะฝะธั ะพัะฝะพัะธัะตะปัะฝะพ ััะพะธะผะพััะธ context switch.

**[[jvm-executors-futures]]** โ JVM Executor framework ัะตะฐะปะธะทัะตั ะฟะปะฐะฝะธัะพะฒะฐะฝะธะต ะทะฐะดะฐั ะฒ userspace ะฟะพะฒะตัั OS scheduling: ThreadPoolExecutor ัะฟัะฐะฒะปัะตั ะฟัะปะพะผ OS threads ะธ ัะฐัะฟัะตะดะตะปัะตั Runnable/Callable ะทะฐะดะฐัะธ ะผะตะถะดั ะฝะธะผะธ. ะญัะพ ะดะฒััััะพะฒะฝะตะฒะพะต ะฟะปะฐะฝะธัะพะฒะฐะฝะธะต: ะะก ะฟะปะฐะฝะธััะตั ะฟะพัะพะบะธ ะฟัะปะฐ, ะฐ Executor ะฟะปะฐะฝะธััะตั ะทะฐะดะฐัะธ ะฝะฐ ะฟะพัะพะบะธ, ะฟัะธััะผ ะบะฐะถะดัะน ััะพะฒะตะฝั ะธะผะตะตั ัะพะฑััะฒะตะฝะฝัะต ะฟะพะปะธัะธะบะธ โ CFS ะฝะฐ ััะพะฒะฝะต ะะก ะธ work queue ะฝะฐ ััะพะฒะฝะต Executor. ForkJoinPool ะธัะฟะพะปัะทัะตั work-stealing ะฐะปะณะพัะธัะผ โ ะบะพะณะดะฐ ะฟะพัะพะบ ะทะฐะฒะตััะฐะตั ัะฒะพะธ ะทะฐะดะฐัะธ, ะพะฝ ยซะบัะฐะดััยป ะทะฐะดะฐัะธ ะธะท ะพัะตัะตะดะตะน ะดััะณะธั ะฟะพัะพะบะพะฒ, ััะพ ะผะธะฝะธะผะธะทะธััะตั idle time ะธ ะฑะฐะปะฐะฝัะธััะตั ะฝะฐะณััะทะบั. ะะพะฝะธะผะฐะฝะธะต OS scheduling ะฟะพะผะพะณะฐะตั ะฝะฐัััะฐะธะฒะฐัั ะฟัะปั: core pool size ะดะพะปะถะตะฝ ัะพะพัะฒะตัััะฒะพะฒะฐัั ะบะพะปะธัะตััะฒั CPU cores ะดะปั CPU-bound ะทะฐะดะฐั ะธ ะฑััั ะฑะพะปััะต ะดะปั IO-bound (ัะพัะผัะปะฐ N_threads = N_cores ร (1 + W/C), ะณะดะต W/C โ ะพัะฝะพัะตะฝะธะต wait time ะบ compute time).

**ะกะฒัะทะฐะฝะฝัะต ะบะพะฝัะตะฟัะธะธ:**
- [[os-memory-management]] โ TLB flush ะฟัะธ context switch ะผะตะถะดั ะฟัะพัะตััะฐะผะธ
- [[jvm-concurrency-overview]] โ Thread.yield(), thread priorities ะฒ JVM
- [[kotlin-coroutines]] โ Dispatchers ัะฐัะฟัะตะดะตะปััั ะบะพัััะธะฝั ะฟะพ ะฟะพัะพะบะฐะผ, ะฝะพ ัะฐะผ scheduling ะบะพัััะธะฝ โ ะฒ userspace

---

## ะะตะบะพะผะตะฝะดัะตะผัะต ะธััะพัะฝะธะบะธ

### ะัะธัะธะฐะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
- [CFS Scheduler โ Linux Kernel docs](https://docs.kernel.org/scheduler/sched-design-CFS.html) โ ะพัะธัะธะฐะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
- [Red Hat: Tuning Scheduling Policy](https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/monitoring_and_managing_system_status_and_performance/tuning-scheduling-policy) โ ะฟัะฐะบัะธัะตัะบะพะต ััะบะพะฒะพะดััะฒะพ

### ะฃัะตะฑะฝะธะบะธ

- Tanenbaum A., Bos H. (2014). *"Modern Operating Systems, 4th Edition."* โ ะณะปะฐะฒะฐ 2.4 (Scheduling) ะฟะพะบััะฒะฐะตั ะฒัะต ะบะปะฐััะธัะตัะบะธะต ะฐะปะณะพัะธัะผั (FCFS, SJF, RR, Priority, MLFQ) ั ะผะฐัะตะผะฐัะธัะตัะบะธะผ ะฐะฝะฐะปะธะทะพะผ ะธ ััะฐะฒะฝะตะฝะธะตะผ; ะดะพะฟะพะปะฝะธัะตะปัะฝะพ ะณะปะฐะฒะฐ 10 (Case Study: UNIX/Linux) ัะฐะทะฑะธัะฐะตั CFS.
- Silberschatz A., Galvin P., Gagne G. (2018). *"Operating System Concepts, 10th Edition."* โ ะณะปะฐะฒะฐ 5 (CPU Scheduling) ะธ ะณะปะฐะฒะฐ 6 (Synchronization Tools) โ ัะพัะผะฐะปัะฝัะต ะพะฟัะตะดะตะปะตะฝะธั scheduling criteria (turnaround time, waiting time, response time) ั ัะตััะฝะฝัะผะธ ะทะฐะดะฐัะฐะผะธ; ะธะดะตะฐะปะตะฝ ะดะปั ะฟะพะดะณะพัะพะฒะบะธ ะบ ัะบะทะฐะผะตะฝะฐะผ.
- Arpaci-Dusseau R., Arpaci-Dusseau A. (2018). *"Operating Systems: Three Easy Pieces."* โ ะณะปะฐะฒั 7-10 (Scheduling) โ ะพั ะฝะฐะธะฒะฝะพะณะพ FIFO ะดะพ MLFQ ั ะธะฝัะตัะฐะบัะธะฒะฝัะผะธ ัะธะผัะปััะพัะฐะผะธ; ะฑะตัะฟะปะฐัะฝะพ ะธ ั ะพัะปะธัะฝัะผะธ ะฐะฝะฐะปะพะณะธัะผะธ.
- Bryant R., O'Hallaron D. (2015). *"Computer Systems: A Programmer's Perspective, 3rd Edition."* โ ะณะปะฐะฒะฐ 8 (Exceptional Control Flow) ะพะฑัััะฝัะตั, ะบะฐะบ signals ะธ interrupts ัะฒัะทะฐะฝั ั preemptive scheduling; ะณะปะฐะฒะฐ 12 (Concurrent Programming) โ ะฒะปะธัะฝะธะต scheduling ะฝะฐ ะผะฝะพะณะพะฟะพัะพัะฝัะน ะบะพะด.
- Love R. (2010). *"Linux Kernel Development, 3rd Edition."* โ ะณะปะฐะฒะฐ 4 (Process Scheduling) โ ะดะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต O(1) scheduler ะธ CFS ั ะฐะฝะฐะปะธะทะพะผ ะธััะพะดะฝะพะณะพ ะบะพะดะฐ ัะดัะฐ Linux; ะพะฑัััะฝัะตั real-time scheduling ะบะปะฐััั (SCHED_FIFO, SCHED_RR).

### ะะฝะธะณะธ ะธ ะบัััั
- [OSTEP: Scheduling chapters](https://pages.cs.wisc.edu/~remzi/OSTEP/cpu-sched.pdf) โ ะฑะตัะฟะปะฐัะฝะฐั ะบะฝะธะณะฐ, ะณะปะฐะฒั 7-10
- [CS 341 Illinois: Scheduling](https://cs341.cs.illinois.edu/coursebook/Scheduling) โ ัะฝะธะฒะตััะธัะตััะบะธะน ะบััั

### ะกัะฐััะธ ะธ ัััะพัะธะฐะปั
- [Opensource.com: CFS in Linux](https://opensource.com/article/19/2/fair-scheduling-linux) โ ะพัะปะธัะฝะพะต ะพะฑัััะฝะตะฝะธะต CFS
- [CodeLucky: CPU Scheduling Algorithms](https://codelucky.com/cpu-scheduling-algorithms/) โ ััะฐะฒะฝะตะฝะธะต ะฐะปะณะพัะธัะผะพะฒ
- [LWN: EEVDF scheduler](https://lwn.net/Articles/925371/) โ ะฝะพะฒัะน scheduler ะฒ Linux 6.6

### ะะพะฒะพััะธ ะธ ะธััะปะตะดะพะฒะฐะฝะธั
- [Runable: SCX-LAVD at Meta](https://runable.blog/posts/scx-lavd-how-steam-deck-s-linux-scheduler-is-reshaping-data-) โ ะบะฐะบ Meta ะธัะฟะพะปัะทัะตั Steam Deck scheduler
- [arXiv: Latency-Aware Group Scheduling](https://arxiv.org/html/2508.15703v1) โ ะธััะปะตะดะพะฒะฐะฝะธะต ะพ context switching ะฒ serverless

---

*ะะฑะฝะพะฒะปะตะฝะพ: 2026-01-09 โ ะดะพะฑะฐะฒะปะตะฝั ะฟะตะดะฐะณะพะณะธัะตัะบะธะต ัะตะบัะธะธ (5 ะฐะฝะฐะปะพะณะธะน: ะดะธัะฟะตััะตั ะฐััะพะฟะพััะฐ, ะพัะธัะธะฐะฝั ะฒ ัะตััะพัะฐะฝะต, ะบะฐัะฐะพะบะต/quantum, ัะบัะฟัะตัั-ะบะฐััะฐ SJF, CFS red-black tree; 6 ัะธะฟะธัะฝัั ะพัะธะฑะพะบ: ะฑะพะปััะต ะฟะพัะพะบะพะฒโะฑััััะตะต, CPU/IO-bound ัะฐะทะปะธัะธั, priority inversion, starvation, real-time quantum, convoy effect; 5 ะผะตะฝัะฐะปัะฝัั ะผะพะดะตะปะตะน: ัะฐะฑะปะธัะฐ ะฐะปะณะพัะธัะผะพะฒ, ัะพััะพัะฝะธั ะฟัะพัะตััะฐ, Gantt chart, CFS ะฒะตัั, MLFQ)*
