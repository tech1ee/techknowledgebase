---
title: "Database Monitoring & Security: pg_stat, RLS, encryption"
created: 2025-12-22
modified: 2025-12-22
type: concept
status: published
confidence: high
tags:
  - topic/databases
  - monitoring
  - topic/security
  - postgresql
  - performance
  - type/concept
  - level/intermediate
related:
  - "[[databases-overview]]"
  - "[[database-design-optimization]]"
  - "[[security-overview]]"
  - "[[observability]]"
---

# Database Monitoring & Security: pg_stat, RLS, encryption

> ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ğ´Ğ¾ Ñ‚Ğ¾Ğ³Ğ¾, ĞºĞ°Ğº Ğ¾Ğ½Ğ¸ ÑÑ‚Ğ°Ğ½ÑƒÑ‚ Ğ¸Ğ½Ñ†Ğ¸Ğ´ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸. Security Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾Ñ‚ ÑƒÑ‚ĞµÑ‡ĞµĞº Ğ¸ Ğ½ĞµÑĞ°Ğ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°.

---

## TL;DR

**ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³:**
- `pg_stat_statements` â€” ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (must have)
- `pg_stat_activity` â€” Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¸ Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
- ĞĞ»ĞµÑ€Ñ‚Ñ‹ Ğ½Ğ°: slow queries, connections, replication lag, disk space

**Security:**
- **RLS** â€” Row-Level Security Ğ´Ğ»Ñ multi-tenant
- **Encryption at rest** â€” TDE Ğ¸Ğ»Ğ¸ filesystem encryption
- **Encryption in transit** â€” SSL/TLS Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
- **Least privilege** â€” Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

---

## Ğ§Ğ°ÑÑ‚ÑŒ 1: Ğ˜Ğ½Ñ‚ÑƒĞ¸Ñ†Ğ¸Ñ Ğ±ĞµĞ· ĞºĞ¾Ğ´Ğ°

### ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ 1: ĞÑ…Ñ€Ğ°Ğ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ (Defense in Depth)

Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ Ğ‘Ğ” Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ°Ğº Ğ¼Ğ½Ğ¾Ğ³Ğ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ğ°Ñ Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ° Ğ½ĞµĞ±Ğ¾ÑĞºÑ€Ñ‘Ğ±Ğ°:

```
Ğ—Ğ”ĞĞĞ˜Ğ• = Ğ‘ĞĞ—Ğ Ğ”ĞĞĞĞ«Ğ¥

Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 1: Ğ—ĞĞ‘ĞĞ  + ĞšĞŸĞŸ (Network security)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ Firewall â€” ĞºÑ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ´Ğ°Ğ¶Ğµ Ğ¿Ğ¾Ğ´Ğ¾Ğ¹Ñ‚Ğ¸?                   â”‚
â”‚  â€¢ VPN â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¸ ÑĞµÑ‚Ğ¸                               â”‚
â”‚  â€¢ SSL/TLS â€” ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ½Ğ°Ğ»                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 2: Ğ Ğ•Ğ¡Ğ•ĞŸĞ¨Ğ (Authentication)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ pg_hba.conf â€” ĞºÑ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²Ğ¾Ğ¹Ñ‚Ğ¸?                       â”‚
â”‚  â€¢ SCRAM-SHA-256 â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ                      â”‚
â”‚  â€¢ Ğ¡ĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ñ‹ â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 3: ĞŸĞ ĞĞŸĞ£Ğ¡Ğš ĞĞ Ğ­Ğ¢ĞĞ– (Authorization - RBAC)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ GRANT/REVOKE â€” ĞºĞ°ĞºĞ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹?               â”‚
â”‚  â€¢ Ğ Ğ¾Ğ»Ğ¸ â€” ÑƒĞ±Ğ¾Ñ€Ñ‰Ğ¸Ğº Ğ½Ğµ Ğ·Ğ°Ğ¹Ğ´Ñ‘Ñ‚ Ğ² ÑĞµÑ€Ğ²ĞµÑ€Ğ½ÑƒÑ                 â”‚
â”‚  â€¢ Ğ¡Ñ…ĞµĞ¼Ñ‹ â€” Ğ¾Ñ‚Ğ´ĞµĞ»Ñ‹ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 4: ĞšĞ›Ğ®Ğ§ ĞĞ¢ ĞšĞĞ‘Ğ˜ĞĞ•Ğ¢Ğ (Row-Level Security)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ RLS â€” Ğ²Ğ¸Ğ´Ğ¸ÑˆÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¡Ğ’ĞĞ˜ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ² ÑˆĞºĞ°Ñ„Ñƒ           â”‚
â”‚  â€¢ Ğ”Ğ°Ğ¶Ğµ Ğ²Ğ¾Ğ¹Ğ´Ñ Ğ² ĞºĞ°Ğ±Ğ¸Ğ½ĞµÑ‚, Ğ½Ğµ Ğ¾Ñ‚ĞºÑ€Ğ¾ĞµÑˆÑŒ Ñ‡ÑƒĞ¶Ğ¾Ğ¹ ÑĞµĞ¹Ñ„        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 5: ĞšĞĞœĞ•Ğ Ğ« + Ğ¡Ğ˜Ğ“ĞĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ (Monitoring + Audit)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ pg_stat_statements â€” ĞºÑ‚Ğ¾ Ñ‡Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ğ»?                  â”‚
â”‚  â€¢ pgAudit â€” Ğ¶ÑƒÑ€Ğ½Ğ°Ğ» Ğ²ÑĞµÑ… Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹                       â”‚
â”‚  â€¢ ĞĞ»ĞµÑ€Ñ‚Ñ‹ â€” ĞºÑ‚Ğ¾-Ñ‚Ğ¾ Ğ»Ğ¾Ğ¼Ğ¸Ñ‚ÑÑ Ğ² 3 Ğ½Ğ¾Ñ‡Ğ¸!                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ Ğ¸Ğ´ĞµÑ:** Ğ•ÑĞ»Ğ¸ Ğ²Ğ·Ğ»Ğ¾Ğ¼Ğ°Ğ»Ğ¸ Ğ¾Ğ´Ğ¸Ğ½ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ â€” Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ²ÑÑ‘ ĞµÑ‰Ñ‘ Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ğ°ÑÑ‚.

### ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ 2: Ğ¤ĞµĞ¹ÑĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ² VIP-ĞºĞ»ÑƒĞ±Ğµ (Row-Level Security)

ĞŸÑ€ĞµĞ´ÑÑ‚Ğ°Ğ²ÑŒ Ğ½Ğ¾Ñ‡Ğ½Ğ¾Ğ¹ ĞºĞ»ÑƒĞ± Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¼Ğ¸ Ğ·Ğ¾Ğ½Ğ°Ğ¼Ğ¸:

```
Ğ‘Ğ•Ğ— RLS (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ²Ñ…Ğ¾Ğ´Ğµ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞÑ…Ñ€Ğ°Ğ½Ğ½Ğ¸Ğº: "Ğ¢Ñ‹ Ğ² ÑĞ¿Ğ¸ÑĞºĞµ VIP?"                           â”‚
â”‚  Ğ“Ğ¾ÑÑ‚ÑŒ: "Ğ”Ğ°!"                                           â”‚
â”‚  ĞÑ…Ñ€Ğ°Ğ½Ğ½Ğ¸Ğº: "ĞŸÑ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸ ĞºÑƒĞ´Ğ° Ñ…Ğ¾Ñ‡ĞµÑˆÑŒ..."                     â”‚
â”‚                                                         â”‚
â”‚  ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: ĞÑ…Ñ€Ğ°Ğ½Ğ½Ğ¸Ğº Ğ·Ğ°Ğ±Ñ‹Ğ» ÑĞ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ â†’ Ğ³Ğ¾ÑÑ‚ÑŒ Ğ²ĞµĞ·Ğ´Ğµ!       â”‚
â”‚           (Ğ·Ğ°Ğ±Ñ‹Ğ» WHERE tenant_id = ?)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ğ¡ RLS (Ğ±Ñ€Ğ°ÑĞ»ĞµÑ‚ Ğ½Ğ° Ñ€ÑƒĞºĞµ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞĞ° Ğ²Ñ…Ğ¾Ğ´Ğµ: "Ğ’Ğ¾Ñ‚ Ñ‚ĞµĞ±Ğµ ĞšĞ ĞĞ¡ĞĞ«Ğ™ Ğ±Ñ€Ğ°ÑĞ»ĞµÑ‚"                   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Ğ—Ğ¾Ğ½Ğ° VIP      â”‚  â”‚ Ğ—Ğ¾Ğ½Ğ° Premium  â”‚                   â”‚
â”‚  â”‚ ğŸ”´ ĞšĞ ĞĞ¡ĞĞ«Ğ•    â”‚  â”‚ ğŸ”µ Ğ¡Ğ˜ĞĞ˜Ğ•      â”‚                   â”‚
â”‚  â”‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾        â”‚  â”‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾        â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                         â”‚
â”‚  Ğ¢ÑƒÑ€Ğ½Ğ¸ĞºĞµÑ‚ ĞĞ’Ğ¢ĞĞœĞĞ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ½Ğµ Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ ÑĞ¸Ğ½ĞµĞ³Ğ¾ Ğ² ĞºÑ€Ğ°ÑĞ½ÑƒÑ!    â”‚
â”‚  ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ "Ğ·Ğ°Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ğ’ PostgreSQL:
SET app.current_tenant = 'red';   -- Ğ‘Ñ€Ğ°ÑĞ»ĞµÑ‚
SELECT * FROM orders;              -- Ğ¢ÑƒÑ€Ğ½Ğ¸ĞºĞµÑ‚ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸
```

### ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ 3: Ğ‘Ğ°Ğ½ĞºĞ¾Ğ²ÑĞºĞ¸Ğ¹ ÑĞµĞ¹Ñ„ (Encryption Layers)

Ğ¢Ñ€Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ñ†ĞµĞ½Ğ½Ğ¾ÑÑ‚ĞµĞ¹:

```
Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 1: Ğ”Ğ’Ğ•Ğ Ğ¬ Ğ‘ĞĞĞšĞ (Encryption in Transit)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ‘Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ²ĞµÑ€Ğ¸ = SSL/TLS                          â”‚
â”‚                                                         â”‚
â”‚  ĞšĞ»Ğ¸ĞµĞ½Ñ‚ â”€â”€â”€â”€[ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ½Ğ°Ğ»]â”€â”€â”€â”€â–¶ Ğ‘Ğ°Ğ½Ğº               â”‚
â”‚                                                         â”‚
â”‚  Ğ—Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ ĞĞ¢: Ğ¿Ğ¾Ğ´ÑĞ»ÑƒÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ñ, man-in-the-middle         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 2: Ğ¥Ğ ĞĞĞ˜Ğ›Ğ˜Ğ©Ğ• (Encryption at Rest)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¡Ñ‚ĞµĞ½Ñ‹ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğ° = Filesystem/TDE encryption            â”‚
â”‚                                                         â”‚
â”‚  Ğ”Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ ÑƒĞºÑ€Ğ°Ğ»Ğ¸ Ğ´Ğ¸ÑĞº â†’ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹            â”‚
â”‚                                                         â”‚
â”‚  Ğ—Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ ĞĞ¢: ĞºÑ€Ğ°Ğ¶Ğ¸ Ğ¾Ğ±Ğ¾Ñ€ÑƒĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ, Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 3: Ğ˜ĞĞ”Ğ˜Ğ’Ğ˜Ğ”Ğ£ĞĞ›Ğ¬ĞĞ«Ğ• Ğ¯Ğ§Ğ•Ğ™ĞšĞ˜ (Column-level encryption)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ›Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ÑĞµĞ¹Ñ„ Ñ Ğ²Ğ°ÑˆĞ¸Ğ¼ ĞºĞ»ÑÑ‡Ğ¾Ğ¼ = pgcrypto                  â”‚
â”‚                                                         â”‚
â”‚  SSN:     pgp_sym_encrypt('123-45-6789', 'my-key')     â”‚
â”‚  Card:    pgp_sym_encrypt('4111...', 'my-key')         â”‚
â”‚                                                         â”‚
â”‚  Ğ”Ğ°Ğ¶Ğµ DBA Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ±ĞµĞ· ĞºĞ»ÑÑ‡Ğ°!                 â”‚
â”‚                                                         â”‚
â”‚  Ğ—Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ ĞĞ¢: Ğ¸Ğ½ÑĞ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ², ĞºĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ°Ñ†Ğ¸Ğ¸ DBA            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ 4: Ğ‘Ğ¾Ğ»ÑŒĞ½Ğ¸Ñ†Ğ° Ñ Ğ¼ĞµĞ´ĞºĞ°Ñ€Ñ‚Ğ°Ğ¼Ğ¸ (Least Privilege)

Ğ’ Ğ±Ğ¾Ğ»ÑŒĞ½Ğ¸Ñ†Ğµ Ğ½Ğµ Ğ²ÑĞµ Ğ¸Ğ¼ĞµÑÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ ĞºĞ¾ Ğ²ÑĞµĞ¼ ĞºĞ°Ñ€Ñ‚Ğ°Ğ¼:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ£Ğ‘ĞĞ Ğ©Ğ˜Ğš (guest)                                        â”‚
â”‚  â€¢ ĞœĞ¾Ğ¶ĞµÑ‚: Ğ²Ğ¾Ğ¹Ñ‚Ğ¸ Ğ² Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ                                â”‚
â”‚  â€¢ ĞĞµĞ»ÑŒĞ·Ñ: Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ñ‹, Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ             â”‚
â”‚                                                         â”‚
â”‚  ĞœĞ•Ğ”Ğ¡Ğ•Ğ¡Ğ¢Ğ Ğ (app_user)                                   â”‚
â”‚  â€¢ ĞœĞ¾Ğ¶ĞµÑ‚: Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ñ‹ ÑĞ²Ğ¾ĞµĞ³Ğ¾ Ğ¾Ñ‚Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ                â”‚
â”‚  â€¢ ĞœĞ¾Ğ¶ĞµÑ‚: Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ                          â”‚
â”‚  â€¢ ĞĞµĞ»ÑŒĞ·Ñ: Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ·Ñ‹, ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸             â”‚
â”‚                                                         â”‚
â”‚  Ğ’Ğ ĞĞ§ (doctor_role)                                     â”‚
â”‚  â€¢ ĞœĞ¾Ğ¶ĞµÑ‚: Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ/Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ñ‹ ÑĞ²Ğ¾Ğ¸Ñ… Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²          â”‚
â”‚  â€¢ ĞœĞ¾Ğ¶ĞµÑ‚: ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ·Ñ‹                              â”‚
â”‚  â€¢ ĞĞµĞ»ÑŒĞ·Ñ: ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸                        â”‚
â”‚                                                         â”‚
â”‚  Ğ“Ğ›ĞĞ’Ğ’Ğ ĞĞ§ (admin)                                       â”‚
â”‚  â€¢ ĞœĞ¾Ğ¶ĞµÑ‚: Ğ²ÑÑ‘ Ğ² Ñ€Ğ°Ğ¼ĞºĞ°Ñ… Ğ±Ğ¾Ğ»ÑŒĞ½Ğ¸Ñ†Ñ‹                         â”‚
â”‚  â€¢ ĞĞµĞ»ÑŒĞ·Ñ: ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸                      â”‚
â”‚                                                         â”‚
â”‚  ĞœĞ˜ĞĞ—Ğ”Ğ ĞĞ’ (superuser)                                   â”‚
â”‚  â€¢ ĞœĞ¾Ğ¶ĞµÑ‚: Ğ²Ğ¾Ğ¾Ğ±Ñ‰Ğµ Ğ²ÑÑ‘                                    â”‚
â”‚  â€¢ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ: Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ² ÑĞºÑÑ‚Ñ€ĞµĞ½Ğ½Ñ‹Ñ… ÑĞ»ÑƒÑ‡Ğ°ÑÑ…!          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ğ´Ğ°ÑÑ‚ Ğ¿Ñ€Ğ°Ğ²Ğ° ĞœĞ•Ğ”Ğ¡Ğ•Ğ¡Ğ¢Ğ Ğ«, Ğ½Ğµ Ğ“Ğ›ĞĞ’Ğ’Ğ ĞĞ§Ğ!
```

### ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ 5: Ğ’Ğ¸Ğ´ĞµĞ¾Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Ğ² Ñ‚Ğ°ĞºÑĞ¸ (Monitoring + Audit)

ĞŸÑ€ĞµĞ´ÑÑ‚Ğ°Ğ²ÑŒ Ñ‚Ğ°ĞºÑĞ¸ Ñ Ğ²Ğ¸Ğ´ĞµĞ¾Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼:

```
Ğ—ĞĞ§Ğ•Ğœ ĞšĞĞœĞ•Ğ Ğ?
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¡Ğ¢Ğ¬                                        â”‚
â”‚     ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€ Ğ²ĞµĞ´Ñ‘Ñ‚ ÑĞµĞ±Ñ Ğ°Ğ´ĞµĞºĞ²Ğ°Ñ‚Ğ½ĞµĞµ                      â”‚
â”‚     (Ğ·Ğ½Ğ°ÑÑ‚ Ñ‡Ñ‚Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ â†’ Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ°Ñ‚Ğ°Ğº)                  â”‚
â”‚                                                         â”‚
â”‚  2. Ğ ĞĞ—Ğ‘ĞĞ  Ğ˜ĞĞ¦Ğ˜Ğ”Ğ•ĞĞ¢ĞĞ’                                   â”‚
â”‚     "ĞšÑ‚Ğ¾ Ğ²Ğ¸Ğ½Ğ¾Ğ²Ğ°Ñ‚ Ğ² Ğ”Ğ¢ĞŸ?" â†’ ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ               â”‚
â”‚     (ĞºÑ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ» DROP TABLE? â†’ pgAudit)                  â”‚
â”‚                                                         â”‚
â”‚  3. ĞĞŸĞ¢Ğ˜ĞœĞ˜Ğ—ĞĞ¦Ğ˜Ğ¯                                         â”‚
â”‚     "ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸ Ğ½Ğ° Ğ›ĞµĞ½Ğ¸Ğ½Ğ°?" â†’ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· GPS      â”‚
â”‚     (Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ Ñ‚Ğ¾Ñ€Ğ¼Ğ¾Ğ·Ğ¸Ñ‚? â†’ pg_stat_statements)             â”‚
â”‚                                                         â”‚
â”‚  4. Ğ¡ĞĞĞ¢Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ• Ğ¢Ğ Ğ•Ğ‘ĞĞ’ĞĞĞ˜Ğ¯Ğœ                            â”‚
â”‚     Ğ¡Ñ‚Ñ€Ğ°Ñ…Ğ¾Ğ²Ğ°Ñ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ²Ğ¸Ğ´ĞµĞ¾ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ¿Ğ»Ğ°Ñ‚                  â”‚
â”‚     (GDPR/PCI Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ audit logs)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

pg_stat_statements = Ğ§ĞµÑ€Ğ½Ñ‹Ğ¹ ÑÑ‰Ğ¸Ğº Ñ€ĞµĞ¹ÑĞ¾Ğ² (ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°)
pgAudit            = Ğ’Ğ¸Ğ´ĞµĞ¾Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ (ĞºÑ‚Ğ¾, ĞºĞ¾Ğ³Ğ´Ğ°, Ñ‡Ñ‚Ğ¾)
Slow query log     = GPS Ñ‚Ñ€ĞµĞºĞµÑ€ (Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²)
```

---

## Ğ§Ğ°ÑÑ‚ÑŒ 2: ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾

### ĞÑˆĞ¸Ğ±ĞºĞ° 1: SQL Injection Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾Ğ½ĞºĞ°Ñ‚ĞµĞ½Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ñ€Ğ¾Ğº

**Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ:** Ğ¡Ñ‚Ñ€Ğ¾Ğ¸Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ ÑĞºĞ»ĞµĞ¸Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ ÑÑ‚Ñ€Ğ¾Ğº Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¼ Ğ²Ğ²Ğ¾Ğ´Ğ¾Ğ¼.

```python
# âŒ ĞĞŸĞĞ¡ĞĞ â€” SQL Injection!
username = request.get("username")
query = f"SELECT * FROM users WHERE name = '{username}'"

# ĞÑ‚Ğ°ĞºÑƒÑÑ‰Ğ¸Ğ¹ Ğ²Ğ²Ğ¾Ğ´Ğ¸Ñ‚: ' OR '1'='1
# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ÑÑ: SELECT * FROM users WHERE name = '' OR '1'='1'
# Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: Ğ’Ğ¡Ğ• Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸!

# ĞÑ‚Ğ°ĞºÑƒÑÑ‰Ğ¸Ğ¹ Ğ²Ğ²Ğ¾Ğ´Ğ¸Ñ‚: '; DROP TABLE users; --
# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ÑÑ: SELECT * FROM users WHERE name = ''; DROP TABLE users; --'
# Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ°!
```

**Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•:** Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹:

```python
# âœ… Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞ â€” Prepared Statement
cursor.execute(
    "SELECT * FROM users WHERE name = %s",
    (username,)
)
# PostgreSQL Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ username ĞºĞ°Ğº Ğ”ĞĞĞĞ«Ğ•, Ğ½Ğµ ĞºĞ°Ğº ĞšĞĞ”
```

### ĞÑˆĞ¸Ğ±ĞºĞ° 2: Superuser Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ

**Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ:** ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ ĞºĞ°Ğº `postgres` superuser.

```
ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ¿Ğ»Ğ¾Ñ…Ğ¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SQL Injection + Superuser = ĞŸĞĞ›ĞĞ«Ğ™ ĞšĞĞĞ¢Ğ ĞĞ›Ğ¬            â”‚
â”‚                                                         â”‚
â”‚  ĞÑ‚Ğ°ĞºÑƒÑÑ‰Ğ¸Ğ¹ Ğ¼Ğ¾Ğ¶ĞµÑ‚:                                       â”‚
â”‚  â€¢ DROP DATABASE                                        â”‚
â”‚  â€¢ CREATE ROLE Ñ Ğ»ÑĞ±Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸                         â”‚
â”‚  â€¢ COPY ... TO '/etc/passwd' (Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ñ‹!)           â”‚
â”‚  â€¢ CREATE EXTENSION Ğ´Ğ»Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ°                 â”‚
â”‚                                                         â”‚
â”‚  ĞšĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ = ĞºĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ°Ñ†Ğ¸Ñ Ğ’Ğ¡Ğ•Ğ“Ğ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•:**
```sql
-- ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ€Ğ¾Ğ»ÑŒ Ñ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸
CREATE ROLE app_user LOGIN PASSWORD 'secure';
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO app_user;
-- ĞĞ• Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ: CREATE, DROP, TRUNCATE, REFERENCES, TRIGGER
```

### ĞÑˆĞ¸Ğ±ĞºĞ° 3: ĞĞµÑ‚ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° slow queries

**Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ:** Ğ£Ğ·Ğ½Ğ°ÑÑ‚ Ğ¾ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°Ñ… Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹: "Ğ¡Ğ°Ğ¹Ñ‚ Ñ‚Ğ¾Ñ€Ğ¼Ğ¾Ğ·Ğ¸Ñ‚!"

```
Ğ‘Ğ•Ğ— ĞœĞĞĞ˜Ğ¢ĞĞ Ğ˜ĞĞ“Ğ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ğ”ĞµĞ½ÑŒ 1: Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ 100ms â†’ Ğ½Ğ¾Ñ€Ğ¼Ğ°                             â”‚
â”‚ Ğ”ĞµĞ½ÑŒ 7: Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ 500ms â†’ Ğ½Ğ¸ĞºÑ‚Ğ¾ Ğ½Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¸Ğ»                 â”‚
â”‚ Ğ”ĞµĞ½ÑŒ 30: Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ 5s â†’ "ÑĞ°Ğ¹Ñ‚ Ğ»Ğ°Ğ³Ğ°ĞµÑ‚"                      â”‚
â”‚ Ğ”ĞµĞ½ÑŒ 31: Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ 30s â†’ timeout, Ğ¸Ğ½Ñ†Ğ¸Ğ´ĞµĞ½Ñ‚!                â”‚
â”‚                                                          â”‚
â”‚ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¶Ğ°Ğ»ÑƒĞµÑ‚ÑÑ Ğ ĞĞĞ¬Ğ¨Ğ• Ñ‡ĞµĞ¼ DBA ÑƒĞ·Ğ½Ğ°Ñ‘Ñ‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•:**
```sql
-- Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ pg_stat_statements
CREATE EXTENSION pg_stat_statements;

-- ĞĞ»ĞµÑ€Ñ‚ Ğ½Ğ° Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
-- Prometheus: pg_stat_statements_seconds_total > threshold
```

### ĞÑˆĞ¸Ğ±ĞºĞ° 4: RLS Ğ±ĞµĞ· FORCE Ğ´Ğ»Ñ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹

**Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ:** Ğ’ĞºĞ»ÑÑ‡Ğ¸Ğ»Ğ¸ RLS, Ğ½Ğ¾ owner Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ğ²ÑĞµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸.

```sql
-- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ»Ğ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ ĞºĞ°Ğº app_owner
CREATE TABLE orders (...);

-- Ğ’ĞºĞ»ÑÑ‡Ğ¸Ğ»Ğ¸ RLS
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;

-- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ»Ğ¸ policy
CREATE POLICY tenant_isolation ON orders
    USING (tenant_id = current_setting('app.tenant'));

-- ĞĞ¾ app_owner (Ğ²Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†) Ğ˜Ğ“ĞĞĞ Ğ˜Ğ Ğ£Ğ•Ğ¢ RLS!
-- ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ owner Ğ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸
```

**Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•:**
```sql
-- ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ RLS Ğ´Ğ»Ñ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°
ALTER TABLE orders FORCE ROW LEVEL SECURITY;

-- Ğ˜Ğ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½ÑƒÑ Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
GRANT SELECT, INSERT, UPDATE, DELETE ON orders TO app_user;
-- app_user ĞĞ• owner â†’ RLS Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
```

### ĞÑˆĞ¸Ğ±ĞºĞ° 5: Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ sensitive Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

**Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ:** Ğ’ Ğ»Ğ¾Ğ³Ğ°Ñ… Ğ²Ğ¸Ğ´Ğ½Ñ‹ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ğ¸, Ğ½Ğ¾Ğ¼ĞµÑ€Ğ° ĞºĞ°Ñ€Ñ‚, Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ.

```
# âŒ ĞŸĞ»Ğ¾Ñ…Ğ¾ â€” postgresql.conf
log_statement = 'all'

# Ğ’ Ğ»Ğ¾Ğ³Ğ°Ñ…:
# SELECT * FROM users WHERE password = 'secret123'
# INSERT INTO payments (card_number) VALUES ('4111-1111-1111-1111')

# Ğ›Ğ¾Ğ³Ğ¸ ÑƒÑ‚ĞµĞºĞ»Ğ¸ â†’ ÑƒÑ‚ĞµĞºĞ»Ğ¸ Ğ²ÑĞµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹!
```

**Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•:**
- `log_statement = 'ddl'` Ğ²Ğ¼ĞµÑÑ‚Ğ¾ `'all'`
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ pgAudit Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹
- ĞœĞ°ÑĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ sensitive Ğ¿Ğ¾Ğ»Ñ Ğ² Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¸
- Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ sensitive Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (pgcrypto)

### ĞÑˆĞ¸Ğ±ĞºĞ° 6: SSL Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ñ‘Ğ½ Ğ¸Ğ»Ğ¸ sslmode=disable

**Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ:** Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ´Ğ°ÑÑ‚ÑÑ Ğ² Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ.

```
Ğ‘Ğ•Ğ— SSL:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client â”‚ â”€â”€â”€ plain text â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ Server â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     "password123"           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
             ğŸ”“ ĞÑ‚Ğ°ĞºÑƒÑÑ‰Ğ¸Ğ¹ Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚
               Ğ²ÑÑ‘ Ğ² Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ!

Ğ¡ SSL:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client â”‚ â”€â”€â”€ ğŸ”’ encrypted â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ Server â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     "A#$%^&*encrypted"      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
             ğŸ”’ ĞÑ‚Ğ°ĞºÑƒÑÑ‰Ğ¸Ğ¹ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ğ¼ÑƒÑĞ¾Ñ€
```

**Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•:**
```bash
# pg_hba.conf â€” Ğ¢Ğ Ğ•Ğ‘ĞĞ’ĞĞ¢Ğ¬ SSL
hostssl all all 0.0.0.0/0 scram-sha-256

# ĞšĞ»Ğ¸ĞµĞ½Ñ‚ â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚
psql "sslmode=verify-full sslrootcert=ca.crt"
```

---

## Ğ§Ğ°ÑÑ‚ÑŒ 3: ĞœĞµĞ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸

### ĞœĞ¾Ğ´ĞµĞ»ÑŒ 1: Defense in Depth (Ğ­ÑˆĞµĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ğ¾Ñ€Ğ¾Ğ½Ğ°)

```
                    ĞĞ¢ĞĞšĞ
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: NETWORK                                        â”‚
â”‚ Firewall, VPN, IP whitelist                             â”‚
â”‚ 90% Ğ°Ñ‚Ğ°Ğº Ğ¾Ñ‚ÑĞµĞ¸Ğ²Ğ°ĞµÑ‚ÑÑ                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ 10% Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: AUTHENTICATION                                 â”‚
â”‚ Strong passwords, MFA, certificate                      â”‚
â”‚ 90% Ğ¸Ğ· Ğ¾ÑÑ‚Ğ°Ğ²ÑˆĞ¸Ñ…ÑÑ Ğ¾Ñ‚ÑĞµĞ¸Ğ²Ğ°ĞµÑ‚ÑÑ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ 1% Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: AUTHORIZATION                                  â”‚
â”‚ RBAC, least privilege                                   â”‚
â”‚ 90% Ğ¸Ğ· Ğ¾ÑÑ‚Ğ°Ğ²ÑˆĞ¸Ñ…ÑÑ Ğ¾Ñ‚ÑĞµĞ¸Ğ²Ğ°ĞµÑ‚ÑÑ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ 0.1% Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: ROW-LEVEL SECURITY                             â”‚
â”‚ Ğ”Ğ°Ğ¶Ğµ Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼ Ğ²Ğ¸Ğ´ÑÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ               â”‚
â”‚ 90% Ğ¸Ğ· Ğ¾ÑÑ‚Ğ°Ğ²ÑˆĞ¸Ñ…ÑÑ Ğ¾Ñ‚ÑĞµĞ¸Ğ²Ğ°ĞµÑ‚ÑÑ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ 0.01% Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 5: ENCRYPTION                                     â”‚
â”‚ Ğ”Ğ°Ğ¶Ğµ ÑƒĞºÑ€Ğ°Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ â€” Ğ½Ğµ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°ÑÑ‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞ»Ğ¾Ğ¹ ÑƒĞ¼ĞµĞ½ÑŒÑˆĞ°ĞµÑ‚ Ñ€Ğ¸ÑĞº Ğ½Ğ° Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº!
```

### ĞœĞ¾Ğ´ĞµĞ»ÑŒ 2: ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ğ° Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ğ Ğ¾Ğ»ÑŒ          â”‚ SELECT â”‚ INSERT â”‚ UPDATE â”‚ DELETE â”‚ DDL    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ app_readonly  â”‚   âœ…   â”‚   âŒ   â”‚   âŒ   â”‚   âŒ   â”‚   âŒ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ app_user      â”‚   âœ…   â”‚   âœ…   â”‚   âœ…   â”‚   âŒ   â”‚   âŒ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ app_admin     â”‚   âœ…   â”‚   âœ…   â”‚   âœ…   â”‚   âœ…   â”‚   âŒ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ migration     â”‚   âœ…   â”‚   âœ…   â”‚   âœ…   â”‚   âœ…   â”‚   âœ…   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ superuser     â”‚   âœ…   â”‚   âœ…   â”‚   âœ…   â”‚   âœ…   â”‚   âœ…*  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

* superuser Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ emergency, Ğ½Ğ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ!

ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ: ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ ĞĞ˜ĞšĞĞ“Ğ”Ğ Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ¸Ğ¼ĞµÑ‚ÑŒ DELETE Ğ¸Ğ»Ğ¸ DDL
         ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ½Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾.
```

### ĞœĞ¾Ğ´ĞµĞ»ÑŒ 3: CIA Triad Ğ´Ğ»Ñ Ğ‘Ğ”

```
                    CONFIDENTIALITY
                    (ĞšĞ¾Ğ½Ñ„Ğ¸Ğ´ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ)
                         â–²
                        â•± â•²
                       â•±   â•²
            RLS       â•±     â•²      Encryption
            RBAC     â•±       â•²     pgcrypto
            SSL     â•± DATABASEâ•²    TDE
                   â•±  SECURITY â•²
                  â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
                 â•±               â•²
                â–¼                 â–¼
         INTEGRITY            AVAILABILITY
         (Ğ¦ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ)        (Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ)

         â€¢ Constraints        â€¢ Replication
         â€¢ Transactions       â€¢ Backup/PITR
         â€¢ Checksums          â€¢ Monitoring
         â€¢ Audit logs         â€¢ Connection pooling

Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğº ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼Ñƒ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ:
â€¢ Confidentiality: ĞšÑ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ’Ğ˜Ğ”Ğ•Ğ¢Ğ¬ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ?
â€¢ Integrity: ĞšÑ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ˜Ğ—ĞœĞ•ĞĞ˜Ğ¢Ğ¬ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ?
â€¢ Availability: Ğ‘ÑƒĞ´ÑƒÑ‚ Ğ»Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ”ĞĞ¡Ğ¢Ğ£ĞŸĞĞ«?
```

### ĞœĞ¾Ğ´ĞµĞ»ÑŒ 4: Observability Stack Ğ´Ğ»Ñ Ğ‘Ğ”

```
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚           DASHBOARDS                â”‚
                 â”‚    Grafana, DataDog, NewRelic       â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                           â”‚                           â”‚
        â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    METRICS    â”‚         â”‚    LOGS       â”‚         â”‚    TRACES     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚pg_stat_        â”‚         â”‚ Slow query   â”‚         â”‚ Query plans   â”‚
â”‚statements     â”‚         â”‚ log           â”‚         â”‚               â”‚
â”‚               â”‚         â”‚               â”‚         â”‚ pg_stat_      â”‚
â”‚pg_stat_       â”‚         â”‚ pgAudit       â”‚         â”‚ activity      â”‚
â”‚activity       â”‚         â”‚               â”‚         â”‚               â”‚
â”‚               â”‚         â”‚ Error log     â”‚         â”‚ EXPLAIN       â”‚
â”‚Prometheus     â”‚         â”‚               â”‚         â”‚ ANALYZE       â”‚
â”‚postgres_      â”‚         â”‚               â”‚         â”‚               â”‚
â”‚exporter       â”‚         â”‚               â”‚         â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

METRICS: Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚? (Ñ‡Ğ¸ÑĞ»Ğ°)
LOGS:    ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ¾? (Ñ‚ĞµĞºÑÑ‚)
TRACES:  ĞšĞ°Ğº Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ğ»Ğ¾? (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ)
```

### ĞœĞ¾Ğ´ĞµĞ»ÑŒ 5: Security Checklist Ğ¿Ğ¾ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñƒ

```
ĞŸĞ Ğ˜ĞĞ Ğ˜Ğ¢Ğ•Ğ¢ 1: ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ (ÑĞ´ĞµĞ»Ğ°Ğ¹ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¡ SSL/TLS Ğ²ĞºĞ»ÑÑ‡Ñ‘Ğ½ Ğ¸ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½                         â”‚
â”‚ â–¡ Prepared statements Ğ²ĞµĞ·Ğ´Ğµ (no SQL injection)         â”‚
â”‚ â–¡ ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ superuser                   â”‚
â”‚ â–¡ ĞŸĞ°Ñ€Ğ¾Ğ»Ğ¸ ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğµ, SCRAM-SHA-256                        â”‚
â”‚ â–¡ Firewall: Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğµ IP/Ğ¿Ğ¾Ñ€Ñ‚Ñ‹                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ĞŸĞ Ğ˜ĞĞ Ğ˜Ğ¢Ğ•Ğ¢ 2: Ğ’ĞĞ–ĞĞ (ÑĞ´ĞµĞ»Ğ°Ğ¹ Ğ½Ğ° ÑÑ‚Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»Ğµ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¡ pg_stat_statements Ğ²ĞºĞ»ÑÑ‡Ñ‘Ğ½                           â”‚
â”‚ â–¡ Slow query log Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ (> 1s)                       â”‚
â”‚ â–¡ ĞĞ»ĞµÑ€Ñ‚Ñ‹ Ğ½Ğ° connections, disk, replication             â”‚
â”‚ â–¡ Least privilege Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ñ€Ğ¾Ğ»ĞµĞ¹                       â”‚
â”‚ â–¡ Backup Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½ (restore test)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ĞŸĞ Ğ˜ĞĞ Ğ˜Ğ¢Ğ•Ğ¢ 3: Ğ¥ĞĞ ĞĞ¨Ğ (ÑĞ´ĞµĞ»Ğ°Ğ¹ Ğ² ÑÑ‚Ğ¾Ğ¼ Ğ¼ĞµÑÑÑ†Ğµ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¡ RLS Ğ´Ğ»Ñ multi-tenant                                 â”‚
â”‚ â–¡ pgAudit Ğ´Ğ»Ñ compliance                               â”‚
â”‚ â–¡ Encryption at rest (filesystem/TDE)                  â”‚
â”‚ â–¡ Column encryption Ğ´Ğ»Ñ PII (pgcrypto)                 â”‚
â”‚ â–¡ Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğ¹ security audit                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ

| Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|--------|----------|
| **pg_stat_statements** | Extension Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°Ğ¼ |
| **pg_stat_activity** | Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ view Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ñ… ÑĞµÑÑĞ¸Ğ¹ |
| **Slow query log** | Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² |
| **RLS** | Row-Level Security â€” Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ ÑÑ‚Ñ€Ğ¾ĞºĞ°Ğ¼ |
| **TDE** | Transparent Data Encryption â€” ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… |
| **Column-level encryption** | Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… ĞºĞ¾Ğ»Ğ¾Ğ½Ğ¾Ğº (pgcrypto) |
| **SSL/TLS** | Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ |
| **Audit log** | Ğ–ÑƒÑ€Ğ½Ğ°Ğ» Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ |
| **Connection pooling** | ĞŸÑƒĞ» ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹ (PgBouncer, pgpool) |

---

## ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³: Ñ‡Ñ‚Ğ¾ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ĞšĞ›Ğ®Ğ§Ğ•Ğ’Ğ«Ğ• ĞœĞ•Ğ¢Ğ Ğ˜ĞšĞ˜ Ğ‘Ğ”                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  PERFORMANCE                                                    â”‚
â”‚  â”œâ”€â”€ Query response time (p50, p95, p99)                       â”‚
â”‚  â”œâ”€â”€ Queries per second (QPS)                                  â”‚
â”‚  â”œâ”€â”€ Slow queries count                                        â”‚
â”‚  â””â”€â”€ Cache hit ratio (> 99% Ğ½Ğ¾Ñ€Ğ¼Ğ°)                             â”‚
â”‚                                                                 â”‚
â”‚  CONNECTIONS                                                    â”‚
â”‚  â”œâ”€â”€ Active connections                                        â”‚
â”‚  â”œâ”€â”€ Idle connections                                          â”‚
â”‚  â”œâ”€â”€ Waiting connections (blocked)                             â”‚
â”‚  â””â”€â”€ Connection errors                                         â”‚
â”‚                                                                 â”‚
â”‚  REPLICATION                                                    â”‚
â”‚  â”œâ”€â”€ Replication lag (bytes/seconds)                           â”‚
â”‚  â”œâ”€â”€ WAL generation rate                                       â”‚
â”‚  â””â”€â”€ Replica status                                            â”‚
â”‚                                                                 â”‚
â”‚  RESOURCES                                                      â”‚
â”‚  â”œâ”€â”€ CPU usage                                                 â”‚
â”‚  â”œâ”€â”€ Memory usage                                              â”‚
â”‚  â”œâ”€â”€ Disk I/O (read/write IOPS)                               â”‚
â”‚  â”œâ”€â”€ Disk space (data + WAL)                                   â”‚
â”‚  â””â”€â”€ Table/index bloat                                         â”‚
â”‚                                                                 â”‚
â”‚  LOCKS                                                          â”‚
â”‚  â”œâ”€â”€ Lock wait time                                            â”‚
â”‚  â”œâ”€â”€ Deadlocks count                                           â”‚
â”‚  â””â”€â”€ Long-running transactions                                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## pg_stat_statements: ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

### Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°

```sql
-- Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ extension
CREATE EXTENSION pg_stat_statements;

-- postgresql.conf
shared_preload_libraries = 'pg_stat_statements'
pg_stat_statements.track = all
pg_stat_statements.max = 10000
```

### ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹

```sql
-- âœ… Ğ¢Ğ¾Ğ¿-10 ÑĞ°Ğ¼Ñ‹Ñ… Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (Ğ¿Ğ¾ Ğ¾Ğ±Ñ‰ĞµĞ¼Ñƒ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸)
SELECT
    substring(query, 1, 100) as query,
    calls,
    round(total_exec_time::numeric, 2) as total_time_ms,
    round(mean_exec_time::numeric, 2) as avg_time_ms,
    round((100 * total_exec_time / sum(total_exec_time) OVER ())::numeric, 2) as pct
FROM pg_stat_statements
ORDER BY total_exec_time DESC
LIMIT 10;

-- âœ… Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ñ Ğ½Ğ°Ğ¸Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾Ğ¼ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²
SELECT
    substring(query, 1, 100) as query,
    calls,
    round(mean_exec_time::numeric, 2) as avg_time_ms,
    rows
FROM pg_stat_statements
ORDER BY calls DESC
LIMIT 10;

-- âœ… Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾Ğ¼ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ±Ğ»Ğ¾ĞºĞ¾Ğ² (I/O intensive)
SELECT
    substring(query, 1, 100) as query,
    calls,
    shared_blks_read + shared_blks_hit as total_blks,
    round(100.0 * shared_blks_hit / nullif(shared_blks_read + shared_blks_hit, 0), 2) as cache_hit_pct
FROM pg_stat_statements
ORDER BY shared_blks_read DESC
LIMIT 10;

-- âœ… Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ
SELECT pg_stat_statements_reset();
```

---

## pg_stat_activity: Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¸

```sql
-- âœ… Ğ’ÑĞµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
SELECT
    pid,
    usename,
    client_addr,
    state,
    wait_event_type,
    wait_event,
    now() - query_start as duration,
    substring(query, 1, 100) as query
FROM pg_stat_activity
WHERE state = 'active'
ORDER BY query_start;

-- âœ… Ğ”Ğ¾Ğ»Ğ³Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ (> 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
SELECT
    pid,
    usename,
    now() - query_start as duration,
    query
FROM pg_stat_activity
WHERE state = 'active'
AND query_start < now() - interval '5 minutes';

-- âœ… Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
SELECT
    blocked.pid as blocked_pid,
    blocked.query as blocked_query,
    blocking.pid as blocking_pid,
    blocking.query as blocking_query
FROM pg_stat_activity blocked
JOIN pg_stat_activity blocking ON blocking.pid = ANY(pg_blocking_pids(blocked.pid))
WHERE blocked.wait_event_type = 'Lock';

-- âœ… Ğ£Ğ±Ğ¸Ñ‚ÑŒ Ğ´Ğ¾Ğ»Ğ³Ğ¸Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
SELECT pg_cancel_backend(pid);      -- ĞœÑĞ³ĞºĞ¾ (Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°)
SELECT pg_terminate_backend(pid);   -- Ğ–Ñ‘ÑÑ‚ĞºĞ¾ (ÑƒĞ±Ğ¸Ñ‚ÑŒ ÑĞµÑÑĞ¸Ñ)
```

---

## Slow Query Log

```bash
# postgresql.conf

# Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ¾Ğ»ÑŒÑˆĞµ 1 ÑĞµĞºÑƒĞ½Ğ´Ñ‹
log_min_duration_statement = 1000

# Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑĞµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ (Ğ¾ÑÑ‚Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ğ¾, Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ»Ğ¾Ğ³Ğ¾Ğ²!)
# log_statement = 'all'

# Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ² Ğ»Ğ¾Ğ³
log_duration = on
log_lock_waits = on

# Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ»Ğ¾Ğ³Ğ° Ğ´Ğ»Ñ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ°
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
```

### ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ»Ğ¾Ğ³Ğ¾Ğ²

```bash
# pgBadger â€” Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ² PostgreSQL
pgbadger /var/log/postgresql/postgresql-16-main.log -o report.html

# ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚
open report.html
```

---

## ĞĞ»ĞµÑ€Ñ‚Ñ‹

```yaml
# Prometheus + Alertmanager Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€

groups:
  - name: postgres
    rules:
      # Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° connections
      - alert: PostgresConnectionsHigh
        expr: pg_stat_activity_count > 100
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High number of connections ({{ $value }})"

      # Replication lag
      - alert: PostgresReplicationLag
        expr: pg_replication_lag_seconds > 60
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Replication lag is {{ $value }}s"

      # Disk space
      - alert: PostgresDiskSpace
        expr: pg_database_size_bytes / pg_settings_value{name="data_directory_size"} > 0.8
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Database using > 80% of disk space"

      # Slow queries
      - alert: PostgresSlowQueries
        expr: rate(pg_stat_statements_seconds_total[5m]) > 1
        for: 10m
        labels:
          severity: warning
```

---

## Security: Row-Level Security (RLS)

### ĞšĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ROW-LEVEL SECURITY                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Ğ‘ĞµĞ· RLS (application-level):                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SELECT * FROM orders WHERE tenant_id = 'acme';           â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚ ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:                                                â”‚  â”‚
â”‚  â”‚ â€¢ Ğ—Ğ°Ğ±Ñ‹Ğ» Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ WHERE â†’ ÑƒÑ‚ĞµÑ‡ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…                  â”‚  â”‚
â”‚  â”‚ â€¢ ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  Ğ¡ RLS (database-level):                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SELECT * FROM orders;  -- RLS Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµÑ‚   â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚ ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:                                            â”‚  â”‚
â”‚  â”‚ â€¢ ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ±Ñ‹Ñ‚ÑŒ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€                              â”‚  â”‚
â”‚  â”‚ â€¢ Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ                           â”‚  â”‚
â”‚  â”‚ â€¢ Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ SQL injection                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° RLS

```sql
-- 1. Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ RLS Ğ½Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;

-- 2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ policy Ğ´Ğ»Ñ SELECT
CREATE POLICY orders_tenant_isolation ON orders
    FOR SELECT
    USING (tenant_id = current_setting('app.current_tenant'));

-- 3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ policy Ğ´Ğ»Ñ INSERT
CREATE POLICY orders_tenant_insert ON orders
    FOR INSERT
    WITH CHECK (tenant_id = current_setting('app.current_tenant'));

-- 4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ policy Ğ´Ğ»Ñ UPDATE/DELETE
CREATE POLICY orders_tenant_modify ON orders
    FOR ALL
    USING (tenant_id = current_setting('app.current_tenant'))
    WITH CHECK (tenant_id = current_setting('app.current_tenant'));

-- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ· Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
SET app.current_tenant = 'acme';
SELECT * FROM orders;  -- Ğ’Ğ¸Ğ´Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ orders Ğ´Ğ»Ñ 'acme'
```

### RLS Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»ĞµĞ¹

```sql
-- Policy Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
CREATE POLICY admin_all ON orders
    FOR ALL
    TO admins
    USING (true);  -- ĞĞ´Ğ¼Ğ¸Ğ½Ñ‹ Ğ²Ğ¸Ğ´ÑÑ‚ Ğ²ÑÑ‘

CREATE POLICY user_own ON orders
    FOR SELECT
    TO users
    USING (user_id = current_user_id());
```

---

## Encryption

### Encryption in Transit (SSL/TLS)

```bash
# postgresql.conf
ssl = on
ssl_cert_file = '/etc/ssl/certs/server.crt'
ssl_key_file = '/etc/ssl/private/server.key'
ssl_ca_file = '/etc/ssl/certs/ca.crt'

# pg_hba.conf â€” Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ SSL
hostssl all all 0.0.0.0/0 scram-sha-256

# ĞšĞ»Ğ¸ĞµĞ½Ñ‚
psql "host=db.example.com dbname=mydb sslmode=verify-full sslrootcert=ca.crt"
```

### Encryption at Rest

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ENCRYPTION AT REST                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. FILESYSTEM-LEVEL (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)                           â”‚
â”‚     â€¢ LUKS (Linux)                                             â”‚
â”‚     â€¢ BitLocker (Windows)                                      â”‚
â”‚     â€¢ EBS encryption (AWS)                                     â”‚
â”‚     â€¢ Cloud KMS (GCP, Azure)                                   â”‚
â”‚                                                                 â”‚
â”‚     âœ… ĞŸÑ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ PostgreSQL                                 â”‚
â”‚     âœ… Ğ—Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ                                      â”‚
â”‚     âœ… ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ overhead                                     â”‚
â”‚                                                                 â”‚
â”‚  2. COLUMN-LEVEL (pgcrypto)                                    â”‚
â”‚     â€¢ Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ĞµĞ¹                               â”‚
â”‚     â€¢ ĞšĞ»ÑÑ‡Ğ¸ Ğ² Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¸                                       â”‚
â”‚                                                                 â”‚
â”‚     âœ… Ğ“Ñ€Ğ°Ğ½ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ                                     â”‚
â”‚     âŒ ĞĞµĞ»ÑŒĞ·Ñ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ/Ğ¸ÑĞºĞ°Ñ‚ÑŒ                              â”‚
â”‚     âŒ Overhead Ğ½Ğ° ĞºĞ°Ğ¶Ğ´ÑƒÑ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ                              â”‚
â”‚                                                                 â”‚
â”‚  3. TDE (Transparent Data Encryption)                          â”‚
â”‚     â€¢ Enterprise PostgreSQL (EDB)                              â”‚
â”‚     â€¢ Ğ˜Ğ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· pg_tde extension                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Column-level encryption Ñ pgcrypto

```sql
-- Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ extension
CREATE EXTENSION pgcrypto;

-- Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ²ÑÑ‚Ğ°Ğ²ĞºĞµ
INSERT INTO users (email, ssn_encrypted)
VALUES (
    'user@example.com',
    pgp_sym_encrypt('123-45-6789', 'my-secret-key')
);

-- Ğ”ĞµÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸
SELECT
    email,
    pgp_sym_decrypt(ssn_encrypted, 'my-secret-key') as ssn
FROM users;

-- âš ï¸ ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸ ĞºĞ»ÑÑ‡ Ğ² Ğ‘Ğ”!
-- ĞŸĞµÑ€ĞµĞ´Ğ°Ğ²Ğ°Ğ¹ Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸Ğ»Ğ¸ SET Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€
```

---

## Least Privilege

```sql
-- âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡

-- Application user (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ CRUD)
CREATE ROLE app_user LOGIN PASSWORD 'secure_password';
GRANT CONNECT ON DATABASE mydb TO app_user;
GRANT USAGE ON SCHEMA public TO app_user;
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO app_user;

-- Read-only user (Ğ´Ğ»Ñ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ²)
CREATE ROLE report_user LOGIN PASSWORD 'another_password';
GRANT CONNECT ON DATABASE mydb TO report_user;
GRANT USAGE ON SCHEMA public TO report_user;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO report_user;

-- Migration user (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ DDL)
CREATE ROLE migration_user LOGIN PASSWORD 'migration_password';
GRANT CONNECT ON DATABASE mydb TO migration_user;
GRANT ALL ON SCHEMA public TO migration_user;

-- âŒ ĞĞ• Ğ”Ğ•Ğ›ĞĞ™ Ğ¢ĞĞš
-- GRANT ALL PRIVILEGES ON DATABASE mydb TO app_user;
```

---

## Audit Logging

```sql
-- pgAudit extension
CREATE EXTENSION pgaudit;

-- postgresql.conf
pgaudit.log = 'ddl, role, write'
pgaudit.log_catalog = off
pgaudit.log_relation = on

-- Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚:
-- ddl: CREATE, ALTER, DROP
-- role: GRANT, REVOKE, CREATE ROLE
-- write: INSERT, UPDATE, DELETE
-- read: SELECT
-- all: Ğ²ÑÑ‘
```

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ audit log

```
2025-01-15 14:30:00 UTC [12345]: AUDIT: SESSION,1,1,DDL,CREATE TABLE,,,
    "CREATE TABLE secrets (id int, data text)",<none>
2025-01-15 14:31:00 UTC [12345]: AUDIT: SESSION,2,1,WRITE,INSERT,public,secrets,
    "INSERT INTO secrets VALUES (1, 'secret')",<none>
```

---

## ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ ÑĞµĞ±Ñ

<details>
<summary>1. ĞšĞ°ĞºĞ¸Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ‘Ğ” ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ?</summary>

**ĞÑ‚Ğ²ĞµÑ‚:**
- **Performance:** Query response time (p95, p99), slow queries count, cache hit ratio
- **Connections:** Active/idle/waiting connections, connection errors
- **Replication:** Lag Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…, replica status
- **Resources:** Disk space, CPU, memory, I/O
- **Locks:** Deadlocks, long-running transactions, lock waits

ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼: pg_stat_statements + disk space + replication lag.

</details>

<details>
<summary>2. Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ pg_stat_statements Ğ¸ Ğ·Ğ°Ñ‡ĞµĞ¼ Ğ¾Ğ½ Ğ½ÑƒĞ¶ĞµĞ½?</summary>

**ĞÑ‚Ğ²ĞµÑ‚:** Extension Ğ´Ğ»Ñ ÑĞ±Ğ¾Ñ€Ğ° ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°Ğ¼:
- ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ² ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
- ĞĞ±Ñ‰ĞµĞµ Ğ¸ ÑÑ€ĞµĞ´Ğ½ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
- ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ‹Ñ…/Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ½Ñ‹Ñ… Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²
- Cache hit ratio

ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ½Ğ°Ğ¹Ñ‚Ğ¸:
- Ğ¡Ğ°Ğ¼Ñ‹Ğµ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
- Ğ¡Ğ°Ğ¼Ñ‹Ğµ Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
- Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ñ Ğ¿Ğ»Ğ¾Ñ…Ğ¸Ğ¼ cache hit

</details>

<details>
<summary>3. ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Row-Level Security (RLS)?</summary>

**ĞÑ‚Ğ²ĞµÑ‚:** RLS â€” Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ ÑÑ‚Ñ€Ğ¾Ğº Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Ğ‘Ğ”.

1. Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ RLS: `ALTER TABLE orders ENABLE ROW LEVEL SECURITY`
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ policy Ñ ÑƒÑĞ»Ğ¾Ğ²Ğ¸ĞµĞ¼: `USING (tenant_id = current_setting('app.tenant'))`
3. Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚: `SET app.tenant = 'acme'`
4. Ğ’ÑĞµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒÑÑ‚ÑÑ

ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°: Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ·Ğ°Ğ±Ñ‹Ñ‚ÑŒ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€, Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ SQL injection, Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ.

</details>

<details>
<summary>4. ĞšĞ°ĞºĞ¸Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸ encryption ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‚ Ğ´Ğ»Ñ PostgreSQL?</summary>

**ĞÑ‚Ğ²ĞµÑ‚:**
1. **In transit (SSL/TLS):** Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ¼ Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ¼
2. **At rest (filesystem):** LUKS, EBS encryption â€” Ğ¿Ñ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ PostgreSQL
3. **Column-level (pgcrypto):** Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ĞµĞ¹, ĞºĞ»ÑÑ‡Ğ¸ Ğ² Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¸
4. **TDE:** Transparent Data Encryption â€” enterprise Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ

Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ: SSL Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½ + filesystem encryption Ğ´Ğ»Ñ at rest.

</details>

<details>
<summary>5. Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿ Least Privilege Ğ´Ğ»Ñ Ğ‘Ğ”?</summary>

**ĞÑ‚Ğ²ĞµÑ‚:** ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¸Ğ¼ĞµÑ‚ÑŒ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ°.

ĞŸÑ€Ğ°ĞºÑ‚Ğ¸ĞºĞ°:
- **app_user:** SELECT, INSERT, UPDATE, DELETE â€” Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
- **report_user:** Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ SELECT â€” Ğ´Ğ»Ñ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ²
- **migration_user:** DDL Ğ¿Ñ€Ğ°Ğ²Ğ° â€” Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
- **backup_user:** pg_read_all_data â€” Ğ´Ğ»Ñ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²

ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ°: `GRANT ALL PRIVILEGES TO app_user`

</details>

---

## Ğ¡Ğ²ÑĞ·Ğ¸

- [[databases-overview]] â€” ĞºĞ°Ñ€Ñ‚Ğ° Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°
- [[database-design-optimization]] â€” Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- [[security-overview]] â€” Ğ¾Ğ±Ñ‰Ğ°Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ
- [[observability]] â€” Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ ÑĞ¸ÑÑ‚ĞµĞ¼

---

## Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸

- [PostgreSQL Monitoring Statistics](https://www.postgresql.org/docs/current/monitoring-stats.html)
- [pg_stat_statements](https://www.postgresql.org/docs/current/pgstatstatements.html)
- [PostgreSQL Row Security Policies](https://www.postgresql.org/docs/current/ddl-rowsecurity.html)
- [pgAudit](https://www.pgaudit.org/)

---

*ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾: 2026-01-09 â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¿ĞµĞ´Ğ°Ğ³Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑĞµĞºÑ†Ğ¸Ğ¸ (5 Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ğ¹: Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°/defense in depth, VIP-ĞºĞ»ÑƒĞ±/RLS, Ğ±Ğ°Ğ½ĞºĞ¾Ğ²ÑĞºĞ¸Ğ¹ ÑĞµĞ¹Ñ„/encryption, Ğ±Ğ¾Ğ»ÑŒĞ½Ğ¸Ñ†Ğ°/least privilege, Ğ²Ğ¸Ğ´ĞµĞ¾Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€/audit; 6 Ñ‚Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ SQL injection; 5 Ğ¼ĞµĞ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸) | PostgreSQL 16*
