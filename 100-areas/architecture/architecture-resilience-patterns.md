---
title: "Resilience Patterns: Circuit Breaker, Retry, Bulkhead"
created: 2025-12-22
modified: 2026-01-02
type: concept
status: published
confidence: high
tags:
  - topic/architecture
  - resilience
  - fault-tolerance
  - circuit-breaker
  - patterns
  - type/concept
  - level/intermediate
related:
  - "[[architecture-overview]]"
  - "[[architecture-distributed-systems]]"
  - "[[architecture-rate-limiting]]"
prerequisites:
  - "[[architecture-distributed-systems]]"
---

# Resilience Patterns: Circuit Breaker, Retry, Bulkhead

> "Everything fails, all the time" ‚Äî Werner Vogels (AWS CTO). Resilience ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–±–æ–µ–≤, –∞ —É–º–µ–Ω–∏–µ gracefully (–∏–∑—è—â–Ω–æ) –∏—Ö –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å.

---

## Prerequisites (–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ)

–ü—Ä–µ–∂–¥–µ —á–µ–º –∏–∑—É—á–∞—Ç—å resilience patterns, —É–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–æ–Ω–∏–º–∞–µ—à—å:

| –¢–µ–º–∞ | –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ | –ì–¥–µ –∏–∑—É—á–∏—Ç—å |
|------|------------|-------------|
| Microservices basics | –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º | [[architecture-overview]] |
| HTTP –∏ REST API | –ö–∞–∫ —Å–µ—Ä–≤–∏—Å—ã –æ–±—â–∞—é—Ç—Å—è | [[api-design]] |
| Async/await –≤ –∫–æ–¥–µ | –ü–æ–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –Ω–∞ Python | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —è–∑—ã–∫–∞ |
| –ß—Ç–æ —Ç–∞–∫–æ–µ latency | –ó–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Å–µ—Ä–≤–∏—Å–æ–≤ | [[performance-optimization]] |

---

## –ó–∞—á–µ–º –Ω—É–∂–Ω—ã Resilience Patterns? (–ü–û–ß–ï–ú–£)

### –ì–ª–∞–≤–Ω–∞—è –∞–Ω–∞–ª–æ–≥–∏—è: –î–æ–º–∏–Ω–æ vs –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏

```
‚ùå –ë–ï–ó RESILIENCE PATTERNS (–î–æ–º–∏–Ω–æ)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  A  ‚îÇ ‚Üí ‚îÇ  B  ‚îÇ ‚Üí ‚îÇ  C  ‚îÇ ‚Üí ‚îÇ  D  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì         ‚Üì         ‚Üì         ‚Üì
    üí•‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄüí•‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄüí•‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄüí•

–°–µ—Ä–≤–∏—Å B —É–ø–∞–ª ‚Üí A –∂–¥—ë—Ç ‚Üí C –∂–¥—ë—Ç ‚Üí D –∂–¥—ë—Ç ‚Üí –í–°–Å –ü–ê–î–ê–ï–¢

‚úÖ –° RESILIENCE PATTERNS (–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  A  ‚îÇ   ‚îÇ  B  ‚îÇ   ‚îÇ  C  ‚îÇ   ‚îÇ  D  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ         üí•         ‚îÇ         ‚îÇ
    ‚îÇ    (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω)    ‚îÇ         ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç!
```

### –ò—Å—Ç–æ—Ä–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è: –£—Ä–æ–∫ Netflix

**–ê–≤–≥—É—Å—Ç 2008 –≥–æ–¥–∞** ‚Äî Netflix –ø–µ—Ä–µ–∂–∏–ª –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—É:
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–≤—Ä–µ–¥–∏–ª–∞—Å—å
- **3 –¥–Ω—è** –Ω–µ –º–æ–≥–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å DVD –∫–ª–∏–µ–Ω—Ç–∞–º
- –û–≥—Ä–æ–º–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏

**–≠—Ç–æ —Å—Ç–∞–ª–æ –ø–æ–≤–æ—Ä–æ—Ç–Ω—ã–º –º–æ–º–µ–Ω—Ç–æ–º.** Netflix –æ—Å–æ–∑–Ω–∞–ª:

> "–ú—ã –¥–æ–ª–∂–Ω—ã —É–π—Ç–∏ –æ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö –µ–¥–∏–Ω—ã—Ö —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞ (single points of failure), —Ç–∞–∫–∏—Ö –∫–∞–∫ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–µ, –∫ –≤—ã—Å–æ–∫–æ–Ω–∞–¥—ë–∂–Ω—ã–º, –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º —Å–∏—Å—Ç–µ–º–∞–º –≤ –æ–±–ª–∞–∫–µ."

**2011 –≥–æ–¥** ‚Äî Netflix —Å–æ–∑–¥–∞–ª **Hystrix** ‚Äî –ø–µ—Ä–≤—É—é production-ready –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è resilience patterns. –ò–∑ –Ω–µ—ë —Ä–æ–¥–∏–ª–∏—Å—å –≤—Å–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã.

**21 –∞–ø—Ä–µ–ª—è 2011** ‚Äî –±–æ–ª—å—à–æ–π —Å–±–æ–π AWS –≤ —Ä–µ–≥–∏–æ–Ω–µ US-East. Netflix –ø—Ä–æ–¥–æ–ª–∂–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è resilience patterns!

**24 –¥–µ–∫–∞–±—Ä—è 2012** ‚Äî –ø—Ä–æ–±–ª–µ–º—ã —Å AWS Elastic Load Balancer. Netflix —Å–Ω–æ–≤–∞ –≤—ã—Å—Ç–æ—è–ª.

### –ü–æ—á–µ–º—É —Å–±–æ–∏ –Ω–µ–∏–∑–±–µ–∂–Ω—ã?

| –§–∞–∫—Ç–æ—Ä | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ |
|--------|-----------|
| **–°–µ—Ç–µ–≤—ã–µ —Å–±–æ–∏** | –ü–∞–∫–µ—Ç—ã —Ç–µ—Ä—è—é—Ç—Å—è, –∫–∞–±–µ–ª–∏ —Ä–≤—É—Ç—Å—è, —Ä–æ—É—Ç–µ—Ä—ã –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è |
| **–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤** | –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí —Å–µ—Ä–≤–∏—Å –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è |
| **–î–µ–ø–ª–æ–π–º–µ–Ω—Ç—ã** | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ = –≤—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å |
| **–ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ —Å–±–æ–∏** | –î–∏—Å–∫–∏ –ª–æ–º–∞—é—Ç—Å—è, –ø–∞–º—è—Ç—å –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è |
| **–ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä** | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –±–∞–≥–∏ –≤ –∫–æ–¥–µ |

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:** –í —Ç–∏–ø–∏—á–Ω–æ–º distributed system —Å 30 —Å–µ—Ä–≤–∏—Å–∞–º–∏, –ø—Ä–∏ 99.9% uptime –∫–∞–∂–¥–æ–≥–æ, –æ–±—â–∏–π uptime —Å–∏—Å—Ç–µ–º—ã = 0.999¬≥‚Å∞ = **97%**, —Ç–æ –µ—Å—Ç—å **~11 —á–∞—Å–æ–≤ –ø—Ä–æ—Å—Ç–æ—è –≤ –º–µ—Å—è—Ü**.

---

## TL;DR (–ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä)

| –ü–∞—Ç—Ç–µ—Ä–Ω | –ê–Ω–∞–ª–æ–≥–∏—è | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|---------|----------|-------------------|
| **Retry** | –ü–æ–∑–≤–æ–Ω–∏—Ç—å –µ—â—ë —Ä–∞–∑, –µ—Å–ª–∏ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–∏ | –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–±–æ–∏ (—Å–µ—Ç—å, –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞) |
| **Circuit Breaker** | –≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å | –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ |
| **Bulkhead** | –ü–µ—Ä–µ–±–æ—Ä–∫–∏ –Ω–∞ –∫–æ—Ä–∞–±–ª–µ | –ò–∑–æ–ª—è—Ü–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ |
| **Timeout** | –ù–µ –∂–¥–∞—Ç—å –≤–µ—á–Ω–æ —É –¥–≤–µ—Ä–∏ | –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∞–Ω–∏—è |
| **Fallback** | –ü–ª–∞–Ω –ë –µ—Å–ª–∏ –ø–ª–∞–Ω –ê –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª | Graceful degradation |

---

## –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è —Å –∞–Ω–∞–ª–æ–≥–∏—è–º–∏

| –¢–µ—Ä–º–∏–Ω | –ê–Ω–∞–ª–æ–≥–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|----------|----------|
| **Resilience** (—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å) | –î–µ—Ä–µ–≤–æ –≥–Ω—ë—Ç—Å—è –Ω–∞ –≤–µ—Ç—Ä—É, –Ω–æ –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è | –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏ —Å–±–æ—è—Ö |
| **Transient failure** (–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–±–æ–π) | –¢–µ–ª–µ—Ñ–æ–Ω –Ω–∞ —Å–µ–∫—É–Ω–¥—É –ø–æ—Ç–µ—Ä—è–ª —Å–µ—Ç—å | –°–±–æ–π, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–∞–º —á–µ—Ä–µ–∑ –º–≥–Ω–æ–≤–µ–Ω–∏–µ |
| **Persistent failure** (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Å–±–æ–π) | –¢–µ–ª–µ—Ñ–æ–Ω —Å–ª–æ–º–∞–ª—Å—è | –°–±–æ–π, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ |
| **Cascading failure** (–∫–∞—Å–∫–∞–¥–Ω—ã–π —Å–±–æ–π) | –î–æ–º–∏–Ω–æ ‚Äî –æ–¥–Ω–∞ —É–ø–∞–ª–∞, –≤—Å–µ –ø–∞–¥–∞—é—Ç | –°–±–æ–π –æ–¥–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–±–æ–π –¥—Ä—É–≥–∏—Ö |
| **Circuit Breaker** | –ê–≤—Ç–æ–º–∞—Ç –≤ —â–∏—Ç–∫–µ ‚Äî –≤—ã–∫–ª—é—á–∞–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ | –ú–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –æ—Ç failing —Å–µ—Ä–≤–∏—Å–∞ |
| **Bulkhead** (–ø–µ—Ä–µ–±–æ—Ä–∫–∞) | –í–æ–¥–æ–Ω–µ–ø—Ä–æ–Ω–∏—Ü–∞–µ–º—ã–µ –æ—Ç—Å–µ–∫–∏ –Ω–∞ –∫–æ—Ä–∞–±–ª–µ | –ò–∑–æ–ª—è—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —Å–±–æ—è |
| **Fallback** (—Ä–µ–∑–µ—Ä–≤) | –ó–∞–ø–∞—Å–Ω–æ–π –≤—ã—Ö–æ–¥ –≤ –∑–¥–∞–Ω–∏–∏ | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —Å–±–æ–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—É—Ç–∏ |
| **Backoff** (–æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–µ) | –ü–æ–¥–æ–∂–¥–∞—Ç—å –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–≤–æ–Ω–∫–æ–º | –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ |
| **Jitter** (–¥—Ä–æ–∂–∞–Ω–∏–µ) | –°–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ SMS –≤ –≥—Ä—É–ø–ø–µ | –°–ª—É—á–∞–π–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è thundering herd |
| **Thundering herd** (—Å—Ç–∞–¥–æ) | –í—Å–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ª–æ–º—è—Ç—Å—è –≤ –¥–≤–µ—Ä—å | –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—é—Ç –∑–∞–ø—Ä–æ—Å—ã |
| **Fail fast** (–±—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞–∑) | –õ—É—á—à–µ —Å—Ä–∞–∑—É —Å–∫–∞–∑–∞—Ç—å "–Ω–µ—Ç", —á–µ–º –∑–∞—Å—Ç–∞–≤–ª—è—Ç—å –∂–¥–∞—Ç—å | –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤–º–µ—Å—Ç–æ –¥–æ–ª–≥–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è |
| **Graceful degradation** | –†–∞–±–æ—Ç–∞—Ç—å —Ö—É–∂–µ, –Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å | –°–Ω–∏–∂–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–∫–∞–∑–∞ |

---

## Resilience Patterns Overview

### –ö–∞–∫ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ (—Å–ª–æ–∏ –∑–∞—â–∏—Ç—ã)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      –°–õ–û–ò –ó–ê–©–ò–¢–´ (—Å–Ω–∞—Ä—É–∂–∏ –≤–Ω—É—Ç—Ä—å)                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                             ‚îÇ
‚îÇ   Client (—Ç–≤–æ—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)                                                 ‚îÇ
‚îÇ     ‚îÇ                                                                       ‚îÇ
‚îÇ     ‚ñº                                                                       ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ   ‚îÇ –°–õ–û–ô 1: TIMEOUT                                                      ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ "–ù–µ –∂–¥–∏ –≤–µ—á–Ω–æ ‚Äî –µ—Å–ª–∏ –∑–∞ 5 —Å–µ–∫—É–Ω–¥ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–∏, —Å—á–∏—Ç–∞–π —á—Ç–æ –Ω–µ –æ—Ç–≤–µ—Ç—è—Ç" ‚îÇ  ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                    ‚îÇ                                        ‚îÇ
‚îÇ                                    ‚ñº                                        ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ   ‚îÇ –°–õ–û–ô 2: RETRY + BACKOFF                                              ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ "–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑, –Ω–æ –Ω–µ —Å—Ä–∞–∑—É ‚Äî –ø–æ–¥–æ–∂–¥–∏ 1—Å, –ø–æ—Ç–æ–º 2—Å, –ø–æ—Ç–æ–º 4—Å"    ‚îÇ  ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                    ‚îÇ                                        ‚îÇ
‚îÇ                                    ‚ñº                                        ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ   ‚îÇ –°–õ–û–ô 3: CIRCUIT BREAKER                                              ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ "5 –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥? –•–≤–∞—Ç–∏—Ç –ø—ã—Ç–∞—Ç—å—Å—è ‚Äî —Å–µ—Ä–≤–∏—Å —è–≤–Ω–æ –ª–µ–∂–∏—Ç"              ‚îÇ  ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                    ‚îÇ                                        ‚îÇ
‚îÇ                                    ‚ñº                                        ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ   ‚îÇ –°–õ–û–ô 4: BULKHEAD                                                     ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ "–¢–æ–ª—å–∫–æ 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —ç—Ç–æ–º—É —Å–µ—Ä–≤–∏—Å—É ‚Äî –Ω–µ –±–æ–ª—å—à–µ"      ‚îÇ  ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                    ‚îÇ                                        ‚îÇ
‚îÇ                                    ‚ñº                                        ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                             ‚îÇ
‚îÇ                    ‚îÇ    External Service     ‚îÇ                             ‚îÇ
‚îÇ                    ‚îÇ   (–≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å)      ‚îÇ                             ‚îÇ
‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                             ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ   –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—à–∏–±–∫–∞ ‚Üí FALLBACK (–∫—ç—à, –¥–µ—Ñ–æ–ª—Ç, degraded mode)           ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 1. Retry Pattern (–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏)

### –ê–Ω–∞–ª–æ–≥–∏—è: –ó–≤–æ–Ω–æ–∫ –¥—Ä—É–≥—É

```
–¢—ã –∑–≤–æ–Ω–∏—à—å –¥—Ä—É–≥—É:
üìû –ü–æ–ø—ã—Ç–∫–∞ 1: –ù–µ –æ—Ç–≤–µ—á–∞–µ—Ç (–∑–∞–Ω—è—Ç)
   –ñ–¥—ë—à—å 1 —Å–µ–∫—É–Ω–¥—É...
üìû –ü–æ–ø—ã—Ç–∫–∞ 2: –ù–µ –æ—Ç–≤–µ—á–∞–µ—Ç (–≤—Å—ë –µ—â—ë –∑–∞–Ω—è—Ç)
   –ñ–¥—ë—à—å 2 —Å–µ–∫—É–Ω–¥—ã...
üìû –ü–æ–ø—ã—Ç–∫–∞ 3: "–ê–ª–ª–æ!" ‚Äî –£–°–ü–ï–•!

–ë–µ–∑ retry: –ü–æ–∑–≤–æ–Ω–∏–ª —Ä–∞–∑ ‚Üí "–ù–µ –æ—Ç–≤–µ—Ç–∏–ª" ‚Üí –°–¥–∞–ª—Å—è
–° retry: –ü–æ–∑–≤–æ–Ω–∏–ª —Ä–∞–∑ ‚Üí –ü–æ–¥–æ–∂–¥–∞–ª ‚Üí –ü–æ–∑–≤–æ–Ω–∏–ª —Å–Ω–æ–≤–∞ ‚Üí –£—Å–ø–µ—Ö!
```

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Retry?

**Transient failures** (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–±–æ–∏) ‚Äî —Å–∞–º—ã–π —á–∞—Å—Ç—ã–π —Ç–∏–ø –æ—à–∏–±–æ–∫:
- –°–µ—Ç–µ–≤–æ–π –ø–∞–∫–µ—Ç –ø–æ—Ç–µ—Ä—è–ª—Å—è (0.1% –ø–∞–∫–µ—Ç–æ–≤ —Ç–µ—Ä—è–µ—Ç—Å—è –¥–∞–∂–µ –≤ —Ö–æ—Ä–æ—à–∏—Ö —Å–µ—Ç—è—Ö)
- –°–µ—Ä–≤–∏—Å –Ω–∞ –º–≥–Ω–æ–≤–µ–Ω–∏–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
- –ö—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π DNS-—Å–±–æ–π
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ë–µ–∑ retry:** 0.1% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–∏–¥—è—Ç –æ—à–∏–±–∫—É
**–° retry:** –¢–æ–ª—å–∫–æ 0.0001% –≤–∏–¥—è—Ç –æ—à–∏–±–∫—É (0.1% √ó 0.1%)

### –ü—Ä–æ–±–ª–µ–º–∞: Thundering Herd (–°—Ç–∞–¥–æ)

```
‚ùå –ë–ï–ó BACKOFF ‚Äî –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –±—å—é—Ç —Å–µ—Ä–≤–µ—Ä –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

–í—Ä–µ–º—è:    0s    1s    2s    3s    4s    5s
Client 1: ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ  (retry –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
Client 2: ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ
Client 3: ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ
          ‚Üì    ‚Üì    ‚Üì    ‚Üì    ‚Üì    ‚Üì
Server:   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  (–ü–ï–†–ï–ì–†–£–ñ–ï–ù!)

–°–µ—Ä–≤–µ—Ä –∏ —Ç–∞–∫ –µ–ª–µ –¥—ã—à–∏—Ç, –∞ –µ–≥–æ –±–æ–º–±—è—Ç –∑–∞–ø—Ä–æ—Å–∞–º–∏ ‚Äî –æ–Ω –ø–∞–¥–∞–µ—Ç –µ—â—ë —Å–∏–ª—å–Ω–µ–µ!


‚úÖ –° EXPONENTIAL BACKOFF + JITTER ‚Äî –Ω–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è

–í—Ä–µ–º—è:    0s    1s    2s    3s    4s    5s    6s    7s    8s
Client 1: ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Client 2: ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Client 3: ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          ‚Üì         ‚Üì                    ‚Üì
Server:   ‚ñà‚ñà‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñà‚ñà‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñà‚ñà‚îÄ‚îÄ‚îÄ‚îÄ  (–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è!)
```

### –§–æ—Ä–º—É–ª–∞ Exponential Backoff

```
delay = min(base_delay √ó 2^attempt + random_jitter, max_delay)
```

**–ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä:**
```
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: base_delay=1s, max_delay=60s

–ü–æ–ø—ã—Ç–∫–∞ 1:  1 √ó 2^0 = 1s  + jitter (0-0.5s) = ~1.3s
–ü–æ–ø—ã—Ç–∫–∞ 2:  1 √ó 2^1 = 2s  + jitter (0-1s)   = ~2.7s
–ü–æ–ø—ã—Ç–∫–∞ 3:  1 √ó 2^2 = 4s  + jitter (0-2s)   = ~5.4s
–ü–æ–ø—ã—Ç–∫–∞ 4:  1 √ó 2^3 = 8s  + jitter (0-4s)   = ~11s
–ü–æ–ø—ã—Ç–∫–∞ 5:  1 √ó 2^4 = 16s + jitter (0-8s)   = ~22s
–ü–æ–ø—ã—Ç–∫–∞ 6:  1 √ó 2^5 = 32s + jitter (0-16s)  = ~45s
–ü–æ–ø—ã—Ç–∫–∞ 7:  1 √ó 2^6 = 64s ‚Üí max=60s         = ~60s (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ)
```

### –í–∏–¥—ã Jitter (–ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ AWS)

| –í–∏–¥ | –§–æ—Ä–º—É–ª–∞ | –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã |
|-----|---------|-------|--------|
| **Full Jitter** | `random(0, delay)` | –õ—É—á—à–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ | –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π |
| **Equal Jitter** | `delay/2 + random(0, delay/2)` | –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π delay | –ú–µ–Ω—å—à–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è |
| **Decorrelated** | `min(max, random(base, prev√ó3))` | –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–æ–º–µ—Ä–∞ –ø–æ–ø—ã—Ç–∫–∏ | –°–ª–æ–∂–Ω–µ–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å |

**AWS —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç Full Jitter –∫–∞–∫ default.**

### Retry Implementation (—Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏)

```python
import asyncio
import random
from typing import TypeVar, Callable, Optional, Tuple
from functools import wraps

T = TypeVar('T')  # Generic —Ç–∏–ø –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è

class RetryConfig:
    """
    –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è retry-–ª–æ–≥–∏–∫–∏.

    –ü–æ—á–µ–º—É –Ω—É–∂–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è?
    –ß—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.
    """

    def __init__(
        self,
        max_attempts: int = 3,           # –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—ã—Ç–∞—Ç—å—Å—è
        base_delay: float = 1.0,         # –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (—Å–µ–∫—É–Ω–¥—ã)
        max_delay: float = 60.0,         # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
        exponential_base: float = 2.0,   # –í–æ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å
        jitter: bool = True,             # –î–æ–±–∞–≤–ª—è—Ç—å —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å?
        retryable_exceptions: Tuple = (Exception,)  # –ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏ —Ä–µ—Ç—Ä–∞–∏—Ç—å
    ):
        self.max_attempts = max_attempts
        self.base_delay = base_delay
        self.max_delay = max_delay
        self.exponential_base = exponential_base
        self.jitter = jitter
        self.retryable_exceptions = retryable_exceptions


def calculate_delay(config: RetryConfig, attempt: int) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –¥–∞–Ω–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏.

    –§–æ—Ä–º—É–ª–∞: delay = base √ó 2^attempt (—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º max_delay)
    –ï—Å–ª–∏ jitter –≤–∫–ª—é—á–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å.

    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
        config: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è retry
        attempt: –ù–æ–º–µ—Ä –ø–æ–ø—ã—Ç–∫–∏ (0, 1, 2, ...)

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
        –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    """
    # –®–∞–≥ 1: –í—ã—á–∏—Å–ª—è–µ–º —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É
    # –ü—Ä–∏–º–µ—Ä: 1 √ó 2^0 = 1, 1 √ó 2^1 = 2, 1 √ó 2^2 = 4
    delay = config.base_delay * (config.exponential_base ** attempt)

    # –®–∞–≥ 2: –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
    # –ó–∞—á–µ–º? –ß—Ç–æ–±—ã –Ω–µ –∂–¥–∞—Ç—å —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1024 —Å–µ–∫—É–Ω–¥—ã)
    delay = min(delay, config.max_delay)

    # –®–∞–≥ 3: –î–æ–±–∞–≤–ª—è–µ–º jitter (—Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å)
    # –ó–∞—á–µ–º? –ß—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ —Ä–µ—Ç—Ä–∞–∏–ª–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
    if config.jitter:
        # Full jitter: —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ delay
        delay = random.uniform(0, delay)

    return delay


def retry(config: Optional[RetryConfig] = None):
    """
    –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ retry.

    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
        @retry(RetryConfig(max_attempts=5))
        async def my_function():
            ...
    """
    if config is None:
        config = RetryConfig()

    def decorator(func: Callable[..., T]) -> Callable[..., T]:
        @wraps(func)  # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–º—è –∏ docstring –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        async def wrapper(*args, **kwargs) -> T:
            last_exception = None

            # –ü—Ä–æ–±—É–µ–º max_attempts —Ä–∞–∑
            for attempt in range(config.max_attempts):
                try:
                    # –ü—ã—Ç–∞–µ–º—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
                    return await func(*args, **kwargs)

                except config.retryable_exceptions as e:
                    # –õ–æ–≤–∏–º —Ç–æ–ª—å–∫–æ "—Ä–µ—Ç—Ä–∞–∏–±–µ–ª—å–Ω—ã–µ" –æ—à–∏–±–∫–∏
                    last_exception = e

                    # –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ ‚Äî –∂–¥—ë–º –∏ –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
                    if attempt < config.max_attempts - 1:
                        delay = calculate_delay(config, attempt)
                        print(f"‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1} –Ω–µ —É–¥–∞–ª–∞—Å—å, "
                              f"–ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ {delay:.2f}—Å: {e}")
                        await asyncio.sleep(delay)

            # –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã ‚Äî –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –æ—à–∏–±–∫—É
            raise last_exception

        return wrapper
    return decorator


# ‚úÖ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
@retry(RetryConfig(
    max_attempts=5,               # 5 –ø–æ–ø—ã—Ç–æ–∫
    base_delay=1.0,               # –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞
    retryable_exceptions=(        # –†–µ—Ç—Ä–∞–∏–º —Ç–æ–ª—å–∫–æ —ç—Ç–∏ –æ—à–∏–±–∫–∏:
        ConnectionError,          # - –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º
        TimeoutError,             # - –¢–∞–π–º–∞—É—Ç
        # ValueError ‚Äî –ù–ï —Ä–µ—Ç—Ä–∞–∏–º, —ç—Ç–æ –±–∞–≥ –≤ –¥–∞–Ω–Ω—ã—Ö
    )
))
async def call_external_api(url: str) -> dict:
    """–í—ã–∑—ã–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π API —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º retry."""
    async with httpx.AsyncClient() as client:
        response = await client.get(url, timeout=5.0)
        response.raise_for_status()  # –í—ã–±—Ä–æ—Å–∏—Ç HTTPError –¥–ª—è 4xx/5xx
        return response.json()
```

### –ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Retry

| –°–∏—Ç—É–∞—Ü–∏—è | –ü–æ—á–µ–º—É –Ω–µ —Ä–µ—Ç—Ä–∞–∏—Ç—å | –ß—Ç–æ –¥–µ–ª–∞—Ç—å |
|----------|-------------------|------------|
| **4xx –æ—à–∏–±–∫–∏** (400, 401, 403, 404) | –≠—Ç–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ—à–∏–±–∫–∏ ‚Äî retry –Ω–µ –ø–æ–º–æ–∂–µ—Ç | –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é |
| **–ù–µ-–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** | POST –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å idempotency key |
| **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥) | Retry –Ω–µ –¥–æ–±–∞–≤–∏—Ç –¥–µ–Ω–µ–≥ –Ω–∞ —Å—á—ë—Ç | –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –±–∏–∑–Ω–µ—Å-–æ—à–∏–±–∫—É |
| **Deterministic failure** | –û—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä–∏—Ç—Å—è –ø—Ä–∏ –ª—é–±—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö | –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ |

### –ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏ –º–æ–∂–Ω–æ —Ä–µ—Ç—Ä–∞–∏—Ç—å

```python
# ‚úÖ –ú–û–ñ–ù–û —Ä–µ—Ç—Ä–∞–∏—Ç—å (transient errors)
RETRYABLE_ERRORS = (
    ConnectionError,      # –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ–±–æ—Ä–≤–∞–ª–æ—Å—å
    TimeoutError,         # –ù–µ –¥–æ–∂–¥–∞–ª–∏—Å—å –æ—Ç–≤–µ—Ç–∞
    # HTTP —Å—Ç–∞—Ç—É—Å—ã:
    # 429 Too Many Requests  ‚Äî –Ω–∞—Å rate limit'–Ω—É–ª–∏
    # 500 Internal Error     ‚Äî —Å–µ—Ä–≤–µ—Ä —Å–≥–ª—é—á–∏–ª
    # 502 Bad Gateway        ‚Äî –ø—Ä–æ–∫—Å–∏ –Ω–µ –¥–æ—Å—Ç—É—á–∞–ª—Å—è
    # 503 Service Unavailable ‚Äî —Å–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
    # 504 Gateway Timeout    ‚Äî –ø—Ä–æ–∫—Å–∏ –Ω–µ –¥–æ–∂–¥–∞–ª—Å—è
)

# ‚ùå –ù–ï–õ–¨–ó–Ø —Ä–µ—Ç—Ä–∞–∏—Ç—å (permanent errors)
NON_RETRYABLE_ERRORS = (
    # HTTP —Å—Ç–∞—Ç—É—Å—ã:
    # 400 Bad Request        ‚Äî –º—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ø–ª–æ—Ö–∏–µ –¥–∞–Ω–Ω—ã–µ
    # 401 Unauthorized       ‚Äî –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    # 403 Forbidden          ‚Äî –Ω–µ—Ç –ø—Ä–∞–≤
    # 404 Not Found          ‚Äî —Ä–µ—Å—É—Ä—Å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    # 409 Conflict           ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π
    ValueError,            # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    AuthenticationError,   # –ù–µ–≤–µ—Ä–Ω—ã–µ credentials
)
```

---

## 2. Circuit Breaker Pattern (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å)

### –ê–Ω–∞–ª–æ–≥–∏—è: –≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç –≤ —â–∏—Ç–∫–µ

```
–ü—Ä–µ–¥—Å—Ç–∞–≤—å —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π —â–∏—Ç–æ–∫ –¥–æ–º–∞:

üè† –û–±—ã—á–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:
   –ê–≤—Ç–æ–º–∞—Ç –í–ö–õ–Æ–ß–ï–ù ‚Üí –¢–æ–∫ —Ç–µ—á—ë—Ç ‚Üí –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

‚ö° –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ (–º–Ω–æ–≥–æ –ø—Ä–∏–±–æ—Ä–æ–≤ –≤–∫–ª—é—á–∏–ª–∏):
   –ê–≤—Ç–æ–º–∞—Ç –í–´–ö–õ–Æ–ß–ê–ï–¢–°–Ø ‚Üí –¢–æ–∫ –Ω–µ —Ç–µ—á—ë—Ç ‚Üí –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–∂–∞—Ä–∞!

üîß –ü–æ—Å–ª–µ –æ—Å—Ç—ã–≤–∞–Ω–∏—è:
   –ú–æ–∂–Ω–æ –í–ö–õ–Æ–ß–ò–¢–¨ –æ–±—Ä–∞—Ç–Ω–æ ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏

–í –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏:
   –ê–≤—Ç–æ–º–∞—Ç = Circuit Breaker
   –¢–æ–∫ = –ó–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–∏—Å—É
   –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ = –ú–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ –æ—Ç —Å–µ—Ä–≤–∏—Å–∞
```

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Circuit Breaker?

**–ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ Circuit Breaker:**

```
–°–µ—Ä–≤–∏—Å B —É–ø–∞–ª. –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –°–µ—Ä–≤–∏—Å A?

–ë–µ–∑ Circuit Breaker:
A ‚Üí B (–æ—à–∏–±–∫–∞, –∂–¥–∞–ª–∏ 5 —Å–µ–∫)
A ‚Üí B (–æ—à–∏–±–∫–∞, –∂–¥–∞–ª–∏ 5 —Å–µ–∫)
A ‚Üí B (–æ—à–∏–±–∫–∞, –∂–¥–∞–ª–∏ 5 —Å–µ–∫)
...
A —Ç—Ä–∞—Ç–∏—Ç —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
A —Å–∞–º –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ A –∂–¥—É—Ç –∏ —É—Ö–æ–¥—è—Ç
```

**–° Circuit Breaker:**

```
A ‚Üí B (–æ—à–∏–±–∫–∞)
A ‚Üí B (–æ—à–∏–±–∫–∞)
A ‚Üí B (–æ—à–∏–±–∫–∞)
A ‚Üí B (–æ—à–∏–±–∫–∞)
A ‚Üí B (–æ—à–∏–±–∫–∞)  ‚Üê 5-—è –æ—à–∏–±–∫–∞

[CIRCUIT –û–¢–ö–†–´–¢]

A ‚Üí B ‚Üí –°–†–ê–ó–£ –û–®–ò–ë–ö–ê (–Ω–µ –∂–¥—ë–º!)
A –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å fallback –∏–ª–∏ cached –¥–∞–Ω–Ω—ã–µ
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –æ—Ç–≤–µ—Ç –±—ã—Å—Ç—Ä–æ
```

### –¢—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è Circuit Breaker

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CIRCUIT BREAKER: –¢–†–ò –°–û–°–¢–û–Ø–ù–ò–Ø                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                              ‚îÇ
‚îÇ                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                             ‚îÇ
‚îÇ                         ‚îÇ      üü¢ CLOSED      ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ   (–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞)‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ                     ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ  –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç    ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ  –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É —Å–µ—Ä–≤–∏—Å—É‚îÇ                             ‚îÇ
‚îÇ                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                             ‚îÇ
‚îÇ                                    ‚îÇ                                         ‚îÇ
‚îÇ                    5+ –æ—à–∏–±–æ–∫ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥                          ‚îÇ
‚îÇ                                    ‚îÇ                                         ‚îÇ
‚îÇ                                    ‚ñº                                         ‚îÇ
‚îÇ                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                             ‚îÇ
‚îÇ                         ‚îÇ       üî¥ OPEN       ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ   (Fail Fast —Ä–µ–∂–∏–º) ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ                     ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ  –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å—Ä–∞–∑—É  ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ  –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫—É  ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ  (–±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è     ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ   –∫ —Å–µ—Ä–≤–∏—Å—É!)       ‚îÇ                             ‚îÇ
‚îÇ                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                             ‚îÇ
‚îÇ                                    ‚îÇ                                         ‚îÇ
‚îÇ                    –ü—Ä–æ—à–ª–æ 30 —Å–µ–∫—É–Ω–¥ (timeout)                               ‚îÇ
‚îÇ                                    ‚îÇ                                         ‚îÇ
‚îÇ                                    ‚ñº                                         ‚îÇ
‚îÇ                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                             ‚îÇ
‚îÇ                         ‚îÇ     üü° HALF-OPEN    ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ    (–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º) ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ                     ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ  –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –û–î–ò–ù    ‚îÇ                             ‚îÇ
‚îÇ                         ‚îÇ  —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å    ‚îÇ                             ‚îÇ
‚îÇ                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                             ‚îÇ
‚îÇ                                    ‚îÇ                                         ‚îÇ
‚îÇ               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ               ‚îÇ                                         ‚îÇ                   ‚îÇ
‚îÇ           –£—Å–ø–µ—Ö!                                    –û—à–∏–±–∫–∞                  ‚îÇ
‚îÇ               ‚îÇ                                         ‚îÇ                   ‚îÇ
‚îÇ               ‚ñº                                         ‚ñº                   ‚îÇ
‚îÇ        –í–æ–∑–≤—Ä–∞—Ç –≤ CLOSED                         –í–æ–∑–≤—Ä–∞—Ç –≤ OPEN             ‚îÇ
‚îÇ        (—Å–µ—Ä–≤–∏—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è)                   (–µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤)             ‚îÇ
‚îÇ                                                                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Circuit Breaker Implementation (—Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏)

```python
import asyncio
import time
from enum import Enum
from dataclasses import dataclass, field
from typing import Callable, Optional
from collections import deque

class CircuitState(Enum):
    """
    –¢—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è Circuit Breaker.

    CLOSED = –í—Å—ë —Ö–æ—Ä–æ—à–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã
    OPEN = –í—Å—ë –ø–ª–æ—Ö–æ, –±–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å—ã
    HALF_OPEN = –¢–µ—Å—Ç–∏—Ä—É–µ–º, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –ª–∏ —Å–µ—Ä–≤–∏—Å
    """
    CLOSED = "closed"
    OPEN = "open"
    HALF_OPEN = "half_open"


@dataclass
class CircuitBreakerConfig:
    """
    –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Circuit Breaker.

    –ö–∞–∫ –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

    failure_threshold:
      - –°–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π (3) ‚Üí —Å–ª–∏—à–∫–æ–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π, —á–∞—Å—Ç—ã–µ "–ª–æ–∂–Ω—ã–µ" –æ—Ç–∫—Ä—ã—Ç–∏—è
      - –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π (20) ‚Üí –º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
      - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: 5-10

    timeout:
      - –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (5s) ‚Üí circuit –±—É–¥–µ—Ç "–º–æ—Ä–≥–∞—Ç—å" (oscillation)
      - –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π (5min) ‚Üí –¥–æ–ª–≥–æ –Ω–µ —É–∑–Ω–∞–µ–º –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏
      - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: 30-60s
    """
    failure_threshold: int = 5      # –°–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫ = –æ—Ç–∫—Ä—ã—Ç—å circuit
    success_threshold: int = 3      # –°–∫–æ–ª—å–∫–æ —É—Å–ø–µ—Ö–æ–≤ –≤ half-open = –∑–∞–∫—Ä—ã—Ç—å
    timeout: float = 30.0           # –ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
    window_size: int = 10           # –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –æ—à–∏–±–æ–∫


@dataclass
class CircuitBreaker:
    """
    –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Circuit Breaker –ø–∞—Ç—Ç–µ—Ä–Ω–∞.

    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
        breaker = CircuitBreaker(CircuitBreakerConfig())
        result = await breaker.call(my_async_function, arg1, arg2)
    """
    config: CircuitBreakerConfig = field(default_factory=CircuitBreakerConfig)
    state: CircuitState = CircuitState.CLOSED
    failures: deque = field(default_factory=lambda: deque(maxlen=10))
    successes_in_half_open: int = 0
    last_failure_time: Optional[float] = None

    async def call(self, func: Callable, *args, **kwargs):
        """
        –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å –∑–∞—â–∏—Ç–æ–π Circuit Breaker.

        –õ–æ–≥–∏–∫–∞:
        1. –ï—Å–ª–∏ OPEN –∏ timeout –Ω–µ –ø—Ä–æ—à—ë–ª ‚Üí —Å—Ä–∞–∑—É –æ—à–∏–±–∫–∞
        2. –ï—Å–ª–∏ OPEN –∏ timeout –ø—Ä–æ—à—ë–ª ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ HALF_OPEN
        3. –ï—Å–ª–∏ CLOSED –∏–ª–∏ HALF_OPEN ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é
        4. –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        """

        # === –ü–†–û–í–ï–†–ö–ê: –ù—É–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∏–∑ OPEN –≤ HALF_OPEN? ===
        if self.state == CircuitState.OPEN:
            if self._should_attempt_reset():
                # –ü—Ä–æ—à–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ ‚Äî –¥–∞—ë–º —à–∞–Ω—Å
                self.state = CircuitState.HALF_OPEN
                self.successes_in_half_open = 0
                print("üü° Circuit ‚Üí HALF_OPEN (—Ç–µ—Å—Ç–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å)")
            else:
                # –ï—â—ë —Ä–∞–Ω–æ ‚Äî —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É (fail fast)
                raise CircuitOpenError(
                    f"üî¥ Circuit OPEN! –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ "
                    f"{self._time_until_retry():.1f}s"
                )

        # === –í–´–ü–û–õ–ù–ï–ù–ò–ï –ó–ê–ü–†–û–°–ê ===
        try:
            result = await func(*args, **kwargs)
            self._on_success()
            return result
        except Exception as e:
            self._on_failure()
            raise

    def _on_success(self):
        """
        –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞.

        –ï—Å–ª–∏ –º—ã –≤ HALF_OPEN:
        - –°—á–∏—Ç–∞–µ–º —É—Å–ø–µ—Ö–∏
        - –ü–æ—Å–ª–µ N —É—Å–ø–µ—Ö–æ–≤ ‚Üí CLOSED

        –ï—Å–ª–∏ –º—ã –≤ CLOSED:
        - –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º (—É–∂–µ –≤—Å—ë —Ö–æ—Ä–æ—à–æ)
        """
        if self.state == CircuitState.HALF_OPEN:
            self.successes_in_half_open += 1

            # –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É—Å–ø–µ—Ö–æ–≤ ‚Äî —Å–µ—Ä–≤–∏—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è!
            if self.successes_in_half_open >= self.config.success_threshold:
                self.state = CircuitState.CLOSED
                self.failures.clear()
                print("üü¢ Circuit ‚Üí CLOSED (—Å–µ—Ä–≤–∏—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è!)")

    def _on_failure(self):
        """
        –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞.

        –ï—Å–ª–∏ –º—ã –≤ HALF_OPEN:
        - –°—Ä–∞–∑—É –æ–±—Ä–∞—Ç–Ω–æ –≤ OPEN (—Å–µ—Ä–≤–∏—Å –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤)

        –ï—Å–ª–∏ –º—ã –≤ CLOSED:
        - –î–æ–±–∞–≤–ª—è–µ–º –æ—à–∏–±–∫—É –≤ —Å—á—ë—Ç—á–∏–∫
        - –ï—Å–ª–∏ –æ—à–∏–±–æ–∫ >= threshold ‚Üí OPEN
        """
        current_time = time.time()
        self.failures.append(current_time)
        self.last_failure_time = current_time

        if self.state == CircuitState.HALF_OPEN:
            # –û–¥–Ω–∞ –æ—à–∏–±–∫–∞ –≤ half-open = —Å—Ä–∞–∑—É –æ–±—Ä–∞—Ç–Ω–æ –≤ open
            self.state = CircuitState.OPEN
            print("üî¥ Circuit ‚Üí OPEN (—Ç–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω)")

        elif self.state == CircuitState.CLOSED:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è
            if len(self.failures) >= self.config.failure_threshold:
                self.state = CircuitState.OPEN
                print(f"üî¥ Circuit ‚Üí OPEN ({len(self.failures)} –æ—à–∏–±–æ–∫!)")

    def _should_attempt_reset(self) -> bool:
        """–ü—Ä–æ—à–ª–æ –ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è?"""
        if self.last_failure_time is None:
            return True
        return time.time() - self.last_failure_time >= self.config.timeout

    def _time_until_retry(self) -> float:
        """–°–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ –ø–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è?"""
        if self.last_failure_time is None:
            return 0
        elapsed = time.time() - self.last_failure_time
        return max(0, self.config.timeout - elapsed)


class CircuitOpenError(Exception):
    """–û—à–∏–±–∫–∞: Circuit Breaker –æ—Ç–∫—Ä—ã—Ç, –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è."""
    pass


# ‚úÖ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º
def circuit_breaker(breaker: CircuitBreaker):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è Circuit Breaker."""
    def decorator(func):
        async def wrapper(*args, **kwargs):
            return await breaker.call(func, *args, **kwargs)
        return wrapper
    return decorator


# –°–æ–∑–¥–∞—ë–º –æ—Ç–¥–µ–ª—å–Ω—ã–π breaker –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
payment_breaker = CircuitBreaker(CircuitBreakerConfig(
    failure_threshold=5,   # –ü–æ—Å–ª–µ 5 –æ—à–∏–±–æ–∫ ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ–º
    timeout=30.0           # –ß–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
))

inventory_breaker = CircuitBreaker(CircuitBreakerConfig(
    failure_threshold=10,  # Inventory –º–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–µ–Ω ‚Äî –ø–æ—Ä–æ–≥ –≤—ã—à–µ
    timeout=60.0           # –ú–æ–∂–µ–º –∂–¥–∞—Ç—å –¥–æ–ª—å—à–µ
))


@circuit_breaker(payment_breaker)
async def process_payment(amount: float) -> dict:
    """–ü—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –ø–ª–∞—Ç–µ–∂–∞ —Å –∑–∞—â–∏—Ç–æ–π Circuit Breaker."""
    async with httpx.AsyncClient() as client:
        response = await client.post(
            "https://payment.api/charge",
            json={"amount": amount},
            timeout=5.0
        )
        return response.json()
```

### –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Circuit Breaker?

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ö—Ä–∏—Ç–∏—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å (–ø–ª–∞—Ç–µ–∂–∏) | –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–π (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏) |
|----------|---------------------------|---------------------------|
| `failure_threshold` | 3-5 | 10-15 |
| `timeout` | 15-30s | 60-120s |
| `success_threshold` | 2-3 | 1 |

**–õ–æ–≥–∏–∫–∞:** –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞—â–∏—â–∞–µ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–µ–µ (–±—ã—Å—Ç—Ä–µ–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º, –¥–æ–ª—å—à–µ –¥–µ—Ä–∂–∏–º –æ—Ç–∫—Ä—ã—Ç—ã–º).

---

## 3. Bulkhead Pattern (–ò–∑–æ–ª—è—Ü–∏—è –ø–µ—Ä–µ–±–æ—Ä–∫–∞–º–∏)

### –ê–Ω–∞–ª–æ–≥–∏—è: –ö–æ—Ä–∞–±–ª—å —Å –≤–æ–¥–æ–Ω–µ–ø—Ä–æ–Ω–∏—Ü–∞–µ–º—ã–º–∏ –æ—Ç—Å–µ–∫–∞–º–∏

```
–ö–û–†–ê–ë–õ–¨ –ë–ï–ó –ü–ï–†–ï–ë–û–†–û–ö (‚ùå)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    üö¢                        ‚îÇ
‚îÇ     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê    ‚îÇ
‚îÇ     ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë    ‚îÇ  ‚Üê –û–¥–Ω–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
‚îÇ     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         üíß –ü—Ä–æ–±–æ–∏–Ω–∞
              ‚Üì
         –í–æ–¥–∞ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –í–°–Å ‚Üí –ö–æ—Ä–∞–±–ª—å –¢–û–ù–ï–¢


–ö–û–†–ê–ë–õ–¨ –° –ü–ï–†–ï–ë–û–†–ö–ê–ú–ò (‚úÖ)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    üö¢                        ‚îÇ
‚îÇ     ‚ïê‚ïê‚ïê‚ïê‚ïë‚ïê‚ïê‚ïê‚ïê‚ïë‚ïê‚ïê‚ïê‚ïê‚ïë‚ïê‚ïê‚ïê‚ïê‚ïë‚ïê‚ïê‚ïê‚ïê‚ïë‚ïê‚ïê‚ïê‚ïê‚ïë‚ïê‚ïê‚ïê‚ïê      ‚îÇ
‚îÇ     ‚ñë‚ñë‚ñë‚ñë‚ïë    ‚ïë    ‚ïë    ‚ïë    ‚ïë    ‚ïë    ‚ñë    ‚îÇ  ‚Üê –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—Å–µ–∫–∏
‚îÇ     ‚ïê‚ïê‚ïê‚ïê‚ïë‚ïê‚ïê‚ïê‚ïê‚ïë‚ïê‚ïê‚ïê‚ïê‚ïë‚ïê‚ïê‚ïê‚ïê‚ïë‚ïê‚ïê‚ïê‚ïê‚ïë‚ïê‚ïê‚ïê‚ïê‚ïë‚ïê‚ïê‚ïê‚ïê      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         üíß –ü—Ä–æ–±–æ–∏–Ω–∞
              ‚Üì
         –í–æ–¥–∞ —Ç–æ–ª—å–∫–æ –≤ –û–î–ù–û–ú –æ—Ç—Å–µ–∫–µ ‚Üí –ö–æ—Ä–∞–±–ª—å –ù–ê –ü–õ–ê–í–£

–¢–∏—Ç–∞–Ω–∏–∫ –∑–∞—Ç–æ–Ω—É–ª –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–µ—Ä–µ–±–æ—Ä–∫–∏ –Ω–µ –¥–æ—Ö–æ–¥–∏–ª–∏ –¥–æ –ø–æ—Ç–æ–ª–∫–∞!
```

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Bulkhead –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏?

**–ü—Ä–æ–±–ª–µ–º–∞: –û–¥–∏–Ω –º–µ–¥–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å "—Å—ä–µ–¥–∞–µ—Ç" –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã**

```
–ë–ï–ó BULKHEAD:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –û–±—â–∏–π –ø—É–ª –ø–æ—Ç–æ–∫–æ–≤ (20)                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Thread 1-20: –≤—Å–µ –∑–∞–Ω—è—Ç—ã –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ Payment Service üíÄ   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  Payment Service —Ç–æ—Ä–º–æ–∑–∏—Ç ‚Üí –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –≤–∏—Å—è—Ç ‚Üí Inventory –∏    ‚îÇ
‚îÇ  User Service —Ç–æ–∂–µ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç –ø–æ—Ç–æ–∫–æ–≤ ‚Üí –í–°–Å —Ç–æ—Ä–º–æ–∑–∏—Ç!        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–° BULKHEAD:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—É–ª—ã                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Payment Pool (5)‚îÇ  ‚îÇ Inventory (10)  ‚îÇ  ‚îÇ User Pool (5) ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Thread 1-5: üíÄ  ‚îÇ  ‚îÇ Thread 1-10: ‚úÖ ‚îÇ  ‚îÇ Thread 1-5: ‚úÖ ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ  Payment —Ç–æ—Ä–º–æ–∑–∏—Ç ‚Üí —Ç–æ–ª—å–∫–æ Payment –ø–æ—Ç–æ–∫–∏ –∑–∞–Ω—è—Ç—ã ‚Üí            ‚îÇ
‚îÇ  Inventory –∏ User –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å! ‚úÖ                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¢–∏–ø—ã Bulkhead

| –¢–∏–ø | –ß—Ç–æ –∏–∑–æ–ª–∏—Ä—É–µ—Ç—Å—è | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-----|-----------------|-------------------|
| **Thread Pool** | –ü–æ—Ç–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | Java/JVM –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| **Semaphore** | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ concurrent –∑–∞–ø—Ä–æ—Å–æ–≤ | Async –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Python, Node.js) |
| **Connection Pool** | –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î | –ó–∞—â–∏—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| **Process/Container** | CPU –∏ –ø–∞–º—è—Ç—å | Kubernetes, Docker |

### Bulkhead Implementation (Semaphore-based)

```python
import asyncio
from dataclasses import dataclass
from typing import Callable

@dataclass
class BulkheadConfig:
    """
    –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Bulkhead.

    max_concurrent: –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
        - –°–ª–∏—à–∫–æ–º –º–∞–ª–æ ‚Üí –æ—á–µ—Ä–µ–¥—å, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∂–¥—É—Ç
        - –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ ‚Üí –Ω–µ—Ç –∑–∞—â–∏—Ç—ã
        - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏

    max_wait: –°–∫–æ–ª—å–∫–æ –∂–¥–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥–∏
        - –°–ª–∏—à–∫–æ–º –º–∞–ª–æ ‚Üí –º–Ω–æ–≥–æ –æ—Ç–∫–∞–∑–æ–≤ –ø—Ä–∏ –ø–∏–∫–∞—Ö
        - –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ ‚Üí –ø–ª–æ—Ö–æ–π user experience
        - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: 1-10 —Å–µ–∫—É–Ω–¥
    """
    max_concurrent: int = 10    # –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    max_wait: float = 5.0       # –ú–∞–∫—Å–∏–º—É–º –∂–¥–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥–∏ (—Å–µ–∫—É–Ω–¥—ã)


class Bulkhead:
    """
    Semaphore-based Bulkhead –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è concurrent –∑–∞–ø—Ä–æ—Å–æ–≤.

    –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Semaphore:
    - –ï—Å—Ç—å N "—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π" (permits)
    - –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –±–µ—Ä—ë—Ç 1 —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
    - –ö–æ–≥–¥–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–µ—Ç ‚Äî –∂–¥—ë–º –∏–ª–∏ –æ—Ç–∫–∞–∑—ã–≤–∞–µ–º
    - –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
    """

    def __init__(self, config: BulkheadConfig):
        self.config = config
        # Semaphore ‚Äî —ç—Ç–æ "—Å—á—ë—Ç—á–∏–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π"
        # asyncio.Semaphore(10) = 10 —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
        self.semaphore = asyncio.Semaphore(config.max_concurrent)
        self.waiting = 0    # –°–∫–æ–ª—å–∫–æ –∂–¥—É—Ç –≤ –æ—á–µ—Ä–µ–¥–∏
        self.active = 0     # –°–∫–æ–ª—å–∫–æ —Å–µ–π—á–∞—Å –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

    async def call(self, func: Callable, *args, **kwargs):
        """
        –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º concurrency.

        –ê–ª–≥–æ—Ä–∏—Ç–º:
        1. –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ (acquire)
        2. –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –∑–∞ max_wait ‚Üí BulkheadFullError
        3. –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é
        4. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ (release)
        """
        self.waiting += 1

        try:
            # –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
            # wait_for –≤—ã–±—Ä–æ—Å–∏—Ç TimeoutError –µ—Å–ª–∏ –Ω–µ —É—Å–ø–µ–µ–º
            acquired = await asyncio.wait_for(
                self.semaphore.acquire(),
                timeout=self.config.max_wait
            )
        except asyncio.TimeoutError:
            # –ù–µ –¥–æ–∂–¥–∞–ª–∏—Å—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è ‚Äî –æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞
            self.waiting -= 1
            raise BulkheadFullError(
                f"üö´ Bulkhead –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω: {self.active} –∞–∫—Ç–∏–≤–Ω—ã—Ö, "
                f"{self.waiting} –≤ –æ—á–µ—Ä–µ–¥–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
            )

        # –ü–æ–ª—É—á–∏–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ ‚Äî —Ç–µ–ø–µ—Ä—å –º—ã "active"
        self.waiting -= 1
        self.active += 1

        try:
            # –í—ã–ø–æ–ª–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é
            return await func(*args, **kwargs)
        finally:
            # –í–°–ï–ì–î–ê –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ, –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            self.active -= 1
            self.semaphore.release()

    @property
    def metrics(self) -> dict:
        """–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞."""
        return {
            "active": self.active,
            "waiting": self.waiting,
            "available": self.config.max_concurrent - self.active,
            "utilization": self.active / self.config.max_concurrent
        }


class BulkheadFullError(Exception):
    """–û—à–∏–±–∫–∞: Bulkhead –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω, –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è."""
    pass


# ‚úÖ –°–æ–∑–¥–∞—ë–º –æ—Ç–¥–µ–ª—å–Ω—ã–π bulkhead –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
payment_bulkhead = Bulkhead(BulkheadConfig(
    max_concurrent=5,    # –ú–∞–∫—Å–∏–º—É–º 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
    max_wait=3.0         # –ñ–¥—ë–º –≤ –æ—á–µ—Ä–µ–¥–∏ –º–∞–∫—Å–∏–º—É–º 3 —Å–µ–∫—É–Ω–¥—ã
))

inventory_bulkhead = Bulkhead(BulkheadConfig(
    max_concurrent=20,   # Inventory –º–æ–∂–µ—Ç –±–æ–ª—å—à–µ
    max_wait=5.0
))

email_bulkhead = Bulkhead(BulkheadConfig(
    max_concurrent=50,   # Email ‚Äî –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–π, –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ
    max_wait=10.0
))


async def process_order(order_id: str):
    """
    –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–∞ —Å –∏–∑–æ–ª—è—Ü–∏–µ–π –∫–∞–∂–¥–æ–≥–æ –≤–Ω–µ—à–Ω–µ–≥–æ –≤—ã–∑–æ–≤–∞.

    –ö–∞–∂–¥—ã–π –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å –≤ —Å–≤–æ—ë–º "–æ—Ç—Å–µ–∫–µ":
    - –ï—Å–ª–∏ –ø–ª–∞—Ç–µ–∂–∏ —Ç–æ—Ä–º–æ–∑—è—Ç ‚Üí inventory –Ω–µ —Å—Ç—Ä–∞–¥–∞–µ—Ç
    - –ï—Å–ª–∏ email –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è ‚Üí –∑–∞–∫–∞–∑ –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è
    """

    # –ü–ª–∞—Ç—ë–∂ ‚Äî —Å—Ç—Ä–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω (–∫—Ä–∏—Ç–∏—á–Ω—ã–π)
    payment_result = await payment_bulkhead.call(
        charge_payment, order_id
    )

    # –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —Å–≤–æ—ë –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
    inventory_result = await inventory_bulkhead.call(
        reserve_inventory, order_id
    )

    # Email ‚Äî –Ω–∞–∏–º–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–π
    try:
        await email_bulkhead.call(
            send_confirmation_email, order_id
        )
    except BulkheadFullError:
        # Email –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω ‚Äî –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ
        await queue_email_for_later(order_id)

    return {
        "order_id": order_id,
        "payment": payment_result,
        "inventory": inventory_result
    }
```

### Bulkhead vs Rate Limiting ‚Äî –≤ —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞?

```
BULKHEAD (–∑–∞—â–∏—Ç–∞ CALLER ‚Äî —Ç–æ–≥–æ, –∫—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ                                              ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                      ‚îÇ
‚îÇ   ‚îÇ "–ù–µ –±–æ–ª–µ–µ 10      ‚îÇ ‚Üí Payment Service (–≤–Ω–µ—à–Ω–∏–π)         ‚îÇ
‚îÇ   ‚îÇ  –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö    ‚îÇ                                      ‚îÇ
‚îÇ   ‚îÇ  –∑–∞–ø—Ä–æ—Å–æ–≤"        ‚îÇ                                      ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                      ‚îÇ
‚îÇ   –ó–∞—â–∏—Ç–∞: –Ω–∞—à–∏ —Ä–µ—Å—É—Ä—Å—ã –Ω–µ –±—É–¥—É—Ç –∏—Å—á–µ—Ä–ø–∞–Ω—ã                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

RATE LIMITING (–∑–∞—â–∏—Ç–∞ CALLEE ‚Äî —Ç–æ–≥–æ, –∫–æ–≥–æ –≤—ã–∑—ã–≤–∞—é—Ç)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –í–Ω–µ—à–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã                                             ‚îÇ
‚îÇ   Client A ‚îÄ‚îê                                               ‚îÇ
‚îÇ   Client B ‚îÄ‚îº‚îÄ‚îÄ‚Üí ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚Üí –ù–∞—à API            ‚îÇ
‚îÇ   Client C ‚îÄ‚îò    ‚îÇ "–ù–µ –±–æ–ª–µ–µ 100    ‚îÇ                      ‚îÇ
‚îÇ                  ‚îÇ  –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫"   ‚îÇ                      ‚îÇ
‚îÇ                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                      ‚îÇ
‚îÇ   –ó–∞—â–∏—Ç–∞: –Ω–∞—à API –Ω–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –í–ú–ï–°–¢–ï!
```

---

## 4. Timeout Pattern (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è)

### –ê–Ω–∞–ª–æ–≥–∏—è: –û—Ñ–∏—Ü–∏–∞–Ω—Ç –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ

```
–ë–ï–ó TIMEOUT:
–¢—ã –∑–∞–∫–∞–∑–∞–ª –µ–¥—É –∏ –∂–¥—ë—à—å...
‚è∞ 10 –º–∏–Ω—É—Ç... 20 –º–∏–Ω—É—Ç... 30 –º–∏–Ω—É—Ç... 1 —á–∞—Å...
–¢—ã –≤—Å—ë –µ—â—ë –∂–¥—ë—à—å. –ú–æ–∂–µ—Ç, –∑–∞–∫–∞–∑ –ø–æ—Ç–µ—Ä—è–ª—Å—è?
–ù–æ —Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ—à—å –∂–¥–∞—Ç—å... –≤–µ—á–Ω–æ.

–° TIMEOUT:
–¢—ã –∑–∞–∫–∞–∑–∞–ª –µ–¥—É –∏ –∑–∞—Å—ë–∫ –≤—Ä–µ–º—è.
‚è∞ 15 –º–∏–Ω—É—Ç ‚Äî "–ï—Å–ª–∏ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç –Ω–µ –ø—Ä–∏–Ω–µ—Å—É—Ç, —Å–ø—Ä–æ—à—É –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞"
‚è∞ 20 –º–∏–Ω—É—Ç ‚Äî "–ò–∑–≤–∏–Ω–∏—Ç–µ, –º–æ–π –∑–∞–∫–∞–∑ –ø–æ—Ç–µ—Ä—è–ª—Å—è?"
–¢—ã –ù–ï –∂–¥—ë—à—å –≤–µ—á–Ω–æ. –¢—ã —Å—Ç–∞–≤–∏—à—å –≥—Ä–∞–Ω–∏—Ü—É.
```

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Timeout?

**–ë–µ–∑ timeout –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å –í–ï–ß–ù–û:**

```python
# ‚ùå –ü–õ–û–•–û: –ú–æ–∂–µ—Ç –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è
async def bad_fetch(url):
    return await client.get(url)  # –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Üí –≤–∏—Å–Ω–µ—Ç

# –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
# 1. –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
# 2. –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç (—É–ø–∞–ª, —Å–µ—Ç—å –ø–æ—Ç–µ—Ä—è–ª–∞—Å—å)
# 3. –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ, –ø–æ—Ç–æ–∫ –∑–∞–Ω—è—Ç
# 4. –î—Ä—É–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
# 5. –ü–∞–º—è—Ç—å —É—Ç–µ–∫–∞–µ—Ç
# 6. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–º–∏—Ä–∞–µ—Ç
```

### –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ Timeout?

```
–°–ª–∏—à–∫–æ–º –ö–û–†–û–¢–ö–ò–ô timeout:
‚îú‚îÄ –ú–Ω–æ–≥–æ –ª–æ–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫ (—Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å)
‚îú‚îÄ –ë–æ–ª—å—à–µ retry ‚Üí –±–æ–ª—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞
‚îî‚îÄ –ü–ª–æ—Ö–æ–π user experience

–°–ª–∏—à–∫–æ–º –î–õ–ò–ù–ù–´–ô timeout:
‚îú‚îÄ –î–æ–ª–≥–æ –∂–¥—ë–º –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö
‚îú‚îÄ –†–µ—Å—É—Ä—Å—ã –∑–∞–Ω—è—Ç—ã –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ
‚îî‚îÄ –ü–ª–æ—Ö–æ–π user experience

–û–ü–¢–ò–ú–ê–õ–¨–ù–´–ô timeout:
‚îú‚îÄ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º p99 latency —Å–µ—Ä–≤–∏—Å–∞ (99% –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã—Å—Ç—Ä–µ–µ X)
‚îú‚îÄ –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∞—Å 20-50%
‚îî‚îÄ timeout = p99 √ó 1.5
```

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞:**
```
Payment Service:
- p50 (–º–µ–¥–∏–∞–Ω–∞): 100ms
- p95: 300ms
- p99: 500ms
- p99.9: 1000ms

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π timeout: 500ms √ó 1.5 = 750ms ‚âà 1 —Å–µ–∫—É–Ω–¥–∞
```

### Timeout Implementation

```python
import asyncio
from typing import TypeVar, Callable
from functools import wraps

T = TypeVar('T')

class TimeoutConfig:
    def __init__(
        self,
        timeout: float = 5.0,          # –°–∫–æ–ª—å–∫–æ –∂–¥–∞—Ç—å (—Å–µ–∫—É–Ω–¥—ã)
        cancel_on_timeout: bool = True  # –û—Ç–º–µ–Ω—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ?
    ):
        self.timeout = timeout
        self.cancel_on_timeout = cancel_on_timeout


def with_timeout(config: TimeoutConfig):
    """
    –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ timeout.

    –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
    1. –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é
    2. –ï—Å–ª–∏ –∑–∞ config.timeout —Å–µ–∫—É–Ω–¥ –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å ‚Üí TimeoutError
    3. –ï—Å–ª–∏ cancel_on_timeout=True ‚Üí –æ—Ç–º–µ–Ω—è–µ–º –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é –∑–∞–¥–∞—á—É
    """
    def decorator(func: Callable[..., T]) -> Callable[..., T]:
        @wraps(func)
        async def wrapper(*args, **kwargs) -> T:
            try:
                # wait_for: –≤—ã–ø–æ–ª–Ω–∏ —Ñ—É–Ω–∫—Ü–∏—é, –Ω–æ –Ω–µ –¥–æ–ª—å—à–µ timeout —Å–µ–∫—É–Ω–¥
                return await asyncio.wait_for(
                    func(*args, **kwargs),
                    timeout=config.timeout
                )
            except asyncio.TimeoutError:
                # –ü—Ä–µ–≤—ã—Å–∏–ª–∏ timeout ‚Äî –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–Ω—è—Ç–Ω—É—é –æ—à–∏–±–∫—É
                raise TimeoutError(
                    f"‚è∞ {func.__name__} –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –∑–∞ {config.timeout}s"
                )
        return wrapper
    return decorator


# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
@with_timeout(TimeoutConfig(timeout=3.0))
async def fetch_user_data(user_id: str) -> dict:
    """–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å timeout 3 —Å–µ–∫—É–Ω–¥—ã."""
    async with httpx.AsyncClient() as client:
        response = await client.get(f"/users/{user_id}")
        return response.json()


# ‚úÖ –ú–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏
@retry(RetryConfig(max_attempts=3))
@with_timeout(TimeoutConfig(timeout=2.0))
@circuit_breaker(user_service_breaker)
async def get_user_with_protection(user_id: str) -> dict:
    """
    –ü–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞:
    1. Circuit Breaker ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç cascade failure
    2. Timeout ‚Äî –Ω–µ –∂–¥—ë–º –≤–µ—á–Ω–æ
    3. Retry ‚Äî –ø–æ–≤—Ç–æ—Ä—è–µ–º –ø—Ä–∏ transient failures
    """
    return await user_service.get(user_id)
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞—Å–∫–∞–¥–Ω—ã–µ Timeouts

```
         Client (timeout=10s)
            ‚îÇ
            ‚ñº
         Service A (timeout=8s)
            ‚îÇ
            ‚ñº
         Service B (timeout=6s)
            ‚îÇ
            ‚ñº
         Service C (timeout=4s)
            ‚îÇ
            ‚ñº
         Database (slow query 5s)

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. DB –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ 5s ‚Üí C —Ç–∞–π–º–∞—É—Ç–∏—Ç—Å—è (4s)
2. B —Ä–µ—Ç—Ä–∞–∏—Ç ‚Üí –∂–¥—ë—Ç –µ—â—ë 6s ‚Üí —Ç–∞–π–º–∞—É—Ç–∏—Ç—Å—è
3. A —Ä–µ—Ç—Ä–∞–∏—Ç ‚Üí –∂–¥—ë—Ç –µ—â—ë 8s ‚Üí —Ç–∞–π–º–∞—É—Ç–∏—Ç—Å—è
4. Client –≤–∏–¥–∏—Ç —Ç–∞–π–º–∞—É—Ç –ø–æ—Å–ª–µ 10s

Retry amplification:
- DB –ø–æ–ª—É—á–∞–µ—Ç: 1 + 3 (retry B) + 9 (retry A √ó retry B) = 13 –∑–∞–ø—Ä–æ—Å–æ–≤!
```

**–†–µ—à–µ–Ω–∏–µ: Retry —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ**

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: Retry —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ
@retry(config)  # Retry –ó–î–ï–°–¨
async def api_handler():
    return await service_a.call()  # –ë–µ–∑ retry

async def service_a_call():
    return await service_b.call()  # –ë–µ–∑ retry

async def service_b_call():
    return await database.query()  # –ë–µ–∑ retry
```

---

## 5. Fallback Pattern (–†–µ–∑–µ—Ä–≤–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)

### –ê–Ω–∞–ª–æ–≥–∏—è: –ü–ª–∞–Ω –ë

```
–¢—ã —Å–æ–±–∏—Ä–∞–µ—à—å—Å—è –Ω–∞ —Ä–∞–±–æ—Ç—É:

–ü–ª–∞–Ω –ê: –ü–æ–µ—Ö–∞—Ç—å –Ω–∞ –º–∞—à–∏–Ω–µ
  ‚Üì (–º–∞—à–∏–Ω–∞ –Ω–µ –∑–∞–≤–æ–¥–∏—Ç—Å—è)
–ü–ª–∞–Ω –ë: –í—ã–∑–≤–∞—Ç—å —Ç–∞–∫—Å–∏
  ‚Üì (—Ç–∞–∫—Å–∏ –Ω–µ—Ç –≤ —Ä–∞–π–æ–Ω–µ)
–ü–ª–∞–Ω –í: –ü–æ–µ—Ö–∞—Ç—å –Ω–∞ –∞–≤—Ç–æ–±—É—Å–µ
  ‚Üì (–∞–≤—Ç–æ–±—É—Å –æ—Ç–º–µ–Ω—ë–Ω)
–ü–ª–∞–Ω –ì: –†–∞–±–æ—Ç–∞—Ç—å –∏–∑ –¥–æ–º–∞ (degraded mode)

–ë–ï–ó fallback: –ú–∞—à–∏–Ω–∞ –Ω–µ –∑–∞–≤–µ–ª–∞—Å—å ‚Üí –ü–ê–ù–ò–ö–ê ‚Üí –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—à—å
–° fallback: –ú–∞—à–∏–Ω–∞ –Ω–µ –∑–∞–≤–µ–ª–∞—Å—å ‚Üí —Ç–∞–∫—Å–∏ ‚Üí –∞–≤—Ç–æ–±—É—Å ‚Üí –∏–∑ –¥–æ–º–∞
```

### –í–∏–¥—ã Fallback

| –í–∏–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----|----------|--------|
| **Cache fallback** | –í–µ—Ä–Ω—É—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞ | –ö—É—Ä—Å –≤–∞–ª—é—Ç—ã –∏–∑ –∫—ç—à–∞ –≤–º–µ—Å—Ç–æ API |
| **Default value** | –í–µ—Ä–Ω—É—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π |
| **Degraded service** | –£—Ä–µ–∑–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å | –¢–æ–≤–∞—Ä –±–µ–∑ –æ—Ç–∑—ã–≤–æ–≤ |
| **Static response** | –ó–∞–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç | "–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω" |
| **Alternative service** | –î—Ä—É–≥–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä | –ó–∞–ø–∞—Å–Ω–æ–π –ø–ª–∞—Ç—ë–∂–Ω—ã–π —à–ª—é–∑ |

### Fallback Implementation

```python
from typing import TypeVar, Callable, Optional, Union
from functools import wraps

T = TypeVar('T')

class FallbackConfig:
    """
    –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è fallback-–ø–æ–≤–µ–¥–µ–Ω–∏—è.

    fallback_value: –°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    fallback_func: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è fallback (–º–æ–∂–µ—Ç –±—ã—Ç—å async)
    exceptions: –ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏ —Ç—Ä–∏–≥–≥–µ—Ä—è—Ç fallback
    log_fallback: –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fallback
    """
    def __init__(
        self,
        fallback_value: Optional[T] = None,
        fallback_func: Optional[Callable[..., T]] = None,
        exceptions: tuple = (Exception,),
        log_fallback: bool = True
    ):
        self.fallback_value = fallback_value
        self.fallback_func = fallback_func
        self.exceptions = exceptions
        self.log_fallback = log_fallback


def with_fallback(config: FallbackConfig):
    """
    –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ fallback.

    –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
    1. –ï—Å–ª–∏ –µ—Å—Ç—å fallback_func ‚Üí –≤—ã–∑—ã–≤–∞–µ–º –µ—ë
    2. –ò–Ω–∞—á–µ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º fallback_value
    """
    def decorator(func: Callable[..., T]) -> Callable[..., T]:
        @wraps(func)
        async def wrapper(*args, **kwargs) -> T:
            try:
                return await func(*args, **kwargs)
            except config.exceptions as e:
                if config.log_fallback:
                    print(f"‚ö†Ô∏è {func.__name__} failed: {e}. Using fallback.")

                if config.fallback_func:
                    # –í—ã–∑—ã–≤–∞–µ–º fallback —Ñ—É–Ω–∫—Ü–∏—é —Å —Ç–µ–º–∏ –∂–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
                    return await config.fallback_func(*args, **kwargs)
                return config.fallback_value
        return wrapper
    return decorator


# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# === –ü—Ä–∏–º–µ—Ä 1: Fallback –Ω–∞ –∫—ç—à ===

async def get_cached_user(user_id: str) -> dict:
    """Fallback: –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫—ç—à–∞."""
    cached = await cache.get(f"user:{user_id}")
    if cached:
        return {**cached, "_source": "cache", "_stale": True}
    # –ï—Å–ª–∏ –≤ –∫—ç—à–µ –Ω–µ—Ç ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    return {"id": user_id, "name": "Unknown", "_source": "default"}


@with_fallback(FallbackConfig(fallback_func=get_cached_user))
async def get_user(user_id: str) -> dict:
    """
    –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî –≤–µ—Ä–Ω—É—Ç—å –∏–∑ –∫—ç—à–∞ (—É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –ª—É—á—à–µ, —á–µ–º –Ω–∏—á–µ–≥–æ).
    """
    user = await user_service.get(user_id)
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à –¥–ª—è –±—É–¥—É—â–∏—Ö fallback
    await cache.set(f"user:{user_id}", user, ttl=3600)
    return user


# === –ü—Ä–∏–º–µ—Ä 2: Fallback –Ω–∞ –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ===

@with_fallback(FallbackConfig(fallback_value=[]))
async def get_recommendations(user_id: str) -> list:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
    –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ (–ª—É—á—à–µ –Ω–∏—á–µ–≥–æ, —á–µ–º –æ—à–∏–±–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ).
    """
    return await recommendation_service.get(user_id)


# === –ü—Ä–∏–º–µ—Ä 3: Graceful Degradation ===

class ProductService:
    """
    –°–µ—Ä–≤–∏—Å —Ç–æ–≤–∞—Ä–æ–≤ —Å graceful degradation.

    –£—Ä–æ–≤–Ω–∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏:
    1. Full: —Ç–æ–≤–∞—Ä + –æ—Ç–∑—ã–≤—ã + —Ä–µ–π—Ç–∏–Ω–≥ + —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    2. Basic: —Ç–æ–≤–∞—Ä + –æ—Ç–∑—ã–≤—ã + —Ä–µ–π—Ç–∏–Ω–≥
    3. Minimal: —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä
    """

    async def get_product(self, product_id: str) -> dict:
        """–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ–π –ø–æ–ª–Ω–æ—Ç–æ–π –¥–∞–Ω–Ω—ã—Ö."""

        # –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã (–±–µ–∑ –Ω–∏—Ö –Ω–µ—Ç —Å–º—ã—Å–ª–∞)
        product = await self._get_basic_product(product_id)

        # –û–±–æ–≥–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–º–∏, –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã
        product["reviews"] = await self._safe_get_reviews(product_id)
        product["rating"] = await self._safe_get_rating(product_id)
        product["recommendations"] = await self._safe_get_recommendations(product_id)

        # –ü–æ–º–µ—á–∞–µ–º, —á—Ç–æ –µ—Å—Ç—å degraded
        if any(v is None for v in [product["reviews"], product["rating"]]):
            product["_degraded"] = True

        return product

    async def _get_basic_product(self, product_id: str) -> dict:
        """–ü–æ–ª—É—á–∏—Ç—å –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞ (–±–µ–∑ fallback ‚Äî —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ)."""
        return await self.db.get(product_id)

    async def _safe_get_reviews(self, product_id: str) -> Optional[list]:
        """–ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–∑—ã–≤—ã (—Å fallback –Ω–∞ None)."""
        try:
            return await review_service.get(product_id)
        except Exception as e:
            print(f"Reviews unavailable: {e}")
            return None  # –ü–æ–∫–∞–∂–µ–º —Ç–æ–≤–∞—Ä –±–µ–∑ –æ—Ç–∑—ã–≤–æ–≤

    async def _safe_get_rating(self, product_id: str) -> Optional[float]:
        """–ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥."""
        try:
            return await rating_service.get(product_id)
        except Exception:
            return None

    async def _safe_get_recommendations(self, product_id: str) -> list:
        """–ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (fallback –Ω–∞ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫)."""
        try:
            return await recommendation_service.get(product_id)
        except Exception:
            return []  # –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ ‚Äî –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é
```

### Trade-offs Fallback (–ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å)

| –°–∏—Ç—É–∞—Ü–∏—è | –ü–æ—á–µ–º—É fallback –æ–ø–∞—Å–µ–Ω | –ß—Ç–æ –¥–µ–ª–∞—Ç—å |
|----------|----------------------|------------|
| **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** | Fallback –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ | Fail fast, –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É |
| **–ë–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** | Fallback path –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω ‚Üí –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å fallback –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å |
| **Stale data –∫—Ä–∏—Ç–∏—á–Ω—ã** | –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –Ω–∞–≤—Ä–µ–¥–∏—Ç—å | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cache fallback |
| **Inconsistent state** | –ß–∞—Å—Ç–∏—á–Ω—ã–π fallback —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è | –í—Å—ë –∏–ª–∏ –Ω–∏—á–µ–≥–æ (atomicity) |

**–ü—Ä–∞–≤–∏–ª–æ:** Fallback path –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–ø—Ä–æ—â–µ** –æ—Å–Ω–æ–≤–Ω–æ–≥–æ, –∏–Ω–∞—á–µ –æ–Ω —Ç–æ–∂–µ —Å–ª–æ–º–∞–µ—Ç—Å—è!

---

## 6. Combined Resilience Stack (–í—Å—ë –≤–º–µ—Å—Ç–µ)

### –ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ—ë–≤ (–≤–∞–∂–Ω–æ!)

```
–ó–∞–ø—Ä–æ—Å –≤—Ö–æ–¥–∏—Ç –°–í–ï–†–•–£, –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –∫–∞–∂–¥—ã–π —Å–ª–æ–π:

    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   BULKHEAD         ‚îÇ ‚Üê 1. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
    ‚îÇ   (max 10 concurrent)‚îÇ    –ó–∞—â–∏—Ç–∞: –Ω–µ –∏—Å—á–µ—Ä–ø–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  CIRCUIT BREAKER   ‚îÇ ‚Üê 2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Å–µ—Ä–≤–∏—Å
    ‚îÇ  (fail fast –µ—Å–ª–∏   ‚îÇ    –ó–∞—â–∏—Ç–∞: –Ω–µ –±–∏—Ç—å –º—ë—Ä—Ç–≤—ã–π —Å–µ—Ä–≤–∏—Å
    ‚îÇ   —Å–µ—Ä–≤–∏—Å –ª–µ–∂–∏—Ç)    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ      RETRY         ‚îÇ ‚Üê 3. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –ø—Ä–∏ transient errors
    ‚îÇ  (3 attempts,      ‚îÇ    –ó–∞—â–∏—Ç–∞: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–±–æ–∏
    ‚îÇ   exponential)     ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ     TIMEOUT        ‚îÇ ‚Üê 4. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è
    ‚îÇ   (max 5s)         ‚îÇ    –ó–∞—â–∏—Ç–∞: –Ω–µ –≤–∏—Å–Ω—É—Ç—å –≤–µ—á–Ω–æ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   EXTERNAL CALL    ‚îÇ ‚Üê 5. –†–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ —Å–µ—Ä–≤–∏—Å–∞
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ï—Å–ª–∏ –ª—é–±–æ–π —Å–ª–æ–π –æ—à–∏–±—Å—è ‚Üí FALLBACK
```

### Complete Implementation

```python
from dataclasses import dataclass
from typing import Callable, Optional, TypeVar

T = TypeVar('T')

@dataclass
class ResilienceConfig:
    """
    –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è resilience stack.

    –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:

    –ö–†–ò–¢–ò–ß–ù–´–ô –°–ï–†–í–ò–° (–ø–ª–∞—Ç–µ–∂–∏):
        timeout=3.0, retry_attempts=2, circuit_failure=3

    –í–ê–ñ–ù–´–ô –°–ï–†–í–ò–° (inventory):
        timeout=5.0, retry_attempts=3, circuit_failure=5

    –ù–ï–ö–†–ò–¢–ò–ß–ù–´–ô –°–ï–†–í–ò–° (analytics):
        timeout=10.0, retry_attempts=5, circuit_failure=10
    """
    # Timeout –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    timeout: float = 5.0

    # Retry –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    retry_attempts: int = 3
    retry_base_delay: float = 1.0
    retry_max_delay: float = 30.0

    # Circuit Breaker –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    circuit_failure_threshold: int = 5
    circuit_timeout: float = 30.0

    # Bulkhead –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    bulkhead_max_concurrent: int = 10
    bulkhead_max_wait: float = 5.0


class ResilientClient:
    """
    –ö–ª–∏–µ–Ω—Ç —Å –ø–æ–ª–Ω—ã–º resilience stack.

    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
        client = ResilientClient(ResilienceConfig())

        result = await client.call(
            external_api.fetch_data,
            "param1",
            fallback=get_cached_data
        )
    """

    def __init__(self, config: ResilienceConfig, name: str = "default"):
        self.config = config
        self.name = name

        # –°–æ–∑–¥–∞—ë–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
        self.circuit_breaker = CircuitBreaker(CircuitBreakerConfig(
            failure_threshold=config.circuit_failure_threshold,
            timeout=config.circuit_timeout
        ))
        self.bulkhead = Bulkhead(BulkheadConfig(
            max_concurrent=config.bulkhead_max_concurrent,
            max_wait=config.bulkhead_max_wait
        ))

        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        self.stats = {
            "total_calls": 0,
            "successful_calls": 0,
            "failed_calls": 0,
            "fallback_calls": 0,
            "circuit_open_rejections": 0,
            "bulkhead_rejections": 0
        }

    async def call(
        self,
        func: Callable,
        *args,
        fallback: Optional[Callable] = None,
        **kwargs
    ) -> T:
        """
        –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—ã–∑–æ–≤ —Å –ø–æ–ª–Ω–æ–π –∑–∞—â–∏—Ç–æ–π.

        –°–ª–æ–∏ –∑–∞—â–∏—Ç—ã (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è):
        1. Bulkhead ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ concurrent
        2. Circuit Breaker ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç cascade
        3. Retry ‚Äî –ø–æ–≤—Ç–æ—Ä –ø—Ä–∏ transient
        4. Timeout ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è

        –ï—Å–ª–∏ –≤—Å—ë fail ‚Üí fallback (–µ—Å–ª–∏ –µ—Å—Ç—å)
        """
        self.stats["total_calls"] += 1

        try:
            # === –°–õ–û–ô 1: BULKHEAD ===
            result = await self.bulkhead.call(
                self._call_with_circuit_breaker,
                func, args, kwargs
            )
            self.stats["successful_calls"] += 1
            return result

        except BulkheadFullError:
            self.stats["bulkhead_rejections"] += 1
            self.stats["failed_calls"] += 1
            return await self._handle_failure(fallback, args, kwargs)

        except CircuitOpenError:
            self.stats["circuit_open_rejections"] += 1
            self.stats["failed_calls"] += 1
            return await self._handle_failure(fallback, args, kwargs)

        except Exception as e:
            self.stats["failed_calls"] += 1
            return await self._handle_failure(fallback, args, kwargs, e)

    async def _call_with_circuit_breaker(self, func, args, kwargs):
        """–°–ª–æ–π 2: Circuit Breaker."""
        return await self.circuit_breaker.call(
            self._call_with_retry,
            func, args, kwargs
        )

    async def _call_with_retry(self, func, args, kwargs):
        """–°–ª–æ–π 3: Retry —Å exponential backoff."""
        last_exception = None

        for attempt in range(self.config.retry_attempts):
            try:
                # === –°–õ–û–ô 4: TIMEOUT ===
                return await asyncio.wait_for(
                    func(*args, **kwargs),
                    timeout=self.config.timeout
                )
            except (asyncio.TimeoutError, ConnectionError) as e:
                last_exception = e
                if attempt < self.config.retry_attempts - 1:
                    # Exponential backoff —Å jitter
                    delay = min(
                        self.config.retry_base_delay * (2 ** attempt),
                        self.config.retry_max_delay
                    )
                    delay = random.uniform(0, delay)  # Full jitter
                    await asyncio.sleep(delay)

        raise last_exception

    async def _handle_failure(
        self,
        fallback: Optional[Callable],
        args: tuple,
        kwargs: dict,
        error: Optional[Exception] = None
    ) -> T:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏: fallback –∏–ª–∏ re-raise."""
        if fallback:
            self.stats["fallback_calls"] += 1
            return await fallback(*args, **kwargs)
        if error:
            raise error
        raise Exception(f"Call to {self.name} failed and no fallback provided")

    @property
    def health(self) -> dict:
        """–°—Ç–∞—Ç—É—Å –∑–¥–æ—Ä–æ–≤—å—è –∫–ª–∏–µ–Ω—Ç–∞."""
        return {
            "name": self.name,
            "circuit_state": self.circuit_breaker.state.value,
            "bulkhead_utilization": self.bulkhead.metrics["utilization"],
            "success_rate": (
                self.stats["successful_calls"] / self.stats["total_calls"]
                if self.stats["total_calls"] > 0 else 1.0
            ),
            "stats": self.stats
        }


# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# –°–æ–∑–¥–∞—ë–º –∫–ª–∏–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
payment_client = ResilientClient(
    ResilienceConfig(
        timeout=3.0,
        retry_attempts=2,
        circuit_failure_threshold=3,
        bulkhead_max_concurrent=5
    ),
    name="payment"
)

inventory_client = ResilientClient(
    ResilienceConfig(
        timeout=5.0,
        retry_attempts=3,
        circuit_failure_threshold=5,
        bulkhead_max_concurrent=20
    ),
    name="inventory"
)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
async def process_order(order: Order):
    # –ü–ª–∞—Ç—ë–∂ —Å fallback
    payment = await payment_client.call(
        payment_service.charge,
        order.amount,
        fallback=lambda amount: {"status": "pending", "retry_later": True}
    )

    # Inventory —Å fallback
    inventory = await inventory_client.call(
        inventory_service.reserve,
        order.items,
        fallback=lambda items: {"status": "pending", "backorder": True}
    )

    return {"payment": payment, "inventory": inventory}


# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
async def health_check():
    return {
        "payment": payment_client.health,
        "inventory": inventory_client.health
    }
```

---

## Decision Tree: –ö–∞–∫–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

```
                           –ü—Ä–æ–±–ª–µ–º–∞?
                              ‚îÇ
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ               ‚îÇ               ‚îÇ
    –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏?    –°–µ—Ä–≤–∏—Å –ª–µ–∂–∏—Ç?    –†–µ—Å—É—Ä—Å—ã –∏—Å—á–µ—Ä–ø–∞–Ω—ã?
              ‚îÇ               ‚îÇ               ‚îÇ
              ‚ñº               ‚ñº               ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ RETRY ‚îÇ    ‚îÇCIRCUIT BREAKER‚îÇ   ‚îÇ BULKHEAD ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ               ‚îÇ                ‚îÇ
              ‚îÇ               ‚îÇ                ‚îÇ
     Retry –ø–æ–º–æ–≥–∞–µ—Ç?   –ï—Å—Ç—å fallback?    –ï—Å—Ç—å –æ—á–µ—Ä–µ–¥—å?
              ‚îÇ               ‚îÇ                ‚îÇ
        –î–∞ ‚Üí ‚úÖ        –î–∞ ‚Üí Fallback     –î–∞ ‚Üí Queue
        –ù–µ—Ç ‚Üí ‚Üì        –ù–µ—Ç ‚Üí Fail fast   –ù–µ—Ç ‚Üí Reject
              ‚îÇ
              ‚ñº
       –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –æ—à–∏–±–∫–∞?
              ‚îÇ
        –î–∞ ‚Üí CIRCUIT BREAKER
        –ù–µ—Ç ‚Üí –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å retry
```

### –®–ø–∞—Ä–≥–∞–ª–∫–∞: –ö–æ–≥–¥–∞ —á—Ç–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å

| –°–∏—Ç—É–∞—Ü–∏—è | –ü–∞—Ç—Ç–µ—Ä–Ω(—ã) |
|----------|-----------|
| –°–µ—Ç–µ–≤—ã–µ —Å–±–æ–∏, —Ç–∞–π–º–∞—É—Ç—ã | **Retry + Timeout** |
| –°–µ—Ä–≤–∏—Å —á–∞—Å—Ç–æ –ø–∞–¥–∞–µ—Ç | **Circuit Breaker + Fallback** |
| –ú–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫ –æ–¥–Ω–æ–º—É —Å–µ—Ä–≤–∏—Å—É | **Bulkhead** |
| –ù—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ, –Ω–æ –º–æ–∂–Ω–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ | **Fallback (cache)** |
| –ö—Ä–∏—Ç–∏—á–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (–ø–ª–∞—Ç—ë–∂) | **Timeout + Retry (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ)** |
| –î–ª–∏–Ω–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –≤—ã–∑–æ–≤–æ–≤ | **Timeout –Ω–∞ –∫–∞–∂–¥–æ–º + Retry —Ç–æ–ª—å–∫–æ –Ω–∞–≤–µ—Ä—Ö—É** |
| –ü–∏–∫–æ–≤—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏ | **Bulkhead + Rate Limiting** |

---

## Netflix Chaos Engineering (–ë–æ–Ω—É—Å)

Netflix –¥–æ–∫–∞–∑–∞–ª —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å resilience patterns —á–µ—Ä–µ–∑ **Chaos Engineering** ‚Äî –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–µ –≤–Ω–µ—Å–µ–Ω–∏–µ —Å–±–æ–µ–≤ –≤ production.

### Simian Army (–ê—Ä–º–∏—è –æ–±–µ–∑—å—è–Ω)

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –ó–∞—á–µ–º |
|------------|-----------|-------|
| **Chaos Monkey** | –í—ã–∫–ª—é—á–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã | –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø–µ—Ä–µ–∂–∏–≤—ë–º –ª–∏ –ø–æ—Ç–µ—Ä—é —Å–µ—Ä–≤–µ—Ä–∞? |
| **Chaos Gorilla** | –í—ã–∫–ª—é—á–∞–µ—Ç —Ü–µ–ª—ã–π AWS AZ | –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø–µ—Ä–µ–∂–∏–≤—ë–º –ª–∏ –ø–æ—Ç–µ—Ä—é –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞? |
| **Latency Monkey** | –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ | –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ä–∞–±–æ—Ç–∞—é—Ç –ª–∏ timeouts? |
| **Chaos Kong** | –í—ã–∫–ª—é—á–∞–µ—Ç —Ü–µ–ª—ã–π —Ä–µ–≥–∏–æ–Ω | –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ DR? |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 21 –∞–ø—Ä–µ–ª—è 2011 ‚Äî –±–æ–ª—å—à–æ–π —Å–±–æ–π AWS. Netflix –ø—Ä–æ–¥–æ–ª–∂–∏–ª —Ä–∞–±–æ—Ç–∞—Ç—å, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ª–µ–≥–ª–∏.

---

## –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

| –û—à–∏–±–∫–∞ | –ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ | –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ |
|--------|-------------|---------------|
| Retry –±–µ–∑ backoff | Thundering herd ‚Üí —Å–µ—Ä–≤–∏—Å –ø–∞–¥–∞–µ—Ç –µ—â—ë —Å–∏–ª—å–Ω–µ–µ | Exponential backoff + jitter |
| Retry non-idempotent | –î—É–±–ª–∏–∫–∞—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π/–∑–∞–∫–∞–∑–æ–≤ | Idempotency key –∏–ª–∏ –Ω–µ —Ä–µ—Ç—Ä–∞–∏—Ç—å |
| Timeout –±–µ–∑ fallback | –û—à–∏–±–∫–∞ –≤–º–µ—Å—Ç–æ degraded experience | –í—Å–µ–≥–¥–∞ –∏–º–µ—Ç—å fallback –¥–ª—è UX-–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π |
| –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—Å–µ—Ö | –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã | –†–∞–∑–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ |
| Retry –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö | Retry amplification (1 –∑–∞–ø—Ä–æ—Å ‚Üí 100) | Retry —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ |
| Fallback —Å–ª–æ–∂–Ω–µ–µ primary | Fallback —Ç–æ–∂–µ –ø–∞–¥–∞–µ—Ç | Fallback –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ—â–µ |
| –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å failure paths | –ü–µ—Ä–≤—ã–π —Å–±–æ–π = –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç | Chaos Engineering, integration tests |

---

## –ß–µ–∫–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä (MVP)
- [ ] Timeout –Ω–∞ –í–°–ï–• –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–∞—Ö
- [ ] Retry —Å exponential backoff –¥–ª—è transient errors
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –Ω–∞–±–æ—Ä
- [ ] Circuit Breaker –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- [ ] Bulkhead –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] Fallback –¥–ª—è UX-–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ú–µ—Ç—Ä–∏–∫–∏: latency, error rate, circuit state
- [ ] –ê–ª–µ—Ä—Ç—ã –Ω–∞ circuit open

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –Ω–∞–±–æ—Ä
- [ ] Adaptive timeout (–Ω–∞ –æ—Å–Ω–æ–≤–µ p99 latency)
- [ ] Chaos Engineering –≤ staging
- [ ] Distributed tracing
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ bulkhead utilization

---

## –°–≤—è–∑–∏

- [[architecture-overview]] ‚Äî –æ–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- [[architecture-distributed-systems]] ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
- [[architecture-rate-limiting]] ‚Äî rate limiting (–∑–∞—â–∏—Ç–∞ callee)
- [[observability]] ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
- [[caching-strategies]] ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è fallback

---

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏

| # | –ò—Å—Ç–æ—á–Ω–∏–∫ | –¢–∏–ø | Credibility | –ö–ª—é—á–µ–≤–æ–π –≤–∫–ª–∞–¥ |
|---|----------|-----|-------------|----------------|
| 1 | [Netflix Hystrix GitHub](https://github.com/Netflix/Hystrix) | Official | 0.95 | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Circuit Breaker |
| 2 | [Resilience4j Docs](https://resilience4j.readme.io/) | Official | 0.95 | –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è Java –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ |
| 3 | [AWS Builders Library: Timeouts & Retries](https://aws.amazon.com/builders-library/timeouts-retries-and-backoff-with-jitter/) | Official | 0.95 | Backoff, jitter, best practices |
| 4 | [Microsoft: Bulkhead Pattern](https://learn.microsoft.com/en-us/azure/architecture/patterns/bulkhead) | Official | 0.90 | –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ Bulkhead |
| 5 | [microservices.io: Circuit Breaker](https://microservices.io/patterns/reliability/circuit-breaker.html) | Technical Blog | 0.85 | –ü–∞—Ç—Ç–µ—Ä–Ω—ã microservices |
| 6 | [Netflix: How Netflix Embraces Failure](https://www.usenix.org/conference/lisa13/how-netflix-embraces-failure-improve-resilience-maximize-availability) | Conference | 0.90 | Chaos Engineering –∏—Å—Ç–æ—Ä–∏—è |
| 7 | [Gergely Orosz: Resiliency in Distributed Systems](https://newsletter.pragmaticengineer.com/p/resiliency-in-distributed-systems-74c) | Technical Blog | 0.85 | –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã |
| 8 | [AWS: Retry Behavior](https://docs.aws.amazon.com/sdkref/latest/guide/feature-retry-behavior.html) | Official | 0.95 | SDK retry –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| 9 | [Martin Fowler: Circuit Breaker](https://martinfowler.com/bliki/CircuitBreaker.html) | Technical Blog | 0.90 | –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ |
| 10 | [AKF Partners: Bulkhead Pattern](https://akfpartners.com/growth-blog/bulkhead-pattern) | Technical Blog | 0.80 | Dos and Don'ts |
| 11 | [InfoQ: Timeouts, Retries and Idempotency](https://www.infoq.com/presentations/distributed-systems-resiliency/) | Conference | 0.85 | –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ |
| 12 | [Netflix Case Study](https://aws.amazon.com/solutions/case-studies/netflix-case-study/) | Official | 0.90 | –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ Netflix |

---

*–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: 2026-01-09. –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫ 2024-2025.*
