---
title: "Rate Limiting: Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° API Ğ¾Ñ‚ Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ·ĞºĞ¸"
created: 2025-12-22
modified: 2026-01-02
type: deep-dive
status: published
confidence: high
sources_verified: true
tags:
  - topic/architecture
  - rate-limiting
  - api
  - throttling
  - distributed
  - redis
  - type/deep-dive
  - level/intermediate
related:
  - "[[architecture-overview]]"
  - "[[architecture-resilience-patterns]]"
  - "[[api-design]]"
  - "[[caching-strategies]]"
---

# Rate Limiting: Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° API Ğ¾Ñ‚ Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ·ĞºĞ¸

ĞŸÑ€ĞµĞ´ÑÑ‚Ğ°Ğ²ÑŒ, Ñ‡Ñ‚Ğ¾ Ñ‚Ñ‹ Ğ²Ğ»Ğ°Ğ´ĞµĞµÑˆÑŒ Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¾Ğ¹ ĞºĞ¾Ñ„ĞµĞ¹Ğ½Ñ. Ğ£Ñ‚Ñ€Ğ¾Ğ¼ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´Ğ¸Ñ‚ 10 ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ² â€” Ñ‚Ñ‹ ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑˆÑŒÑÑ. ĞĞ¾ Ğ¾Ğ´Ğ½Ğ°Ğ¶Ğ´Ñ‹ Ğ°Ğ²Ñ‚Ğ¾Ğ±ÑƒÑ Ñ Ñ‚ÑƒÑ€Ğ¸ÑÑ‚Ğ°Ğ¼Ğ¸ Ğ²Ñ‹ÑĞ°Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ 200 Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº, Ğ¸ Ğ²ÑĞµ Ñ…Ğ¾Ñ‚ÑÑ‚ ĞºĞ¾Ñ„Ğµ Ğ¡Ğ•Ğ™Ğ§ĞĞ¡. Ğ‘Ğ°Ñ€Ğ¸ÑÑ‚Ğ° Ğ½Ğµ ÑƒÑĞ¿ĞµĞ²Ğ°ĞµÑ‚, Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ Ñ€Ğ°ÑÑ‚Ñ‘Ñ‚, ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñ‹ Ğ·Ğ»ÑÑ‚ÑÑ, ĞºĞ¾Ñ„ĞµĞ¼Ğ°ÑˆĞ¸Ğ½Ğ° Ğ¿ĞµÑ€ĞµĞ³Ñ€ĞµĞ²Ğ°ĞµÑ‚ÑÑ Ğ¸ Ğ»Ğ¾Ğ¼Ğ°ĞµÑ‚ÑÑ. **Rate limiting â€” ÑÑ‚Ğ¾ Ñ‚ÑƒÑ€Ğ½Ğ¸ĞºĞµÑ‚ Ğ½Ğ° Ğ²Ñ…Ğ¾Ğ´Ğµ**, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚: "Ğ˜Ğ·Ğ²Ğ¸Ğ½Ğ¸Ñ‚Ğµ, Ğ¼Ñ‹ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¾Ğ±ÑĞ»ÑƒĞ¶Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ 20 Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ. ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ â€” Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ."

---

## ĞŸÑ€ĞµĞ¶Ğ´Ğµ Ñ‡ĞµĞ¼ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ

Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ° Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ğ¾ Ğ·Ğ½Ğ°Ñ‚ÑŒ:
- Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ¸Ñ HTTP (Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹, Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹, ÑÑ‚Ğ°Ñ‚ÑƒÑ-ĞºĞ¾Ğ´Ñ‹) â†’ [[api-design]]
- Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Redis (in-memory Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ) â†’ [[caching-strategies]]
- ĞÑĞ½Ğ¾Ğ²Ñ‹ Python Ğ¸Ğ»Ğ¸ Ğ»ÑĞ±Ğ¾Ğ³Ğ¾ ÑĞ·Ñ‹ĞºĞ° Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

---

## TL;DR (ĞµÑĞ»Ğ¸ ÑĞ¾Ğ²ÑĞµĞ¼ Ğ½ĞµÑ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸)

- **Rate limiting** â€” Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ·Ğ° Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
- **Ğ—Ğ°Ñ‡ĞµĞ¼:** Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ DDoS, ÑĞ¿Ñ€Ğ°Ğ²ĞµĞ´Ğ»Ğ¸Ğ²Ğ¾Ğµ Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ², ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚
- **Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğµ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ñ‹:** Token Bucket (Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ²ÑĞ¿Ğ»ĞµÑĞºĞ¸), Leaky Bucket (Ñ€Ğ°Ğ²Ğ½Ğ¾Ğ¼ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ‚Ğ¾Ğº)
- **Ğ’ distributed ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ñ…:** Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Redis + Lua ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ°Ñ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾ÑÑ‚Ğ¸
- **ĞÑ‚Ğ²ĞµÑ‚ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ:** HTTP 429 + Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº `Retry-After`

---

## Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ (Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°)

| Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½ | Ğ§Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ğ¼Ğ¸ ÑĞ»Ğ¾Ğ²Ğ°Ğ¼Ğ¸ | ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ Ğ¸Ğ· Ğ¶Ğ¸Ğ·Ğ½Ğ¸ |
|--------|--------------------------|-------------------|
| **Rate Limit** | ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ·Ğ° Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 100 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ) | Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ½Ğ° ÑĞ½ÑÑ‚Ğ¸Ğµ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ñ…: Ğ½Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ 50 000 â‚½ Ğ² Ğ´ĞµĞ½ÑŒ |
| **Throttling** | Ğ—Ğ°Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ñ | Ğ’Ğ¼ĞµÑÑ‚Ğ¾ "ĞĞµÑ‚ Ğ¼ĞµÑÑ‚!" â€” "ĞŸĞ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚" |
| **Quota** | Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ·Ğ° Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 10 000 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ´ĞµĞ½ÑŒ) | ĞœĞµÑÑÑ‡Ğ½Ñ‹Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ğ° Ğ² Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğµ |
| **Burst** | ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²ÑĞ¿Ğ»ĞµÑĞº Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ²Ñ‹ÑˆĞµ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ñ€Ğ¼Ñ‹ | Ğ¢Ğ¾Ğ»Ğ¿Ğ° Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ² Ğ§Ñ‘Ñ€Ğ½ÑƒÑ Ğ¿ÑÑ‚Ğ½Ğ¸Ñ†Ñƒ |
| **Token** | "Ğ–ĞµÑ‚Ğ¾Ğ½" Ğ½Ğ° Ğ¿Ñ€Ğ°Ğ²Ğ¾ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ¾Ğ´Ğ¸Ğ½ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ | Ğ¢Ğ°Ğ»Ğ¾Ğ½Ñ‡Ğ¸Ğº Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸ Ğ² Ğ±Ğ°Ğ½ĞºĞµ |
| **Bucket** | "Ğ’ĞµĞ´Ñ€Ğ¾", Ğ³Ğ´Ğµ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ | ĞšĞ¾Ğ¿Ğ¸Ğ»ĞºĞ° Ñ Ğ¼Ğ¾Ğ½ĞµÑ‚Ğ°Ğ¼Ğ¸ |
| **Window** | Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ÑÑ‡Ñ‘Ñ‚Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² | ĞŸĞµÑ€Ğ¸Ğ¾Ğ´ Ñ 10:00 Ğ´Ğ¾ 10:01 |
| **429** | HTTP ĞºĞ¾Ğ´ "Too Many Requests" (ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²) | Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ‡ĞºĞ° "Ğ˜Ğ·Ğ²Ğ¸Ğ½Ğ¸Ñ‚Ğµ, Ğ¼Ñ‹ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹" |
| **Retry-After** | Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº, Ğ³Ğ¾Ğ²Ğ¾Ñ€ÑÑ‰Ğ¸Ğ¹ "Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ñ‡ĞµÑ€ĞµĞ· X ÑĞµĞºÑƒĞ½Ğ´" | "ĞŸÑ€Ğ¸Ñ…Ğ¾Ğ´Ğ¸Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚" |

---

## Ğ—Ğ°Ñ‡ĞµĞ¼ Ğ½ÑƒĞ¶ĞµĞ½ Rate Limiting? (Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ğ±ĞµĞ· Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ)

### Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ: GitHub ÑƒĞ¿Ğ°Ğ» Ğ¸Ğ·-Ğ·Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°

Ğ’ 2018 Ğ³Ğ¾Ğ´Ñƒ GitHub ÑÑ‚Ğ¾Ğ»ĞºĞ½ÑƒĞ»ÑÑ Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ¾Ğ¹: Ğ¾Ğ´Ğ¸Ğ½ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞ» Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ, Ğ¿Ñ‹Ñ‚Ğ°ÑÑÑŒ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸. Ğ¡ĞµÑ€Ğ²ĞµÑ€Ñ‹ Ğ½Ğµ ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¸ÑÑŒ â€” GitHub Ğ±Ñ‹Ğ» Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½Ğ¾Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ² Ğ¿Ğ¾ Ğ²ÑĞµĞ¼Ñƒ Ğ¼Ğ¸Ñ€Ñƒ.

**Ğ‘ĞµĞ· rate limiting:**

```
Ğ¡Ğ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚   ĞšĞ»Ğ¸ĞµĞ½Ñ‚ A: 1 000 000 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/Ğ¼Ğ¸Ğ½    â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚   ĞšĞ»Ğ¸ĞµĞ½Ñ‚ B: 10 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/Ğ¼Ğ¸Ğ½           â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â–¶  Ğ¡Ğ•Ğ Ğ’Ğ•Ğ   â”€â”€â–¶ ğŸ’¥   â”‚
â”‚   ĞšĞ»Ğ¸ĞµĞ½Ñ‚ C: 50 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/Ğ¼Ğ¸Ğ½           â”€â”€â”€â”€â”€â”€â”˜      (ÑƒĞ¿Ğ°Ğ»)          â”‚
â”‚                                                                     â”‚
â”‚   Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: ĞšĞ»Ğ¸ĞµĞ½Ñ‚ A "ÑÑŠĞµĞ»" Ğ²ÑĞµ Ñ€ĞµÑÑƒÑ€ÑÑ‹                           â”‚
â”‚              ĞšĞ»Ğ¸ĞµĞ½Ñ‚Ñ‹ B Ğ¸ C Ğ½Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ¸ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾                      â”‚
â”‚              Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ¶ĞµĞ½ Ğ¸ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½                        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ğ¡ rate limiting:**

```
Ğ¡Ğ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚   ĞšĞ»Ğ¸ĞµĞ½Ñ‚ A: 1 000 000 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/Ğ¼Ğ¸Ğ½ â”€â”€â”                              â”‚
â”‚              â”‚                        â”‚                             â”‚
â”‚              â–¼                        â”‚                             â”‚
â”‚         [Rate Limiter]                â”‚                             â”‚
â”‚         "Ğ¡Ñ‚Ğ¾Ğ¿! Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ 100/Ğ¼Ğ¸Ğ½"         â”‚                             â”‚
â”‚              â”‚                        â”‚                             â”‚
â”‚              â–¼                        â–¼                             â”‚
â”‚         100 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/Ğ¼Ğ¸Ğ½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  Ğ¡Ğ•Ğ Ğ’Ğ•Ğ   â”€â”€â–¶ âœ…          â”‚
â”‚   ĞšĞ»Ğ¸ĞµĞ½Ñ‚ B: 10 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/Ğ¼Ğ¸Ğ½   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  (Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚)             â”‚
â”‚   ĞšĞ»Ğ¸ĞµĞ½Ñ‚ C: 50 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/Ğ¼Ğ¸Ğ½   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                         â”‚
â”‚                                                                     â”‚
â”‚   Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: Ğ’ÑĞµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ÑÑ‚ ÑĞ¿Ñ€Ğ°Ğ²ĞµĞ´Ğ»Ğ¸Ğ²ÑƒÑ Ğ´Ğ¾Ğ»Ñ                â”‚
â”‚              Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾                             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞŸÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Rate Limiting

| ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° | ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ğ±ĞµĞ· rate limiting | Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ |
|---------|---------------------------|---------|
| **1. Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ DDoS** | ĞÑ‚Ğ°ĞºÑƒÑÑ‰Ğ¸Ğ¹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ², ÑĞµÑ€Ğ²ĞµÑ€ Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ | ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ IP Ğ´Ğ¾ N Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/ÑĞµĞº |
| **2. Ğ¡Ğ¿Ñ€Ğ°Ğ²ĞµĞ´Ğ»Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒ** | ĞĞ´Ğ¸Ğ½ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ÑĞµÑ‚ 99% Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² | Ğ Ğ°Ğ²Ğ½Ñ‹Ğµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… |
| **3. ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚** | Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¸Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ (OpenAI API, Ğ±Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…) Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ Ğ±ĞµÑĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒĞ½Ğ¾ | Ğ›Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ½Ğ° Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ¸Ğµ endpoints |
| **4. Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ±Ñ€ÑƒÑ‚Ñ„Ğ¾Ñ€ÑĞ°** | Ğ’Ğ·Ğ»Ğ¾Ğ¼Ñ‰Ğ¸Ğº Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµÑ‚ 10 000 Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ | 5 Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº Ğ»Ğ¾Ğ³Ğ¸Ğ½Ğ° Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ |
| **5. Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** | Ğ’Ğ½ĞµĞ·Ğ°Ğ¿Ğ½Ñ‹Ğ¹ Ğ½Ğ°Ğ¿Ğ»Ñ‹Ğ² Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ° Ğ»Ğ¾Ğ¼Ğ°ĞµÑ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ | ĞÑ‚ĞºĞ»Ğ¾Ğ½ÑÑ‚ÑŒ Ğ¸Ğ·Ğ»Ğ¸ÑˆĞµĞº, ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑŒ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ |

### ĞšĞ¾Ğ³Ğ´Ğ° ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Rate Limiting

| Ğ¡Ğ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ | ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ½Ğµ Ğ½ÑƒĞ¶ĞµĞ½ | Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ |
|----------|-----------------|-------------------|
| Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ | Ğ”Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº, Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° | Circuit Breaker, Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ |
| Health checks | ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ğ°Ğ¶Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° | Ğ˜ÑĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ· rate limiting |
| Webhooks Ğ¾Ñ‚ Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ğ¾Ğ² | ĞĞµĞ»ÑŒĞ·Ñ Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ğ° "Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ°Ñ‚ÑŒ" | ĞÑ‡ĞµÑ€ĞµĞ´ÑŒ + Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ² Ñ„Ğ¾Ğ½Ğµ |
| Ğ¡Ñ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ | CDN ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ»ÑƒÑ‡ÑˆĞµ | Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ CDN |

---

## ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ñ‹ Rate Limiting (Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ³Ğ¾ Ğº ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾Ğ¼Ñƒ)

Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ 5 Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¾Ğ². ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ€ĞµÑˆĞ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñƒ Ğ¿Ğ¾-ÑĞ²Ğ¾ĞµĞ¼Ñƒ. Ğ Ğ°Ğ·Ğ±ĞµÑ€Ñ‘Ğ¼ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹.

### ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ 1: Fixed Window Counter (Ğ¤Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾)

**ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ:** ĞŸÑ€ĞµĞ´ÑÑ‚Ğ°Ğ²ÑŒ Ğ½Ğ¾Ñ‡Ğ½Ğ¾Ğ¹ ĞºĞ»ÑƒĞ± Ñ Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒÑ 100 Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº. ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‡Ğ°Ñ Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ½Ğ¸Ğº Ğ¾Ğ±Ğ½ÑƒĞ»ÑĞµÑ‚ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ğ¸ Ğ²Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ 100.

**ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:**

```
FIXED WINDOW COUNTER

Ğ›Ğ¸Ğ¼Ğ¸Ñ‚: 100 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ

Ğ’Ñ€ĞµĞ¼Ñ:     00:00                 01:00                 02:00
           â—„â”€â”€â”€ ĞĞºĞ½Ğ¾ 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ—„â”€â”€â”€ ĞĞºĞ½Ğ¾ 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

           Ğ¡Ñ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº: 0 â†’ 1 â†’ 2 â†’ ... â†’ 100 â†’ Ğ¡Ğ¢ĞĞŸ!
                                            â”‚
           Ğ’ 01:00 ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ğ¾Ğ±Ğ½ÑƒĞ»ÑĞµÑ‚ÑÑ: 0 â†’ 1 â†’ 2 â†’ ...

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                   â”‚
â”‚  ĞĞºĞ½Ğ¾ 00:00-01:00          â”‚  ĞĞºĞ½Ğ¾ 01:00-02:00                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ â”‚  â”‚  â”‚ Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ â”‚           â”‚
â”‚  â”‚ Ğ¡Ñ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº: 80/100     â”‚  â”‚  â”‚ Ğ¡Ñ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº: 50/100     â”‚           â”‚
â”‚  â”‚ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: ĞĞš          â”‚  â”‚  â”‚ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: ĞĞš          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° "Ğ¿Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ²ÑĞ¿Ğ»ĞµÑĞºĞ°" (Boundary Burst):**

```
ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ FIXED WINDOW â€” Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾Ñ‚ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ Ğ¾Ğ¿Ğ°ÑĞµĞ½

Ğ›Ğ¸Ğ¼Ğ¸Ñ‚: 100 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ

Ğ§Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ¾Ğ¹Ñ‚Ğ¸:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                   â”‚
â”‚  Ğ’Ñ€ĞµĞ¼Ñ:  00:00        00:59  â”‚  01:00  01:01        02:00        â”‚
â”‚          â—„â”€â”€â”€ ĞĞºĞ½Ğ¾ 1 â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ĞĞºĞ½Ğ¾ 2 â”€â”€â”€â”€â”€â”€â–º          â”‚
â”‚                              â”‚                                    â”‚
â”‚          0 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²... 99    â”‚  99 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²... 0                 â”‚
â”‚                        â†‘     â”‚  â†‘                                 â”‚
â”‚                        â”‚     â”‚  â”‚                                 â”‚
â”‚                Ğ—Ğ° 2 ÑĞµĞºÑƒĞ½Ğ´Ñ‹: 99 + 99 = 198 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²!              â”‚
â”‚                Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ 2x Ğ¾Ñ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ°!                            â”‚
â”‚                                                                   â”‚
â”‚  ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ» 99 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² 00:59                   â”‚
â”‚            Ğ¸ ĞµÑ‰Ñ‘ 99 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² 01:01                             â”‚
â”‚            ĞĞ±Ğ° Ñ€Ğ°Ğ·Ğ° Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ² Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğµ, Ğ½Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€ Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ¶ĞµĞ½     â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (Ğ¿Ñ€Ğ¾ÑÑ‚Ğ°Ñ, Ğ½Ğ¾ Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ¾Ğ¹):**

```python
# ĞĞ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ: Fixed Window â€” ÑĞ°Ğ¼Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼.
# ĞœÑ‹ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ¼ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¾ĞºĞ½Ğ°.
# ĞšĞ¾Ğ³Ğ´Ğ° Ğ¾ĞºĞ½Ğ¾ Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ â€” ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ğ¾Ğ±Ğ½ÑƒĞ»ÑĞµÑ‚ÑÑ.

import time
from typing import Tuple

class FixedWindowLimiter:
    """
    Fixed Window Rate Limiter.

    ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:
    1. Ğ Ğ°Ğ·Ğ±Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ½Ğ° Ğ¾ĞºĞ½Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ¿Ğ¾ 60 ÑĞµĞºÑƒĞ½Ğ´)
    2. Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ² Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¼ Ğ¾ĞºĞ½Ğµ
    3. Ğ•ÑĞ»Ğ¸ Ğ¿Ñ€ĞµĞ²Ñ‹ÑĞ¸Ğ»Ğ¸ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ â€” Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ÑĞµĞ¼
    4. ĞšĞ¾Ğ³Ğ´Ğ° Ğ¾ĞºĞ½Ğ¾ Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ â€” ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº = 0
    """

    def __init__(self, limit: int, window_seconds: int):
        # limit = Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 100)
        self.limit = limit

        # window_seconds = Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¾ĞºĞ½Ğ° Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ… (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 60)
        self.window_seconds = window_seconds

        # Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ: ĞºĞ»ÑÑ‡ â†’ (Ğ½Ğ¾Ğ¼ĞµÑ€_Ğ¾ĞºĞ½Ğ°, ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº)
        # ĞšĞ»ÑÑ‡ â€” ÑÑ‚Ğ¾ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° (IP, user_id Ğ¸ Ñ‚.Ğ´.)
        self.counters = {}

    def _get_window(self) -> int:
        """
        Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ½Ğ¾Ğ¼ĞµÑ€ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¾ĞºĞ½Ğ°.

        ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:
        - Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ 125 ÑĞµĞºÑƒĞ½Ğ´ Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ¿Ğ¾Ñ…Ğ¸
        - Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¾ĞºĞ½Ğ° = 60 ÑĞµĞºÑƒĞ½Ğ´
        - ĞĞ¾Ğ¼ĞµÑ€ Ğ¾ĞºĞ½Ğ° = 125 // 60 = 2
        """
        return int(time.time() // self.window_seconds)

    def is_allowed(self, key: str) -> Tuple[bool, int]:
        """
        ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ.

        Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:
        - (True, remaining) â€” Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½, Ğ¾ÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ remaining Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº
        - (False, 0) â€” Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½
        """
        current_window = self._get_window()

        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ°
        if key not in self.counters:
            # ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ â€” ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ
            self.counters[key] = (current_window, 0)

        stored_window, count = self.counters[key]

        # Ğ•ÑĞ»Ğ¸ Ğ¾ĞºĞ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¾ÑÑŒ â€” Ğ¾Ğ±Ğ½ÑƒĞ»ÑĞµĞ¼ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº
        if stored_window != current_window:
            count = 0

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
        if count >= self.limit:
            return False, 0

        # Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼
        count += 1
        self.counters[key] = (current_window, count)

        return True, self.limit - count


# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:
limiter = FixedWindowLimiter(limit=100, window_seconds=60)

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ñ IP "192.168.1.1"
allowed, remaining = limiter.is_allowed("192.168.1.1")
if allowed:
    print(f"Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½. ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº: {remaining}")
else:
    print("Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½! ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ.")
```

**ĞŸĞ»ÑÑÑ‹ Ğ¸ Ğ¼Ğ¸Ğ½ÑƒÑÑ‹:**

| âœ… ĞŸĞ»ÑÑÑ‹ | âŒ ĞœĞ¸Ğ½ÑƒÑÑ‹ |
|---------|----------|
| ĞÑ‡ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ | ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ğ¿Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ²ÑĞ¿Ğ»ĞµÑĞºĞ° (2x Ğ»Ğ¸Ğ¼Ğ¸Ñ‚!) |
| ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ (1 Ñ‡Ğ¸ÑĞ»Ğ¾ Ğ½Ğ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°) | ĞĞµÑ€Ğ°Ğ²Ğ½Ğ¾Ğ¼ĞµÑ€Ğ½Ğ¾Ğµ Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ |
| Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ | ĞĞµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ´Ğ»Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… API |

---

### ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ 2: Sliding Window Log (Ğ¡ĞºĞ¾Ğ»ÑŒĞ·ÑÑ‰ĞµĞµ Ğ¾ĞºĞ½Ğ¾ Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ¼)

**ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ:** Ğ’Ğ¼ĞµÑÑ‚Ğ¾ Ğ¿Ğ¾Ğ´ÑÑ‡Ñ‘Ñ‚Ğ° "ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº Ğ²Ğ¾ÑˆĞ»Ğ¾ Ñ 10:00 Ğ´Ğ¾ 11:00", Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ½Ğ¸Ğº Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ²Ñ€ĞµĞ¼Ñ Ğ²Ñ…Ğ¾Ğ´Ğ° ĞšĞĞ–Ğ”ĞĞ“Ğ Ğ¿Ğ¾ÑĞµÑ‚Ğ¸Ñ‚ĞµĞ»Ñ Ğ¸ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚: "Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº Ğ²Ğ¾ÑˆĞ»Ğ¾ Ğ·Ğ° ĞŸĞĞ¡Ğ›Ğ•Ğ”ĞĞ˜Ğ• 60 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¾Ñ‚ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ğ°?"

**ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:**

```
SLIDING WINDOW LOG

Ğ›Ğ¸Ğ¼Ğ¸Ñ‚: 5 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² 60 ÑĞµĞºÑƒĞ½Ğ´

Ğ¥Ñ€Ğ°Ğ½Ğ¸Ğ¼ timestamp (Ğ²Ñ€ĞµĞ¼Ñ) ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°:

Ğ›Ğ¾Ğ³ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²: [00:15, 00:23, 00:45, 00:58, 01:02, 01:15]

Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ 01:20. ĞĞºĞ½Ğ¾ = Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 60 ÑĞµĞºÑƒĞ½Ğ´ = [00:20, 01:20]

Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ² Ğ¾ĞºĞ½Ğµ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                   â”‚
â”‚  Ğ’Ñ€ĞµĞ¼Ñ:  00:00   00:15  00:23   00:45  00:58  01:02  01:15  01:20 â”‚
â”‚                   â”‚      â”‚       â”‚      â”‚      â”‚      â”‚      â”‚   â”‚
â”‚                   â–¼      â–¼       â–¼      â–¼      â–¼      â–¼      â”‚   â”‚
â”‚                   â—      â—       â—      â—      â—      â—      â”‚   â”‚
â”‚                   â”‚      â”‚       â”‚      â”‚      â”‚      â”‚      â”‚   â”‚
â”‚          â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚          Ğ’Ğ½Ğµ Ğ¾ĞºĞ½Ğ° â”‚             Ğ’Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ¾ĞºĞ½Ğ° [00:20 - 01:20]  â”‚   â”‚
â”‚                   â”‚                                          â”‚   â”‚
â”‚  00:15 â€” Ğ£Ğ”ĞĞ›Ğ˜Ğ¢Ğ¬ (Ğ²Ğ½Ğµ Ğ¾ĞºĞ½Ğ°)                                  â”‚   â”‚
â”‚  00:23, 00:45, 00:58, 01:02, 01:15 â€” Ğ¡Ğ§Ğ˜Ğ¢ĞĞ¢Ğ¬                 â”‚   â”‚
â”‚                                                               â”‚   â”‚
â”‚  Ğ˜Ñ‚Ğ¾Ğ³Ğ¾ Ğ² Ğ¾ĞºĞ½Ğµ: 5 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ². ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ = ĞĞ¢ĞšĞ›ĞĞĞ˜Ğ¢Ğ¬          â”‚   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ»ÑƒÑ‡ÑˆĞµ Fixed Window?**

```
Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ• ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ« ĞŸĞĞ“Ğ ĞĞĞ˜Ğ§ĞĞĞ“Ğ Ğ’Ğ¡ĞŸĞ›Ğ•Ğ¡ĞšĞ

Fixed Window:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ĞĞºĞ½Ğ¾ 1       â”‚   ĞĞºĞ½Ğ¾ 2       â”‚
â”‚   99 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²  â”‚   99 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²  â”‚
â”‚                â”‚                â”‚
â”‚    â”€â”€â”€â”€â”€â”€99â”€â”€â”€â”€â”¼99â”€â”€â”€â”€â”€â”€â”€       â”‚  198 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ·Ğ° 2 ÑĞµĞºÑƒĞ½Ğ´Ñ‹!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Sliding Window Log:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  â”‚
â”‚     â—„â”€â”€â”€â”€ 60 ÑĞµĞºÑƒĞ½Ğ´ â”€â”€â”€â”€â–º        â”‚
â”‚                                  â”‚
â”‚  Ğ›ÑĞ±Ğ¾Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸:           â”‚
â”‚  Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ·Ğ° ĞŸĞĞ¡Ğ›Ğ•Ğ”ĞĞ˜Ğ•    â”‚
â”‚  60 ÑĞµĞºÑƒĞ½Ğ´, Ğ½Ğµ Ğ·Ğ° "Ñ 00:00"      â”‚
â”‚                                  â”‚
â”‚  99 Ğ² 00:59 + 1 Ğ² 01:00?         â”‚
â”‚  Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼: Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 60 ÑĞµĞº    â”‚
â”‚  Ğ¾Ñ‚ 01:00 = [00:00, 01:00]       â”‚
â”‚  Ğ£Ğ¶Ğµ ĞµÑÑ‚ÑŒ 99 â†’ ĞĞ¢ĞšĞ›ĞĞĞ¯Ğ•Ğœ         â”‚
â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**

```python
# ĞĞ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ: Sliding Window Log Ñ‚Ğ¾Ñ‡Ğ½ĞµĞµ Fixed Window,
# Ğ½Ğ¾ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ timestamp ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°.
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ´Ğ»Ñ API Ñ Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¼ Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ¾Ğ¼, Ğ³Ğ´Ğµ Ğ²Ğ°Ğ¶Ğ½Ğ° Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ.

import time
from collections import defaultdict
from typing import Tuple, List

class SlidingWindowLogLimiter:
    """
    Sliding Window Log Rate Limiter.

    ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:
    1. Ğ¥Ñ€Ğ°Ğ½Ğ¸Ğ¼ timestamp ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
    2. Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ (Ğ·Ğ° Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ°Ğ¼Ğ¸ Ğ¾ĞºĞ½Ğ°)
    3. Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ¾ÑÑ‚Ğ°Ğ²ÑˆĞ¸ĞµÑÑ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
    4. Ğ•ÑĞ»Ğ¸ Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ° â€” Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼
    """

    def __init__(self, limit: int, window_seconds: int):
        self.limit = limit
        self.window_seconds = window_seconds

        # Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ: ĞºĞ»ÑÑ‡ â†’ ÑĞ¿Ğ¸ÑĞ¾Ğº timestamp'Ğ¾Ğ²
        # ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: {"user123": [1704067200.5, 1704067201.3, ...]}
        self.logs: dict[str, List[float]] = defaultdict(list)

    def is_allowed(self, key: str) -> Tuple[bool, int, float]:
        """
        ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ.

        Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:
        - (True, remaining, 0) â€” Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½
        - (False, 0, retry_after) â€” Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½Ñ‘Ğ½, Ğ¶Ğ´Ğ°Ñ‚ÑŒ retry_after ÑĞµĞºÑƒĞ½Ğ´
        """
        now = time.time()
        window_start = now - self.window_seconds

        # Ğ¨Ğ°Ğ³ 1: Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
        # ĞÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾ Ğ² Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¼ Ğ¾ĞºĞ½Ğµ
        self.logs[key] = [
            ts for ts in self.logs[key]
            if ts > window_start
        ]

        # Ğ¨Ğ°Ğ³ 2: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
        current_count = len(self.logs[key])

        if current_count >= self.limit:
            # Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½
            # Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼, ĞºĞ¾Ğ³Ğ´Ğ° Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ğ¼ĞµÑÑ‚Ğ¾
            oldest = self.logs[key][0]  # Ğ¡Ğ°Ğ¼Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
            retry_after = oldest + self.window_seconds - now
            return False, 0, max(0, retry_after)

        # Ğ¨Ğ°Ğ³ 3: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
        self.logs[key].append(now)

        remaining = self.limit - current_count - 1
        return True, remaining, 0


# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:
limiter = SlidingWindowLogLimiter(limit=5, window_seconds=60)

for i in range(7):
    allowed, remaining, retry_after = limiter.is_allowed("user123")
    if allowed:
        print(f"Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ {i+1}: ĞĞš. ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ: {remaining}")
    else:
        print(f"Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ {i+1}: ĞĞ¢ĞšĞ›ĞĞĞĞ. ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· {retry_after:.1f} ÑĞµĞº")
    time.sleep(0.1)

# Ğ’Ñ‹Ğ²Ğ¾Ğ´:
# Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ 1: ĞĞš. ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ: 4
# Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ 2: ĞĞš. ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ: 3
# Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ 3: ĞĞš. ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ: 2
# Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ 4: ĞĞš. ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ: 1
# Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ 5: ĞĞš. ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ: 0
# Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ 6: ĞĞ¢ĞšĞ›ĞĞĞĞ. ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· 59.5 ÑĞµĞº
# Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ 7: ĞĞ¢ĞšĞ›ĞĞĞĞ. ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· 59.4 ÑĞµĞº
```

**ĞŸĞ»ÑÑÑ‹ Ğ¸ Ğ¼Ğ¸Ğ½ÑƒÑÑ‹:**

| âœ… ĞŸĞ»ÑÑÑ‹ | âŒ ĞœĞ¸Ğ½ÑƒÑÑ‹ |
|---------|----------|
| ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ | ĞŸĞ°Ğ¼ÑÑ‚ÑŒ Ñ€Ğ°ÑÑ‚Ñ‘Ñ‚ Ñ Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ¾Ğ¼ |
| ĞĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ğ¿Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ²ÑĞ¿Ğ»ĞµÑĞºĞ° | ĞŸÑ€Ğ¸ 1M Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² = 1M timestamp'Ğ¾Ğ² |
| Ğ¢Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Retry-After | ĞœĞµĞ´Ğ»ĞµĞ½Ğ½ĞµĞµ Ğ¿Ñ€Ğ¸ Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğ¹ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ |

---

### ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ 3: Sliding Window Counter (Ğ“Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ñ‹Ğ¹)

**ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ:** ĞšĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼Ğ¸ÑÑ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¸ Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒÑ. Ğ’Ğ¼ĞµÑÑ‚Ğ¾ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ timestamp, Ğ¼Ñ‹ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ 2 ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ° (Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ğ¸ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞµ Ğ¾ĞºĞ½Ğ¾) Ğ¸ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ±Ğ»Ğ¸Ğ·Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ.

**Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ° (Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ¿Ğ¾ ÑˆĞ°Ğ³Ğ°Ğ¼):**

```
SLIDING WINDOW COUNTER â€” Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°

Ğ’Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ:
- previous_count = Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ² Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¼ Ğ¾ĞºĞ½Ğµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 80)
- current_count = Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ² Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¼ Ğ¾ĞºĞ½Ğµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 40)
- time_in_window = ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ % Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¾ĞºĞ½Ğ° Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 70%)

Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                   â”‚
â”‚   estimated_count = previous_count Ã— (1 - time_in_window)        â”‚
â”‚                   + current_count                                 â”‚
â”‚                                                                   â”‚
â”‚   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:                                                         â”‚
â”‚   estimated = 80 Ã— (1 - 0.70) + 40                               â”‚
â”‚             = 80 Ã— 0.30 + 40                                      â”‚
â”‚             = 24 + 40                                             â”‚
â”‚             = 64 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°                                          â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                   â”‚
â”‚   ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞµ Ğ¾ĞºĞ½Ğ¾          Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ Ğ¾ĞºĞ½Ğ¾                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ 80 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²       â”‚    â”‚ 40 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²       â”‚                 â”‚
â”‚   â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚    â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                            â–²                 â–²                    â”‚
â”‚                            â”‚     70%        â”‚                    â”‚
â”‚                            â”‚   Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾       â”‚                    â”‚
â”‚                            â”‚                â”‚                    â”‚
â”‚   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
â”‚   â”‚  30% Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾       â”‚ 70% Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾   â”‚                    â”‚
â”‚   â”‚  ĞµÑ‰Ñ‘ "Ğ² Ğ¾ĞºĞ½Ğµ"          â”‚ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾         â”‚                    â”‚
â”‚   â”‚                        â”‚                â”‚                    â”‚
â”‚   â”‚  80 Ã— 0.30 = 24        â”‚ 40             â”‚                    â”‚
â”‚   â”‚                        â”‚                â”‚                    â”‚
â”‚   â”‚  Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 24 + 40 = 64 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°                                 â”‚
â”‚   â”‚                                                               â”‚
â”‚   Ğ¡ĞºĞ¾Ğ»ÑŒĞ·ÑÑ‰ĞµĞµ Ğ¾ĞºĞ½Ğ¾ = [30% Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾] + [Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ]                â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**

```python
# ĞĞ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ: Sliding Window Counter â€” Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼Ğ¸ÑÑ.
# Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ Ğ±Ğ»Ğ¸Ğ·ĞºĞ° Ğº Log, Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ ĞºĞ°Ğº Ñƒ Fixed Window.
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ² Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ½ÑÑ‚Ğ²Ğµ production-ÑĞ¸ÑÑ‚ĞµĞ¼.

import time
from typing import Tuple

class SlidingWindowCounterLimiter:
    """
    Sliding Window Counter Rate Limiter.

    ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:
    1. Ğ¥Ñ€Ğ°Ğ½Ğ¸Ğ¼ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¸ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾ Ğ¾ĞºĞ½Ğ°
    2. Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ²Ğ·Ğ²ĞµÑˆĞµĞ½Ğ½ÑƒÑ ÑÑƒĞ¼Ğ¼Ñƒ
    3. Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ¼
    """

    def __init__(self, limit: int, window_seconds: int):
        self.limit = limit
        self.window_seconds = window_seconds

        # Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ° Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ¼:
        # {key: (prev_window, prev_count, curr_window, curr_count)}
        self.data: dict[str, tuple] = {}

    def _get_window(self) -> int:
        """ĞĞ¾Ğ¼ĞµÑ€ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¾ĞºĞ½Ğ°."""
        return int(time.time() // self.window_seconds)

    def _get_window_position(self) -> float:
        """
        ĞšĞ°ĞºĞ°Ñ Ñ‡Ğ°ÑÑ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¾ĞºĞ½Ğ° Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ° (Ğ¾Ñ‚ 0.0 Ğ´Ğ¾ 1.0).

        ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:
        - ĞĞºĞ½Ğ¾ = 60 ÑĞµĞºÑƒĞ½Ğ´
        - Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ 00:45 (45 ÑĞµĞºÑƒĞ½Ğ´ Ğ² Ğ¾ĞºĞ½Ğµ)
        - ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ñ = 45 / 60 = 0.75 (75% Ğ¾ĞºĞ½Ğ° Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾)
        """
        current_time = time.time()
        window_start = (current_time // self.window_seconds) * self.window_seconds
        elapsed = current_time - window_start
        return elapsed / self.window_seconds

    def is_allowed(self, key: str) -> Tuple[bool, int]:
        """
        ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ.
        """
        current_window = self._get_window()
        window_position = self._get_window_position()

        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ»Ğ¸ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
        if key not in self.data:
            self.data[key] = (current_window - 1, 0, current_window, 0)

        prev_window, prev_count, curr_window, curr_count = self.data[key]

        # Ğ¡Ğ´Ğ²Ğ¸Ğ³Ğ°ĞµĞ¼ Ğ¾ĞºĞ½Ğ° ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
        if curr_window != current_window:
            if curr_window == current_window - 1:
                # ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞµ Ğ¾ĞºĞ½Ğ¾ ÑÑ‚Ğ°Ğ»Ğ¾ current
                prev_window = curr_window
                prev_count = curr_count
            else:
                # ĞŸÑ€Ğ¾ÑˆĞ»Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¾ĞºĞ½Ğ° â€” Ğ¾Ğ±Ğ½ÑƒĞ»ÑĞµĞ¼ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞµ
                prev_window = current_window - 1
                prev_count = 0
            curr_window = current_window
            curr_count = 0

        # Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ²Ğ·Ğ²ĞµÑˆĞµĞ½Ğ½ÑƒÑ ÑÑƒĞ¼Ğ¼Ñƒ
        # (1 - window_position) â€” ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾ Ğ¾ĞºĞ½Ğ° ĞµÑ‰Ñ‘ "Ğ² Ğ·Ğ¾Ğ½Ğµ"
        prev_weight = 1 - window_position
        estimated = (prev_count * prev_weight) + curr_count

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
        if estimated >= self.limit:
            return False, 0

        # Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¾ĞºĞ½Ğ°
        curr_count += 1
        self.data[key] = (prev_window, prev_count, curr_window, curr_count)

        remaining = int(self.limit - estimated - 1)
        return True, max(0, remaining)


# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:
limiter = SlidingWindowCounterLimiter(limit=100, window_seconds=60)
allowed, remaining = limiter.is_allowed("user123")
print(f"Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¾: {allowed}, Ğ¾ÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ: {remaining}")
```

**Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ‚Ñ€Ñ‘Ñ… Ğ¾ĞºĞ¾Ğ½Ğ½Ñ‹Ñ… Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¾Ğ²:**

| ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ | ĞŸĞ°Ğ¼ÑÑ‚ÑŒ | Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ | Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ | Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ |
|----------|--------|----------|----------|--------------|
| Fixed Window | O(1) | ĞĞ¸Ğ·ĞºĞ°Ñ | ĞÑ‡ĞµĞ½ÑŒ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ | Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ½ĞµĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… API |
| Sliding Log | O(n) | Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ | ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ | ĞœĞ°Ğ»Ñ‹Ğ¹ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº, Ğ½ÑƒĞ¶Ğ½Ğ° Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ |
| Sliding Counter | O(1) | Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ | Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾ | **Ğ›ÑƒÑ‡ÑˆĞ¸Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ½ÑÑ‚Ğ²Ğ°** |

---

### ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ 4: Token Bucket (Ğ’ĞµĞ´Ñ€Ğ¾ Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ°Ğ¼Ğ¸)

**ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ Ğ´Ğ»Ñ 5-Ğ»ĞµÑ‚Ğ½ĞµĞ³Ğ¾:**

ĞŸÑ€ĞµĞ´ÑÑ‚Ğ°Ğ²ÑŒ, Ñ‡Ñ‚Ğ¾ Ñƒ Ñ‚ĞµĞ±Ñ ĞµÑÑ‚ÑŒ ĞºĞ¾Ğ¿Ğ¸Ğ»ĞºĞ° Ñ Ğ¼Ğ¾Ğ½ĞµÑ‚ĞºĞ°Ğ¼Ğ¸. ĞšĞ°Ğ¶Ğ´ÑƒÑ ÑĞµĞºÑƒĞ½Ğ´Ñƒ Ğ¼Ğ°Ğ¼Ğ° ĞºĞ»Ğ°Ğ´Ñ‘Ñ‚ Ğ² Ğ½ĞµÑ‘ 1 Ğ¼Ğ¾Ğ½ĞµÑ‚ĞºÑƒ (Ğ½Ğ¾ Ğ½Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ 10 â€” ĞºĞ¾Ğ¿Ğ¸Ğ»ĞºĞ° Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ°Ñ). ĞšĞ¾Ğ³Ğ´Ğ° Ñ…Ğ¾Ñ‡ĞµÑˆÑŒ ĞºÑƒĞ¿Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„ĞµÑ‚Ñƒ, Ğ½ÑƒĞ¶Ğ½Ğ° 1 Ğ¼Ğ¾Ğ½ĞµÑ‚ĞºĞ°. Ğ•ÑĞ»Ğ¸ Ğ¼Ğ¾Ğ½ĞµÑ‚ĞºĞ¸ ĞµÑÑ‚ÑŒ â€” Ğ±ĞµÑ€Ñ‘ÑˆÑŒ Ğ¸ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°ĞµÑˆÑŒ. Ğ•ÑĞ»Ğ¸ ĞºĞ¾Ğ¿Ğ¸Ğ»ĞºĞ° Ğ¿ÑƒÑÑ‚Ğ°Ñ â€” Ğ¶Ğ´Ğ¸, Ğ¿Ğ¾ĞºĞ° Ğ¼Ğ°Ğ¼Ğ° Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ ĞµÑ‰Ñ‘.

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Token Bucket Ğ»ÑƒÑ‡ÑˆĞµ Ğ¾ĞºĞ¾Ğ½Ğ½Ñ‹Ñ… Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¼Ğ½Ğ¾Ğ³Ğ¸Ñ… ÑĞ»ÑƒÑ‡Ğ°ĞµĞ²:**

```
ĞŸĞ Ğ•Ğ˜ĞœĞ£Ğ©Ğ•Ğ¡Ğ¢Ğ’Ğ TOKEN BUCKET: Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ°ĞµÑ‚ Ğ²ÑĞ¿Ğ»ĞµÑĞºĞ¸

Ğ¡Ğ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ: Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ 10 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ

ĞĞºĞ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¡ĞµĞºÑƒĞ½Ğ´Ğ° 1: 10 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² âœ…                                       â”‚
â”‚  Ğ¡ĞµĞºÑƒĞ½Ğ´Ğ° 2: 0 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞ¿Ğ°Ğ»)                            â”‚
â”‚  Ğ¡ĞµĞºÑƒĞ½Ğ´Ğ° 3: 15 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² â†’ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ 10 âœ…, 5 âŒ                     â”‚
â”‚                                                                  â”‚
â”‚  ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: ĞºĞ»Ğ¸ĞµĞ½Ñ‚ "Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ»" 10 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ·Ğ° ÑĞµĞºÑƒĞ½Ğ´Ñƒ 2            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Token Bucket (rate=10/ÑĞµĞº, capacity=20):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¡ĞµĞºÑƒĞ½Ğ´Ğ° 1: 10 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² âœ… (Ğ±Ñ‹Ğ»Ğ¾ 10 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ², ÑÑ‚Ğ°Ğ»Ğ¾ 0)           â”‚
â”‚  Ğ¡ĞµĞºÑƒĞ½Ğ´Ğ° 2: 0 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ Ğ½Ğ°ĞºĞ°Ğ¿Ğ»Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ: 0 â†’ 10)           â”‚
â”‚  Ğ¡ĞµĞºÑƒĞ½Ğ´Ğ° 3: 15 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² âœ… (Ğ±Ñ‹Ğ»Ğ¾ 10+10=20, ÑÑ‚Ğ°Ğ»Ğ¾ 5)             â”‚
â”‚                                                                  â”‚
â”‚  Ğ‘Ğ¾Ğ½ÑƒÑ: Ğ½Ğ°ĞºĞ¾Ğ¿Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑÑÑ‚ "Ğ²ÑĞ¿Ğ»ĞµÑĞº"                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Token Bucket:**

```
TOKEN BUCKET â€” ĞºĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:
- rate = 10 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²/ÑĞµĞºÑƒĞ½Ğ´Ñƒ (ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ)
- capacity = 20 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ² Ğ²ĞµĞ´Ñ€Ğµ)

ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ: Ğ²ĞµĞ´Ñ€Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ (20 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚            â”‚   Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² â”‚                                  â”‚
â”‚            â”‚   (rate: 10/ÑĞµĞº)    â”‚                                  â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                       â”‚                                             â”‚
â”‚                       â”‚ +10 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² ĞºĞ°Ğ¶Ğ´ÑƒÑ ÑĞµĞºÑƒĞ½Ğ´Ñƒ                  â”‚
â”‚                       â”‚ (Ğ½Ğ¾ Ğ½Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ capacity)                     â”‚
â”‚                       â–¼                                             â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚            â”‚      Ğ’Ğ•Ğ”Ğ Ğ          â”‚                                  â”‚
â”‚            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â† capacity = 20 (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼)       â”‚
â”‚            â”‚   â”‚ â— â— â— â— â— â”‚     â”‚                                  â”‚
â”‚            â”‚   â”‚ â— â— â— â— â— â”‚     â”‚                                  â”‚
â”‚            â”‚   â”‚ â— â— â— â—   â”‚     â”‚ â† Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ = 14            â”‚
â”‚            â”‚   â”‚           â”‚     â”‚                                  â”‚
â”‚            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                  â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                       â”‚                                             â”‚
â”‚     Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Ğ‘ĞµÑ€Ñ‘Ğ¼ 1 Ñ‚Ğ¾ĞºĞµĞ½                              â”‚
â”‚                       â”‚                                             â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚            â”‚                     â”‚                                  â”‚
â”‚      Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ >= 1?          Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ == 0?                             â”‚
â”‚            â”‚                     â”‚                                  â”‚
â”‚            â–¼                     â–¼                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚     â”‚ Ğ ĞĞ—Ğ Ğ•Ğ¨Ğ˜Ğ¢Ğ¬â”‚          â”‚ ĞĞ¢ĞšĞ›ĞĞĞ˜Ğ¢Ğ¬â”‚                              â”‚
â”‚     â”‚ (Ñ‚Ğ¾ĞºĞµĞ½--)â”‚          â”‚  (429)   â”‚                              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞœĞ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñ‹ Token Bucket:**

```
Ğ¤ĞĞ ĞœĞ£Ğ›Ğ« TOKEN BUCKET

1. ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                                 â”‚
   â”‚   new_tokens = old_tokens + (elapsed_time Ã— rate)              â”‚
   â”‚   tokens = min(new_tokens, capacity)                           â”‚
   â”‚                                                                 â”‚
   â”‚   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:                                                       â”‚
   â”‚   - old_tokens = 5                                              â”‚
   â”‚   - elapsed_time = 2 ÑĞµĞºÑƒĞ½Ğ´Ñ‹                                    â”‚
   â”‚   - rate = 10 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²/ÑĞµĞº                                       â”‚
   â”‚   - capacity = 20                                               â”‚
   â”‚                                                                 â”‚
   â”‚   new_tokens = 5 + (2 Ã— 10) = 25                                â”‚
   â”‚   tokens = min(25, 20) = 20  â† Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¾ Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒÑ         â”‚
   â”‚                                                                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ (ĞµÑĞ»Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ½Ğµ Ñ…Ğ²Ğ°Ñ‚Ğ°ĞµÑ‚):
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                                 â”‚
   â”‚   tokens_needed = requested - current_tokens                   â”‚
   â”‚   wait_time = tokens_needed / rate                             â”‚
   â”‚                                                                 â”‚
   â”‚   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:                                                       â”‚
   â”‚   - Ğ¥Ğ¾Ñ‚Ğ¸Ğ¼ 5 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ², ĞµÑÑ‚ÑŒ 2                                    â”‚
   â”‚   - rate = 10 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²/ÑĞµĞº                                       â”‚
   â”‚                                                                 â”‚
   â”‚   tokens_needed = 5 - 2 = 3                                     â”‚
   â”‚   wait_time = 3 / 10 = 0.3 ÑĞµĞºÑƒĞ½Ğ´Ñ‹                             â”‚
   â”‚                                                                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ²ÑĞ¿Ğ»ĞµÑĞºĞ°:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                                 â”‚
   â”‚   max_burst_rate = capacity / 1 ÑĞµĞºÑƒĞ½Ğ´Ñƒ                        â”‚
   â”‚                                                                 â”‚
   â”‚   Ğ•ÑĞ»Ğ¸ capacity = 20 Ğ¸ rate = 10:                              â”‚
   â”‚   - ĞœĞ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²ÑĞ¿Ğ»ĞµÑĞº: Ğ´Ğ¾ 20 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²                         â”‚
   â”‚   - Ğ£ÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ°Ñ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ: 10 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/ÑĞµĞº                       â”‚
   â”‚                                                                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¼Ğ¸ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ÑĞ¼Ğ¸:**

```python
# Token Bucket â€” ÑĞ°Ğ¼Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¿ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğ¹ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼.
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ²: Amazon AWS, Stripe, GitHub, Google Cloud.
# ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ²ÑĞ¿Ğ»ĞµÑĞºĞ¸, Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ¾Ğ¼ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°Ñ ÑÑ€ĞµĞ´Ğ½ÑÑ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ.

import time
from dataclasses import dataclass
from typing import Tuple

@dataclass
class TokenBucket:
    """
    Token Bucket Rate Limiter.

    ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:
    - rate: ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ (ÑÑ€ĞµĞ´Ğ½ÑÑ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ)
    - capacity: Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ² Ğ²ĞµĞ´Ñ€Ğµ (Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ²ÑĞ¿Ğ»ĞµÑĞºĞ°)

    ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: rate=10, capacity=20
    - Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ: 10 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/ÑĞµĞº
    - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ÑĞ¿Ğ»ĞµÑĞº: 20 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾
    """
    rate: float          # Ğ¢Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ
    capacity: float      # ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
    tokens: float = None # Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
    last_update: float = None  # Ğ’Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ

    def __post_init__(self):
        # ĞŸÑ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ğ²ĞµĞ´Ñ€Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ
        if self.tokens is None:
            self.tokens = self.capacity
        if self.last_update is None:
            self.last_update = time.time()

    def _refill(self):
        """
        ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ¿Ñ€Ğ¾ÑˆĞµĞ´ÑˆĞµĞ³Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸.

        Ğ­Ñ‚Ğ¾ "Ğ»ĞµĞ½Ğ¸Ğ²Ğ¾Ğµ" Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ:
        - ĞĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ‚Ğ°Ğ¹Ğ¼ĞµÑ€
        - Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼, ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ½Ğ°ĞºĞ¾Ğ¿Ğ¸Ğ»Ğ¾ÑÑŒ Ñ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ°
        """
        now = time.time()

        # Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑĞµĞºÑƒĞ½Ğ´ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾ Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
        elapsed = now - self.last_update

        # Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ½Ğ°ĞºĞ¾Ğ¿Ğ¸Ğ»Ğ¾ÑÑŒ
        # Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°: Ğ½Ğ¾Ğ²Ñ‹Ğµ_Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ = Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾_ÑĞµĞºÑƒĞ½Ğ´ Ã— ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ_Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
        new_tokens = elapsed * self.rate

        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹, Ğ½Ğ¾ Ğ½Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
        self.tokens = min(self.capacity, self.tokens + new_tokens)

        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ
        self.last_update = now

    def consume(self, tokens: int = 1) -> Tuple[bool, float]:
        """
        ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ "Ğ¿Ğ¾Ñ‚Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ" Ñ‚Ğ¾ĞºĞµĞ½Ñ‹.

        ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:
        - tokens: ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ½ÑƒĞ¶Ğ½Ğ¾ (Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ 1)

        Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:
        - (True, 0) â€” Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½
        - (False, wait_time) â€” Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½Ñ‘Ğ½, Ğ¶Ğ´Ğ°Ñ‚ÑŒ wait_time ÑĞµĞºÑƒĞ½Ğ´
        """
        # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼
        self._refill()

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ…Ğ²Ğ°Ñ‚Ğ°ĞµÑ‚ Ğ»Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
        if self.tokens >= tokens:
            # Ğ¢Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ñ…Ğ²Ğ°Ñ‚Ğ°ĞµÑ‚ â€” Ñ‚Ñ€Ğ°Ñ‚Ğ¸Ğ¼ Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ°ĞµĞ¼
            self.tokens -= tokens
            return True, 0

        # Ğ¢Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ½Ğµ Ñ…Ğ²Ğ°Ñ‚Ğ°ĞµÑ‚ â€” Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ
        tokens_needed = tokens - self.tokens
        wait_time = tokens_needed / self.rate

        return False, wait_time

    def get_state(self) -> dict:
        """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸/Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°."""
        self._refill()
        return {
            "tokens": round(self.tokens, 2),
            "capacity": self.capacity,
            "rate": self.rate,
            "fill_percentage": round(self.tokens / self.capacity * 100, 1)
        }


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ĞŸĞ Ğ˜ĞœĞ•Ğ  Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞĞ˜Ğ¯
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ĞµÑ€:
# - 10 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ (ÑÑ€ĞµĞ´Ğ½ÑÑ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ)
# - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ÑĞ¿Ğ»ĞµÑĞº: 20 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
limiter = TokenBucket(rate=10, capacity=20)

# Ğ¡Ğ¸Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞµĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
print("=== Token Bucket Demo ===\n")

# Ğ¢ĞµÑÑ‚ 1: Ğ’ÑĞ¿Ğ»ĞµÑĞº Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
print("Ğ¢ĞµÑÑ‚ 1: 25 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¿Ğ¾Ğ´Ñ€ÑĞ´")
for i in range(25):
    allowed, wait_time = limiter.consume()
    status = "âœ…" if allowed else f"âŒ (Ğ¶Ğ´Ğ°Ñ‚ÑŒ {wait_time:.2f}Ñ)"
    print(f"  Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ {i+1:2d}: {status}")

print(f"\nĞ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ: {limiter.get_state()}")

# Ğ–Ğ´Ñ‘Ğ¼ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
print("\nĞ–Ğ´Ñ‘Ğ¼ 1 ÑĞµĞºÑƒĞ½Ğ´Ñƒ...")
time.sleep(1)

print(f"Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ: {limiter.get_state()}")

# Ğ¢ĞµÑÑ‚ 2: Ğ•Ñ‰Ñ‘ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ
print("\nĞ¢ĞµÑÑ‚ 2: 5 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ")
for i in range(5):
    allowed, wait_time = limiter.consume()
    status = "âœ…" if allowed else f"âŒ (Ğ¶Ğ´Ğ°Ñ‚ÑŒ {wait_time:.2f}Ñ)"
    print(f"  Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ {i+1}: {status}")
```

---

### ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ 5: Leaky Bucket (Ğ”Ñ‹Ñ€ÑĞ²Ğ¾Ğµ Ğ²ĞµĞ´Ñ€Ğ¾)

**ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ:** ĞŸÑ€ĞµĞ´ÑÑ‚Ğ°Ğ²ÑŒ Ğ²ĞµĞ´Ñ€Ğ¾ Ñ Ğ´Ñ‹Ñ€ĞºĞ¾Ğ¹ Ğ²Ğ½Ğ¸Ğ·Ñƒ. Ğ’Ğ¾Ğ´Ğ° (Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹) Ğ½Ğ°Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ ÑĞ²ĞµÑ€Ñ…Ñƒ Ñ Ñ€Ğ°Ğ·Ğ½Ğ¾Ğ¹ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒÑ, Ğ½Ğ¾ Ğ²Ñ‹Ñ‚ĞµĞºĞ°ĞµÑ‚ (Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ) Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ğ¾ â€” Ğ¿Ğ¾ ĞºĞ°Ğ¿Ğ»Ğµ Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ.

**Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¾Ñ‚ Token Bucket:**

```
TOKEN BUCKET vs LEAKY BUCKET

Token Bucket:                    Leaky Bucket:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚          â”‚                     â”‚
â”‚  Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹: â—â—â—â—â—â—â—â—  â”‚          â”‚  Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹: â—â—â—â—â—â—â—â—  â”‚
â”‚           â†“â†“â†“â†“â†“â†“â†“â†“  â”‚          â”‚           â†“â†“â†“â†“â†“â†“â†“â†“  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚          â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ Ğ¢Ğ¾ĞºĞµĞ½Ñ‹    â”‚    â”‚          â”‚    â”‚ ĞÑ‡ĞµÑ€ĞµĞ´ÑŒ   â”‚    â”‚
â”‚    â”‚ â— â— â— â—   â”‚    â”‚          â”‚    â”‚ â†’ â†’ â†’ â†’ â†’ â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚          â”‚    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚
â”‚          â”‚          â”‚          â”‚          â”‚          â”‚
â”‚          â–¼          â”‚          â”‚          â–¼          â”‚
â”‚   ĞŸĞ•Ğ Ğ•ĞœĞ•ĞĞĞĞ¯        â”‚          â”‚   ĞŸĞĞ¡Ğ¢ĞĞ¯ĞĞĞĞ¯        â”‚
â”‚   ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ°   â”‚          â”‚   ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ°   â”‚
â”‚   (Ğ´Ğ¾ capacity/ÑĞµĞº) â”‚          â”‚   (Ğ²ÑĞµĞ³Ğ´Ğ° rate/ÑĞµĞº) â”‚
â”‚                     â”‚          â”‚                     â”‚
â”‚   ĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ´Ğ»Ñ:     â”‚          â”‚   ĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ´Ğ»Ñ:     â”‚
â”‚   â€¢ API ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²    â”‚          â”‚   â€¢ Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² Ğ‘Ğ”     â”‚
â”‚   â€¢ Burst-Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº    â”‚          â”‚   â€¢ Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ API     â”‚
â”‚   â€¢ User-facing     â”‚          â”‚   â€¢ Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ    â”‚
â”‚                     â”‚          â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Leaky Bucket:**

| Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ | ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Leaky Bucket |
|----------|---------------------|
| Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… | Ğ‘Ğ” Ğ½Ğµ Ğ»ÑĞ±Ğ¸Ñ‚ Ğ²ÑĞ¿Ğ»ĞµÑĞºĞ¾Ğ², Ğ½ÑƒĞ¶Ğ½Ğ° Ñ€Ğ°Ğ²Ğ½Ğ¾Ğ¼ĞµÑ€Ğ½Ğ°Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° |
| Ğ’Ñ‹Ğ·Ğ¾Ğ² Ğ²Ğ½ĞµÑˆĞ½ĞµĞ³Ğ¾ API ÑĞ¾ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ğ¼ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ¼ | Stripe API: Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ 100 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/ÑĞµĞº, Ğ½Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ |
| ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° email/SMS | ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ |
| Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ | Ğ Ğ°Ğ²Ğ½Ğ¾Ğ¼ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ‚Ğ¾Ğº Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ğ»Ğ¾Ğ³Ğ¾Ğ² |

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒÑ:**

```python
# Leaky Bucket â€” ĞºĞ¾Ğ³Ğ´Ğ° Ğ½ÑƒĞ¶Ğ½Ğ° Ğ ĞĞ’ĞĞĞœĞ•Ğ ĞĞĞ¯ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°.
# Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ ÑÑ‚Ğ°Ğ²ÑÑ‚ÑÑ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ñ Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾Ğ¹ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒÑ.

import asyncio
from collections import deque
from dataclasses import dataclass, field
from typing import Any, Callable, Awaitable

@dataclass
class LeakyBucket:
    """
    Leaky Bucket Rate Limiter Ñ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒÑ.

    ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:
    - rate: ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ
    - capacity: Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸

    ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿:
    1. Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ
    2. ĞÑ‡ĞµÑ€ĞµĞ´ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ñ Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾Ğ¹ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒÑ
    3. Ğ•ÑĞ»Ğ¸ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ â€” Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ÑĞµĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
    """
    rate: float                          # Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ
    capacity: int                        # Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸
    queue: deque = field(default_factory=deque)
    processing: bool = False

    # Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ÑÑ)
    handler: Callable[[Any], Awaitable[None]] = None

    async def add(self, item: Any) -> bool:
        """
        Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ.

        Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:
        - True â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ
        - False â€” Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ, Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½Ñ‘Ğ½
        """
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ğ¼ĞµÑÑ‚Ğ¾ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸
        if len(self.queue) >= self.capacity:
            return False

        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ
        self.queue.append(item)

        # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ, ĞµÑĞ»Ğ¸ ĞµÑ‰Ñ‘ Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ°
        if not self.processing:
            asyncio.create_task(self._process())

        return True

    async def _process(self):
        """
        ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ Ñ Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾Ğ¹ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒÑ.

        Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°Ğ¼Ğ¸ = 1 / rate
        ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, rate=10 â†’ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» = 0.1 ÑĞµĞº
        """
        self.processing = True

        # Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°Ğ¼Ğ¸
        interval = 1.0 / self.rate

        while self.queue:
            # Ğ‘ĞµÑ€Ñ‘Ğ¼ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ¸Ğ· Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸
            item = self.queue.popleft()

            # ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼
            if self.handler:
                await self.handler(item)

            # Ğ–Ğ´Ñ‘Ğ¼ Ğ¿ĞµÑ€ĞµĞ´ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¾Ğ¹
            await asyncio.sleep(interval)

        self.processing = False


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ĞŸĞ ĞĞšĞ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ ĞŸĞ Ğ˜ĞœĞ•Ğ : ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async def send_notification(message: str):
    """Ğ˜Ğ¼Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ."""
    print(f"ğŸ“¤ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾: {message}")

async def demo():
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Leaky Bucket:
    # - Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ: 2 ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ
    # - ĞÑ‡ĞµÑ€ĞµĞ´ÑŒ: Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 10 ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
    bucket = LeakyBucket(rate=2, capacity=10)
    bucket.handler = send_notification

    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ 5 ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾
    messages = [
        "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚!",
        "Ğ’Ğ°Ñˆ Ğ·Ğ°ĞºĞ°Ğ· Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚",
        "Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°",
        "Ğ¡ĞºĞ¸Ğ´ĞºĞ° 20%",
        "ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€"
    ]

    print("=== Leaky Bucket Demo ===\n")
    print("Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ 5 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ...")

    for msg in messages:
        added = await bucket.add(msg)
        if added:
            print(f"âœ… Ğ’ Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸: {msg}")
        else:
            print(f"âŒ ĞÑ‡ĞµÑ€ĞµĞ´ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ: {msg}")

    print(f"\nĞÑ‡ĞµÑ€ĞµĞ´ÑŒ: {len(bucket.queue)} ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹")
    print("ĞĞ°Ñ‡Ğ¸Ğ½Ğ°ĞµĞ¼ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ (2 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ/ÑĞµĞº)...\n")

    # Ğ–Ğ´Ñ‘Ğ¼, Ğ¿Ğ¾ĞºĞ° Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ Ğ¾Ğ¿ÑƒÑÑ‚ĞµĞµÑ‚
    while bucket.queue or bucket.processing:
        await asyncio.sleep(0.1)

    print("\nâœ… Ğ’ÑĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ñ‹!")

# Ğ—Ğ°Ğ¿ÑƒÑĞº: asyncio.run(demo())
```

---

## Distributed Rate Limiting (Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°)

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²

Ğ’ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¼Ğ¸Ñ€Ğµ Ñƒ Ñ‚ĞµĞ±Ñ Ğ½Ğµ Ğ¾Ğ´Ğ¸Ğ½ ÑĞµÑ€Ğ²ĞµÑ€, Ğ° Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ (Ğ´Ğ»Ñ Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸). ĞšĞ°Ğº ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ½Ğ¸Ğ¼Ğ¸?

```
ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ Ğ ĞĞ¡ĞŸĞ Ğ•Ğ”Ğ•Ğ›ĞĞĞĞĞ“Ğ RATE LIMITING

Ğ›Ğ¸Ğ¼Ğ¸Ñ‚: 100 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

Ğ‘ĞµĞ· ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚   ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ 300 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²                              â”‚
â”‚             â”‚                                                       â”‚
â”‚             â–¼                                                       â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚      â”‚ Load Balancerâ”‚                                               â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚             â”‚                                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚    â”‚        â”‚        â”‚                                              â”‚
â”‚    â–¼        â–¼        â–¼                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚ â”‚App 1 â”‚ â”‚App 2 â”‚ â”‚App 3 â”‚                                          â”‚
â”‚ â”‚      â”‚ â”‚      â”‚ â”‚      â”‚                                          â”‚
â”‚ â”‚Ğ›Ğ¸Ğ¼Ğ¸Ñ‚:â”‚ â”‚Ğ›Ğ¸Ğ¼Ğ¸Ñ‚:â”‚ â”‚Ğ›Ğ¸Ğ¼Ğ¸Ñ‚:â”‚ â† ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾!               â”‚
â”‚ â”‚100   â”‚ â”‚100   â”‚ â”‚100   â”‚                                          â”‚
â”‚ â”‚      â”‚ â”‚      â”‚ â”‚      â”‚                                          â”‚
â”‚ â”‚Ğ’Ğ¸Ğ´Ğ¸Ñ‚:â”‚ â”‚Ğ’Ğ¸Ğ´Ğ¸Ñ‚:â”‚ â”‚Ğ’Ğ¸Ğ´Ğ¸Ñ‚:â”‚                                          â”‚
â”‚ â”‚100   â”‚ â”‚100   â”‚ â”‚100   â”‚ â† Ğ’ÑĞµ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ»Ğ¸!                        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                     â”‚
â”‚   Ğ˜Ñ‚Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾: 100 + 100 + 100 = 300 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²                   â”‚
â”‚   Ğ’Ğ¼ĞµÑÑ‚Ğ¾ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ° 100!                                                â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ (Redis)

```
Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•: Redis ĞºĞ°Ğº Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚   ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ 300 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²                              â”‚
â”‚             â”‚                                                       â”‚
â”‚             â–¼                                                       â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚      â”‚ Load Balancerâ”‚                                               â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚             â”‚                                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚    â”‚        â”‚        â”‚                                              â”‚
â”‚    â–¼        â–¼        â–¼                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚ â”‚App 1 â”‚ â”‚App 2 â”‚ â”‚App 3 â”‚                                          â”‚
â”‚ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜                                          â”‚
â”‚    â”‚        â”‚        â”‚                                              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚             â”‚                                                       â”‚
â”‚             â–¼                                                       â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚      â”‚    Redis     â”‚ â† Ğ•Ğ´Ğ¸Ğ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¿Ñ€Ğ°Ğ²Ğ´Ñ‹                      â”‚
â”‚      â”‚              â”‚                                               â”‚
â”‚      â”‚ user:123 = 87â”‚ â† ĞĞ±Ñ‰Ğ¸Ğ¹ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ              â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                     â”‚
â”‚   Ğ’ÑĞµ ÑĞµÑ€Ğ²ĞµÑ€Ñ‹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑÑ‚ Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑÑ‚ ĞĞ”Ğ˜Ğ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº                   â”‚
â”‚   100-Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½Ñ‘Ğ½, Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ 200 Ñ‚Ğ¾Ğ¶Ğµ                        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° race condition Ğ¸ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ

```
RACE CONDITION â€” Ğ³Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ½Ğ¾Ğ²Ğ¸Ñ‡ĞºĞ¾Ğ²

ĞĞ°Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ (ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  App 1                          App 2                               â”‚
â”‚    â”‚                              â”‚                                 â”‚
â”‚    â”‚ 1. GET counter               â”‚ 1. GET counter                  â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Redis        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Redis           â”‚
â”‚    â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 99           â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 99              â”‚
â”‚    â”‚                              â”‚                                 â”‚
â”‚    â”‚ 2. if 99 < 100:              â”‚ 2. if 99 < 100:                 â”‚
â”‚    â”‚      allow                   â”‚      allow                      â”‚
â”‚    â”‚                              â”‚                                 â”‚
â”‚    â”‚ 3. SET counter = 100         â”‚ 3. SET counter = 100            â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Redis        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Redis           â”‚
â”‚    â”‚                              â”‚                                 â”‚
â”‚    â”‚                                                                â”‚
â”‚  âš ï¸ ĞĞ±Ğ° Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ»Ğ¸! Ğ¡Ñ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº = 100, Ğ½Ğ¾ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾ 101 Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ!           â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: Lua ÑĞºÑ€Ğ¸Ğ¿Ñ‚ (Ğ°Ñ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ°Ñ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  Lua ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ ĞĞ¢ĞĞœĞĞ ĞĞ                                    â”‚
â”‚  (Ğ½Ğ¸ĞºÑ‚Ğ¾ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²Ğ¼ĞµÑˆĞ°Ñ‚ÑŒÑÑ Ğ¿Ğ¾ÑĞµÑ€ĞµĞ´Ğ¸Ğ½Ğµ)                              â”‚
â”‚                                                                     â”‚
â”‚  App 1                          App 2                               â”‚
â”‚    â”‚                              â”‚                                 â”‚
â”‚    â”‚ 1. EVAL lua_script           â”‚                                 â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Redis        â”‚ (Ğ¶Ğ´Ñ‘Ñ‚)                          â”‚
â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                 â”‚
â”‚    â”‚    â”‚ READ counter = 99    â”‚   â”‚                                 â”‚
â”‚    â”‚    â”‚ IF 99 < 100:         â”‚   â”‚                                 â”‚
â”‚    â”‚    â”‚   counter = 100      â”‚   â”‚                                 â”‚
â”‚    â”‚    â”‚   RETURN "allowed"   â”‚   â”‚                                 â”‚
â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                 â”‚
â”‚    â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ allowed      â”‚                                 â”‚
â”‚    â”‚                              â”‚ 2. EVAL lua_script               â”‚
â”‚    â”‚                              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Redis           â”‚
â”‚    â”‚                              â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚                              â”‚    â”‚ READ counter = 100   â”‚      â”‚
â”‚    â”‚                              â”‚    â”‚ IF 100 < 100: FALSE  â”‚      â”‚
â”‚    â”‚                              â”‚    â”‚   RETURN "denied"    â”‚      â”‚
â”‚    â”‚                              â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚    â”‚                              â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ denied          â”‚
â”‚                                                                     â”‚
â”‚  âœ… ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ÑˆÑ‘Ğ», Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½Ñ‘Ğ½                                  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Redis + Lua: Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸ÑĞ¼Ğ¸

```python
# Distributed Rate Limiter Ñ Redis.
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Lua ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ°Ñ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾ÑÑ‚Ğ¸.
# ĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ´Ğ»Ñ production-ÑĞ¸ÑÑ‚ĞµĞ¼ Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ğ¼Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€Ğ°Ğ¼Ğ¸.

import redis
import time
from typing import Tuple

class RedisRateLimiter:
    """
    Distributed Rate Limiter using Redis.

    ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Redis:
    - Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ (in-memory)
    - ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ°Ñ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Lua
    - Ğ›ĞµĞ³ĞºĞ¾ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ (Redis Cluster)
    - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… ĞºĞ»ÑÑ‡ĞµĞ¹ (TTL)
    """

    def __init__(self, redis_client: redis.Redis, key_prefix: str = "rate_limit"):
        self.redis = redis_client
        self.key_prefix = key_prefix

    def _key(self, identifier: str) -> str:
        """Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Redis ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ."""
        return f"{self.key_prefix}:{identifier}"

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ĞœĞ•Ğ¢ĞĞ” 1: Sliding Window Ñ Sorted Set
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    def check_sliding_window(
        self,
        identifier: str,
        limit: int,
        window_seconds: int
    ) -> Tuple[bool, int, int]:
        """
        Sliding Window Counter using Redis Sorted Set.

        ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:
        1. Ğ¥Ñ€Ğ°Ğ½Ğ¸Ğ¼ timestamp ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ² Sorted Set
        2. Score = timestamp
        3. Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ (Ğ·Ğ° Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ°Ğ¼Ğ¸ Ğ¾ĞºĞ½Ğ°)
        4. Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ¾ÑÑ‚Ğ°Ğ²ÑˆĞ¸ĞµÑÑ

        ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:
        - identifier: ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (IP, user_id, API key)
        - limit: Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
        - window_seconds: Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¾ĞºĞ½Ğ° Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…

        Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:
        - (allowed, remaining, reset_after_seconds)
        """
        key = self._key(identifier)
        now = time.time()
        window_start = now - window_seconds

        # Pipeline â€” Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ round-trip
        pipe = self.redis.pipeline()

        # Ğ¨Ğ°Ğ³ 1: Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
        # ZREMRANGEBYSCORE ÑƒĞ´Ğ°Ğ»ÑĞµÑ‚ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ ÑĞ¾ score Ğ¾Ñ‚ 0 Ğ´Ğ¾ window_start
        pipe.zremrangebyscore(key, 0, window_start)

        # Ğ¨Ğ°Ğ³ 2: Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
        # ZCARD Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ² Sorted Set
        pipe.zcard(key)

        # Ğ¨Ğ°Ğ³ 3: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
        # ZADD Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ Ñ score = now
        # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ now ĞºĞ°Ğº Ğ¸ ĞºĞ»ÑÑ‡, Ğ¸ score (ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ)
        pipe.zadd(key, {str(now): now})

        # Ğ¨Ğ°Ğ³ 4: Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ TTL (Ğ°Ğ²Ñ‚Ğ¾ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ)
        pipe.expire(key, window_seconds)

        # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ²ÑĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
        results = pipe.execute()

        # results[1] = Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ZCARD (ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ)
        current_count = results[1]

        if current_count >= limit:
            # Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½
            # ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ğ¼ ÑĞ°Ğ¼Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´Ğ»Ñ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ñ reset time
            oldest = self.redis.zrange(key, 0, 0, withscores=True)
            if oldest:
                oldest_ts = oldest[0][1]
                reset_after = int(oldest_ts + window_seconds - now) + 1
            else:
                reset_after = window_seconds
            return False, 0, reset_after

        remaining = limit - current_count - 1
        return True, remaining, window_seconds

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ĞœĞ•Ğ¢ĞĞ” 2: Token Bucket Ñ Lua ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ¼
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    def check_token_bucket(
        self,
        identifier: str,
        rate: float,
        capacity: float,
        tokens: int = 1
    ) -> Tuple[bool, float, float]:
        """
        Token Bucket using Redis + Lua.

        Lua ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ ĞĞ¢ĞĞœĞĞ ĞĞ â€” ÑÑ‚Ğ¾ ĞºĞ»ÑÑ‡ĞµĞ²Ğ¾Ğµ!
        ĞĞ¸ĞºĞ°ĞºĞ¾Ğ¹ race condition.

        Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:
        - (allowed, tokens_remaining, retry_after_seconds)
        """
        key = self._key(identifier)
        now = time.time()

        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # LUA Ğ¡ĞšĞ Ğ˜ĞŸĞ¢ â€” ÑĞµÑ€Ğ´Ñ†Ğµ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ°
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        lua_script = """
        -- KEYS[1] = Redis ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        -- ARGV[1] = rate (Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ)
        -- ARGV[2] = capacity (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²)
        -- ARGV[3] = now (Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ)
        -- ARGV[4] = requested (ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ½ÑƒĞ¶Ğ½Ğ¾)

        local key = KEYS[1]
        local rate = tonumber(ARGV[1])
        local capacity = tonumber(ARGV[2])
        local now = tonumber(ARGV[3])
        local requested = tonumber(ARGV[4])

        -- ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ bucket
        -- HMGET Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾Ğ»ĞµĞ¹ Ğ¸Ğ· Hash
        local bucket = redis.call('HMGET', key, 'tokens', 'last_update')

        -- Ğ•ÑĞ»Ğ¸ bucket Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚, Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµĞ¼ Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ğ²ĞµĞ´Ñ€Ğ°
        local tokens = tonumber(bucket[1]) or capacity
        local last_update = tonumber(bucket[2]) or now

        -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        -- ĞŸĞĞŸĞĞ›ĞĞ•ĞĞ˜Ğ• Ğ¢ĞĞšĞ•ĞĞĞ’
        -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        -- Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°: Ğ½Ğ¾Ğ²Ñ‹Ğµ_Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ = (ÑĞµĞ¹Ñ‡Ğ°Ñ - Ğ¿Ñ€Ğ¾ÑˆĞ»Ñ‹Ğ¹_Ñ€Ğ°Ğ·) Ã— ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ
        -- ĞĞ¾ Ğ½Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ capacity

        local elapsed = now - last_update
        tokens = math.min(capacity, tokens + elapsed * rate)

        -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        -- ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ˜ Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•
        -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        local allowed = 0      -- 0 = Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¾, 1 = Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¾
        local retry_after = 0  -- ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¶Ğ´Ğ°Ñ‚ÑŒ ĞµÑĞ»Ğ¸ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¾

        if tokens >= requested then
            -- Ğ¢Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ñ…Ğ²Ğ°Ñ‚Ğ°ĞµÑ‚ â€” Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ°ĞµĞ¼
            tokens = tokens - requested
            allowed = 1
        else
            -- Ğ¢Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ½Ğµ Ñ…Ğ²Ğ°Ñ‚Ğ°ĞµÑ‚ â€” Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ÑĞµĞ¼
            -- Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ:
            -- (ÑĞºĞ¾Ğ»ÑŒĞºĞ¾_Ğ½ÑƒĞ¶Ğ½Ğ¾ - ÑĞºĞ¾Ğ»ÑŒĞºĞ¾_ĞµÑÑ‚ÑŒ) / ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ_Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
            retry_after = (requested - tokens) / rate
        end

        -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        -- Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ• Ğ¡ĞĞ¡Ğ¢ĞĞ¯ĞĞ˜Ğ¯
        -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        -- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ½Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ² Redis Hash
        redis.call('HMSET', key, 'tokens', tokens, 'last_update', now)

        -- Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ TTL â€” Ğ°Ğ²Ñ‚Ğ¾ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ĞºĞ»ÑÑ‡ĞµĞ¹
        -- Ğ’Ñ€ĞµĞ¼Ñ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ = Ğ²Ñ€ĞµĞ¼Ñ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ¿ÑƒÑÑ‚Ğ¾Ğ³Ğ¾ Ğ²ĞµĞ´Ñ€Ğ° + Ğ·Ğ°Ğ¿Ğ°Ñ
        redis.call('EXPIRE', key, math.ceil(capacity / rate) + 1)

        -- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
        return {allowed, tokens, retry_after}
        """

        # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Lua ÑĞºÑ€Ğ¸Ğ¿Ñ‚
        result = self.redis.eval(
            lua_script,
            1,              # ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ KEYS
            key,            # KEYS[1]
            rate,           # ARGV[1]
            capacity,       # ARGV[2]
            now,            # ARGV[3]
            tokens          # ARGV[4]
        )

        allowed = result[0] == 1
        tokens_remaining = result[1]
        retry_after = result[2]

        return allowed, tokens_remaining, retry_after


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ğ˜ĞĞ¢Ğ•Ğ“Ğ ĞĞ¦Ğ˜Ğ¯ Ğ¡ FASTAPI
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ middleware Ğ´Ğ»Ñ FastAPI:
"""
from fastapi import FastAPI, Request
from fastapi.responses import JSONResponse
import redis
import time

app = FastAPI()
redis_client = redis.Redis(host='localhost', port=6379, decode_responses=True)
rate_limiter = RedisRateLimiter(redis_client)

@app.middleware("http")
async def rate_limit_middleware(request: Request, call_next):
    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°
    # Ğ’ production Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹: API key, user_id, Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ
    client_ip = request.client.host

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚: 100 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ
    allowed, remaining, reset = rate_limiter.check_sliding_window(
        identifier=client_ip,
        limit=100,
        window_seconds=60
    )

    if not allowed:
        # HTTP 429 Too Many Requests
        return JSONResponse(
            status_code=429,
            content={
                "error": "rate_limit_exceeded",
                "message": f"ĞŸÑ€ĞµĞ²Ñ‹ÑˆĞµĞ½ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ². ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· {reset} ÑĞµĞº.",
                "retry_after": reset
            },
            headers={
                "Retry-After": str(reset),
                "X-RateLimit-Limit": "100",
                "X-RateLimit-Remaining": "0",
                "X-RateLimit-Reset": str(int(time.time()) + reset)
            }
        )

    # Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½ â€” Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼
    response = await call_next(request)

    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¸
    response.headers["X-RateLimit-Limit"] = "100"
    response.headers["X-RateLimit-Remaining"] = str(remaining)
    response.headers["X-RateLimit-Reset"] = str(int(time.time()) + 60)

    return response
"""
```

---

## ĞšĞ°Ğº ÑÑ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚ Stripe (Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€)

Stripe Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ°Ñ€Ğ´Ñ‹ API-Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ². Ğ’Ğ¾Ñ‚ Ğ¸Ñ… Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ ([Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº](https://stripe.com/blog/rate-limiters)):

### Ğ§ĞµÑ‚Ñ‹Ñ€Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Stripe

```
STRIPE: 4 Ğ£Ğ ĞĞ’ĞĞ¯ RATE LIMITING

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ 1: Request Rate Limiter                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚  Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚: ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹/ÑĞµĞºÑƒĞ½Ğ´Ñƒ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°     â”‚
â”‚  ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼: Token Bucket                                            â”‚
â”‚  Ğ›Ğ¸Ğ¼Ğ¸Ñ‚: 25 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/ÑĞµĞº (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)                             â”‚
â”‚  Ğ—Ğ°Ñ‡ĞµĞ¼: Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²                        â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ 2: Concurrent Requests Limiter                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚  Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚: ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ ĞĞ”ĞĞĞ’Ğ Ğ•ĞœĞ•ĞĞĞ«Ğ• Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹                    â”‚
â”‚  Ğ—Ğ°Ñ‡ĞµĞ¼: CPU-Ñ‚ÑĞ¶Ñ‘Ğ»Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ (Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ĞºĞ°Ñ€Ñ‚)                      â”‚
â”‚  ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: ĞĞµ Ğ±Ğ¾Ğ»ĞµĞµ 10 Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¾Ñ‚ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°              â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ 3: Fleet Usage Load Shedder                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚  Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚: Ğ ĞµĞ·ĞµÑ€Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ Ñ€ĞµÑÑƒÑ€ÑÑ‹ Ğ´Ğ»Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹            â”‚
â”‚                                                                     â”‚
â”‚  ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ:           ĞĞµĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ:                                 â”‚
â”‚  â€¢ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°   â€¢ Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶ĞµĞ¹                            â”‚
â”‚  â€¢ Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚            â€¢ Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°                                  â”‚
â”‚                                                                     â”‚
â”‚  ĞŸÑ€Ğ¸ Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ·ĞºĞµ: ĞÑ‚ĞºĞ»Ğ¾Ğ½ÑĞµĞ¼ Ğ½ĞµĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ       â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ 4: Worker Utilization Load Shedder                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚
â”‚  Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚: ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²                           â”‚
â”‚  ĞŸÑ€Ğ¸ Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ·ĞºĞµ: ĞÑ‚ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñƒ                           â”‚
â”‚                                                                     â”‚
â”‚  ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ (Ğ¾Ñ‚ Ğ½Ğ¸Ğ·ĞºĞ¾Ğ³Ğ¾ Ğº Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğ¼Ñƒ):                                â”‚
â”‚  4. Test mode Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº (sandbox) â€” Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼                  â”‚
â”‚  3. GET Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹                                                     â”‚
â”‚  2. POST Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹                                                    â”‚
â”‚  1. ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ â€” Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¼Ğ¸                        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## HTTP Headers: Ñ‡Ñ‚Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ

ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¸ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ÑÑ‚ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ¸ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ:

```
HTTP RESPONSE HEADERS

ĞŸÑ€Ğ¸ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ (200 OK):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  HTTP/1.1 200 OK                                                    â”‚
â”‚  X-RateLimit-Limit: 100          â† ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¾ĞºĞ½Ğµ        â”‚
â”‚  X-RateLimit-Remaining: 45       â† ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²               â”‚
â”‚  X-RateLimit-Reset: 1704067200   â† Unix timestamp ÑĞ±Ñ€Ğ¾ÑĞ°           â”‚
â”‚                                                                     â”‚
â”‚  Ğ§Ñ‚Ğ¾ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚:                                              â”‚
â”‚  "Ğ£ Ğ¼ĞµĞ½Ñ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ 100, Ğ¾ÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ 45, ÑĞ±Ñ€Ğ¾Ñ Ğ² 12:00:00"                 â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ĞŸÑ€Ğ¸ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½Ğ¸Ğ¸ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ° (429 Too Many Requests):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  HTTP/1.1 429 Too Many Requests                                     â”‚
â”‚  Retry-After: 30                 â† ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ! Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¶Ğ´Ğ°Ñ‚ÑŒ      â”‚
â”‚  X-RateLimit-Limit: 100                                            â”‚
â”‚  X-RateLimit-Remaining: 0                                          â”‚
â”‚  X-RateLimit-Reset: 1704067200                                     â”‚
â”‚  Content-Type: application/json                                     â”‚
â”‚                                                                     â”‚
â”‚  {                                                                  â”‚
â”‚    "error": "rate_limit_exceeded",                                 â”‚
â”‚    "message": "ĞŸÑ€ĞµĞ²Ñ‹ÑˆĞµĞ½ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚. ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· 30 ÑĞµĞºÑƒĞ½Ğ´.",        â”‚
â”‚    "retry_after": 30,                                              â”‚
â”‚    "documentation_url": "https://docs.api.com/rate-limiting"       â”‚
â”‚  }                                                                  â”‚
â”‚                                                                     â”‚
â”‚  Ğ§Ñ‚Ğ¾ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚:                                              â”‚
â”‚  "ĞÑƒĞ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ°Ñ‚ÑŒ 30 ÑĞµĞºÑƒĞ½Ğ´ Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ"                           â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ¢Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¸ ĞºĞ°Ğº Ğ¸Ñ… Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ

ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¾Ğ¿Ñ‹Ñ‚Ğ° ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹ ([Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ](#Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸)):

### ĞÑˆĞ¸Ğ±ĞºĞ° 1: Race Condition

```
âŒ ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: GET â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° â†’ SET

if redis.get("counter") < 100:
    redis.set("counter", redis.get("counter") + 1)
    allow_request()

ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: ĞœĞµĞ¶Ğ´Ñƒ GET Ğ¸ SET Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ Ñ‚Ğ¾Ğ¶Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ 99

âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: ĞÑ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ°Ñ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ Lua

result = redis.eval(lua_script, ...)
if result == "allowed":
    allow_request()
```

### ĞÑˆĞ¸Ğ±ĞºĞ° 2: ĞĞµ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ñ‡Ğ°ÑÑ‹

```
âŒ ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:
Ğ¡ĞµÑ€Ğ²ĞµÑ€ A: 12:00:00
Ğ¡ĞµÑ€Ğ²ĞµÑ€ B: 12:00:05 (Ğ¾Ñ‚ÑÑ‚Ğ°Ñ‘Ñ‚ Ğ½Ğ° 5 ÑĞµĞº)

ĞŸÑ€Ğ¸ Fixed Window ÑĞµÑ€Ğ²ĞµÑ€ B ÑĞ±Ñ€Ğ¾ÑĞ¸Ñ‚ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ğ¿Ğ¾Ğ·Ğ¶Ğµ,
Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ² Ğ»Ğ¸ÑˆĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹.

âœ… Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:
1. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ NTP Ğ´Ğ»Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ñ‡Ğ°ÑĞ¾Ğ²
2. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Redis TIME Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
3. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Sliding Window (Ğ¼ĞµĞ½ĞµĞµ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ĞµĞ½)
```

### ĞÑˆĞ¸Ğ±ĞºĞ° 3: Sticky Sessions Ğ½Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒÑÑ‚ÑÑ

```
âŒ Ğ˜Ğ´ĞµÑ: ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ½Ğ° Ğ¾Ğ´Ğ¸Ğ½ ÑĞµÑ€Ğ²ĞµÑ€

ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:
- Ğ¡ĞµÑ€Ğ²ĞµÑ€ ÑƒĞ¿Ğ°Ğ» â†’ Ğ²ÑĞµ ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ±ĞµĞ· ÑĞµÑ€Ğ²Ğ¸ÑĞ°
- ĞĞµÑ€Ğ°Ğ²Ğ½Ğ¾Ğ¼ĞµÑ€Ğ½Ğ°Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° (Ğ¾Ğ´Ğ¸Ğ½ ÑĞµÑ€Ğ²ĞµÑ€ Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ¶ĞµĞ½)
- Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ

âœ… Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: Centralized rate limiting (Redis)
```

### ĞÑˆĞ¸Ğ±ĞºĞ° 4: ĞĞµÑ‚ fallback Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºĞ°Ğ·Ğµ Redis

```
âŒ Ğ•ÑĞ»Ğ¸ Redis Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½:
throw error â†’ Ğ’ÑĞµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¿Ğ°Ğ´Ğ°ÑÑ‚

âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ fallback:

try:
    allowed = rate_limiter.check(user_id)
except redis.RedisError:
    # Redis Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½
    # Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ²ÑĞµÑ… (Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ğ¿Ñ€Ğ¸ Ğ°Ñ‚Ğ°ĞºĞµ)
    # Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: Local rate limiting (Ğ¼ĞµĞ½ĞµĞµ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾)
    # Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 3: ĞÑ‚ĞºĞ»Ğ¾Ğ½ÑĞµĞ¼ Ğ²ÑĞµÑ… (Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾, Ğ½Ğ¾ Ğ¶Ñ‘ÑÑ‚ĞºĞ¾)

    allowed = local_rate_limiter.check(user_id)  # Fallback
    log.warning("Redis unavailable, using local limiter")
```

---

## Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ğ²Ğ½ĞµĞ´Ñ€ĞµĞ½Ğ¸Ñ Rate Limiting

### ĞŸĞµÑ€ĞµĞ´ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ¼

- [ ] Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ» Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ (Token Bucket Ğ´Ğ»Ñ API, Sliding Window Ğ´Ğ»Ñ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸)
- [ ] ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ğ» Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ¿Ğ¾ tier'Ğ°Ğ¼ (free: 10/Ğ¼Ğ¸Ğ½, pro: 100/Ğ¼Ğ¸Ğ½)
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ğ» Redis Ğ´Ğ»Ñ distributed ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
- [ ] ĞĞ°Ğ¿Ğ¸ÑĞ°Ğ» Lua ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ°Ñ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾ÑÑ‚Ğ¸
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ» Ğ²ÑĞµ HTTP Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¸ (Retry-After Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½!)
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ» fallback Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºĞ°Ğ·Ğµ Redis
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ» kill switch (Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğµ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ)
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ğ» Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ (ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ 429, latency)

### ĞŸĞ¾ÑĞ»Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°

- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑÑ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸: ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ 429 Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼?
- [ ] ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒÑ: Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ğµ/Ğ¼ÑĞ³ĞºĞ¸Ğµ?
- [ ] Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ API Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ° Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ¾ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ñ…
- [ ] ĞšĞ»Ğ¸ĞµĞ½Ñ‚Ñ‹ Ğ·Ğ½Ğ°ÑÑ‚ Ğ¾ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ñ… Ğ¸ Ğ¸Ğ¼ĞµÑÑ‚ SDK Ñ retry logic

---

## Ğ¡Ğ²ÑĞ·Ğ¸

### ĞŸÑ€ĞµĞ¶Ğ´Ğµ Ñ‡ĞµĞ¼ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ
- [[api-design]] â€” ĞŸÑ€Ğ¾ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ API (Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ HTTP)
- [[caching-strategies]] â€” Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (Redis Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ‚Ğ°Ğ¼ Ğ¶Ğµ)

### ĞšÑƒĞ´Ğ° Ğ´Ğ°Ğ»ÑŒÑˆĞµ
- [[architecture-resilience-patterns]] â€” Circuit Breaker, Retry, Fallback (Ñ‡Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ ĞŸĞĞ¡Ğ›Ğ• rate limiting)
- [[security-api-protection]] â€” DDoS Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°, WAF (Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹)
- [[performance-optimization]] â€” ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

### Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµĞ¼Ñ‹
- [[architecture-overview]] â€” ĞĞ±Ñ‰Ğ¸Ğ¹ Ğ¾Ğ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹
- [[microservices-vs-monolith]] â€” ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²

---

## Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸

### ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ±Ğ»Ğ¾Ğ³Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹
- [Stripe: Scaling your API with rate limiters](https://stripe.com/blog/rate-limiters) â€” ĞºĞ°Ğº Stripe Ğ´ĞµĞ»Ğ°ĞµÑ‚ rate limiting Ğ² production
- [GitHub Gist: Stripe Rate Limiters Code](https://gist.github.com/ptarjan/e38f45f2dfe601419ca3af937fff574d) â€” Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ´ Ğ¸Ğ· Stripe

### Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑŒĞ¸
- [AlgoMaster: Rate Limiting Algorithms Explained with Code](https://blog.algomaster.io/p/rate-limiting-algorithms-explained-with-code) â€” Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ²ÑĞµÑ… Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¾Ğ²
- [Arpit Bhayani: Sliding Window Rate Limiter](https://arpitbhayani.me/blogs/sliding-window-ratelimiter/) â€” Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¸Ğ¹ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»
- [freeCodeCamp: Distributed Rate Limiting with Redis](https://www.freecodecamp.org/news/build-rate-limiting-system-using-redis-and-lua/) â€” Redis + Lua tutorial
- [Callr Tech: Rate limiting for distributed systems](https://blog.callr.tech/rate-limiting-for-distributed-systems-with-redis-and-lua/) â€” Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¾Ğ¿Ñ‹Ñ‚

### ĞĞºĞ°Ğ´ĞµĞ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸
- [Wikipedia: Token Bucket](https://en.wikipedia.org/wiki/Token_bucket) â€” Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ
- [LUC.edu: Token Bucket Rate Limiting](https://intronetworks.cs.luc.edu/current/html/tokenbucket.html) â€” Ğ¼Ğ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºĞ° Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ°

### System Design
- [Hello Interview: Design a Distributed Rate Limiter](https://www.hellointerview.com/learn/system-design/problem-breakdowns/distributed-rate-limiter) â€” Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²ÑŒÑ
- System Design Interview by Alex Xu, Chapter 4 â€” ĞºĞ½Ğ¸Ğ³Ğ°

---

*ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾: 2026-01-09*
*Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸: 15+ (Stripe, freeCodeCamp, Wikipedia, Hello Interview, AlgoMaster Ğ¸ Ğ´Ñ€.)*
*Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€Ğ½Ğ¾ÑÑ‚Ğ¸: high*
