---
title: "Сетевые основы для разработчиков"
date_created: 2025-12-26
date_modified: 2025-12-26
type: explainer
status: published
tags:
  - networking/fundamentals
  - networking/beginner
  - skills/developer
related:
  - "[[networking-overview]]"
  - "[[network-dns-tls]]"
  - "[[network-transport-layer]]"
  - "[[network-http-evolution]]"
  - "[[network-debugging-basics]]"
---

# Сетевые основы для разработчиков

**Ты набираешь `google.com` в браузере и нажимаешь Enter. Через 200 миллисекунд видишь страницу. За эти 200ms происходит десятки операций, задействуются тысячи километров кабелей и десятки серверов.**

Большинство разработчиков воспринимают сеть как чёрный ящик: "отправил запрос — получил ответ". Но когда что-то ломается, этот чёрный ящик становится непроницаемой стеной.

---

## Prerequisites

| Тема | Зачем нужно | Где изучить |
|------|-------------|-------------|
| **Браузер DevTools** | Вкладка Network для отладки | F12 в любом браузере |
| **Командная строка** | ping, curl, dig — базовые утилиты | Bash basics |

### Для кого этот материал

| Уровень | Подходит? | Рекомендация |
|---------|-----------|--------------|
| **Новичок** | ✅ Да | Отличная точка входа в сети |
| **Intermediate** | ✅ Да | Освежить знания |
| **Advanced** | ⏭️ Пропустить | Переходи к [[network-transport-layer]] |

### Терминология для новичков

> 💡 **Сетевой стек** = набор протоколов, работающих на разных уровнях. Как почтовая система: упаковка → адресация → маршрутизация → доставка.

| Термин | Значение | Аналогия для новичка |
|--------|----------|---------------------|
| **URL** | Uniform Resource Locator — адрес ресурса в интернете | **Визитная карточка** — куда идти и что просить |
| **DNS** | Система доменных имён — переводит google.com в IP | **Контакт в телефоне** — имя → номер |
| **TCP Handshake** | Три сообщения для установки соединения | **Рукопожатие** — "Привет!" "Привет!" "Поговорим?" |
| **TLS** | Шифрование соединения | **Секретный код** — никто не подслушает разговор |
| **TTFB** | Time To First Byte — время до первого байта | **Время ожидания в ресторане** — когда принесут первое блюдо |
| **RTT** | Round-Trip Time — время туда и обратно | **Пинг-понг** — мяч долетел и вернулся |
| **HTTP Request** | Запрос от клиента к серверу | **Заказ в кафе** — "хочу это" |
| **HTTP Response** | Ответ сервера клиенту | **Ответ официанта** — "вот ваш заказ" |
| **Status Code** | Код ответа (200, 404, 500) | **Статус заказа** — готово, не нашли, кухня сломалась |
| **Header** | Метаданные запроса/ответа | **Этикетка на посылке** — информация о содержимом |

---

## Часть 1: Интуиция без кода

### 5 аналогий для глубокого понимания

---

### Аналогия 1: HTTP-запрос как заказ в ресторане

Представь, что ты пришёл в ресторан. Весь процесс общения с рестораном — это HTTP-коммуникация:

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        РЕСТОРАН = ВЕБ-СЕРВЕР                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ТЫ (клиент)                              ОФИЦИАНТ (сервер)                │
│   ═══════════                              ══════════════════                │
│                                                                             │
│   1. Заходишь в ресторан           →       TCP Handshake                    │
│      "Можно войти?"                         (установка соединения)          │
│                                                                             │
│   2. Садишься за столик №7         →       Сессия с session_id              │
│      (тебя запомнили)                                                       │
│                                                                             │
│   3. "Принесите меню"              →       GET /menu HTTP/1.1               │
│                                            Host: restaurant.com             │
│                                                                             │
│   4. Официант приносит меню        →       HTTP/1.1 200 OK                  │
│                                            Content-Type: text/html          │
│                                            [список блюд]                    │
│                                                                             │
│   5. "Хочу пиццу Маргарита"        →       POST /order HTTP/1.1             │
│                                            {"dish": "margherita"}           │
│                                                                             │
│   6. "Заказ принят, готовим"       →       HTTP/1.1 201 Created             │
│                                            Location: /orders/42             │
│                                                                             │
│   7. "Как там мой заказ?"          →       GET /orders/42 HTTP/1.1          │
│                                                                             │
│   8. "В процессе готовки"          →       HTTP/1.1 200 OK                  │
│                                            {"status": "cooking"}            │
│                                                                             │
│   9. Приносят пиццу                →       GET /orders/42                   │
│                                            {"status": "delivered",          │
│                                             "dish": {...}}                  │
│                                                                             │
│   10. "Счёт, пожалуйста"           →       GET /bill HTTP/1.1               │
│                                                                             │
│   11. Уходишь                      →       Connection: close                │
│                                            (соединение закрыто)             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**HTTP статус-коды в ресторанной терминологии:**

| Код | Ответ официанта | Значение |
|-----|-----------------|----------|
| 200 | "Вот ваш заказ" | OK — запрос выполнен |
| 201 | "Заказ оформлен, номер 42" | Created — ресурс создан |
| 301 | "Мы переехали на новый адрес" | Moved Permanently |
| 400 | "Не понимаю, что вы хотите" | Bad Request |
| 401 | "Покажите членскую карту" | Unauthorized |
| 403 | "Это блюдо только для VIP" | Forbidden |
| 404 | "Такого блюда нет в меню" | Not Found |
| 429 | "Вы слишком часто заказываете!" | Too Many Requests |
| 500 | "Кухня сломалась" | Internal Server Error |
| 503 | "Все повара заняты, подождите" | Service Unavailable |

---

### Аналогия 2: DNS как контакты в телефоне

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          ТЕЛЕФОННАЯ КНИГА = DNS                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   КАК ТЫ ЗВОНИШЬ ДРУГУ:                                                     │
│                                                                             │
│   1. Открываешь контакты                                                    │
│   2. Ищешь "Мама"                    →    Человекочитаемое имя (домен)      │
│   3. Телефон показывает номер        →    IP-адрес                          │
│   4. Нажимаешь "Позвонить"           →    TCP соединение                    │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────┐       │
│   │  КОНТАКТ         НОМЕР              │  ДОМЕН         IP         │       │
│   ├─────────────────────────────────────┼───────────────────────────┤       │
│   │  Мама            +7-999-111-22-33   │  google.com    142.250.x  │       │
│   │  Работа          +7-495-123-45-67   │  github.com    140.82.x   │       │
│   │  Доктор          +7-800-555-35-35   │  amazon.com    54.239.x   │       │
│   └─────────────────────────────────────┴───────────────────────────┘       │
│                                                                             │
│   ИЕРАРХИЯ "КОНТАКТОВ" В DNS:                                               │
│                                                                             │
│   Твой телефон (кэш браузера)                                               │
│        │                                                                    │
│        ▼ не нашёл?                                                          │
│   Записная книжка дома (кэш ОС)                                             │
│        │                                                                    │
│        ▼ не нашёл?                                                          │
│   Справочная района (DNS провайдера)                                        │
│        │                                                                    │
│        ▼ не нашёл?                                                          │
│   Городская справочная (Root DNS)                                           │
│        │                                                                    │
│        ▼ "Спроси в справочной по фамилиям на 'G'"                           │
│   Справочная по букве G (TLD .com)                                          │
│        │                                                                    │
│        ▼ "Вот телефон семьи Google"                                         │
│   Домашний телефон Google (Authoritative DNS)                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**TTL = как долго помнить номер:**
- TTL 300 секунд = "Запиши номер, но через 5 минут перезвони уточнить — вдруг сменился"
- TTL 86400 = "Этот номер точно не изменится сутки"

---

### Аналогия 3: TCP vs UDP как разговор по телефону vs рация

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      TCP = ТЕЛЕФОННЫЙ РАЗГОВОР                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────┐                                    ┌─────────┐                │
│   │ Клиент  │                                    │ Сервер  │                │
│   └────┬────┘                                    └────┬────┘                │
│        │                                              │                     │
│        │─────────── "Алло, можно поговорить?" ───────►│  SYN                │
│        │                                              │                     │
│        │◄────────── "Да, слушаю, говори" ────────────│  SYN-ACK            │
│        │                                              │                     │
│        │─────────── "Отлично, начинаю" ─────────────►│  ACK                │
│        │                                              │                     │
│        │═══════════ СОЕДИНЕНИЕ УСТАНОВЛЕНО ══════════│                     │
│        │                                              │                     │
│        │─────────── "Запиши: А, Б, В" ──────────────►│  Данные             │
│        │◄────────── "Понял: А, Б, В" ────────────────│  ACK                │
│        │                                              │                     │
│        │─────────── "Теперь: Г, Д, Е" ──────────────►│  Данные             │
│        │◄────────── "Понял: Г, Д, Е" ────────────────│  ACK                │
│        │                                              │                     │
│        │─────────── "Всё, пока!" ───────────────────►│  FIN                │
│        │◄────────── "Пока!" ─────────────────────────│  FIN-ACK            │
│        │                                              │                     │
│                                                                             │
│   ГАРАНТИИ:                                                                 │
│   ✓ Собеседник точно услышал                                                │
│   ✓ Порядок слов сохранён                                                   │
│   ✓ Если связь оборвалась — узнаешь                                         │
│   ✗ Нужно время на "Алло? — Да? — Говори"                                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                          UDP = РАЦИЯ (WALKIE-TALKIE)                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────┐                                    ┌─────────┐                │
│   │ Клиент  │                                    │ Сервер  │                │
│   └────┬────┘                                    └────┬────┘                │
│        │                                              │                     │
│        │─────────── "Кадр 1" ───────────────────────►│                     │
│        │─────────── "Кадр 2" ──────────── ✗ ПОТЕРЯН  │  (помехи)           │
│        │─────────── "Кадр 3" ───────────────────────►│                     │
│        │─────────── "Кадр 4" ───────────────────────►│                     │
│        │                                              │                     │
│   РЕЗУЛЬТАТ: Сервер получил кадры 1, 3, 4 (без 2)                           │
│                                                                             │
│   ХАРАКТЕРИСТИКИ:                                                           │
│   ✓ Мгновенная отправка (нет handshake)                                     │
│   ✓ Низкий overhead                                                         │
│   ✗ Не знаешь, дошло ли                                                     │
│   ✗ Порядок может нарушиться                                                │
│                                                                             │
│   ИДЕАЛЬНО ДЛЯ:                                                             │
│   • Видеозвонки (лучше пропустить кадр, чем задержать)                       │
│   • Онлайн-игры (старая позиция игрока бесполезна)                          │
│   • DNS (быстрый запрос-ответ)                                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Аналогия 4: Порт как номер квартиры в доме

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           IP = АДРЕС ДОМА                                   │
│                          ПОРТ = НОМЕР КВАРТИРЫ                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│          ┌─────────────────────────────────────────────┐                    │
│          │           СЕРВЕР (192.168.1.100)            │                    │
│          │            "Многоквартирный дом"            │                    │
│          │                                             │                    │
│          │  ┌─────────┐  ┌─────────┐  ┌─────────┐     │                    │
│          │  │  :22    │  │  :80    │  │  :443   │     │                    │
│          │  │  SSH    │  │  HTTP   │  │  HTTPS  │     │                    │
│          │  │(сисадм.)│  │ (веб)   │  │ (веб🔒)│     │                    │
│          │  └─────────┘  └─────────┘  └─────────┘     │                    │
│          │                                             │                    │
│          │  ┌─────────┐  ┌─────────┐  ┌─────────┐     │                    │
│          │  │ :3306   │  │ :5432   │  │ :6379   │     │                    │
│          │  │  MySQL  │  │PostgreSQL│ │  Redis  │     │                    │
│          │  │  (БД)   │  │  (БД)   │  │ (кэш)   │     │                    │
│          │  └─────────┘  └─────────┘  └─────────┘     │                    │
│          │                                             │                    │
│          │  ┌─────────┐  ┌─────────┐  ┌─────────┐     │                    │
│          │  │ :8080   │  │ :3000   │  │ :9000   │     │                    │
│          │  │Alt HTTP │  │  Node   │  │ Custom  │     │                    │
│          │  │ (dev)   │  │  (dev)  │  │  App    │     │                    │
│          │  └─────────┘  └─────────┘  └─────────┘     │                    │
│          │                                             │                    │
│          └─────────────────────────────────────────────┘                    │
│                                                                             │
│   ЗАПРОС К 192.168.1.100:443 = "Иду в дом 192.168.1.100, квартира 443"      │
│                                                                             │
│   ДИАПАЗОНЫ "КВАРТИР":                                                      │
│   ┌────────────────┬──────────────────────────────────────────────┐         │
│   │ 0-1023         │ Пентхаусы (системные) — нужен root           │         │
│   │ 1024-49151     │ Обычные квартиры (registered)                │         │
│   │ 49152-65535    │ Временное жильё (ephemeral)                  │         │
│   └────────────────┴──────────────────────────────────────────────┘         │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Аналогия 5: HTTPS как разговор через зашифрованную трубку

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    HTTP = РАЗГОВОР В ПУБЛИЧНОМ МЕСТЕ                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ТЫ ──────────────────────────────────────────────────────► СЕРВЕР        │
│          "Мой пароль: qwerty123"                                            │
│                    │                                                        │
│               ┌────┴────┐                                                   │
│               │  ХАКЕР  │  👂 "Ага, пароль qwerty123!"                      │
│               │ (в кафе)│                                                   │
│               └─────────┘                                                   │
│                                                                             │
│   Любой в той же сети может ПОДСЛУШАТЬ и ПОДМЕНИТЬ данные                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                    HTTPS = ЗВУКОНЕПРОНИЦАЕМАЯ ТРУБКА                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   УСТАНОВКА "ТРУБКИ" (TLS Handshake):                                       │
│                                                                             │
│   1. Клиент: "Хочу секретный канал. Вот мои возможности шифрования"         │
│              ─────────────────────────────────────────────────────►         │
│                                                                             │
│   2. Сервер: "Ок. Вот мой сертификат (паспорт), выбираю AES-256"            │
│              ◄─────────────────────────────────────────────────────         │
│                                                                             │
│   3. Клиент: [проверяет сертификат у "нотариуса" (CA)]                       │
│              "Сертификат настоящий. Вот секретный ключ для нас двоих"       │
│              ─────────────────────────────────────────────────────►         │
│                                                                             │
│   4. ══════════════ ШИФРОВАННЫЙ КАНАЛ УСТАНОВЛЕН ═══════════════            │
│                                                                             │
│   ТЫ ═══════════════[🔒 зашифровано 🔒]════════════════════► СЕРВЕР        │
│                    │                                                        │
│               ┌────┴────┐                                                   │
│               │  ХАКЕР  │  😕 "Вижу только #@$%^&*!!!"                      │
│               │ (в кафе)│                                                   │
│               └─────────┘                                                   │
│                                                                             │
│   ЧТО ШИФРУЕТСЯ:                    ЧТО НЕ СКРЫВАЕТСЯ:                      │
│   ✓ URL path (/secret/data)         ✗ IP-адреса клиента и сервера          │
│   ✓ Заголовки (Cookie, Auth)        ✗ Размер данных                         │
│   ✓ Тело запроса/ответа             ✗ Время запросов                        │
│   ✓ Query parameters                ✗ Домен (SNI до TLS 1.3 ECH)           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Часть 2: Почему это сложно

### 6 типичных ошибок разработчиков

---

### Ошибка 1: Не понимаю, на каком уровне проблема

**СИМПТОМ:**
```
Пользователь: "Сайт не работает"
Разработчик: *хаотично проверяет всё подряд*
              *2 часа гуглит "site not working"*
              *случайно находит решение (или нет)*
```

**РЕШЕНИЕ:**
```
СИСТЕМНЫЙ ПОДХОД — СНИЗУ ВВЕРХ:

□ Уровень 1: Физическая связность
  └─ ping google.com
     • Работает? → Интернет есть, идём выше
     • Не работает? → Проблема сети/DNS

□ Уровень 2: DNS резолвинг
  └─ dig api.example.com
     • Есть IP? → DNS работает
     • Нет IP? → Проблема DNS (домен? резолвер?)

□ Уровень 3: TCP соединение
  └─ curl -v https://api.example.com (смотри на connection)
     • Connected? → TCP работает
     • Connection refused? → Порт закрыт
     • Timeout? → Firewall или сервер мёртв

□ Уровень 4: TLS/SSL
  └─ curl показывает TLS handshake
     • Успех? → Сертификат валидный
     • Ошибка? → Проверь сертификат, дату, CA

□ Уровень 5: HTTP
  └─ Смотри статус-код ответа
     • 2xx → Всё ок на уровне протокола
     • 4xx → Проблема с запросом (твоя вина)
     • 5xx → Проблема сервера (их вина)

□ Уровень 6: Приложение
  └─ Смотри тело ответа, логи
     • Бизнес-логика, валидация, авторизация
```

---

### Ошибка 2: "Локально работает, в проде — нет"

**СИМПТОМ:**
```javascript
// Локально:
fetch('http://localhost:3000/api/users')  // ✅ Работает!

// В проде:
fetch('http://localhost:3000/api/users')  // ❌ Не работает!
// Причина: localhost в браузере пользователя ≠ твой сервер
```

**РЕШЕНИЕ:**
```javascript
// Правильно: относительный путь или переменная окружения
fetch('/api/users')  // Относительный — всегда работает
// или
fetch(`${process.env.API_URL}/api/users`)  // Явный URL из конфига
```

**Чеклист локально vs прод:**
```
□ URL абсолютные или относительные?
□ HTTPS в проде, HTTP локально — учёл?
□ CORS настроен для прод-домена?
□ Переменные окружения разные?
□ Порты совпадают?
□ Firewall/Security Groups открыты?
```

---

### Ошибка 3: Игнорирование CORS

**СИМПТОМ:**
```
Console: Access to fetch at 'https://api.example.com' from origin
'https://mysite.com' has been blocked by CORS policy
```

**РЕШЕНИЕ:**
```
CORS — это ЗАЩИТА БРАУЗЕРА, не сервера!

Когда возникает:
• Твой сайт (mysite.com) делает запрос к другому домену (api.example.com)
• Браузер спрашивает api.example.com: "Можно ли mysite.com к тебе ходить?"
• Сервер должен ответить: "Да, можно" (через заголовки)

Сервер должен добавить заголовки:
Access-Control-Allow-Origin: https://mysite.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type, Authorization

⚠️ Access-Control-Allow-Origin: * — только для публичных API!
   Для приватных API — указывай конкретные домены.

⚠️ CORS НЕ защищает API от curl/Postman!
   Это только браузерная защита.
```

---

### Ошибка 4: Путаница между 401 и 403

**СИМПТОМ:**
```
"Пользователь видит 403, но он точно залогинен!"
"Возвращаю 401, но пользователь уже отправил токен"
```

**РЕШЕНИЕ:**
```
401 Unauthorized = "КТО ТЫ?"
├─ Нет токена/credentials вообще
├─ Токен невалидный/истёк
└─ Действие: покажи форму логина

403 Forbidden = "ЗНАЮ КТО ТЫ, НО НЕЛЬЗЯ"
├─ Пользователь аутентифицирован
├─ Но нет прав на этот ресурс
└─ Действие: покажи "Нет доступа" (не форму логина!)

ПРИМЕРЫ:

Запрос без токена к /admin       → 401 (кто ты?)
Обычный юзер с токеном к /admin  → 403 (ты не админ)
Админ с токеном к /admin         → 200 (добро пожаловать)

Истёкший токен                   → 401 (перелогинься)
Токен другого пользователя       → 401 (это не твой токен)
Свой токен, но нет прав          → 403 (прав нет)
```

---

### Ошибка 5: Не обрабатываю сетевые ошибки

**СИМПТОМ:**
```javascript
// Код, который "работает" только при идеальной сети:
const data = await fetch('/api/users').then(r => r.json());
// Что если:
// • Нет интернета?
// • Сервер не отвечает?
// • Timeout?
// • Ответ не JSON?
```

**РЕШЕНИЕ:**
```javascript
async function fetchWithRetry(url, options = {}, retries = 3) {
  const controller = new AbortController();
  const timeout = setTimeout(() => controller.abort(), 10000); // 10s timeout

  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal
    });

    clearTimeout(timeout);

    // Проверяем HTTP статус
    if (!response.ok) {
      if (response.status === 401) {
        // Редирект на логин или обновление токена
        throw new AuthError('Требуется авторизация');
      }
      if (response.status >= 500 && retries > 0) {
        // Retry при 5xx ошибках
        await sleep(1000);
        return fetchWithRetry(url, options, retries - 1);
      }
      throw new HttpError(response.status, await response.text());
    }

    // Проверяем Content-Type перед парсингом
    const contentType = response.headers.get('content-type');
    if (contentType?.includes('application/json')) {
      return response.json();
    }
    return response.text();

  } catch (error) {
    clearTimeout(timeout);

    if (error.name === 'AbortError') {
      throw new TimeoutError('Запрос превысил timeout');
    }
    if (!navigator.onLine) {
      throw new NetworkError('Нет подключения к интернету');
    }
    throw error;
  }
}
```

---

### Ошибка 6: Доверяю размеру timeout по умолчанию

**СИМПТОМ:**
```
Запрос "висит" 2 минуты, потом падает
Пользователь давно ушёл, а запрос всё ещё ждёт
В мобильном приложении — ANR (Application Not Responding)
```

**РЕШЕНИЕ:**
```
ПРАВИЛО: Всегда устанавливай явные timeouts

┌─────────────────────────────────────────────────────────────────┐
│                    РЕКОМЕНДУЕМЫЕ TIMEOUTS                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Connection timeout:  5-10 секунд                              │
│   └─ Сколько ждать установки соединения                         │
│                                                                 │
│   Read timeout:  30 секунд (обычный API)                        │
│                  60-120 секунд (загрузка файлов)                │
│   └─ Сколько ждать ответа после соединения                      │
│                                                                 │
│   Total timeout: connection + read + buffer                     │
│   └─ Общее время на весь запрос                                 │
│                                                                 │
│   МОБИЛЬНЫЕ ПРИЛОЖЕНИЯ:                                         │
│   • 3G/медленная сеть: увеличь timeouts                         │
│   • Критичные запросы: показывай прогресс                       │
│   • Фоновые запросы: можно больше timeouts                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

// OkHttp (Android/JVM)
val client = OkHttpClient.Builder()
    .connectTimeout(10, TimeUnit.SECONDS)
    .readTimeout(30, TimeUnit.SECONDS)
    .writeTimeout(30, TimeUnit.SECONDS)
    .build()

// URLSession (iOS)
let config = URLSessionConfiguration.default
config.timeoutIntervalForRequest = 30
config.timeoutIntervalForResource = 60
```

---

## Часть 3: Ментальные модели

### 5 способов думать о сетях

---

### Модель 1: Сеть как конвейер с этапами

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    ЗАПРОС = ТОВАР НА КОНВЕЙЕРЕ                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Твой код                                                                  │
│      │                                                                      │
│      ▼                                                                      │
│   ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐             │
│   │   DNS    │───►│   TCP    │───►│   TLS    │───►│   HTTP   │──► Сервер   │
│   │ Резолвер │    │ Сокет    │    │ Шифрован.│    │ Запрос   │             │
│   └──────────┘    └──────────┘    └──────────┘    └──────────┘             │
│       20ms           50ms            30ms            10ms                   │
│                                                                             │
│   TOTAL: ~110ms минимум до отправки запроса!                                │
│                                                                             │
│   КАК ОПТИМИЗИРОВАТЬ:                                                       │
│   • DNS prefetch (браузер заранее резолвит домены)                          │
│   • Connection pooling (переиспользуем TCP соединения)                      │
│   • HTTP/2 (одно соединение, много запросов)                                │
│   • TLS session resumption (пропускаем часть handshake)                     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Модель 2: Матрёшка инкапсуляции

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      ДАННЫЕ = МАТРЁШКА                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   При ОТПРАВКЕ — заворачиваем:                                              │
│                                                                             │
│   Твои данные: {"user": "John"}                                             │
│                    │                                                        │
│                    ▼                                                        │
│   ┌─────────────────────────────────────────────────────────────────┐       │
│   │ HTTP: POST /api Host:... │ {"user": "John"}                     │       │
│   └─────────────────────────────────────────────────────────────────┘       │
│                    │                                                        │
│                    ▼                                                        │
│   ┌─────────────────────────────────────────────────────────────────┐       │
│   │ TLS: [зашифровано] │ HTTP + данные                              │       │
│   └─────────────────────────────────────────────────────────────────┘       │
│                    │                                                        │
│                    ▼                                                        │
│   ┌─────────────────────────────────────────────────────────────────┐       │
│   │ TCP: src:52431 dst:443 seq:1 │ TLS + HTTP + данные              │       │
│   └─────────────────────────────────────────────────────────────────┘       │
│                    │                                                        │
│                    ▼                                                        │
│   ┌─────────────────────────────────────────────────────────────────┐       │
│   │ IP: src:192.168.1.5 dst:93.184.216.34 │ TCP + TLS + HTTP + данные│      │
│   └─────────────────────────────────────────────────────────────────┘       │
│                    │                                                        │
│                    ▼                                                        │
│   ┌─────────────────────────────────────────────────────────────────┐       │
│   │ Ethernet: MAC src → MAC dst │ IP + TCP + TLS + HTTP + данные    │       │
│   └─────────────────────────────────────────────────────────────────┘       │
│                                                                             │
│   При ПОЛУЧЕНИИ — разворачиваем в обратном порядке!                         │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Модель 3: Bandwidth vs Latency — труба и расстояние

```
┌─────────────────────────────────────────────────────────────────────────────┐
│               BANDWIDTH = ТОЛЩИНА ТРУБЫ (сколько за раз)                    │
│               LATENCY = ДЛИНА ТРУБЫ (как быстро дойдёт)                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ВЫСОКИЙ BANDWIDTH, ВЫСОКАЯ LATENCY:                                       │
│   ═══════════════════════════════════════════════════════════              │
│                                                                             │
│   Грузовик с жёсткими дисками Москва → Владивосток                          │
│   • Bandwidth: 100 TB / рейс                                                │
│   • Latency: 7 дней                                                         │
│   • Хорошо для: бэкапы огромных данных                                      │
│   • Плохо для: видеозвонок                                                  │
│                                                                             │
│   ─────────────────────────────────────────────────────────────────────     │
│                                                                             │
│   НИЗКИЙ BANDWIDTH, НИЗКАЯ LATENCY:                                         │
│   ───────────────────────────────────────────────────────────               │
│                                                                             │
│   SMS-сообщение                                                             │
│   • Bandwidth: 160 байт / сообщение                                         │
│   • Latency: 1-2 секунды                                                    │
│   • Хорошо для: уведомления, алерты                                         │
│   • Плохо для: передача видео                                               │
│                                                                             │
│   ═════════════════════════════════════════════════════════════════════     │
│                                                                             │
│   ОПТИМАЛЬНЫЙ БАЛАНС:                                                       │
│   ═════════════════════════════════════════════════════════════════════     │
│                                                                             │
│   Оптоволокно                                                               │
│   • Bandwidth: 1 Gbps+                                                      │
│   • Latency: ~10-50ms (зависит от расстояния)                               │
│   • Хорошо для: почти всего                                                 │
│                                                                             │
│   ─────────────────────────────────────────────────────────────────────     │
│                                                                             │
│   ПРАВИЛО ДЛЯ РАЗРАБОТЧИКА:                                                 │
│   • Много мелких запросов → важна LATENCY (уменьшай RTT)                    │
│   • Большие файлы → важен BANDWIDTH (сжимай, chunked transfer)              │
│   • Интерактивные приложения → минимизируй LATENCY                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Модель 4: Запрос как путешествие с документами

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                  HTTP ЗАПРОС = ТУРИСТ В АЭРОПОРТУ                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ДОКУМЕНТЫ ТУРИСТА (HTTP Request):                                         │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────┐       │
│   │  ПАСПОРТ (обязательно):                                         │       │
│   │  • Host: api.example.com  ← куда летишь                         │       │
│   │  • Method: GET            ← зачем (туризм/бизнес)               │       │
│   │  • Path: /users           ← точный адрес                        │       │
│   ├─────────────────────────────────────────────────────────────────┤       │
│   │  ВИЗА (если нужна):                                             │       │
│   │  • Authorization: Bearer token  ← разрешение на въезд           │       │
│   │  • Cookie: session=abc          ← "я уже был тут раньше"        │       │
│   ├─────────────────────────────────────────────────────────────────┤       │
│   │  ДЕКЛАРАЦИЯ (что везёшь):                                       │       │
│   │  • Content-Type: application/json  ← тип багажа                 │       │
│   │  • Content-Length: 1234            ← вес багажа                 │       │
│   │  • Body: {...}                     ← сам багаж                  │       │
│   ├─────────────────────────────────────────────────────────────────┤       │
│   │  ПОЖЕЛАНИЯ:                                                     │       │
│   │  • Accept: application/json        ← "хочу ответ в JSON"        │       │
│   │  • Accept-Language: ru             ← "говорю по-русски"         │       │
│   │  • Accept-Encoding: gzip           ← "можно сжать"              │       │
│   └─────────────────────────────────────────────────────────────────┘       │
│                                                                             │
│   ОТВЕТ ПОГРАНИЧНИКА (HTTP Response):                                       │
│                                                                             │
│   200 OK          → "Добро пожаловать!"                                     │
│   301 Redirect    → "Страна переехала, лети туда"                           │
│   400 Bad Request → "Документы заполнены неправильно"                       │
│   401 Unauthorized→ "Где виза?"                                             │
│   403 Forbidden   → "Виза есть, но тебе сюда нельзя"                        │
│   404 Not Found   → "Такой страны не существует"                            │
│   429 Rate Limit  → "Слишком часто летаешь, подожди"                        │
│   500 Server Error→ "У нас пожар в аэропорту"                               │
│   503 Unavailable → "Аэропорт закрыт на ремонт"                             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Модель 5: Соединение как разговор с правилами

```
┌─────────────────────────────────────────────────────────────────────────────┐
│              СЕТЕВОЕ СОЕДИНЕНИЕ = ДЕЛОВОЙ РАЗГОВОР                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ЭТАП 1: ЗНАКОМСТВО (DNS + TCP Handshake)                                  │
│   ─────────────────────────────────────────                                 │
│   Ты: "Мне нужен телефон компании Google"           → DNS lookup            │
│   Справочная: "Вот номер: 142.250.74.46"                                    │
│                                                                             │
│   Ты: "Алло, это Google?"                           → SYN                   │
│   Google: "Да, слушаю"                              → SYN-ACK               │
│   Ты: "Отлично, хочу поговорить"                    → ACK                   │
│                                                                             │
│   ЭТАП 2: ПРОВЕРКА БЕЗОПАСНОСТИ (TLS Handshake)                             │
│   ─────────────────────────────────────────────                             │
│   Ты: "Давай говорить по секретному каналу"         → ClientHello           │
│   Google: "Ок, вот мой паспорт (сертификат)"        → ServerHello+Cert      │
│   Ты: "Паспорт настоящий, вот наш секретный код"    → Key Exchange          │
│   [Канал зашифрован]                                                        │
│                                                                             │
│   ЭТАП 3: ДЕЛОВОЙ РАЗГОВОР (HTTP Request/Response)                          │
│   ─────────────────────────────────────────────────                         │
│   Ты: "Покажи главную страницу" (GET /)              → Request              │
│   Google: "Вот она: <!DOCTYPE html>..."              → Response             │
│                                                                             │
│   Ты: "А ещё покажи картинку" (GET /logo.png)        → Request              │
│   Google: "Держи картинку"                           → Response             │
│                                                                             │
│   ЭТАП 4: ПРОЩАНИЕ (Connection close)                                       │
│   ─────────────────────────────────────                                     │
│   Ты: "Спасибо, пока"                               → FIN                   │
│   Google: "Пока"                                    → FIN-ACK               │
│                                                                             │
│   KEEP-ALIVE = "Не клади трубку, я ещё позвоню"                             │
│   └─ Экономит время на повторное "знакомство"                               │
│                                                                             │
│   HTTP/2 = "Один звонок, много вопросов параллельно"                        │
│   └─ Мультиплексирование запросов                                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Зачем разработчику понимать сети?

```
Сценарий: "API тормозит"

Без знания сетей:
├─ "Наверное, бэкенд медленный"
├─ Гуглим "API slow fix" 2 часа
└─ Случайно решаем (или нет)

С пониманием сетей:
├─ Открываем DevTools → Network tab
├─ Видим: TTFB (Time To First Byte) = 2 секунды
├─ Копаем: DNS resolution занимает 500ms
└─ Решение: DNS prefetch или смена резолвера
   Время: 15 минут
```

По данным Stack Overflow Survey 2024, способность диагностировать сетевые проблемы — один из ключевых навыков, отличающих senior-разработчиков.

---

## Что происходит когда ты набираешь URL

### Анатомия URL

```
https://www.example.com:443/products/phone?color=black#specs
│       │               │   │                │         │
Схема   Домен           Порт Путь            Query     Фрагмент
(протокол)              (опц.)               String    (клиент)
```

| Часть | Пример | Назначение |
|-------|--------|------------|
| **Схема** | `https://` | Протокол: HTTP, HTTPS, FTP |
| **Домен** | `www.example.com` | Человекочитаемый адрес сервера |
| **Порт** | `:443` | Какому приложению на сервере (по умолчанию: 80/443) |
| **Путь** | `/products/phone` | Какой ресурс на сервере |
| **Query** | `?color=black` | Параметры запроса |
| **Фрагмент** | `#specs` | Позиция на странице (не отправляется на сервер!) |

### 7 шагов от URL до страницы

```
┌─────────────────────────────────────────────────────────────────────┐
│  ТЫ: набираешь google.com и жмёшь Enter                             │
└─────────────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────────┐
│  1. ПАРСИНГ URL                                                     │
│  Браузер разбирает URL на компоненты                                │
│  Определяет протокол (HTTPS), домен (google.com), путь (/)          │
└─────────────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────────┐
│  2. DNS LOOKUP (20-120ms обычно)                                    │
│  "google.com" → "142.250.74.46"                                     │
│                                                                     │
│  Кэш браузера → Кэш ОС → Router → ISP DNS → Рекурсивный резолвер    │
│  → Root Server → TLD Server (.com) → Authoritative Server           │
└─────────────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────────┐
│  3. TCP HANDSHAKE (1 RTT = ~10-50ms)                                │
│                                                                     │
│  Клиент ──── SYN ────────►  Сервер                                  │
│  Клиент ◄─── SYN-ACK ─────  Сервер                                  │
│  Клиент ──── ACK ────────►  Сервер                                  │
│                                                                     │
│  "Установим надёжное соединение"                                    │
└─────────────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────────┐
│  4. TLS HANDSHAKE (1-2 RTT для TLS 1.3)                             │
│                                                                     │
│  Клиент ──── ClientHello ────────►  Сервер                          │
│  Клиент ◄─── ServerHello + Cert ──  Сервер                          │
│  Клиент ──── Finished ───────────►  Сервер                          │
│                                                                     │
│  "Договоримся о шифровании"                                         │
└─────────────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────────┐
│  5. HTTP REQUEST                                                    │
│                                                                     │
│  GET / HTTP/1.1                                                     │
│  Host: google.com                                                   │
│  User-Agent: Mozilla/5.0...                                         │
│  Accept: text/html                                                  │
│  Cookie: session=abc123                                             │
└─────────────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────────┐
│  6. SERVER RESPONSE                                                 │
│                                                                     │
│  HTTP/1.1 200 OK                                                    │
│  Content-Type: text/html; charset=utf-8                             │
│  Content-Length: 15234                                              │
│  Set-Cookie: tracking=xyz789                                        │
│                                                                     │
│  <!DOCTYPE html>...                                                 │
└─────────────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────────┐
│  7. RENDERING                                                       │
│  Браузер парсит HTML → строит DOM → применяет CSS → рендерит        │
│  Подгружает JS, изображения, шрифты (параллельно)                   │
└─────────────────────────────────────────────────────────────────────┘
```

**Источники:** [ByteByteGo](https://bytebytego.com/guides/what-happens-when-you-type-a-url-into-your-browser/), [AWS Blog](https://aws.amazon.com/blogs/mobile/what-happens-when-you-type-a-url-into-your-browser/)

---

## IP-адреса и порты

### IP-адрес: адрес дома

IP-адрес — это уникальный идентификатор устройства в сети. Как почтовый адрес для писем.

```
IPv4:  192.168.1.100     (32 бита, ~4.3 миллиарда адресов)
IPv6:  2001:0db8:85a3:0000:0000:8a2e:0370:7334  (128 бит)
```

**Специальные адреса:**
| Адрес | Значение |
|-------|----------|
| `127.0.0.1` | localhost — твой компьютер |
| `0.0.0.0` | Все интерфейсы (для сервера: слушать везде) |
| `192.168.x.x` | Локальная сеть (private) |
| `10.x.x.x` | Локальная сеть (private) |

### Порт: номер квартиры

IP-адрес определяет машину, порт — конкретное приложение на ней.

```
Аналогия:
IP-адрес = адрес здания
Порт = номер квартиры

192.168.1.100:80   → Веб-сервер в "квартире 80"
192.168.1.100:22   → SSH в "квартире 22"
192.168.1.100:5432 → PostgreSQL в "квартире 5432"
```

**Порт — 16-битное число (0-65535):**

| Диапазон | Название | Использование |
|----------|----------|---------------|
| 0-1023 | Well-known | Системные (HTTP: 80, HTTPS: 443, SSH: 22) |
| 1024-49151 | Registered | Приложения (PostgreSQL: 5432, Redis: 6379) |
| 49152-65535 | Dynamic | Временные (твой браузер получает случайный) |

**Важно:** TCP и UDP используют порты **независимо**. Можно иметь TCP:53 и UDP:53 одновременно (DNS так и работает).

---

## Сокеты: точка подключения

**Сокет = IP + Port + Protocol**

Это программный endpoint для сетевой коммуникации. Комбинация IP-адреса, порта и протокола создаёт уникальный идентификатор.

```
┌─────────────────────────────────────────────────────────────────────┐
│  ТВОЙ БРАУЗЕР               │              ВЕБ-СЕРВЕР               │
│                             │                                       │
│  Сокет:                     │              Сокет:                   │
│  192.168.1.100:52431 ────────────────────► 93.184.216.34:443       │
│  (твой IP : случайный порт) │              (сервер : HTTPS)        │
│                             │                                       │
│  Протокол: TCP              │              Протокол: TCP            │
└─────────────────────────────────────────────────────────────────────┘
```

**5-tuple** — уникальный идентификатор соединения:
1. Source IP
2. Source Port
3. Destination IP
4. Destination Port
5. Protocol (TCP/UDP)

**Источник:** [Baeldung: Port vs Socket](https://www.baeldung.com/cs/port-vs-socket)

---

## DNS: телефонная книга интернета

Люди запоминают имена (`google.com`), компьютеры работают с числами (`142.250.74.46`). DNS переводит одно в другое.

### Иерархия DNS (дерево)

```
                         . (root)
                         │
         ┌───────────────┼───────────────┐
         │               │               │
       .com            .org            .ru
         │               │               │
    ┌────┼────┐     ┌────┴────┐         │
    │    │    │     │         │         │
 google amazon     wiki     apache    yandex
```

### Процесс резолвинга

```
Твой компьютер: "Какой IP у google.com?"

1. Проверь кэш браузера         → Нет
2. Проверь кэш ОС               → Нет
3. Спроси роутер                → Нет
4. Спроси DNS провайдера (ISP)  → Нет, но я узнаю!

   ISP DNS → Root Server: "Где .com?"
   Root: "Спроси TLD сервер 192.5.6.30"

   ISP DNS → TLD (.com): "Где google.com?"
   TLD: "Спроси Authoritative 216.239.34.10"

   ISP DNS → Authoritative: "IP google.com?"
   Auth: "142.250.74.46, TTL=300 секунд"

5. Вернуть ответ и закэшировать
```

**TTL (Time To Live)** — сколько секунд можно хранить в кэше. После истечения — запрос заново.

**Типичное время DNS lookup:** 20-120ms (без кэша), <1ms (с кэшем).

**Источник:** [FreeCodeCamp: How DNS Works](https://www.freecodecamp.org/news/how-dns-works-the-internets-address-book/)

---

## TCP vs UDP: два способа доставки

### TCP: заказное письмо с уведомлением

**TCP (Transmission Control Protocol)** — надёжный, упорядоченный, с подтверждением.

```
Гарантии TCP:
✓ Данные дойдут (или узнаешь об ошибке)
✓ Данные придут в правильном порядке
✓ Дубликаты будут отброшены
✓ Получатель не захлебнётся (flow control)

Цена:
✗ Дополнительная задержка (handshake)
✗ Overhead на заголовки и подтверждения
✗ Head-of-line blocking
```

**Three-way handshake:**
```
Client ──── SYN ────────► Server    "Хочу подключиться"
Client ◄─── SYN-ACK ───── Server    "Ок, я тоже готов"
Client ──── ACK ────────► Server    "Отлично, начинаем"
```

### UDP: открытка без уведомления

**UDP (User Datagram Protocol)** — быстрый, без гарантий, "fire and forget".

```
Характеристики UDP:
✓ Минимальная задержка (нет handshake)
✓ Маленький overhead (8 байт заголовок vs 20+ у TCP)
✓ Поддержка broadcast/multicast

Нет гарантий:
✗ Пакет может потеряться
✗ Пакеты могут прийти в другом порядке
✗ Пакеты могут дублироваться
```

### Когда что использовать

| Сценарий | Протокол | Почему |
|----------|----------|--------|
| Веб-страницы (HTTP) | TCP | Нужна целостность данных |
| API запросы | TCP | Надёжность критична |
| DNS запросы | UDP* | Быстрые запрос-ответ |
| Видеозвонки | UDP | Лучше пропустить кадр, чем задержать |
| Онлайн-игры | UDP | Устаревшие данные бесполезны |
| Стриминг | UDP | Потеря кадра некритична |

*DNS использует UDP для обычных запросов, TCP для больших ответов (>512 байт).

**Источник:** [DEV.to: Beginner's Guide to Networking Protocols](https://dev.to/dev_ojay/a-beginners-guide-to-networking-protocols-tcp-udp-http-and-http3-3pp6)

---

## HTTP: язык общения браузера и сервера

### Структура HTTP запроса

```http
GET /api/users?limit=10 HTTP/1.1
Host: api.example.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)
Accept: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
Cookie: session=abc123
Content-Type: application/json

{"name": "John"}   ← тело запроса (для POST/PUT)
```

**Части запроса:**
1. **Request line:** Метод + Путь + Версия протокола
2. **Headers:** Метаданные (Host, Accept, Cookie, Authorization)
3. **Body:** Данные (для POST, PUT, PATCH)

### HTTP методы

| Метод | Назначение | Идемпотентный? | Тело? |
|-------|------------|----------------|-------|
| **GET** | Получить ресурс | Да | Нет |
| **POST** | Создать ресурс | Нет | Да |
| **PUT** | Заменить ресурс | Да | Да |
| **PATCH** | Частично обновить | Нет | Да |
| **DELETE** | Удалить ресурс | Да | Нет |
| **HEAD** | GET без тела | Да | Нет |
| **OPTIONS** | Узнать возможности | Да | Нет |

### HTTP Status Codes

```
1xx — Информационные (редко видишь)
2xx — Успех
3xx — Редирект
4xx — Ошибка клиента (твоя вина)
5xx — Ошибка сервера (их вина)
```

**Самые важные:**

| Код | Название | Когда |
|-----|----------|-------|
| **200** | OK | Всё хорошо |
| **201** | Created | Ресурс создан (POST) |
| **204** | No Content | Успех, но тела нет |
| **301** | Moved Permanently | Ресурс переехал навсегда |
| **302** | Found | Временный редирект |
| **400** | Bad Request | Неправильный запрос |
| **401** | Unauthorized | Нет аутентификации |
| **403** | Forbidden | Нет прав |
| **404** | Not Found | Ресурс не найден |
| **429** | Too Many Requests | Rate limit |
| **500** | Internal Server Error | Сервер сломался |
| **502** | Bad Gateway | Прокси не получил ответ от upstream |
| **503** | Service Unavailable | Сервис перегружен |
| **504** | Gateway Timeout | Upstream не ответил вовремя |

**Источник:** [BrowserStack: HTTP Request Lifecycle](https://www.browserstack.com/guide/http-request)

---

## Важные HTTP заголовки

### Заголовки запроса

| Заголовок | Пример | Зачем |
|-----------|--------|-------|
| `Host` | `api.example.com` | Какой сайт (для virtual hosting) |
| `User-Agent` | `Mozilla/5.0...` | Кто ты (браузер/версия) |
| `Accept` | `application/json` | Какой формат хочешь |
| `Authorization` | `Bearer token123` | Аутентификация |
| `Cookie` | `session=abc` | Сессия |
| `Content-Type` | `application/json` | Формат тела запроса |
| `Accept-Encoding` | `gzip, deflate` | Какое сжатие понимаешь |

### Заголовки ответа

| Заголовок | Пример | Зачем |
|-----------|--------|-------|
| `Content-Type` | `text/html; charset=utf-8` | Тип контента |
| `Content-Length` | `15234` | Размер тела |
| `Set-Cookie` | `session=xyz; HttpOnly` | Установить cookie |
| `Cache-Control` | `max-age=3600` | Правила кэширования |
| `Location` | `https://new.url/` | Куда редиректить (3xx) |
| `Access-Control-*` | `...` | CORS настройки |

---

## Browser DevTools: Network Tab

DevTools — твой лучший друг для отладки сети.

### Как открыть

- **Chrome/Edge:** `F12` или `Cmd+Option+I` → Network
- **Firefox:** `F12` → Network
- **Safari:** `Cmd+Option+I` → Network

### Что смотреть

```
┌─────────────────────────────────────────────────────────────────────┐
│ Name        Status   Type    Initiator   Size    Time   Waterfall  │
├─────────────────────────────────────────────────────────────────────┤
│ api/users   200      fetch   app.js:45   2.3KB   234ms  ████       │
│ styles.css  200      css     index.html  15KB    45ms   ██         │
│ logo.png    304      image   styles.css  0B      12ms   █          │
└─────────────────────────────────────────────────────────────────────┘
```

**Ключевые метрики при клике на запрос → Timing:**

| Метрика | Что означает |
|---------|--------------|
| **Queueing** | Ожидание в очереди браузера |
| **DNS Lookup** | Резолвинг домена |
| **Initial Connection** | TCP handshake |
| **SSL** | TLS handshake |
| **TTFB** | Time To First Byte — время до первого байта ответа |
| **Content Download** | Скачивание тела ответа |

**Красные флаги:**
- TTFB > 500ms → проблема на сервере или сети
- DNS Lookup > 100ms → проблема DNS
- SSL > 100ms → возможна проблема с сертификатами

**Источник:** [Chrome DevTools Documentation](https://developer.chrome.com/docs/devtools/network)

---

## Базовые команды для диагностики

### ping — "сервер жив?"

```bash
$ ping google.com
PING google.com (142.250.74.46): 56 data bytes
64 bytes from 142.250.74.46: icmp_seq=0 ttl=117 time=14.2 ms
64 bytes from 142.250.74.46: icmp_seq=1 ttl=117 time=13.8 ms
```

**Что показывает:** Время round-trip (туда-обратно) в миллисекундах.

### dig — "какой IP у домена?"

```bash
$ dig google.com
;; ANSWER SECTION:
google.com.     233     IN      A       142.250.74.46
```

**Альтернатива:** `nslookup google.com`

### curl — "что отвечает сервер?"

```bash
$ curl -v https://api.example.com/health
*   Trying 93.184.216.34:443...
* Connected to api.example.com
* TLS handshake...
> GET /health HTTP/1.1
> Host: api.example.com
< HTTP/1.1 200 OK
< Content-Type: application/json
{"status": "ok"}
```

**Полезные флаги:**
- `-v` — verbose (показать всё)
- `-I` — только заголовки
- `-X POST` — метод POST
- `-d '{"key":"value"}'` — тело запроса
- `-H "Authorization: Bearer token"` — заголовок

### traceroute — "каким путём идут пакеты?"

```bash
$ traceroute google.com
 1  router.local (192.168.1.1)  1.234 ms
 2  isp-gw.net (10.0.0.1)  5.678 ms
 3  core-router.net (72.14.194.1)  12.345 ms
...
```

**Источник:** [Medium: Mastering Network Diagnostics](https://medium.com/@samiashafique/mastering-network-diagnostics-a-simple-guide-to-curl-traceroute-and-ping-8c8f315ebf67)

---

## Частые ошибки и что они значат

### Connection Refused

```
curl: (7) Failed to connect: Connection refused
```

**Что это:** Сервер достижим, но **ничего не слушает на порту**.

**Причины:**
- Приложение не запущено
- Приложение слушает другой порт
- Firewall с правилом REJECT

**Как проверить:**
```bash
# На сервере: что слушает порт 8080?
ss -tuln | grep 8080
# или
netstat -tuln | grep 8080
```

### Connection Timeout

```
curl: (28) Connection timed out after 30000 ms
```

**Что это:** Сервер **не отвечает вообще** — пакеты уходят в никуда.

**Причины:**
- Сервер выключен
- Firewall с правилом DROP (не REJECT)
- Неправильный IP
- Сетевая проблема на пути

**Как отличить от refused:** Timeout занимает много времени (30+ сек), refused — мгновенно.

### No Route to Host

```
curl: (7) Failed to connect: No route to host
```

**Что это:** **Сетевой уровень** — нет пути до хоста.

**Причины:**
- Неправильная маршрутизация
- Хост в другой подсети
- Firewall отвечает ICMP "host unreachable"

### DNS Resolution Failed

```
curl: (6) Could not resolve host: api.example.com
```

**Что это:** DNS не смог найти IP для домена.

**Причины:**
- Домен не существует
- DNS сервер недоступен
- Опечатка в домене

**Источник:** [Netgate Forum: Connection refused vs timeout](https://forum.netgate.com/topic/90710/connection-refused-vs-timeout)

---

## Частые заблуждения

### "TCP гарантирует доставку"

**Неточно.** TCP гарантирует, что **если** данные доставлены, они будут в правильном порядке и целые. Но TCP **не гарантирует** доставку при обрыве соединения. Приложение должно обрабатывать connection errors.

### "HTTPS шифрует всё"

**Частично.** HTTPS шифрует **содержимое** запроса (тело, заголовки, путь).

**Но НЕ скрывает:**
- IP-адреса клиента и сервера
- Размер передаваемых данных
- Домен (в SNI до TLS 1.3 с ECH)
- Тайминги

### "localhost и 127.0.0.1 — одно и то же"

**Почти.** `localhost` резолвится в `127.0.0.1` (IPv4) или `::1` (IPv6). Но некоторые приложения проверяют строку "localhost" отдельно.

### "Порт 80 только для HTTP"

**Конвенция, не правило.** Технически на порту 80 можно запустить что угодно. Но firewalls и proxies ожидают HTTP и могут блокировать другое.

---

## Чеклист: первые шаги при проблемах

```
□ 1. Проверь URL — нет ли опечатки?

□ 2. ping <hostname>
   ├─ Работает? → Сервер достижим
   └─ Не работает? → Проблема сети или DNS

□ 3. dig <hostname>
   ├─ Есть IP? → DNS работает
   └─ Нет IP? → Проблема DNS

□ 4. curl -v <url>
   ├─ Connection refused → Порт закрыт/сервис не запущен
   ├─ Timeout → Firewall DROP или сервер мёртв
   └─ HTTP error → Смотри код ошибки

□ 5. Проверь DevTools → Network Tab
   ├─ Какой статус?
   ├─ Какой TTFB?
   └─ Есть ли CORS ошибки?
```

---

## Куда дальше

### Углубить понимание

**Если только начинаешь:**
→ [[network-debugging-basics]] — систематический подход к диагностике
→ [[network-tools-reference]] — все инструменты в одном месте

**Если хочешь понять глубже:**
→ [[network-transport-layer]] — TCP, UDP, QUIC под капотом
→ [[network-dns-tls]] — DNS и TLS детально
→ [[network-http-evolution]] — HTTP/1.1 → HTTP/2 → HTTP/3

**Если хочешь практические навыки:**
→ [[network-tcpdump-wireshark]] — анализ пакетов
→ [[network-troubleshooting-advanced]] — сложные кейсы

---

## Источники

| # | Источник | Тип | Вклад |
|---|----------|-----|-------|
| 1 | [ByteByteGo: What happens when you type a URL](https://bytebytego.com/guides/what-happens-when-you-type-a-url-into-your-browser/) | Guide | Основная структура |
| 2 | [AWS Blog: URL lifecycle](https://aws.amazon.com/blogs/mobile/what-happens-when-you-type-a-url-into-your-browser/) | Official | Детали DNS, TCP |
| 3 | [Chrome DevTools: Network](https://developer.chrome.com/docs/devtools/network) | Official | DevTools reference |
| 4 | [FreeCodeCamp: How DNS Works](https://www.freecodecamp.org/news/how-dns-works-the-internets-address-book/) | Tutorial | DNS объяснение |
| 5 | [Baeldung: Port vs Socket](https://www.baeldung.com/cs/port-vs-socket) | Technical | Порты и сокеты |
| 6 | [DEV.to: Networking Protocols](https://dev.to/dev_ojay/a-beginners-guide-to-networking-protocols-tcp-udp-http-and-http3-3pp6) | Tutorial | TCP vs UDP |
| 7 | [Medium: Network Diagnostics](https://medium.com/@samiashafique/mastering-network-diagnostics-a-simple-guide-to-curl-traceroute-and-ping-8c8f315ebf67) | Guide | CLI инструменты |
| 8 | [BrowserStack: HTTP Request](https://www.browserstack.com/guide/http-request) | Reference | HTTP lifecycle |

---

*Последнее обновление: 2026-01-09 — Добавлены педагогические секции: 5 аналогий (HTTP-ресторан, DNS-контакты, TCP/UDP, порты-квартиры, HTTPS-шифрование), 6 типичных ошибок разработчиков с решениями, 5 ментальных моделей*
*Источников использовано: 20+*
