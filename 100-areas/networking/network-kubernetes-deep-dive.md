---
title: "Kubernetes Networking Deep Dive"
created: 2025-01-15
modified: 2025-01-15
tags:
  - topic/networking
  - kubernetes
  - k8s
  - cni
  - service-mesh
  - topic/devops
  - type/deep-dive
  - level/advanced
related:
  - [network-docker-deep-dive]]
  - "[[network-cloud-modern]]"
  - "[[network-observability]"
status: published
---

# Kubernetes Networking Deep Dive

---

## Prerequisites

| Ğ¢ĞµĞ¼Ğ° | Ğ—Ğ°Ñ‡ĞµĞ¼ Ğ½ÑƒĞ¶Ğ½Ğ¾ | Ğ“Ğ´Ğµ Ğ¸Ğ·ÑƒÑ‡Ğ¸Ñ‚ÑŒ |
|------|-------------|-------------|
| **Docker networking** | K8s Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹ | [[network-docker-deep-dive]] |
| **IP-Ğ°Ğ´Ñ€ĞµÑĞ°Ñ†Ğ¸Ñ** | Pod IP, Service CIDR | [[network-ip-routing]] |
| **Kubernetes basics** | Pods, Services, Deployments | K8s getting started |

### Ğ”Ğ»Ñ ĞºĞ¾Ğ³Ğ¾ ÑÑ‚Ğ¾Ñ‚ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»

| Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ | ĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚? | Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ |
|---------|-----------|--------------|
| **ĞĞ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº** | âš ï¸ Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° basics | K8s fundamentals |
| **Intermediate** | âœ… Ğ”Ğ° | ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ |
| **Advanced** | âœ… Ğ”Ğ° | CNI, Network Policies |

### Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¸Ñ‡ĞºĞ¾Ğ²

> ğŸ’¡ **K8s Networking** = ĞºĞ°Ğº Pods Ğ½Ğ°Ñ…Ğ¾Ğ´ÑÑ‚ Ğ´Ñ€ÑƒĞ³ Ğ´Ñ€ÑƒĞ³Ğ° Ğ¸ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ Ğ¼Ğ¸Ñ€. Ğ’ K8s Ğ½ĞµÑ‚ NAT Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾Ğ´Ğ°Ğ¼Ğ¸ â€” ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Pod Ğ¸Ğ¼ĞµĞµÑ‚ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ IP.

| Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ | ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¸Ñ‡ĞºĞ° |
|--------|----------|---------------------|
| **Pod IP** | Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ IP Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Pod | **ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ½Ğ¾Ğ¼ĞµÑ€ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ°** â€” Ğ·Ğ²Ğ¾Ğ½Ğ¸ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ |
| **Service** | Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ IP Ğ´Ğ»Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ Pods | **ĞĞ¾Ğ¼ĞµÑ€ Ğ¾Ñ‚Ğ´ĞµĞ»Ğ°** â€” Ğ½Ğµ Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ ÑĞ¼ĞµĞ½Ğµ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ¾Ğ² |
| **ClusterIP** | Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğ¹ IP ÑĞµÑ€Ğ²Ğ¸ÑĞ° | **Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğ¹ Ğ½Ğ¾Ğ¼ĞµÑ€** â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ¾Ğ² |
| **NodePort** | ĞŸĞ¾Ñ€Ñ‚ Ğ½Ğ° Ğ²ÑĞµÑ… Ğ½Ğ¾Ğ´Ğ°Ñ… | **ĞĞ±Ñ‰Ğ¸Ğ¹ Ğ²Ñ…Ğ¾Ğ´** â€” Ñ Ğ»ÑĞ±Ğ¾Ğ³Ğ¾ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ñ‘ÑˆÑŒ |
| **LoadBalancer** | Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº | **Ğ ĞµÑĞµĞ¿ÑˆĞµĞ½** â€” Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ğ·Ğ²Ğ¾Ğ½ĞºĞ¸ |
| **Ingress** | HTTP/HTTPS Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ | **Ğ£Ğ¼Ğ½Ñ‹Ğ¹ ÑĞµĞºÑ€ĞµÑ‚Ğ°Ñ€ÑŒ** â€” Ğ¿Ğ¾ URL Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ |
| **CNI** | Container Network Interface | **Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ** â€” Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚ ÑĞ²ÑĞ·ÑŒ |
| **kube-proxy** | Ğ ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚ Services | **ĞĞ¢Ğ¡** â€” Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ·Ğ²Ğ¾Ğ½ĞºĞ¸ |
| **CoreDNS** | DNS Ğ´Ğ»Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² | **Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ°Ñ ÑĞ»ÑƒĞ¶Ğ±Ğ°** â€” Ğ¸Ğ¼Ñ â†’ IP |
| **Network Policy** | Ğ¤Ğ°Ğ¹Ñ€Ğ²Ğ¾Ğ» Ğ´Ğ»Ñ Pods | **ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°** â€” ĞºĞ¾Ğ³Ğ¾ Ğ¿ÑƒÑĞºĞ°Ñ‚ÑŒ |
| **Service Mesh** | Istio, Linkerd â€” ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ¾Ğ¼ | **Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ²Ğ¸Ğ´ĞµĞ¾Ğ½Ğ°Ğ±Ğ»ÑĞ´ĞµĞ½Ğ¸Ñ** â€” Ğ²ÑÑ‘ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ğ¸ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµÑ‚ |

---

## Ğ§Ğ°ÑÑ‚ÑŒ 1: Ğ˜Ğ½Ñ‚ÑƒĞ¸Ñ†Ğ¸Ñ Ğ±ĞµĞ· ĞºĞ¾Ğ´Ğ° â€” ĞšĞ°Ğº Ğ´ÑƒĞ¼Ğ°Ñ‚ÑŒ Ğ¾ Kubernetes networking

> **Ğ¦ĞµĞ»ÑŒ:** ĞŸĞ¾Ğ½ÑÑ‚ÑŒ, ĞºĞ°Ğº pods Ğ½Ğ°Ñ…Ğ¾Ğ´ÑÑ‚ Ğ´Ñ€ÑƒĞ³ Ğ´Ñ€ÑƒĞ³Ğ° Ğ¸ Ğ¾Ğ±Ñ‰Ğ°ÑÑ‚ÑÑ Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼ Ğ¼Ğ¸Ñ€Ğ¾Ğ¼, Ñ‡ĞµÑ€ĞµĞ· Ğ¼ĞµÑ‚Ğ°Ñ„Ğ¾Ñ€Ñ‹ Ğ¸Ğ· Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¶Ğ¸Ğ·Ğ½Ğ¸. K8s networking ÑĞ»Ğ¾Ğ¶Ğ½ĞµĞµ Docker â€” Ğ·Ğ´ĞµÑÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ°Ğ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ğ¸Ğ¹.

### ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ 1: Kubernetes cluster ĞºĞ°Ğº ĞºĞ¾Ñ€Ğ¿Ğ¾Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¾Ñ„Ğ¸Ñ

```
KUBERNETES CLUSTER = ĞšĞĞ ĞŸĞĞ ĞĞ¢Ğ˜Ğ’ĞĞ«Ğ™ ĞĞ¤Ğ˜Ğ¡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  PODS = Ğ¡ĞĞ¢Ğ Ğ£Ğ”ĞĞ˜ĞšĞ˜                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ğº Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ğ½Ğ¾Ğ¼ĞµÑ€ (Pod IP)                 â”‚
â”‚  â€¢ Ğ¡Ğ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ·Ğ²Ğ¾Ğ½Ğ¸Ñ‚ÑŒ Ğ´Ñ€ÑƒĞ³ Ğ´Ñ€ÑƒĞ³Ñƒ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ                 â”‚
â”‚  â€¢ Ğ¡Ğ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´ÑÑ‚ Ğ¸ ÑƒÑ…Ğ¾Ğ´ÑÑ‚ (pods ÑÑ„ĞµĞ¼ĞµÑ€Ğ½Ñ‹)                 â”‚
â”‚  â€¢ ĞĞ¾Ğ²Ñ‹Ğ¹ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ğº = Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ½Ğ¾Ğ¼ĞµÑ€ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ°                       â”‚
â”‚                                                                 â”‚
â”‚  SERVICES = ĞĞĞœĞ•Ğ Ğ ĞĞ¢Ğ”Ğ•Ğ›ĞĞ’                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ "ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ½Ğ¸ Ğ² Ğ±ÑƒÑ…Ğ³Ğ°Ğ»Ñ‚ĞµÑ€Ğ¸Ñ" (my-service.default.svc)             â”‚
â”‚  â€¢ ĞĞ¾Ğ¼ĞµÑ€ Ğ¾Ñ‚Ğ´ĞµĞ»Ğ° ĞĞ• Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ, Ğ´Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ¸ ÑƒÑ…Ğ¾Ğ´ÑÑ‚        â”‚
â”‚  â€¢ ĞĞ¢Ğ¡ (kube-proxy) Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ğ½Ğ° ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ°        â”‚
â”‚  â€¢ ĞĞµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ·Ğ½Ğ°Ñ‚ÑŒ Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ° â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ¾Ğ¼ĞµÑ€ Ğ¾Ñ‚Ğ´ĞµĞ»Ğ°           â”‚
â”‚                                                                 â”‚
â”‚  CNI = Ğ¢Ğ•Ğ›Ğ•Ğ¤ĞĞĞĞĞ¯ ĞšĞĞœĞŸĞĞĞ˜Ğ¯                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ ĞŸÑ€Ğ¾ĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ° (Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ ÑĞµÑ‚ÑŒ Ğ´Ğ»Ñ pods)             â”‚
â”‚  â€¢ Ğ’Ñ‹Ğ´Ğ°Ñ‘Ñ‚ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ° (IP Ñ‡ĞµÑ€ĞµĞ· IPAM)                                â”‚
â”‚  â€¢ Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹: Calico, Cilium, Flannel                   â”‚
â”‚  â€¢ ĞÑ‚ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ²ÑĞ·Ğ¸ Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸               â”‚
â”‚                                                                 â”‚
â”‚  COREDNS = Ğ¡ĞŸĞ ĞĞ’ĞĞ§ĞĞĞ¯ Ğ¡Ğ›Ğ£Ğ–Ğ‘Ğ                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ "ĞšĞ°ĞºĞ¾Ğ¹ Ğ½Ğ¾Ğ¼ĞµÑ€ Ñƒ Ğ±ÑƒÑ…Ğ³Ğ°Ğ»Ñ‚ĞµÑ€Ğ¸Ğ¸?" â†’ 10.96.0.15                    â”‚
â”‚  â€¢ Ğ—Ğ½Ğ°ĞµÑ‚ Ğ²ÑĞµ Ğ¾Ñ‚Ğ´ĞµĞ»Ñ‹ (Services) Ğ¸ Ğ¸Ñ… Ğ½Ğ¾Ğ¼ĞµÑ€Ğ°                      â”‚
â”‚  â€¢ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾ÑĞ²Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ½Ğ¾Ğ²Ñ‹Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²       â”‚
â”‚                                                                 â”‚
â”‚  NETWORK POLICY = ĞŸĞ ĞĞŸĞ£Ğ¡ĞšĞĞĞ¯ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ "Ğ‘ÑƒÑ…Ğ³Ğ°Ğ»Ñ‚ĞµÑ€Ğ¸Ñ Ğ¾Ğ±Ñ‰Ğ°ĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ HR Ğ¸ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¾Ğ¼"              â”‚
â”‚  â€¢ ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ’Ğ¡Ğ• Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ·Ğ²Ğ¾Ğ½Ğ¸Ñ‚ÑŒ Ğ’Ğ¡Ğ•Ğœ                          â”‚
â”‚  â€¢ ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ÑÑ‚ â€” ĞºÑ‚Ğ¾ Ñ ĞºĞµĞ¼ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ğ±Ñ‰Ğ°Ñ‚ÑŒÑÑ             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾:** Ğ’ K8s Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ·Ğ½Ğ°Ñ‚ÑŒ IP ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ pod â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ¸Ğ¼Ñ Service. Ğ­Ñ‚Ğ¾ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¾Ñ‚ Docker: Ğ°Ğ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ğ¸Ñ Service Ğ´ĞµĞ»Ğ°ĞµÑ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ¾Ğ¹ Ğº Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°Ğ¼ pods.

### ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ 2: Service ĞºĞ°Ğº Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµÑĞµĞ¿ÑˆĞµĞ½

```
SERVICE = Ğ’Ğ˜Ğ Ğ¢Ğ£ĞĞ›Ğ¬ĞĞ«Ğ™ Ğ Ğ•Ğ¡Ğ•ĞŸĞ¨Ğ•Ğ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚   ĞšĞ›Ğ˜Ğ•ĞĞ¢                        Ğ¡Ğ•Ğ Ğ’Ğ˜Ğ¡                PODS      â”‚
â”‚                                                                 â”‚
â”‚   "ĞœĞ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ°                   "Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    Ğ±ÑƒÑ…Ğ³Ğ°Ğ»Ñ‚ĞµÑ€Ğ¸Ñ"                 ÑĞ¾ĞµĞ´Ğ¸Ğ½Ñ"            â”‚ Pod 1  â”‚  â”‚
â”‚        â”‚                           â”‚                â”‚10.0.1.5â”‚  â”‚
â”‚        â”‚    my-service            â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚    10.96.0.15            â”‚                            â”‚
â”‚        â–¼         â”‚                â–¼                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ Pod 2  â”‚  â”‚
â”‚   â”‚                                             â”‚  â”‚10.0.1.6â”‚  â”‚
â”‚   â”‚   ClusterIP: 10.96.0.15                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   â”‚                                             â”‚              â”‚
â”‚   â”‚   kube-proxy ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚: ĞºĞ°ĞºĞ¸Ğµ pods ready?     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   Endpoints: 10.0.1.5, 10.0.1.6, 10.0.2.3   â”‚  â”‚ Pod 3  â”‚  â”‚
â”‚   â”‚                                             â”‚  â”‚10.0.2.3â”‚  â”‚
â”‚   â”‚   Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ â†’ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   â”‚                                             â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                 â”‚
â”‚   ClusterIP â€” Ğ’Ğ˜Ğ Ğ¢Ğ£ĞĞ›Ğ¬ĞĞ«Ğ™ IP:                                   â”‚
â”‚   â€¢ ĞĞµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ½Ğ° ÑĞµÑ‚ĞµĞ²Ñ‹Ñ… Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°Ñ…                        â”‚
â”‚   â€¢ Ğ–Ğ¸Ğ²Ñ‘Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² iptables/IPVS Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°Ñ…                       â”‚
â”‚   â€¢ kube-proxy Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ½Ğ¾Ğ´Ğµ Ğ·Ğ½Ğ°ĞµÑ‚: ClusterIP â†’ Pod IPs        â”‚
â”‚                                                                 â”‚
â”‚   ENDPOINT = "ĞšÑ‚Ğ¾ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ½Ğ° ÑĞ¼ĞµĞ½Ğµ?"                             â”‚
â”‚   â€¢ K8s ÑĞ»ĞµĞ´Ğ¸Ñ‚: Pod ready? â†’ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² endpoints               â”‚
â”‚   â€¢ Pod Ğ½Ğµ ready/deleted? â†’ ÑƒĞ±Ñ€Ğ°Ñ‚ÑŒ Ğ¸Ğ· endpoints                 â”‚
â”‚   â€¢ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ½Ğµ Ğ·Ğ°Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ â€” Service Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾:** ClusterIP â€” ÑÑ‚Ğ¾ Ğ¸Ğ»Ğ»ÑĞ·Ğ¸Ñ. Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ° Ñ ÑÑ‚Ğ¸Ğ¼ IP Ğ½ĞµÑ‚. kube-proxy Ğ¿ĞµÑ€ĞµÑ…Ğ²Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ°ĞºĞµÑ‚Ñ‹ Ğº ClusterIP Ğ¸ Ğ¿ĞµÑ€ĞµĞ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ½Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ pod IP.

### ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ 3: Ğ¢Ğ¸Ğ¿Ñ‹ Services ĞºĞ°Ğº ÑĞ¿Ğ¾ÑĞ¾Ğ±Ñ‹ ÑĞ²ÑĞ·Ğ¸ Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼ Ğ¼Ğ¸Ñ€Ğ¾Ğ¼

```
Ğ¢Ğ˜ĞŸĞ« SERVICES = Ğ£Ğ ĞĞ’ĞĞ˜ Ğ”ĞĞ¡Ğ¢Ğ£ĞŸĞ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  ğŸ“ ClusterIP = Ğ’ĞĞ£Ğ¢Ğ Ğ•ĞĞĞ˜Ğ™ ĞĞĞœĞ•Ğ                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ¾Ğ² Ğ¾Ñ„Ğ¸ÑĞ°                                 â”‚
â”‚  â€¢ Ğ˜Ğ·Ğ²Ğ½Ğµ Ğ½Ğµ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ½Ğ¸Ñ‚ÑŒ                                           â”‚
â”‚  â€¢ Ğ”Ğ»Ñ: backend â†’ database, service â†’ service                   â”‚
â”‚  â€¢ Ğ¡Ğ°Ğ¼Ñ‹Ğ¹ Ñ‡Ğ°ÑÑ‚Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)                              â”‚
â”‚                                                                 â”‚
â”‚  ğŸšª NodePort = Ğ’Ğ¥ĞĞ” Ğ¡ Ğ›Ğ®Ğ‘ĞĞ“Ğ Ğ­Ğ¢ĞĞ–Ğ                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ ĞĞ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ ÑÑ‚Ğ°Ğ¶Ğµ (Ğ½Ğ¾Ğ´Ğµ) Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ° Ğ´Ğ²ĞµÑ€ÑŒ 30000-32767             â”‚
â”‚  â€¢ Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ Ğ»ÑĞ±Ğ¾Ğ³Ğ¾ ÑÑ‚Ğ°Ğ¶Ğ° â€” Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ñ‘ÑˆÑŒ Ğ² Ğ½ÑƒĞ¶Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ´ĞµĞ»         â”‚
â”‚  â€¢ ĞœĞ¸Ğ½ÑƒÑ: Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ·Ğ½Ğ°Ñ‚ÑŒ Ğ°Ğ´Ñ€ĞµÑ ÑÑ‚Ğ°Ğ¶Ğ° (Node IP)                     â”‚
â”‚  â€¢ Ğ”Ğ»Ñ: dev/test, ĞºĞ¾Ğ³Ğ´Ğ° Ğ½ĞµÑ‚ LoadBalancer                        â”‚
â”‚                                                                 â”‚
â”‚  ğŸ¢ LoadBalancer = Ğ“Ğ›ĞĞ’ĞĞ«Ğ™ Ğ Ğ•Ğ¡Ğ•ĞŸĞ¨Ğ•Ğ                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ ĞĞ´Ğ¸Ğ½ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ Ğ°Ğ´Ñ€ĞµÑ Ğ´Ğ»Ñ Ğ²ÑĞµĞ³Ğ¾ Ğ¾Ñ„Ğ¸ÑĞ°                           â”‚
â”‚  â€¢ ĞĞ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ Ğ²Ñ‹Ğ´ĞµĞ»ÑĞµÑ‚ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ IP                     â”‚
â”‚  â€¢ Ğ¢Ñ€Ğ°Ñ„Ğ¸Ğº Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ÑÑ Ğ¿Ğ¾ ÑÑ‚Ğ°Ğ¶Ğ°Ğ¼ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸                â”‚
â”‚  â€¢ Ğ”Ğ»Ñ: production, Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ API                               â”‚
â”‚  â€¢ ĞœĞ¸Ğ½ÑƒÑ: ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ LB ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ´ĞµĞ½ĞµĞ³!                                â”‚
â”‚                                                                 â”‚
â”‚  ğŸ¯ Ingress = Ğ£ĞœĞĞ«Ğ™ Ğ¡Ğ•ĞšĞ Ğ•Ğ¢ĞĞ Ğ¬                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ ĞĞ´Ğ¸Ğ½ LB, Ğ¼Ğ½Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²                                      â”‚
â”‚  â€¢ "api.example.com â†’ Ğ¾Ñ‚Ğ´ĞµĞ» API"                                â”‚
â”‚  â€¢ "app.example.com â†’ Ğ¾Ñ‚Ğ´ĞµĞ» Frontend"                           â”‚
â”‚  â€¢ L7 routing: Ğ¿Ğ¾ URL, headers, host                            â”‚
â”‚  â€¢ Ğ”Ğ»Ñ: Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ¾ HTTP-ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² Ğ·Ğ° Ğ¾Ğ´Ğ½Ğ¸Ğ¼ IP                     â”‚
â”‚                                                                 â”‚
â”‚  ĞšĞĞ“Ğ”Ğ Ğ§Ğ¢Ğ Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞ¢Ğ¬:                                        â”‚
â”‚  ClusterIP  â†’ Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ñ (90% ÑĞ»ÑƒÑ‡Ğ°ĞµĞ²)             â”‚
â”‚  NodePort   â†’ dev/test Ğ±ĞµĞ· cloud LB                             â”‚
â”‚  LoadBalancer â†’ Ğ¾Ğ´Ğ¸Ğ½ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ                           â”‚
â”‚  Ingress    â†’ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ HTTP-ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² Ğ·Ğ° Ğ¾Ğ´Ğ½Ğ¸Ğ¼ IP (ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ)        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾:** ĞÑˆĞ¸Ğ±ĞºĞ° Ğ½Ğ¾Ğ²Ğ¸Ñ‡ĞºĞ° â€” ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ LoadBalancer Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ°. Ğ­Ñ‚Ğ¾ Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ¾. Ingress Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¸Ğ¼ĞµÑ‚ÑŒ Ğ¾Ğ´Ğ¸Ğ½ LB Ğ´Ğ»Ñ Ğ²ÑĞµÑ… HTTP-ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ².

### ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ 4: CNI ĞºĞ°Ğº Ğ¿Ğ¾Ğ´Ñ€ÑĞ´Ñ‡Ğ¸Ğº Ğ¿Ğ¾ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸ÑĞ¼

```
CNI = ĞŸĞĞ”Ğ Ğ¯Ğ”Ğ§Ğ˜Ğš, ĞŸĞ ĞĞšĞ›ĞĞ”Ğ«Ğ’ĞĞ®Ğ©Ğ˜Ğ™ Ğ¡Ğ•Ğ¢Ğ˜:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚   Kubernetes Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚: "ĞœĞ½Ğµ Ğ½ÑƒĞ¶ĞµĞ½ Pod Ñ ÑĞµÑ‚ÑŒÑ"                   â”‚
â”‚   CNI Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚: "Ğ¡Ğ´ĞµĞ»Ğ°Ñ!"                                       â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  kubelet ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Pod                                    â”‚   â”‚
â”‚   â”‚        â”‚                                                â”‚   â”‚
â”‚   â”‚        â–¼                                                â”‚   â”‚
â”‚   â”‚  kubelet Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ CNI: "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ ÑĞµÑ‚ÑŒ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Pod"     â”‚   â”‚
â”‚   â”‚        â”‚                                                â”‚   â”‚
â”‚   â”‚        â–¼                                                â”‚   â”‚
â”‚   â”‚  CNI:                                                   â”‚   â”‚
â”‚   â”‚  1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ network namespace                           â”‚   â”‚
â”‚   â”‚  2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ veth pair                                   â”‚   â”‚
â”‚   â”‚  3. Ğ’Ñ‹Ğ´ĞµĞ»ÑĞµÑ‚ IP (IPAM)                                  â”‚   â”‚
â”‚   â”‚  4. ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ routing                                 â”‚   â”‚
â”‚   â”‚        â”‚                                                â”‚   â”‚
â”‚   â”‚        â–¼                                                â”‚   â”‚
â”‚   â”‚  Pod Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ!                                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚   Ğ ĞĞ—ĞĞ«Ğ• ĞŸĞĞ”Ğ Ğ¯Ğ”Ğ§Ğ˜ĞšĞ˜ â€” Ğ ĞĞ—ĞĞ«Ğ• Ğ’ĞĞ—ĞœĞĞ–ĞĞĞ¡Ğ¢Ğ˜:                       â”‚
â”‚                                                                 â”‚
â”‚   FLANNEL = Ğ‘Ğ®Ğ”Ğ–Ğ•Ğ¢ĞĞ«Ğ™ ĞŸĞĞ”Ğ Ğ¯Ğ”Ğ§Ğ˜Ğš                                 â”‚
â”‚   â”œâ”€â”€ ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ overlay-ÑĞµÑ‚ÑŒ (VXLAN)                              â”‚
â”‚   â”œâ”€â”€ ĞĞµÑ‚ Network Policies                                      â”‚
â”‚   â””â”€â”€ Ğ”Ğ»Ñ: dev/test, Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ğµ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ñ‹                           â”‚
â”‚                                                                 â”‚
â”‚   CALICO = ĞšĞĞ ĞŸĞĞ ĞĞ¢Ğ˜Ğ’ĞĞ«Ğ™ ĞŸĞĞ”Ğ Ğ¯Ğ”Ğ§Ğ˜Ğš                              â”‚
â”‚   â”œâ”€â”€ BGP routing (Ğ±ĞµĞ· overlay)                                 â”‚
â”‚   â”œâ”€â”€ ĞœĞ¾Ñ‰Ğ½Ñ‹Ğµ Network Policies                                   â”‚
â”‚   â””â”€â”€ Ğ”Ğ»Ñ: production, security-focused                         â”‚
â”‚                                                                 â”‚
â”‚   CILIUM = Ğ˜ĞĞĞĞ’ĞĞ¦Ğ˜ĞĞĞĞ«Ğ™ ĞŸĞĞ”Ğ Ğ¯Ğ”Ğ§Ğ˜Ğš                              â”‚
â”‚   â”œâ”€â”€ eBPF Ğ²Ğ¼ĞµÑÑ‚Ğ¾ iptables (Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ)                            â”‚
â”‚   â”œâ”€â”€ L7 policies (HTTP, gRPC)                                  â”‚
â”‚   â”œâ”€â”€ Observability Ğ¸Ğ· ĞºĞ¾Ñ€Ğ¾Ğ±ĞºĞ¸ (Hubble)                         â”‚
â”‚   â””â”€â”€ Ğ”Ğ»Ñ: modern production, observability                     â”‚
â”‚                                                                 â”‚
â”‚   âš ï¸ Ğ’ĞĞ–ĞĞ: Ğ’Ñ‹Ğ±Ğ¾Ñ€ CNI â€” Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ¾Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ!                  â”‚
â”‚   ĞœĞµĞ½ÑÑ‚ÑŒ CNI Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‰ĞµĞ¼ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğµ â€” Ğ¾Ñ‡ĞµĞ½ÑŒ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾.              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾:** CNI â€” ÑÑ‚Ğ¾ Ğ½Ğµ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ "Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½ Ğ´Ğ»Ñ ÑĞµÑ‚Ğ¸". ĞÑ‚ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° CNI Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚: Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Network Policies, Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ, observability. Flannel ĞĞ• Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Network Policies!

### ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ 5: Network Policy ĞºĞ°Ğº Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°

```
NETWORK POLICY = ĞĞ¥Ğ ĞĞĞ Ğ˜ ĞŸĞ ĞĞŸĞ£Ğ¡ĞšĞ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚   Ğ‘Ğ•Ğ— NETWORK POLICY (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ):                            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚   Ğ’ÑĞµ Ğ´Ğ²ĞµÑ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹. Ğ›ÑĞ±Ğ¾Ğ¹ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ğ¹Ñ‚Ğ¸ ĞºÑƒĞ´Ğ° ÑƒĞ³Ğ¾Ğ´Ğ½Ğ¾.             â”‚
â”‚   Frontend â†’ Database? ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°!                              â”‚
â”‚   Random pod â†’ Production secrets? ĞšĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾!                     â”‚
â”‚                                                                 â”‚
â”‚   Ğ¡ DEFAULT DENY:                                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚   Ğ’ÑĞµ Ğ´Ğ²ĞµÑ€Ğ¸ Ğ·Ğ°Ğ¿ĞµÑ€Ñ‚Ñ‹. ĞĞ¸ĞºÑ‚Ğ¾ Ğ½Ğ¸ĞºÑƒĞ´Ğ° Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚.                     â”‚
â”‚   Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ñ‹Ğ´Ğ°Ñ‘Ğ¼ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ° Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğ¼.                         â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚                    NAMESPACE: production              â”‚      â”‚
â”‚   â”‚                                                      â”‚      â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚      â”‚
â”‚   â”‚  â”‚frontend â”‚ â”€â”€?â”€â”€â”‚ backend â”‚ â”€â”€?â”€â”€â”‚database â”‚       â”‚      â”‚
â”‚   â”‚  â”‚  app    â”‚      â”‚   api   â”‚      â”‚  mysql  â”‚       â”‚      â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚      â”‚
â”‚   â”‚       â”‚                â”‚                â”‚            â”‚      â”‚
â”‚   â”‚       â–¼                â–¼                â–¼            â”‚      â”‚
â”‚   â”‚   INGRESS          INGRESS          INGRESS          â”‚      â”‚
â”‚   â”‚   Policy:          Policy:          Policy:          â”‚      â”‚
â”‚   â”‚   from: ingress    from: frontend   from: backend    â”‚      â”‚
â”‚   â”‚   port: 80         port: 8080       port: 3306       â”‚      â”‚
â”‚   â”‚                                                      â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                 â”‚
â”‚   Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢:                                                    â”‚
â”‚   âœ“ ingress â†’ frontend:80      (Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¾)                      â”‚
â”‚   âœ“ frontend â†’ backend:8080    (Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¾)                      â”‚
â”‚   âœ“ backend â†’ database:3306    (Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¾)                      â”‚
â”‚   âœ— frontend â†’ database:3306   (Ğ—ĞĞ‘Ğ›ĞĞšĞ˜Ğ ĞĞ’ĞĞĞ!)                 â”‚
â”‚   âœ— random-pod â†’ anything      (Ğ—ĞĞ‘Ğ›ĞĞšĞ˜Ğ ĞĞ’ĞĞĞ!)                 â”‚
â”‚                                                                 â”‚
â”‚   âš ï¸ ĞĞ• Ğ—ĞĞ‘Ğ£Ğ”Ğ¬ DNS!                                             â”‚
â”‚   ĞŸÑ€Ğ¸ default deny â€” DNS Ñ‚Ğ¾Ğ¶Ğµ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!                     â”‚
â”‚   ĞÑƒĞ¶Ğ½Ğ¾ ÑĞ²Ğ½Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ¸Ñ‚ÑŒ egress Ğº kube-dns Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚ 53.            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾:** Network Policies â€” ÑÑ‚Ğ¾ Zero Trust Ğ² K8s. Ğ‘ĞµĞ· Ğ½Ğ¸Ñ… Ğ»ÑĞ±Ğ¾Ğ¹ ÑĞºĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ pod Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ°Ñ‚Ğ°ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑÑ‘ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ. Default deny + ÑĞ²Ğ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ = Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ.

---

## Ğ§Ğ°ÑÑ‚ÑŒ 2: ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ â€” Ğ¢Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ² Kubernetes networking

> **Ğ¦ĞµĞ»ÑŒ:** ĞĞ°ÑƒÑ‡Ğ¸Ñ‚ÑŒÑÑ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¸ Ğ¸Ğ·Ğ±ĞµĞ³Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ²ÑƒÑˆĞµĞº, Ğ² ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ÑÑ‚ Ğ´Ğ°Ğ¶Ğµ Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğµ K8s-Ğ¸Ğ½Ğ¶ĞµĞ½ĞµÑ€Ñ‹. Ğ¡ĞµÑ‚ĞµĞ²Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ğ² K8s â€” Ğ¾Ğ´Ğ½Ğ¸ Ğ¸Ğ· ÑĞ°Ğ¼Ñ‹Ñ… ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ¸.

### ĞÑˆĞ¸Ğ±ĞºĞ° 1: Network Policy Ğ±ĞµĞ· Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ DNS

**Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ:**
```bash
# ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¸ default deny
$ kubectl apply -f default-deny.yaml

# Pod Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ğ» Ñ€ĞµĞ·Ğ¾Ğ»Ğ²Ğ¸Ñ‚ÑŒ DNS!
$ kubectl exec my-pod -- nslookup my-service
;; connection timed out; no servers could be reached

"Ğ’ÑÑ‘ ÑĞ»Ğ¾Ğ¼Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾ÑĞ»Ğµ Network Policy!"
```

**Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•:**
```yaml
# Ğ’Ğ¡Ğ•Ğ“Ğ”Ğ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ°Ğ¹Ñ‚Ğµ DNS Ğ¿Ñ€Ğ¸ default deny!
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns
  namespace: production
spec:
  podSelector: {}  # Ğ’ÑĞµ pods Ğ² namespace
  policyTypes:
    - Egress
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: kube-system
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾:** ĞŸÑ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ NetworkPolicy Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼ Ğ´ĞµĞ»Ğ¾Ğ¼ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ Ğ´Ğ»Ñ DNS. Ğ‘ĞµĞ· DNS Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚.

### ĞÑˆĞ¸Ğ±ĞºĞ° 2: Flannel + NetworkPolicy = Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

**Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ:**
```bash
# ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¸ NetworkPolicy
$ kubectl apply -f deny-all.yaml
networkpolicy.networking.k8s.io/deny-all created

# ĞĞ¾ pods Ğ²ÑÑ‘ ĞµÑ‰Ñ‘ Ğ¾Ğ±Ñ‰Ğ°ÑÑ‚ÑÑ!
$ kubectl exec pod-a -- curl pod-b:8080
HTTP/1.1 200 OK

"NetworkPolicy Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚! Ğ‘Ğ°Ğ³ Ğ² Kubernetes!"
```

**Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•:**
```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ CNI
$ kubectl get pods -n kube-system | grep -E "flannel|calico|cilium"
kube-flannel-ds-xxxxx   1/1   Running

# Flannel ĞĞ• ĞŸĞĞ”Ğ”Ğ•Ğ Ğ–Ğ˜Ğ’ĞĞ•Ğ¢ NetworkPolicy!
# NetworkPolicy Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ, Ğ½Ğ¾ Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ.

# Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Calico Ğ¸Ğ»Ğ¸ Cilium
# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Calico Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… Flannel:
$ kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾:** ĞŸĞµÑ€ĞµĞ´ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ NetworkPolicy ÑƒĞ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ²Ğ°Ñˆ CNI Ğ¸Ñ… Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚. Flannel â€” ĞĞ• Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚.

### ĞÑˆĞ¸Ğ±ĞºĞ° 3: Service Ğ±ĞµĞ· endpoints

**Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ:**
```bash
$ kubectl get svc my-service
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)
my-service   ClusterIP   10.96.0.15     <none>        80/TCP

$ kubectl get endpoints my-service
NAME         ENDPOINTS
my-service   <none>  # â† ĞŸĞ£Ğ¡Ğ¢Ğ!

$ kubectl exec debug-pod -- curl my-service:80
# Connection refused Ğ¸Ğ»Ğ¸ timeout
```

**Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•:**
```bash
# Endpoints Ğ¿ÑƒÑÑ‚Ñ‹ = selector Ğ½Ğµ Ğ¼Ğ°Ñ‚Ñ‡Ğ¸Ñ‚ pods

# 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ selector ÑĞµÑ€Ğ²Ğ¸ÑĞ°
$ kubectl describe svc my-service | grep Selector
Selector: app=my-app

# 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ labels pods
$ kubectl get pods --show-labels
NAME       READY   STATUS    LABELS
my-pod-1   1/1     Running   app=myapp  # â† "myapp" != "my-app"!

# 3. Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ labels
$ kubectl label pod my-pod-1 app=my-app --overwrite

# Ğ˜Ğ»Ğ¸ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Service selector
$ kubectl patch svc my-service -p '{"spec":{"selector":{"app":"myapp"}}}'
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾:** `kubectl get endpoints` â€” Ğ¿ĞµÑ€Ğ²Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°Ñ… Ñ Service. ĞŸÑƒÑÑ‚Ñ‹Ğµ endpoints = selector Ğ½Ğµ Ğ¼Ğ°Ñ‚Ñ‡Ğ¸Ñ‚ Ğ¸Ğ»Ğ¸ pods Ğ½Ğµ Ready.

### ĞÑˆĞ¸Ğ±ĞºĞ° 4: Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ğ´Ğ¸Ğ½Ğ³ Pod IP Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Service DNS

**Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ:**
```python
# config.py
DATABASE_HOST = "10.0.1.5"  # IP ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ pod

# ĞŸĞ¾ÑĞ»Ğµ Ñ€ĞµÑÑ‚Ğ°Ñ€Ñ‚Ğ° pod:
$ kubectl get pods -o wide
NAME      IP
db-pod    10.0.2.8  # ĞĞ¾Ğ²Ñ‹Ğ¹ IP!

# ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ: "Connection refused to 10.0.1.5"
```

**Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•:**
```python
# ĞĞ˜ĞšĞĞ“Ğ”Ğ Ğ½Ğµ Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ´ÑŒÑ‚Ğµ Pod IP!

# ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Service DNS
DATABASE_HOST = "db-service"
# Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ğ¸Ğ¼Ñ:
DATABASE_HOST = "db-service.default.svc.cluster.local"

# Ğ”Ğ»Ñ StatefulSet:
# Headless Service + ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ pod:
DATABASE_HOST = "db-0.db-service.default.svc.cluster.local"
```

```yaml
# Service Ğ´Ğ»Ñ database
apiVersion: v1
kind: Service
metadata:
  name: db-service
spec:
  selector:
    app: database
  ports:
    - port: 5432
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾:** Pod IP ÑÑ„ĞµĞ¼ĞµÑ€Ğ½Ñ‹. Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Service DNS. Ğ”Ğ»Ñ StatefulSet Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Headless Service Ñ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·ÑƒĞµĞ¼Ñ‹Ğ¼Ğ¸ Ğ¸Ğ¼ĞµĞ½Ğ°Ğ¼Ğ¸.

### ĞÑˆĞ¸Ğ±ĞºĞ° 5: kube-proxy iptables mode Ğ¿Ñ€Ğ¸ 1000+ services

**Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ:**
```bash
# ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº ÑĞµÑ€Ğ²Ğ¸ÑÑƒ â€” 2-3 ÑĞµĞºÑƒĞ½Ğ´Ñ‹ latency
# ĞŸĞ¾ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ â€” Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾

# ĞĞ° Ğ½Ğ¾Ğ´Ğ°Ñ… Ğ²Ñ‹ÑĞ¾ĞºĞ°Ñ CPU load Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ÑÑ… Ğ² ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğµ
$ top -b -n1 | grep kube-proxy
kube-proxy   98% CPU  # â† Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ¶ĞµĞ½!

# Ğ’ Ğ»Ğ¾Ğ³Ğ°Ñ… kube-proxy:
"iptables-restore: slow"
"Syncing iptables rules took 5.2s"
```

**Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•:**
```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ¶Ğ¸Ğ¼ kube-proxy
$ kubectl get configmap kube-proxy -n kube-system -o yaml | grep mode
mode: ""  # Ğ¿ÑƒÑÑ‚Ğ¾Ğµ = iptables (default)

# ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ° IPVS
$ kubectl edit configmap kube-proxy -n kube-system
# Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ:
mode: "ipvs"

# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ kube-proxy
$ kubectl rollout restart daemonset kube-proxy -n kube-system

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ
$ kubectl logs -n kube-system -l k8s-app=kube-proxy | grep "Using"
Using ipvs Proxier.  # âœ“
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾:** ĞŸÑ€Ğ¸ > 500 services Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ğ¹Ñ‚ĞµÑÑŒ Ğ½Ğ° IPVS mode. iptables = O(n) lookup, IPVS = O(1).

### ĞÑˆĞ¸Ğ±ĞºĞ° 6: Ingress Ğ±ĞµĞ· Ingress Controller

**Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ:**
```bash
$ kubectl apply -f my-ingress.yaml
ingress.networking.k8s.io/my-ingress created

$ kubectl get ingress
NAME         CLASS    HOSTS           ADDRESS   PORTS
my-ingress   nginx    app.example.com           80  # â† ADDRESS Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹!

$ curl http://app.example.com
# Connection refused
```

**Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•:**
```bash
# Ingress â€” ÑÑ‚Ğ¾ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞœĞĞĞ˜Ğ¤Ğ•Ğ¡Ğ¢. ĞÑƒĞ¶ĞµĞ½ Controller!

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ingress Controller
$ kubectl get pods -n ingress-nginx
No resources found  # â† Controller Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½!

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ nginx-ingress
$ kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.0/deploy/static/provider/cloud/deploy.yaml

# Ğ¢ĞµĞ¿ĞµÑ€ÑŒ ADDRESS Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑÑ
$ kubectl get ingress
NAME         CLASS    HOSTS           ADDRESS        PORTS
my-ingress   nginx    app.example.com 203.0.113.50   80
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾:** Ingress resource Ğ±ĞµĞ· Ingress Controller â€” Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ñ‚ĞµĞºÑÑ‚ Ğ² etcd. Controller (nginx, traefik, etc.) Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½ÑƒÑ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ.

---

## Ğ§Ğ°ÑÑ‚ÑŒ 3: ĞœĞµĞ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ´Ğ»Ñ Kubernetes networking

> **Ğ¦ĞµĞ»ÑŒ:** Ğ¡Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¼Ñ‹ÑˆĞ»ĞµĞ½Ğ¸Ñ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ğ¸ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ.

### ĞœĞ¾Ğ´ĞµĞ»ÑŒ 1: "Ğ§ĞµÑ‚Ñ‹Ñ€Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸"

```
K8S NETWORKING = Ğ§Ğ•Ğ¢Ğ«Ğ Ğ• ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ«:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ 1: CONTAINER-TO-CONTAINER (Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Pod)                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚  POD (Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ network namespace)      â”‚                        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                        â”‚
â”‚  â”‚  â”‚Containerâ”‚â—„â”€â”€â”€â”€â–ºâ”‚Containerâ”‚       â”‚                        â”‚
â”‚  â”‚  â”‚   A     â”‚localhostâ”‚  B    â”‚       â”‚                        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚  Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: localhost â€” ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹ Ğ² Pod Ğ´ĞµĞ»ÑÑ‚ network namespace  â”‚
â”‚                                                                 â”‚
â”‚  Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ 2: POD-TO-POD (Ğ¼ĞµĞ¶Ğ´Ñƒ Pods)                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Pod A  â”‚â—„â”€â”€â”€â”€ ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ IP â”€â”€â”€â”€â–ºâ”‚  Pod B  â”‚                     â”‚
â”‚  â”‚10.0.1.5 â”‚     (Ğ±ĞµĞ· NAT!)     â”‚10.0.2.3 â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚  Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: CNI â€” ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ pod Ğ¸Ğ¼ĞµĞµÑ‚ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ routable IP         â”‚
â”‚                                                                 â”‚
â”‚  Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ 3: POD-TO-SERVICE (Ğº Ğ°Ğ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ğ¸Ğ¸)                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Pod    â”‚â”€â”€â”€â”€â–ºâ”‚   Service   â”‚â”€â”€â”€â”€â–ºâ”‚  Pod 1  â”‚              â”‚
â”‚  â”‚ Client  â”‚      â”‚ 10.96.0.15  â”‚      â”‚  Pod 2  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  Pod 3  â”‚              â”‚
â”‚  Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: kube-proxy â€” DNAT Ğ¾Ñ‚ ClusterIP Ğº Pod IP               â”‚
â”‚                                                                 â”‚
â”‚  Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ 4: EXTERNAL-TO-SERVICE (Ğ¸Ğ· Ğ²Ğ½ĞµÑˆĞ½ĞµĞ³Ğ¾ Ğ¼Ğ¸Ñ€Ğ°)              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Internet â”‚â”€â”€â”€â”€â–ºâ”‚LoadBalancerâ”‚â”€â”€â”€â”€â–ºâ”‚ Service â”‚               â”‚
â”‚  â”‚          â”‚     â”‚  / Ingress â”‚     â”‚         â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: NodePort / LoadBalancer / Ingress                     â”‚
â”‚                                                                 â”‚
â”‚  ĞĞ¢Ğ›ĞĞ”ĞšĞ: ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸ Ğ½Ğ° ĞºĞ°ĞºĞ¾Ğ¼ ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°!                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:** ĞŸÑ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğµ Ñ connectivity Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚Ğµ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ: containerâ†”container (localhost?), podâ†”pod (CNI?), podâ†”service (kube-proxy?), externalâ†”service (Ingress/LB?).

### ĞœĞ¾Ğ´ĞµĞ»ÑŒ 2: "Service â€” ÑÑ‚Ğ¾ iptables/IPVS Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°"

```
CLUSTERIP = Ğ’Ğ˜Ğ Ğ¢Ğ£ĞĞ›Ğ¬ĞĞĞ¯ ĞœĞĞ“Ğ˜Ğ¯:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚   ClusterIP 10.96.0.15 â€” Ğ­Ğ¢Ğ ĞĞ• Ğ Ğ•ĞĞ›Ğ¬ĞĞ«Ğ™ Ğ˜ĞĞ¢Ğ•Ğ Ğ¤Ğ•Ğ™Ğ¡!             â”‚
â”‚                                                                 â”‚
â”‚   $ ip addr | grep 10.96  # ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´Ñ‘Ñ‚ÑÑ                  â”‚
â”‚                                                                 â”‚
â”‚   Ğ­Ñ‚Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ Ğ² iptables/IPVS:                                  â”‚
â”‚                                                                 â”‚
â”‚   iptables mode:                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ -A KUBE-SERVICES -d 10.96.0.15/32 -p tcp --dport 80     â”‚   â”‚
â”‚   â”‚   -j KUBE-SVC-XXXX                                      â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â”‚ -A KUBE-SVC-XXXX -m statistic --mode random             â”‚   â”‚
â”‚   â”‚   --probability 0.333 -j KUBE-SEP-POD1                  â”‚   â”‚
â”‚   â”‚ -A KUBE-SVC-XXXX -m statistic --mode random             â”‚   â”‚
â”‚   â”‚   --probability 0.500 -j KUBE-SEP-POD2                  â”‚   â”‚
â”‚   â”‚ -A KUBE-SVC-XXXX -j KUBE-SEP-POD3                       â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â”‚ -A KUBE-SEP-POD1 -j DNAT --to-destination 10.0.1.5:8080 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚   IPVS mode:                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ $ ipvsadm -Ln                                           â”‚   â”‚
â”‚   â”‚ TCP  10.96.0.15:80 rr                                   â”‚   â”‚
â”‚   â”‚   -> 10.0.1.5:8080    Masq  1  0  0                     â”‚   â”‚
â”‚   â”‚   -> 10.0.1.6:8080    Masq  1  0  0                     â”‚   â”‚
â”‚   â”‚   -> 10.0.2.3:8080    Masq  1  0  0                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚   Ğ¡Ğ›Ğ•Ğ”Ğ¡Ğ¢Ğ’Ğ˜Ğ•:                                                    â”‚
â”‚   â€¢ ping ClusterIP â€” Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ (ICMP Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ)             â”‚
â”‚   â€¢ curl ClusterIP:port â€” Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ (DNAT Ğº pod)                 â”‚
â”‚   â€¢ ĞĞ¾ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ° Ñ ÑÑ‚Ğ¸Ğ¼ IP Ğ½ĞµÑ‚!                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:** Service Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ‡ĞµÑ€ĞµĞ· kube-proxy Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°. Ğ•ÑĞ»Ğ¸ Service Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ endpoints (pods ready?) Ğ¸ iptables/ipvs Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°.

### ĞœĞ¾Ğ´ĞµĞ»ÑŒ 3: "DNS Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ Ğ² K8s"

```
DNS Ğ Ğ•Ğ—ĞĞ›Ğ’Ğ˜ĞĞ“ Ğ’ KUBERNETES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚   Pod Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ: "my-service"                               â”‚
â”‚          â”‚                                                      â”‚
â”‚          â–¼                                                      â”‚
â”‚   /etc/resolv.conf Ğ² Pod:                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ nameserver 10.96.0.10  â† CoreDNS ClusterIP            â”‚     â”‚
â”‚   â”‚ search default.svc.cluster.local svc.cluster.local    â”‚     â”‚
â”‚   â”‚        cluster.local                                  â”‚     â”‚
â”‚   â”‚ ndots: 5                                              â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                                                      â”‚
â”‚          â–¼                                                      â”‚
â”‚   ĞŸĞĞ˜Ğ¡Ğš ĞŸĞ Ğ¦Ğ•ĞŸĞĞ§ĞšĞ• (search domains):                            â”‚
â”‚                                                                 â”‚
â”‚   1. my-service.default.svc.cluster.local  â† ĞĞĞ™Ğ”Ğ•ĞĞ! âœ“         â”‚
â”‚   2. my-service.svc.cluster.local                               â”‚
â”‚   3. my-service.cluster.local                                   â”‚
â”‚   4. my-service (external DNS)                                  â”‚
â”‚                                                                 â”‚
â”‚   DNS Ğ¤ĞĞ ĞœĞĞ¢Ğ«:                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Service:                                                â”‚   â”‚
â”‚   â”‚ my-service                         (Ğ² Ñ‚Ğ¾Ğ¼ Ğ¶Ğµ namespace) â”‚   â”‚
â”‚   â”‚ my-service.other-ns                (Ğ² Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼ namespace) â”‚   â”‚
â”‚   â”‚ my-service.other-ns.svc.cluster.local (FQDN)           â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â”‚ Pod (Ñ€ĞµĞ´ĞºĞ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾):                                      â”‚   â”‚
â”‚   â”‚ 10-0-1-5.default.pod.cluster.local                      â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â”‚ Headless Service (StatefulSet):                         â”‚   â”‚
â”‚   â”‚ pod-0.my-service.default.svc.cluster.local              â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚   ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ ndots:5                                              â”‚
â”‚   "google.com" Ğ¸Ğ¼ĞµĞµÑ‚ < 5 Ñ‚Ğ¾Ñ‡ĞµĞº â†’ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµÑ‚ search domains â”‚
â”‚   Ğ­Ñ‚Ğ¾ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾! Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ: FQDN Ñ Ñ‚Ğ¾Ñ‡ĞºĞ¾Ğ¹: "google.com."           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:** Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾Ğµ Ğ¸Ğ¼Ñ (my-service) Ğ² Ñ‚Ğ¾Ğ¼ Ğ¶Ğµ namespace, Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ğ¸Ğ¼Ñ (my-service.other-ns) Ğ´Ğ»Ñ cross-namespace. Ğ”Ğ»Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… Ğ´Ğ¾Ğ¼ĞµĞ½Ğ¾Ğ² â€” FQDN Ñ Ñ‚Ğ¾Ñ‡ĞºĞ¾Ğ¹.

### ĞœĞ¾Ğ´ĞµĞ»ÑŒ 4: "Ğ”ĞµÑ€ĞµĞ²Ğ¾ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°"

```
ĞšĞĞš ĞŸĞĞ›Ğ£Ğ§Ğ˜Ğ¢Ğ¬ Ğ”ĞĞ¡Ğ¢Ğ£ĞŸ Ğš Ğ¡Ğ•Ğ Ğ’Ğ˜Ğ¡Ğ£?
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚              ĞÑ‚ĞºÑƒĞ´Ğ° Ğ¸Ğ´Ñ‘Ñ‚ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº?                                â”‚
â”‚                    â”‚                                            â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚         â–¼                   â–¼                                   â”‚
â”‚   Ğ˜Ğ· ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ°         Ğ˜Ğ·Ğ²Ğ½Ğµ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ°                            â”‚
â”‚         â”‚                   â”‚                                   â”‚
â”‚         â–¼                   â–¼                                   â”‚
â”‚    ClusterIP          HTTP/HTTPS?                               â”‚
â”‚   (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)            â”‚                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â–¼                 â–¼                          â”‚
â”‚                   Ğ”Ğ°                ĞĞµÑ‚                         â”‚
â”‚                    â”‚                 â”‚                          â”‚
â”‚                    â–¼                 â–¼                          â”‚
â”‚               Ingress         ĞÑƒĞ¶ĞµĞ½ Ğ»Ğ¸ LB?                      â”‚
â”‚              (ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ)             â”‚                           â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                            â–¼                 â–¼                  â”‚
â”‚                      Cloud ĞµÑÑ‚ÑŒ?        ĞĞµÑ‚ cloud               â”‚
â”‚                            â”‚                 â”‚                  â”‚
â”‚                            â–¼                 â–¼                  â”‚
â”‚                      LoadBalancer       NodePort                â”‚
â”‚                                                                 â”‚
â”‚  ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ«:                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  backend â†’ database          â†’ ClusterIP                        â”‚
â”‚  frontend â†’ api              â†’ ClusterIP                        â”‚
â”‚  users â†’ web app (HTTP)      â†’ Ingress                          â”‚
â”‚  users â†’ TCP service         â†’ LoadBalancer                     â”‚
â”‚  dev testing                 â†’ NodePort                         â”‚
â”‚  gRPC service                â†’ LoadBalancer / Ingress (L7)      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:** 90% ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² â€” ClusterIP. Ingress Ğ´Ğ»Ñ HTTP. LoadBalancer Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ¾Ğ³Ğ´Ğ° Ingress Ğ½Ğµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ (TCP/UDP, ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ).

### ĞœĞ¾Ğ´ĞµĞ»ÑŒ 5: "Troubleshooting checklist"

```
Ğ”Ğ˜ĞĞ“ĞĞĞ¡Ğ¢Ğ˜ĞšĞ K8S NETWORKING â€” ĞŸĞĞ¨ĞĞ“ĞĞ’Ğ«Ğ™ Ğ§Ğ•ĞšĞ›Ğ˜Ğ¡Ğ¢:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  Ğ¨ĞĞ“ 1: PODS RUNNING?                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  $ kubectl get pods -o wide                                     â”‚
â”‚  â€¢ Ğ’ÑĞµ Ğ»Ğ¸ pods Ğ² Running?                                       â”‚
â”‚  â€¢ ĞĞ° ĞºĞ°ĞºĞ¸Ñ… Ğ½Ğ¾Ğ´Ğ°Ñ…? (cross-node networking?)                     â”‚
â”‚                                                                 â”‚
â”‚  Ğ¨ĞĞ“ 2: ENDPOINTS Ğ•Ğ¡Ğ¢Ğ¬?                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  $ kubectl get endpoints my-service                             â”‚
â”‚  â€¢ Endpoints Ğ¿ÑƒÑÑ‚Ñ‹Ğµ? â†’ selector Ğ½Ğµ Ğ¼Ğ°Ñ‚Ñ‡Ğ¸Ñ‚ Ğ¸Ğ»Ğ¸ pods Ğ½Ğµ Ready     â”‚
â”‚  â€¢ Endpoints ĞµÑÑ‚ÑŒ? â†’ Service Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚, Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ğ² Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼        â”‚
â”‚                                                                 â”‚
â”‚  Ğ¨ĞĞ“ 3: DNS Ğ ĞĞ‘ĞĞ¢ĞĞ•Ğ¢?                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  $ kubectl exec debug-pod -- nslookup my-service                â”‚
â”‚  â€¢ Timeout? â†’ CoreDNS Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ¶ĞµĞ½ Ğ¸Ğ»Ğ¸ NetworkPolicy Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚    â”‚
â”‚  â€¢ NXDOMAIN? â†’ Service Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ² Ñ‚Ğ¾Ğ¼ namespace     â”‚
â”‚                                                                 â”‚
â”‚  Ğ¨ĞĞ“ 4: CONNECTIVITY Ğ•Ğ¡Ğ¢Ğ¬?                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  $ kubectl exec debug-pod -- curl my-service:port               â”‚
â”‚  â€¢ Connection refused? â†’ Pod Ğ½Ğµ ÑĞ»ÑƒÑˆĞ°ĞµÑ‚ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ½Ğ° Ñ‚Ğ¾Ğ¼ Ğ¿Ğ¾Ñ€Ñ‚Ñƒ     â”‚
â”‚  â€¢ Timeout? â†’ NetworkPolicy Ğ¸Ğ»Ğ¸ CNI Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°                    â”‚
â”‚                                                                 â”‚
â”‚  Ğ¨ĞĞ“ 5: NETWORK POLICY?                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  $ kubectl get networkpolicy -n <namespace>                     â”‚
â”‚  â€¢ Ğ•ÑÑ‚ÑŒ deny policy? â†’ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ allow rules                    â”‚
â”‚  â€¢ CNI Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚? â†’ Flannel Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚!                 â”‚
â”‚                                                                 â”‚
â”‚  Ğ¨ĞĞ“ 6: Ğ“Ğ›Ğ£Ğ‘ĞĞšĞĞ¯ Ğ”Ğ˜ĞĞ“ĞĞĞ¡Ğ¢Ğ˜ĞšĞ                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  $ kubectl run debug --image=nicolaka/netshoot -it --rm -- bash â”‚
â”‚  â€¢ tcpdump -i any port <port>                                   â”‚
â”‚  â€¢ ip route                                                     â”‚
â”‚  â€¢ iptables -L -n -v                                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:** Ğ˜Ğ´Ğ¸Ñ‚Ğµ Ğ¿Ğ¾ ÑˆĞ°Ğ³Ğ°Ğ¼ ÑĞ²ĞµÑ€Ñ…Ñƒ Ğ²Ğ½Ğ¸Ğ·. 80% Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼ Ğ½Ğ°Ñ…Ğ¾Ğ´ÑÑ‚ÑÑ Ğ½Ğ° ÑˆĞ°Ğ³Ğ°Ñ… 1-3: pods Ğ½Ğµ Ready, endpoints Ğ¿ÑƒÑÑ‚Ñ‹Ğµ, DNS Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚.

---

## ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾

Kubernetes networking â€” Ğ¾Ğ´Ğ½Ğ° Ğ¸Ğ· ÑĞ°Ğ¼Ñ‹Ñ… ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… Ñ‚ĞµĞ¼ Ğ² cloud-native. ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚:

- **Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ** "pod Ğ½Ğµ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ ÑĞµÑ€Ğ²Ğ¸Ñ" Ğ·Ğ° Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹, Ğ° Ğ½Ğµ Ñ‡Ğ°ÑÑ‹
- **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** â€” Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ workloads Ñ‡ĞµÑ€ĞµĞ· Network Policies
- **Performance** â€” Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ CNI Ğ¸ kube-proxy mode
- **ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** â€” Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸ 1000+ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ñ…

### Ğ¢Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹

| Ğ¡Ğ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼ | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° |
|---------|------------------|
| Pod Ğ½Ğµ Ñ€ĞµĞ·Ğ¾Ğ»Ğ²Ğ¸Ñ‚ DNS | CoreDNS Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ¶ĞµĞ½ / NetworkPolicy Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ |
| Service Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ | kube-proxy Ğ½Ğµ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ» endpoints |
| Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ latency | Overlay network overhead / Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ CNI |
| Ingress 502 | Backend pods Ğ½Ğµ ready / NetworkPolicy |

---

## Kubernetes Networking Model

### Ğ§ĞµÑ‚Ñ‹Ñ€Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ€ĞµÑˆĞ°ĞµÑ‚ K8s

1. **Container-to-Container** â€” Ñ€ĞµÑˆĞµĞ½Ğ¾ Ñ‡ĞµÑ€ĞµĞ· Pod (Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ network namespace)
2. **Pod-to-Pod** â€” CNI plugin (ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ pod Ğ¸Ğ¼ĞµĞµÑ‚ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ IP)
3. **Pod-to-Service** â€” kube-proxy (iptables/IPVS)
4. **External-to-Service** â€” Ingress / LoadBalancer

### Ğ¤ÑƒĞ½Ğ´Ğ°Ğ¼ĞµĞ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°

> 1. ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Pod Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ **ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ IP**
> 2. Pods Ğ¾Ğ±Ñ‰Ğ°ÑÑ‚ÑÑ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ **Ğ±ĞµĞ· NAT**
> 3. Nodes Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¾Ğ±Ñ‰Ğ°Ñ‚ÑŒÑÑ Ñ Pods **Ğ±ĞµĞ· NAT**
> 4. IP ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Pod Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ñƒ ÑĞµĞ±Ñ = IP ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ²Ğ¸Ğ´ÑÑ‚ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Kubernetes Cluster                     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚   Node A    â”‚         â”‚   Node B    â”‚                     â”‚
â”‚  â”‚             â”‚         â”‚             â”‚                     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                     â”‚
â”‚  â”‚ â”‚  Pod 1  â”‚ â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â”‚  Pod 3  â”‚ â”‚                     â”‚
â”‚  â”‚ â”‚10.0.1.5 â”‚ â”‚  Direct â”‚ â”‚10.0.2.3 â”‚ â”‚                     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  (no NAT)â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚
â”‚  â”‚             â”‚         â”‚             â”‚                     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                     â”‚
â”‚  â”‚ â”‚  Pod 2  â”‚ â”‚         â”‚ â”‚  Pod 4  â”‚ â”‚                     â”‚
â”‚  â”‚ â”‚10.0.1.6 â”‚ â”‚         â”‚ â”‚10.0.2.4 â”‚ â”‚                     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Container Network Interface (CNI)

### ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ CNI, Ğ° Ğ½Ğµ Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ networking

**Kubernetes Ğ½Ğ°Ğ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾ Ğ½Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚ networking.** Ğ­Ñ‚Ğ¾ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ¾Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ: Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ ÑÑ€ĞµĞ´Ñ‹ Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ÑĞµÑ‚ĞµĞ²Ñ‹Ñ… Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹. AWS Ñ…Ğ¾Ñ‡ĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ VPC. On-prem Ñ…Ğ¾Ñ‡ĞµÑ‚ BGP. Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ñ…Ğ¾Ñ‚ÑÑ‚ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ñƒ.

**CNI â€” ÑÑ‚Ğ¾ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚:** "Ğ”Ğ°Ğ¹ Ğ¼Ğ½Ğµ network namespace, Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ñ ĞµĞ¼Ñƒ ÑĞµÑ‚ÑŒ". Kubernetes Ğ·Ğ½Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ğ¾Ñ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ, Ğ½Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸.

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ²Ğ°Ñ:**
- Ğ’Ñ‹Ğ±Ğ¾Ñ€ CNI Ğ²Ğ»Ğ¸ÑĞµÑ‚ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ, Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ, observability
- ĞĞµ Ğ²ÑĞµ CNI Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‚ NetworkPolicy
- ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ CNI â€” ÑĞ»Ğ¾Ğ¶Ğ½Ğ°Ñ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ

### ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ CNI

Kubernetes **Ğ½Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚** networking ÑĞ°Ğ¼. ĞĞ½ Ğ´ĞµĞ»ĞµĞ³Ğ¸Ñ€ÑƒĞµÑ‚ ÑÑ‚Ğ¾ **CNI plugin**.

```
kubelet ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Pod
        â†“
kubelet Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ CNI Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½
        â†“
CNI ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ network namespace
        â†“
CNI Ğ²Ñ‹Ğ´ĞµĞ»ÑĞµÑ‚ IP Ñ‡ĞµÑ€ĞµĞ· IPAM
        â†“
CNI ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ veth pair
        â†“
Pod Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ
```

### ĞŸĞ¾Ğ¿ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğµ CNI Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ñ‹

| CNI | ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ | ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ |
|-----|-------------|-------------------|
| **Flannel** | ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹, Ğ»ĞµĞ³ĞºĞ¾Ğ²ĞµÑĞ½Ñ‹Ğ¹ | Dev/test, Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğµ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ñ‹ |
| **Calico** | Network Policies, BGP, enterprise | Production, security-focused |
| **Cilium** | eBPF, L7 policies, observability | Modern production, eBPF-ready |
| **Weave** | Mesh networking, encryption | Multi-cloud, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ğ° |
| **AWS VPC CNI** | Native AWS networking | EKS production |

### Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (2024)

Benchmark Ğ½Ğ° 40Gbit ÑĞµÑ‚Ğ¸:

| CNI | Throughput | CPU Usage | Latency Overhead |
|-----|-----------|-----------|------------------|
| **Cilium** | 28.5 Gbps | ĞĞ¸Ğ·ĞºĞ¸Ğ¹ (10%) | +20-30% |
| **Calico** | 22.1 Gbps | Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ (25%) | +25-35% |
| **Flannel** | ~22 Gbps | ĞĞ¸Ğ·ĞºĞ¸Ğ¹ (10%) | +15-25% |

### Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸

- **ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ğ°:** Flannel
- **Production, security:** Calico
- **Modern, eBPF, observability:** Cilium

---

## Services Ğ¸ kube-proxy

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°, ĞºĞ¾Ñ‚Ğ¾Ñ€ÑƒÑ Ñ€ĞµÑˆĞ°ÑÑ‚ Services

**Pod IP ÑÑ„ĞµĞ¼ĞµÑ€Ğ½Ñ‹.** Pod ÑƒĞ¼ĞµÑ€ â†’ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ pod Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼ IP. ĞĞµĞ»ÑŒĞ·Ñ Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ´Ğ¸Ñ‚ÑŒ IP Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ°Ñ…. ĞÑƒĞ¶Ğ½Ğ° Ğ°Ğ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ğ¸Ñ â€” ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ´Ñ€ĞµÑ Ğ´Ğ»Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ pods.

**Service â€” ÑÑ‚Ğ¾ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ load balancer.** ĞĞ´Ğ¸Ğ½ IP (ClusterIP), Ğ·Ğ° ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¼ ÑĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ° pods. Kubernetes Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸:
- Ğ¡Ğ»ĞµĞ´Ğ¸Ñ‚ Ğ·Ğ° Ğ¿Ğ¾ÑĞ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼/Ğ¸ÑÑ‡ĞµĞ·Ğ½Ğ¾Ğ²ĞµĞ½Ğ¸ĞµĞ¼ pods (Ñ‡ĞµÑ€ĞµĞ· labels)
- ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ endpoints
- Ğ‘Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€ÑƒĞµÑ‚ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº Ğ¼ĞµĞ¶Ğ´Ñƒ pods

**kube-proxy â€” Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ğ¾Ğ¹ Ğ¼Ğ°Ğ³Ğ¸Ğ¸.** ĞĞ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ½Ğ¾Ğ´Ğµ kube-proxy Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° (iptables/IPVS), Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº Ğ½Ğ° ClusterIP Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°Ğ» Ğ½Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ pod IP.

### ClusterIP â€” Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Service

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  selector:
    app: my-app
  ports:
    - port: 80
      targetPort: 8080
  type: ClusterIP
```

Service Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ **Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ IP (VIP)** â€” Ğ¾Ğ½ Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ½Ğ° Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°Ñ…, Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² iptables/IPVS.

### kube-proxy modes

| Mode | ĞœĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ | Performance | ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ |
|------|----------|-------------|-------------------|
| **iptables** (default) | NAT rules | O(n) | < 1000 services |
| **IPVS** | Hash table | O(1) | > 1000 services |
| **nftables** (new) | Modern iptables | O(1) | Modern kernels |

### iptables mode

```bash
# ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Service rules
iptables -t nat -L KUBE-SERVICES -n

# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ chain Ğ´Ğ»Ñ service
# KUBE-SVC-XXX â†’ random selection â†’ KUBE-SEP-YYY (endpoint)
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞŸÑ€Ğ¸ 1000+ services traversal iptables chains Ğ·Ğ°Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ ÑĞµĞºÑƒĞ½Ğ´Ñ‹!

### IPVS mode

```bash
# Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ IPVS
# kube-proxy --proxy-mode=ipvs

# ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ IPVS Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»
ipvsadm -L -n

# ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ° IPVS:
# - O(1) lookup Ñ‡ĞµÑ€ĞµĞ· hash table
# - ĞœĞ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ¾ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¾Ğ² Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸
# - Ğ›ÑƒÑ‡ÑˆĞµ Ğ´Ğ»Ñ > 1000 services
```

**Load balancing Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ñ‹ IPVS:**
- `rr` â€” Round Robin
- `lc` â€” Least Connections
- `sh` â€” Source Hashing
- `sed` â€” Shortest Expected Delay

---

## DNS Ğ¸ CoreDNS

### ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ DNS Ğ² K8s

```
Pod Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ: my-service.default.svc.cluster.local
        â†“
/etc/resolv.conf â†’ nameserver 10.96.0.10 (CoreDNS ClusterIP)
        â†“
CoreDNS ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚ Ğ² K8s API â†’ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Service IP
        â†“
Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ClusterIP ÑĞµÑ€Ğ²Ğ¸ÑĞ°
```

### DNS Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹

| Ğ ĞµÑÑƒÑ€Ñ | DNS Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ |
|--------|-----------|
| Service | `<service>.<namespace>.svc.cluster.local` |
| Pod | `<pod-ip-dashed>.<namespace>.pod.cluster.local` |
| Headless Service | `<pod-name>.<service>.<namespace>.svc.cluster.local` |

### CoreDNS ConfigMap

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: coredns
  namespace: kube-system
data:
  Corefile: |
    .:53 {
        errors
        health
        kubernetes cluster.local in-addr.arpa ip6.arpa {
           pods insecure
           fallthrough in-addr.arpa ip6.arpa
        }
        forward . /etc/resolv.conf
        cache 30
        loop
        reload
        loadbalance
    }
```

### Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

```yaml
# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Corefile
log    # Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑĞµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
```

```bash
# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº CoreDNS
kubectl -n kube-system rollout restart deployment coredns
```

### Troubleshooting DNS

```bash
# 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ CoreDNS pods
kubectl get pods -n kube-system -l k8s-app=kube-dns

# 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸
kubectl logs -n kube-system -l k8s-app=kube-dns

# 3. Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ pod Ğ´Ğ»Ñ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ¸
kubectl run -it --rm debug --image=nicolaka/netshoot -- \
    nslookup kubernetes.default

# 4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ DNS Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ pod
kubectl exec my-pod -- nslookup my-service

# 5. CPU CoreDNS (Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ·ĞºĞ°?)
kubectl top pods -n kube-system -l k8s-app=kube-dns
```

---

## Network Policies

### Ğ—Ğ°Ñ‡ĞµĞ¼ Ğ½ÑƒĞ¶Ğ½Ñ‹

> ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ K8s **Ğ½Ğµ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµÑ‚** pods. Ğ›ÑĞ±Ğ¾Ğ¹ pod Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ğ±Ñ‰Ğ°Ñ‚ÑŒÑÑ Ñ Ğ»ÑĞ±Ñ‹Ğ¼.

Network Policy â€” Ğ´ĞµĞºĞ»Ğ°Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ firewall Ğ´Ğ»Ñ pods.

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: Default Deny All

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-all
  namespace: production
spec:
  podSelector: {}  # Ğ’ÑĞµ pods Ğ² namespace
  policyTypes:
    - Ingress
    - Egress
```

ĞŸĞ¾ÑĞ»Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ â€” **Ğ²ĞµÑÑŒ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½**. Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğµ.

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: Ğ Ğ°Ğ·Ñ€ĞµÑˆĞ¸Ñ‚ÑŒ ingress Ğ¾Ñ‚ frontend Ğº backend

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-frontend-to-backend
  namespace: production
spec:
  podSelector:
    matchLabels:
      app: backend
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: frontend
      ports:
        - protocol: TCP
          port: 8080
```

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: Ğ Ğ°Ğ·Ñ€ĞµÑˆĞ¸Ñ‚ÑŒ DNS (Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾!)

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns
  namespace: production
spec:
  podSelector: {}
  policyTypes:
    - Egress
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: kube-system
        - podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
```

### Best Practices

1. **Default deny** â€” Ğ½Ğ°Ñ‡Ğ½Ğ¸ Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ²ÑĞµĞ³Ğ¾
2. **Allow minimum required** â€” Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°Ğ¹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğµ
3. **Ğ’ÑĞµĞ³Ğ´Ğ° Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ°Ğ¹ DNS** â€” Ğ¸Ğ½Ğ°Ñ‡Ğµ service discovery Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
4. **Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ labels** â€” Ğ½Ğµ IP Ğ°Ğ´Ñ€ĞµÑĞ° (pods ÑÑ„ĞµĞ¼ĞµÑ€Ğ½Ñ‹)
5. **Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞ¹ Ğ² staging** â€” NetworkPolicy Ğ¼Ğ¾Ğ¶ĞµÑ‚ "Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ" Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ

### CNI Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°

> **Flannel ĞĞ• Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚** NetworkPolicy!
> Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Calico, Cilium, Ğ¸Ğ»Ğ¸ Weave.

---

## Service Mesh

### Ğ§Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ¸ Ğ·Ğ°Ñ‡ĞµĞ¼

Service Mesh Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ L7 capabilities:
- **mTLS** Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸
- **Observability** â€” distributed tracing
- **Traffic management** â€” canary, A/B
- **Retries, timeouts** â€” circuit breaking

### Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ (2024)

| Mesh | ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° | Performance | Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ |
|------|-------------|-------------|-----------|
| **Linkerd** | Rust sidecar | Ğ›ÑƒÑ‡ÑˆĞ°Ñ (33% overhead) | ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ |
| **Istio** | Envoy sidecar | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ (166% mTLS overhead) | Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ |
| **Cilium Mesh** | eBPF (sidecarless) | Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ (no sidecar overhead) | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ |

### ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Service Mesh ĞµÑĞ»Ğ¸:**
- ĞÑƒĞ¶ĞµĞ½ mTLS Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸
- Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ observability Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ°
- Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ traffic patterns (canary, traffic splitting)

**ĞĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ĞµÑĞ»Ğ¸:**
- ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€ (< 20 ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²)
- ĞŸÑ€Ğ¾ÑÑ‚Ñ‹Ğµ stateless workloads
- ĞĞµÑ‚ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² Ğ½Ğ° Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½ÑƒÑ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: Istio VirtualService

```yaml
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: my-app
spec:
  hosts:
    - my-app
  http:
    - route:
        - destination:
            host: my-app
            subset: v1
          weight: 90
        - destination:
            host: my-app
            subset: v2
          weight: 10
```

---

## Ingress Ğ¸ Gateway API

### Ingress

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  ingressClassName: nginx
  rules:
    - host: app.example.com
      http:
        paths:
          - path: /api
            pathType: Prefix
            backend:
              service:
                name: api-service
                port:
                  number: 80
```

### Gateway API (ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ°)

```yaml
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: my-route
spec:
  parentRefs:
    - name: my-gateway
  hostnames:
    - "app.example.com"
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /api
      backendRefs:
        - name: api-service
          port: 80
```

**Gateway API Ğ¿Ñ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- Ğ‘Ğ¾Ğ»ĞµĞµ Ğ²Ñ‹Ñ€Ğ°Ğ·Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹
- Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ (Gateway vs Route)
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° TCP/UDP, gRPC

---

## Troubleshooting

### Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° pod-to-pod

```bash
# 1. Pods Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ğ´Ğµ Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ…?
kubectl get pods -o wide

# 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ connectivity
kubectl exec pod-a -- ping <pod-b-ip>
kubectl exec pod-a -- curl http://<pod-b-ip>:8080

# 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ endpoints ÑĞµÑ€Ğ²Ğ¸ÑĞ°
kubectl get endpoints my-service

# 4. ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑĞ°
kubectl describe svc my-service
```

### Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Service

```bash
# 1. Service ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚?
kubectl get svc my-service

# 2. Endpoints Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½Ñ‹?
kubectl get endpoints my-service
# Ğ•ÑĞ»Ğ¸ Ğ¿ÑƒÑÑ‚Ğ¾ â€” selector Ğ½Ğµ Ğ¼Ğ°Ñ‚Ñ‡Ğ¸Ñ‚ pods!

# 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ selector
kubectl describe svc my-service | grep Selector

# 4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ labels pods
kubectl get pods --show-labels
```

### Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° DNS

```bash
# Debug pod
kubectl run -it --rm debug --image=nicolaka/netshoot -- bash

# Ğ’Ğ½ÑƒÑ‚Ñ€Ğ¸:
nslookup my-service
nslookup my-service.default.svc.cluster.local
dig my-service.default.svc.cluster.local

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ resolv.conf
cat /etc/resolv.conf
```

### Network Policy debugging

```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½Ñ‘Ğ½Ğ½Ñ‹Ğµ policies
kubectl get networkpolicy -A

# Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ policy
kubectl describe networkpolicy my-policy

# Ğ¢ĞµÑÑ‚ connectivity
kubectl exec pod-a -- nc -zv pod-b 8080

# Ğ•ÑĞ»Ğ¸ Cilium â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Hubble
hubble observe --from-pod default/pod-a --to-pod default/pod-b
```

### ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹

| Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|------------|-----------|
| **netshoot** | Swiss-army knife Ğ´Ğ»Ñ networking |
| **kubectl debug** | Ephemeral debug containers |
| **Hubble (Cilium)** | Network observability |
| **tcpdump** | Packet capture |

---

## ĞŸĞ¾Ğ´Ğ²Ğ¾Ğ´Ğ½Ñ‹Ğµ ĞºĞ°Ğ¼Ğ½Ğ¸

### 1. Flannel + NetworkPolicy = Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

Flannel **Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚** NetworkPolicy. ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ policy Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ ÑĞ´ĞµĞ»Ğ°ĞµÑ‚.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Calico Ğ¸Ğ»Ğ¸ Cilium.

### 2. NetworkPolicy Ğ±ĞµĞ· DNS egress

```yaml
# Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸ Ğ²ĞµÑÑŒ egress, Ğ·Ğ°Ğ±Ñ‹Ğ»Ğ¸ DNS
spec:
  policyTypes:
    - Egress
  egress: []  # ĞŸÑƒÑÑ‚Ğ¾ = Ğ²ÑÑ‘ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾, Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ DNS!
```

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Ğ’ÑĞµĞ³Ğ´Ğ° Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ°Ğ¹ UDP/TCP 53 Ğº kube-dns.

### 3. Service Ğ±ĞµĞ· endpoints

```bash
kubectl get svc my-service
# EXTERNAL-IP: <pending> Ğ¸Ğ»Ğ¸ Endpoints: <none>
```

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹:**
- Selector Ğ½Ğµ Ğ¼Ğ°Ñ‚Ñ‡Ğ¸Ñ‚ labels pods
- Pods Ğ½Ğµ Ğ² ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¸ Ready
- Pods Ğ² Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼ namespace

### 4. Pod IP Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ

Pods ÑÑ„ĞµĞ¼ĞµÑ€Ğ½Ñ‹ â€” Ğ¸Ñ… IP Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€ĞµÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ´ÑŒ Pod IP. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Service DNS.

### 5. Headless Service Ğ´Ğ»Ñ StatefulSet

```yaml
spec:
  clusterIP: None  # Headless
```

Ğ”Ğ»Ñ StatefulSet Ğ½ÑƒĞ¶ĞµĞ½ Headless Service, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ pod Ğ¸Ğ¼ĞµĞ» ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ DNS.

### 6. kube-proxy iptables Ğ¿Ñ€Ğ¸ 1000+ services

ĞŸÑ€Ğ¸ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğµ services iptables mode Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚:
- Ğ’Ñ‹ÑĞ¾ĞºÑƒÑ latency Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¸
- CPU spikes Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ rules

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸ÑÑŒ Ğ½Ğ° IPVS mode.

### 7. CoreDNS throttling

CoreDNS Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑŒ bottleneck Ğ¿Ñ€Ğ¸ Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğ¹ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ.

**ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¸:**
- Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ CPU Ñƒ CoreDNS pods
- DNS timeout Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```bash
kubectl scale deployment coredns -n kube-system --replicas=5
```

---

## Ğ§ĞµĞº-Ğ»Ğ¸ÑÑ‚

### Production readiness

- [ ] CNI Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ NetworkPolicy (Ğ½Ğµ Flannel)
- [ ] Default deny NetworkPolicy Ğ² ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ namespace
- [ ] DNS egress Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½
- [ ] kube-proxy mode = IPVS (ĞµÑĞ»Ğ¸ > 500 services)
- [ ] CoreDNS scaled appropriately
- [ ] Ingress/Gateway Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ñ TLS

### Troubleshooting

- [ ] `kubectl get endpoints` â€” endpoints Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½Ñ‹?
- [ ] `kubectl exec ... nslookup` â€” DNS Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚?
- [ ] `kubectl get networkpolicy` â€” Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚?
- [ ] `kubectl logs -n kube-system -l k8s-app=kube-dns` â€” Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ CoreDNS?

---

## Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹

- [[network-docker-deep-dive]] â€” Docker networking, namespaces
- [[network-security-fundamentals]] â€” Zero Trust, firewall
- [[network-observability]] â€” Distributed tracing, metrics
- [[network-cloud-modern]] â€” Cloud-native patterns
- [[network-troubleshooting-advanced]] â€” Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼

---

## Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸

| # | Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº | Ğ¢Ğ¸Ğ¿ | ĞšĞ»ÑÑ‡ĞµĞ²Ğ¾Ğ¹ Ğ²ĞºĞ»Ğ°Ğ´ |
|---|----------|-----|----------------|
| 1 | [K8s Cluster Networking](https://kubernetes.io/docs/concepts/cluster-administration/networking/) | Docs | Official networking concepts |
| 2 | [K8s Network Policies](https://kubernetes.io/docs/concepts/services-networking/network-policies/) | Docs | Policy specification |
| 3 | [K8s DNS Debugging](https://kubernetes.io/docs/tasks/administer-cluster/dns-debugging-resolution/) | Docs | DNS troubleshooting |
| 4 | [Tigera kube-proxy Comparison](https://www.tigera.io/blog/comparing-kube-proxy-modes-iptables-or-ipvs/) | Blog | iptables vs IPVS |
| 5 | [CNI Benchmark 2024](https://itnext.io/benchmark-results-of-kubernetes-network-plugins-cni-over-40gbit-s-network-2024-156f085a5e4e) | Blog | CNI performance |
| 6 | [Cilium vs Calico vs Flannel](https://www.civo.com/blog/calico-vs-flannel-vs-cilium) | Blog | CNI comparison |
| 7 | [Service Mesh Comparison](https://livewyer.io/blog/service-meshes-decoded-istio-vs-linkerd-vs-cilium/) | Blog | Istio vs Linkerd vs Cilium |
| 8 | [Network Policy Recipes](https://github.com/ahmetb/kubernetes-network-policy-recipes) | GitHub | Policy examples |
| 9 | [Tigera Network Policy Guide](https://www.tigera.io/learn/guides/kubernetes-security/kubernetes-network-policy/) | Guide | Policy best practices |
| 10 | [Spacelift K8s Networking](https://spacelift.io/blog/kubernetes-networking) | Blog | Architecture overview |
| 11 | [Tetrate CNI Essentials](https://tetrate.io/blog/kubernetes-networking) | Blog | CNI deep dive |
| 12 | [AWS EKS IPVS](https://docs.aws.amazon.com/eks/latest/best-practices/ipvs.html) | Docs | IPVS in production |
| 13 | [Ground Cover DNS Issues](https://www.groundcover.com/kubernetes-troubleshooting/dns-issues) | Blog | DNS troubleshooting |
| 14 | [Buoyant Linkerd vs Istio](https://www.buoyant.io/linkerd-vs-istio) | Blog | Service mesh comparison |
| 15 | [Container Solutions Debugging](https://blog.container-solutions.com/debugging-kubernetes-networking) | Blog | Practical troubleshooting |

---

*ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: 2026-01-09 â€” Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¿ĞµĞ´Ğ°Ğ³Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑĞµĞºÑ†Ğ¸Ğ¸: 5 Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ğ¹ (K8s cluster ĞºĞ°Ğº ĞºĞ¾Ñ€Ğ¿Ğ¾Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¾Ñ„Ğ¸Ñ, Service ĞºĞ°Ğº Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµÑĞµĞ¿ÑˆĞµĞ½, Ñ‚Ğ¸Ğ¿Ñ‹ Services ĞºĞ°Ğº ÑĞ¿Ğ¾ÑĞ¾Ğ±Ñ‹ ÑĞ²ÑĞ·Ğ¸ Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼ Ğ¼Ğ¸Ñ€Ğ¾Ğ¼, CNI ĞºĞ°Ğº Ğ¿Ğ¾Ğ´Ñ€ÑĞ´Ñ‡Ğ¸Ğº Ğ¿Ğ¾ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸ÑĞ¼, Network Policy ĞºĞ°Ğº Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°), 6 Ñ‚Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ñ Ğ¡Ğ˜ĞœĞŸĞ¢ĞĞœ/Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ• (NetworkPolicy Ğ±ĞµĞ· DNS egress, Flannel + NetworkPolicy = Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚, Service Ğ±ĞµĞ· endpoints, Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ´Ğ¸Ğ½Ğ³ Pod IP, kube-proxy iptables Ğ¿Ñ€Ğ¸ 1000+ services, Ingress Ğ±ĞµĞ· Ingress Controller), 5 Ğ¼ĞµĞ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ (Ñ‡ĞµÑ‚Ñ‹Ñ€Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸, Service = iptables/IPVS Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°, DNS Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ, Ğ´ĞµÑ€ĞµĞ²Ğ¾ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°, troubleshooting checklist)*
