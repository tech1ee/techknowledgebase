---
title: "Structured Outputs –∏ Tool Use: –û—Ç —Ö–∞–æ—Å–∞ –∫ –ø–æ—Ä—è–¥–∫—É"
created: 2025-12-24
updated: 2025-12-24
author: AI Assistant
level: intermediate
type: guide
topics:
  - structured-outputs
  - function-calling
  - tool-use
  - JSON
  - Pydantic
  - Instructor
  - Outlines
  - constrained-decoding
status: published
tags:
  - topic/ai-ml
  - type/guide
  - level/intermediate
related:
  - "[[ai-api-integration]]"
  - "[[mcp-model-context-protocol]]"
  - "[[type-systems-theory]]"
---

# Structured Outputs –∏ Tool Use: –û—Ç —Ö–∞–æ—Å–∞ –∫ –ø–æ—Ä—è–¥–∫—É

---

## Prerequisites

| –¢–µ–º–∞ | –ó–∞—á–µ–º –Ω—É–∂–Ω–æ | –ì–¥–µ –∏–∑—É—á–∏—Ç—å |
|------|-------------|-------------|
| **–ë–∞–∑–æ–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ LLM** | –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ | [[llm-fundamentals]] |
| **JSON** | –§–æ—Ä–º–∞—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | –ë–∞–∑–æ–≤–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **Python + Pydantic** | –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º | Python docs, Pydantic docs |
| **REST API** | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ API | [[ai-api-integration]] |

### –î–ª—è –∫–æ–≥–æ —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª

| –£—Ä–æ–≤–µ–Ω—å | –ü–æ–¥—Ö–æ–¥–∏—Ç? | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|---------|-----------|--------------|
| **–ù–æ–≤–∏—á–æ–∫ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏** | ‚ùå –ù–µ—Ç | –°–Ω–∞—á–∞–ª–∞ Python + JSON |
| **–ë—ç–∫–µ–Ω–¥ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫** | ‚úÖ –î–∞ | –ò–¥–µ–∞–ª—å–Ω–æ ‚Äî —Å—Ä–∞–∑—É –ø—Ä–∏–º–µ–Ω–∏–º–æ –≤ production |
| **Data Engineer** | ‚úÖ –î–∞ | Structured extraction –∏–∑ —Ç–µ–∫—Å—Ç–∞ |
| **AI Engineer** | ‚úÖ –î–∞ | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è LLM –≤ –ø–∞–π–ø–ª–∞–π–Ω—ã |

### –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤

> üí° **Structured Output** = LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–≥–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (JSON), –∞ –Ω–µ —Å–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç

| –¢–µ—Ä–º–∏–Ω | –ó–Ω–∞—á–µ–Ω–∏–µ | –ê–Ω–∞–ª–æ–≥–∏—è –¥–ª—è –Ω–æ–≤–∏—á–∫–∞ |
|--------|----------|---------------------|
| **Structured Output** | –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞ | **–ê–Ω–∫–µ—Ç–∞ —Å –ø–æ–ª—è–º–∏** ‚Äî –∑–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É, –∞ –Ω–µ –ø–∏—à–∏ —ç—Å—Å–µ |
| **JSON Schema** | –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö | **–®–∞–±–ª–æ–Ω –∞–Ω–∫–µ—Ç—ã** ‚Äî –∫–∞–∫–∏–µ –ø–æ–ª—è, –∫–∞–∫–æ–π —Ç–∏–ø |
| **Pydantic** | Python-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ | **–°—Ç—Ä–æ–≥–∏–π —Å–µ–∫—Ä–µ—Ç–∞—Ä—å** ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ |
| **Function Calling** | LLM –≤—ã–∑—ã–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ | **–ü–æ–º–æ—â–Ω–∏–∫ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º** ‚Äî –º–æ–∂–µ—Ç –ø–æ–∑–≤–æ–Ω–∏—Ç—å –∏ —É–∑–Ω–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é |
| **Tool Use** | –ë–æ–ª–µ–µ –æ–±—â–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è Function Calling | **–ù–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤** ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, –ø–æ–∏—Å–∫, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| **Constrained Decoding** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–æ–∫–µ–Ω–æ–≤ | **–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π** ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–∂–∞—Ç—å "–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é" –∫–Ω–æ–ø–∫—É |
| **Response Format** | –ü–∞—Ä–∞–º–µ—Ç—Ä API –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ | **–í—ã–±–æ—Ä —Ñ–æ—Ä–º—ã –æ—Ç–≤–µ—Ç–∞** ‚Äî —Ç–µ–∫—Å—Ç, JSON, –∏–ª–∏ –ø–æ —Å—Ö–µ–º–µ |

---

## –í–≤–µ–¥–µ–Ω–∏–µ: –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã —Å—Ç—Ä–æ–∏—à—å production —Å–∏—Å—Ç–µ–º—É. –¢–≤–æ–π –±—ç–∫–µ–Ω–¥ –æ–∂–∏–¥–∞–µ—Ç JSON —Å –ø–æ–ª—è–º–∏ `name`, `price`, `currency`. –¢—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—à—å –∑–∞–ø—Ä–æ—Å –∫ LLM: "–ò–∑–≤–ª–µ–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–¥—É–∫—Ç–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞: iPhone 15 Pro —Å—Ç–æ–∏—Ç $999".

–ò –ø–æ–ª—É—á–∞–µ—à—å –æ—Ç–≤–µ—Ç:

```
–ö–æ–Ω–µ—á–Ω–æ! –í–æ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ:
- –ù–∞–∑–≤–∞–Ω–∏–µ: iPhone 15 Pro
- –¶–µ–Ω–∞: 999 –¥–æ–ª–ª–∞—Ä–æ–≤ –°–®–ê
- –í–∞–ª—é—Ç–∞: USD

–ù–∞–¥–µ—é—Å—å, —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç!
```

–ö–∞–∫ —Ç—ã —ç—Ç–æ —Ä–∞—Å–ø–∞—Ä—Å–∏—à—å? Regex? –ê –µ—Å–ª–∏ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –º–æ–¥–µ–ª—å –æ—Ç–≤–µ—Ç–∏—Ç –∏–Ω–∞—á–µ? –ê –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç —ç–º–æ–¥–∑–∏? –ê –µ—Å–ª–∏ –ø–µ—Ä–µ–ø—É—Ç–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π?

**–≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ LLM –≤ production —Å–∏—Å—Ç–µ–º—ã** ‚Äî —è–∑—ã–∫–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –∞ –Ω–µ –º–∞—à–∏–Ω–æ—á–∏—Ç–∞–µ–º—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä.

> –ü–æ –¥–∞–Ω–Ω—ã–º OpenAI, –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è Structured Outputs –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ —á–µ—Ä–µ–∑ prompt engineering —Å–æ—Å—Ç–∞–≤–ª—è–ª–∞ ~35.9%. –° –≤–∫–ª—é—á—ë–Ω–Ω—ã–º `strict: true` —ç—Ç–∞ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–∞–µ—Ç **100%**.

–í —ç—Ç–æ–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ –º—ã —Ä–∞–∑–±–µ—Ä—ë–º:
1. –≠–≤–æ–ª—é—Ü–∏—é —Ä–µ—à–µ–Ω–∏–π: –æ—Ç —Ö–∞–∫–æ–≤ –¥–æ native –ø–æ–¥–¥–µ—Ä–∂–∫–∏
2. Structured Outputs: –∫–∞–∫ –∑–∞—Å—Ç–∞–≤–∏—Ç—å LLM –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON
3. Tool Use: –∫–∞–∫ –¥–∞—Ç—å LLM "—Ä—É–∫–∏" –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –≤–Ω–µ—à–Ω–∏–º –º–∏—Ä–æ–º
4. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏: Instructor, Outlines, Pydantic AI, BAML, Guidance
5. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—á–µ–º—É LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "—á—Ç–æ –ø–æ–ø–∞–ª–æ"](#–ø—Ä–æ–±–ª–µ–º–∞-–ø–æ—á–µ–º—É-llm-–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç-—á—Ç–æ-–ø–æ–ø–∞–ª–æ)
2. [–≠–≤–æ–ª—é—Ü–∏—è —Ä–µ—à–µ–Ω–∏–π](#—ç–≤–æ–ª—é—Ü–∏—è-—Ä–µ—à–µ–Ω–∏–π)
3. [Structured Outputs: –ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ](#structured-outputs-–≥–ª—É–±–æ–∫–æ–µ-–ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ)
4. [Tool Use: –†—É–∫–∏ –¥–ª—è LLM](#tool-use-—Ä—É–∫–∏-–¥–ª—è-llm)
5. [Constrained Decoding: –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º](#constrained-decoding-–∫–∞–∫-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç-–ø–æ–¥-–∫–∞–ø–æ—Ç–æ–º)
6. [–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏](#–±–∏–±–ª–∏–æ—Ç–µ–∫–∏-–∏-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏)
7. [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è](#–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
8. [–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å](#—Ç–∏–ø–∏—á–Ω—ã–µ-–æ—à–∏–±–∫–∏-–∏-–∫–∞–∫-–∏—Ö-–∏–∑–±–µ–∂–∞—Ç—å)
9. [Best Practices](#best-practices)
10. [–ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è](#–ø—Ä–æ–≤–µ—Ä—å-—Å–µ–±—è)

---

## –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—á–µ–º—É LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "—á—Ç–æ –ø–æ–ø–∞–ª–æ"

### –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞

–ß—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –ø—Ä–æ–±–ª–µ–º—É, –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å –∫–∞–∫ LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç. –≠—Ç–æ –Ω–µ "—É–º–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö", –∫–æ—Ç–æ—Ä–∞—è –¥–æ—Å—Ç–∞—ë—Ç –≥–æ—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã. –≠—Ç–æ **–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω–∞—è –º–∞—à–∏–Ω–∞**, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ç–æ–∫–µ–Ω.

```
–í—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç: "–°—Ç–æ–ª–∏—Ü–∞ –§—Ä–∞–Ω—Ü–∏–∏ ‚Äî"

LLM –≤—ã—á–∏—Å–ª—è–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞:
  "–ü–∞—Ä–∏–∂"  ‚Üí 0.85
  "–≥–æ—Ä–æ–¥"  ‚Üí 0.08
  "—ç—Ç–æ"    ‚Üí 0.03
  ...      ‚Üí –æ—Å—Ç–∞–ª—å–Ω—ã–µ

–í—ã–±–∏—Ä–∞–µ—Ç—Å—è —Ç–æ–∫–µ–Ω —Å —É—á—ë—Ç–æ–º temperature:
  temperature=0: –≤—Å–µ–≥–¥–∞ "–ü–∞—Ä–∏–∂" (—Å–∞–º—ã–π –≤–µ—Ä–æ—è—Ç–Ω—ã–π)
  temperature=1: —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é
```

**–ö–ª—é—á–µ–≤–æ–π –∏–Ω—Å–∞–π—Ç**: LLM –Ω–µ "–∑–Ω–∞–µ—Ç", —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–µ–Ω JSON. –û–Ω–∞ –ø—Ä–æ—Å—Ç–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–æ–π —Ç–µ–∫—Å—Ç –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–æ —Å–ª–µ–¥—É–µ—Ç –∑–∞ —Ç–≤–æ–∏–º –ø—Ä–æ–º–ø—Ç–æ–º. –ï—Å–ª–∏ –≤ training data –ø–æ—Å–ª–µ –ø–æ–¥–æ–±–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —á–∞—â–µ —à—ë–ª prose text ‚Äî –æ–Ω–∞ –≤—ã–¥–∞—Å—Ç prose text.

### –ü–æ—á–µ–º—É —ç—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–±–ª–µ–º—ã

```
–û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å ‚Üí –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –æ—Ç–≤–µ—Ç–∞:

–ó–∞–ø—Ä–æ—Å: "–ò–∑–≤–ª–µ–∫–∏ –∏–º—è –∏ –≤–æ–∑—Ä–∞—Å—Ç: –î–∂–æ–Ω—É 30 –ª–µ—Ç"

–û—Ç–≤–µ—Ç 1: "–ò–º—è: –î–∂–æ–Ω, –í–æ–∑—Ä–∞—Å—Ç: 30"
–û—Ç–≤–µ—Ç 2: "{"name": "–î–∂–æ–Ω", "age": 30}"
–û—Ç–≤–µ—Ç 3: "–î–∂–æ–Ω (30 –ª–µ—Ç)"
–û—Ç–≤–µ—Ç 4: "–ò–∑ —Ç–µ–∫—Å—Ç–∞ –º–æ–∂–Ω–æ –∏–∑–≤–ª–µ—á—å: –∏–º—è —á–µ–ª–æ–≤–µ–∫–∞ ‚Äî –î–∂–æ–Ω, –µ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç ‚Äî 30 –ª–µ—Ç."
–û—Ç–≤–µ—Ç 5: "{name: '–î–∂–æ–Ω', age: 30}"  ‚Üê –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON!
```

**–ü—Ä–æ–±–ª–µ–º—ã –¥–ª—è production:**
- **–ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**: –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –¥–∞—Ç—å —Ä–∞–∑–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- **–•—Ä—É–ø–∫–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞**: regex –ª–æ–º–∞–µ—Ç—Å—è –Ω–∞ edge cases
- **–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å**: JSON –±–µ–∑ –∫–∞–≤—ã—á–µ–∫, –ª–∏—à–Ω–∏–µ –∑–∞–ø—è—Ç—ã–µ
- **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è**: –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç "–∑–∞–±—ã—Ç—å" –≤–µ—Ä–Ω—É—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç**: "–í–æ—Ç –≤–∞—à JSON: {...}" ‚Äî –∫–∞–∫ –æ—Ç–¥–µ–ª–∏—Ç—å JSON –æ—Ç —Ç–µ–∫—Å—Ç–∞?

---

## –≠–≤–æ–ª—é—Ü–∏—è —Ä–µ—à–µ–Ω–∏–π

–ò–Ω–¥—É—Å—Ç—Ä–∏—è –ø—Ä–æ—à–ª–∞ –¥–æ–ª–≥–∏–π –ø—É—Ç—å –æ—Ç –∫–æ—Å—Ç—ã–ª–µ–π –∫ —ç–ª–µ–≥–∞–Ω—Ç–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è–º. –ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç—Ç–æ–π —ç–≤–æ–ª—é—Ü–∏–∏ –ø–æ–º–æ–∂–µ—Ç —Ç–µ–±–µ –≤—ã–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥.

### –≠—Ç–∞–ø 1: Prompt Engineering (2020-2022)

**–ò–¥–µ—è**: –ï—Å–ª–∏ —Ö–æ—Ä–æ—à–æ –ø–æ–ø—Ä–æ—Å–∏—Ç—å ‚Äî –º–æ–¥–µ–ª—å –ø–æ—Å–ª—É—à–∞–µ—Ç—Å—è.

```python
prompt = """
–ò–∑–≤–ª–µ–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∏ –≤–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON.
–ù–∏–∫–∞–∫–æ–≥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞. –¢–æ–ª—å–∫–æ JSON.

–§–æ—Ä–º–∞—Ç:
{"name": "string", "price": number, "currency": "string"}

–¢–µ–∫—Å—Ç: iPhone 15 Pro —Å—Ç–æ–∏—Ç $999

JSON:
"""

response = openai.Completion.create(
    model="text-davinci-003",
    prompt=prompt
)

# –ù–∞–¥–µ–µ–º—Å—è, —á—Ç–æ –ø–æ–ª—É—á–∏–º JSON...
try:
    data = json.loads(response.choices[0].text)
except json.JSONDecodeError:
    # –£–ø—Å. –ü—Ä–∏–º–µ—Ä–Ω–æ –≤ 10-20% —Å–ª—É—á–∞–µ–≤
    # –º–æ–¥–µ–ª—å –¥–æ–±–∞–≤–∏—Ç "–í–æ—Ç –≤–∞—à JSON:" –∏–ª–∏ —Å–ª–æ–º–∞–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
    pass
```

**–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∏–Ω–æ–≥–¥–∞)**:
- –ú–æ–¥–µ–ª–∏ –æ–±—É—á–µ–Ω—ã —Å–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
- –ß—ë–º —á—ë—Ç—á–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, —Ç–µ–º –≤—ã—à–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–æ–±–ª—é–¥–µ–Ω–∏—è
- Few-shot –ø—Ä–∏–º–µ—Ä—ã –ø–æ–≤—ã—à–∞—é—Ç success rate

**–ü–æ—á–µ–º—É —ç—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç (—á–∞—Å—Ç–æ)**:
- –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π ‚Äî —ç—Ç–æ –≤—Å—ë –µ—â—ë –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- –î–ª–∏–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã "—Ä–∞–∑–º—ã–≤–∞—é—Ç" –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –°–ª–æ–∂–Ω—ã–µ —Å—Ö–µ–º—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—à–∏–±–∫–∏
- Temperature > 0 –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å

**Success rate**: ~80-90% –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤, –ø–∞–¥–∞–µ—Ç —Å —Ä–æ—Å—Ç–æ–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.

### –≠—Ç–∞–ø 2: Regex Post-Processing (2021-2023)

**–ò–¥–µ—è**: –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º—É—Å–æ—Ä –≤–æ–∫—Ä—É–≥ JSON ‚Äî –≤—ã—Ä–µ–∂–µ–º –µ–≥–æ.

```python
import re
import json

def extract_json_from_response(text: str) -> dict | None:
    """
    –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ JSON –≤ –æ—Ç–≤–µ—Ç–µ –º–æ–¥–µ–ª–∏.

    –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ—à–∞–µ—Ç —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è:
    - "–í–æ—Ç –≤–∞—à JSON: {...}"
    - "```json\n{...}\n```"
    - "{...}\n\n–ù–∞–¥–µ—é—Å—å, —ç—Ç–æ –ø–æ–º–æ–≥–ª–æ!"
    """

    # –ü–∞—Ç—Ç–µ—Ä–Ω 1: JSON –≤ markdown code block
    code_block_pattern = r'```(?:json)?\s*(\{[\s\S]*?\})\s*```'
    match = re.search(code_block_pattern, text)
    if match:
        try:
            return json.loads(match.group(1))
        except json.JSONDecodeError:
            pass

    # –ü–∞—Ç—Ç–µ—Ä–Ω 2: –ü—Ä–æ—Å—Ç–æ –Ω–∞–π—Ç–∏ {...}
    json_pattern = r'\{[^{}]*\}'
    match = re.search(json_pattern, text)
    if match:
        try:
            return json.loads(match.group())
        except json.JSONDecodeError:
            pass

    # –ü–∞—Ç—Ç–µ—Ä–Ω 3: –í–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π regex)
    # –≠—Ç–æ —É–∂–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–µ–∑—É–º–∏–µ–º...

    return None

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
raw_response = """
–ö–æ–Ω–µ—á–Ω–æ! –í–æ—Ç –∏–∑–≤–ª–µ—á—ë–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:

```json
{"name": "iPhone 15 Pro", "price": 999, "currency": "USD"}
```

–î–∞–π—Ç–µ –∑–Ω–∞—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –µ—â—ë!
"""

data = extract_json_from_response(raw_response)
```

**–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
- –ü–æ–≤—ã—à–∞–µ—Ç success rate –¥–æ ~95%
- –ü—Ä–æ—Å—Ç–∞—è –∏–¥–µ—è, –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

**–ü–æ—á–µ–º—É —ç—Ç–æ –ü–õ–û–•–û**:
- **–•—Ä—É–ø–∫–æ—Å—Ç—å**: –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ ‚Äî –Ω–æ–≤—ã–π regex
- **–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON**: Regex –Ω–µ –∏—Å–ø—Ä–∞–≤–∏—Ç `{name: 'test'}` (–Ω—É–∂–Ω—ã –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏)
- **–í–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**: Regex –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
- **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è**: Regex –Ω–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –≤—Å–µ required –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö**: `"price": "999"` vs `"price": 999` ‚Äî regex –Ω–µ —Ä–∞–∑–ª–∏—á–∏—Ç

**Success rate**: ~90-95%, –Ω–æ –±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º—ã.

### –≠—Ç–∞–ø 3: JSON Mode (2023)

**–ò–¥–µ—è**: –ü—É—Å—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ö–æ—Ç—è –±—ã –≤–∞–ª–∏–¥–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å JSON.

OpenAI –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª `response_format: {"type": "json_object"}` –≤ –Ω–æ—è–±—Ä–µ 2023.

```python
from openai import OpenAI

client = OpenAI()

response = client.chat.completions.create(
    model="gpt-4-turbo-preview",
    messages=[
        {
            "role": "system",
            "content": "–¢—ã –∏–∑–≤–ª–µ–∫–∞–µ—à—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö. –í–æ–∑–≤—Ä–∞—â–∞–π JSON —Å –ø–æ–ª—è–º–∏: name, price, currency."
        },
        {
            "role": "user",
            "content": "iPhone 15 Pro —Å—Ç–æ–∏—Ç $999"
        }
    ],
    response_format={"type": "json_object"}  # –ú–∞–≥–∏—è –∑–¥–µ—Å—å!
)

# –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤–∞–ª–∏–¥–Ω—ã–π JSON (—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏)
data = json.loads(response.choices[0].message.content)

# –ù–û! –°—Ö–µ–º–∞ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞:
# –ú–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å {"product": "iPhone", "cost": 999}
# –≤–º–µ—Å—Ç–æ {"name": "iPhone", "price": 999, "currency": "USD"}
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º**:

JSON Mode –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **constrained decoding** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

```
–û–±—ã—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è:
  –ü–æ—Å–ª–µ "{" –¥–æ–ø—É—Å—Ç–∏–º—ã 50,000+ —Ç–æ–∫–µ–Ω–æ–≤

JSON Mode:
  –ü–æ—Å–ª–µ "{" –¥–æ–ø—É—Å—Ç–∏–º—ã —Ç–æ–ª—å–∫–æ:
    - '"' (–Ω–∞—á–∞–ª–æ –∫–ª—é—á–∞)
    - '}' (–ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç)
    - whitespace

  –ü–æ—Å–ª–µ '{"name": "iPhone' –¥–æ–ø—É—Å—Ç–∏–º—ã:
    - –ª—é–±–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏)
    - '"' (–∫–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏)
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ—Ä—ã–≤**:
- **100% –≤–∞–ª–∏–¥–Ω—ã–π JSON —Å–∏–Ω—Ç–∞–∫—Å–∏—Å** ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å `{name: value}` –∏–ª–∏ –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–µ —Å–∫–æ–±–∫–∏
- –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ inference engine
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π overhead –ø–æ latency

**–ü–æ—á–µ–º—É —ç—Ç–æ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ**:
- –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ö–µ–º–µ
- –ü–æ–ª—è –º–æ–≥—É—Ç –±—ã—Ç—å named –ø–æ-–¥—Ä—É–≥–æ–º—É
- –¢–∏–ø—ã –º–æ–≥—É—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å
- Required –ø–æ–ª—è –º–æ–≥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å

**Success rate**: 100% –¥–ª—è –≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON, ~90-95% –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω—É–∂–Ω–æ–π —Å—Ö–µ–º–µ.

### –≠—Ç–∞–ø 4: Structured Outputs (2024-2025)

**–ò–¥–µ—è**: Constrained decoding, –Ω–æ —Å —É—á—ë—Ç–æ–º JSON Schema.

OpenAI –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª Structured Outputs –≤ –∞–≤–≥—É—Å—Ç–µ 2024. Anthropic –¥–æ–±–∞–≤–∏–ª –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤ –Ω–æ—è–±—Ä–µ 2025 (beta). –≠—Ç–æ **game changer**.

```python
from openai import OpenAI
from pydantic import BaseModel

client = OpenAI()

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ—á–Ω—É—é —Å—Ö–µ–º—É —á–µ—Ä–µ–∑ Pydantic
class Product(BaseModel):
    name: str
    price: float
    currency: str

# API –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ
response = client.beta.chat.completions.parse(
    model="gpt-4o-2024-08-06",
    messages=[
        {"role": "user", "content": "iPhone 15 Pro —Å—Ç–æ–∏—Ç $999"}
    ],
    response_format=Product
)

# –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ:
# 1. –í–∞–ª–∏–¥–Ω—ã–π JSON
# 2. –í—Å–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
# 3. –¢–∏–ø—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—Ö–µ–º–µ
product = response.choices[0].message.parsed
print(product.name)      # str, –≤—Å–µ–≥–¥–∞
print(product.price)     # float, –≤—Å–µ–≥–¥–∞
print(product.currency)  # str, –≤—Å–µ–≥–¥–∞
```

**–≠—Ç–æ —Ä–µ–≤–æ–ª—é—Ü–∏—è, –ø–æ—Ç–æ–º—É —á—Ç–æ**:
- **100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ** ‚Äî –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ
- –í—Å–µ required –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- –¢–∏–ø—ã —Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç
- Enum –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∏–∑ —Å–ø–∏—Å–∫–∞
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º (–¥–µ–∫–∞–±—Ä—å 2025):**

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –ú–æ–¥–µ–ª–∏ | –ú–µ—Ö–∞–Ω–∏–∑–º |
|-----------|--------|----------|
| OpenAI | gpt-4o, gpt-4o-mini, o1, o3 | Native `strict: true` |
| Anthropic | Claude Sonnet 4.5, Opus 4.1 | Beta `structured-outputs-2025-11-13` |
| Google | Gemini 2.0, 2.5 | `response_mime_type` + `response_schema` |
| Cohere | Command R, Command A | JSON Schema mode |
| vLLM/SGLang | –õ—é–±—ã–µ –º–æ–¥–µ–ª–∏ | XGrammar, Outlines backends |

**Success rate**: 100%.

### –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü–æ–¥—Ö–æ–¥ | –í–∞–ª–∏–¥–Ω—ã–π JSON | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ | –ì–∞—Ä–∞–Ω—Ç–∏–∏ | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|--------|--------------|-------------------|----------|-----------|
| Prompt Engineering | ~85% | ~75% | –ù–µ—Ç | –ù–∏–∑–∫–∞—è |
| Regex Extraction | ~95% | ~85% | –ù–µ—Ç | –°—Ä–µ–¥–Ω—è—è |
| JSON Mode | 100% | ~92% | –¢–æ–ª—å–∫–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å | –ù–∏–∑–∫–∞—è |
| Structured Outputs | 100% | 100% | –ü–æ–ª–Ω—ã–µ | –ù–∏–∑–∫–∞—è |
| Instructor + Retries | ~100% | ~99% | –ü–æ—á—Ç–∏ –ø–æ–ª–Ω—ã–µ | –ù–∏–∑–∫–∞—è |

---

## Structured Outputs: –ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ

### –ú–µ—Ö–∞–Ω–∏–∑–º: Constrained Decoding

–ß—Ç–æ–±—ã –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –ø–æ–Ω—è—Ç—å Structured Outputs, —Ä–∞–∑–±–µ—Ä—ë–º –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç constrained decoding —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø—Ä–∏–º–µ—Ä–æ–º.

**–°—Ö–µ–º–∞:**
```json
{
  "type": "object",
  "properties": {
    "status": {
      "type": "string",
      "enum": ["active", "inactive", "pending"]
    },
    "count": {
      "type": "integer",
      "minimum": 0
    }
  },
  "required": ["status", "count"]
}
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à–∞–≥ –∑–∞ —à–∞–≥–æ–º:**

```
–®–∞–≥ 1: –ù–∞—á–∞–ª–æ –æ–±—ä–µ–∫—Ç–∞
  –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ç–æ–∫–µ–Ω—ã: ["{"]
  –í—ã–±—Ä–∞–Ω–æ: "{"
  –¢–µ–∫—É—â–∏–π output: "{"

–®–∞–≥ 2: –ü–µ—Ä–≤—ã–π –∫–ª—é—á (required: status –∏–ª–∏ count)
  –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ç–æ–∫–µ–Ω—ã: ["\"status\"", "\"count\""]
  –í—ã–±—Ä–∞–Ω–æ: "\"status\""
  –¢–µ–∫—É—â–∏–π output: "{\"status\""

–®–∞–≥ 3: –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
  –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ç–æ–∫–µ–Ω—ã: [":"]
  –í—ã–±—Ä–∞–Ω–æ: ":"
  –¢–µ–∫—É—â–∏–π output: "{\"status\":"

–®–∞–≥ 4: –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è status (enum)
  –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ç–æ–∫–µ–Ω—ã: ["\"active\"", "\"inactive\"", "\"pending\""]
  –ú–æ–¥–µ–ª—å "—Ö–æ—á–µ—Ç" —Å–∫–∞–∑–∞—Ç—å "active" ‚Üí –í—ã–±—Ä–∞–Ω–æ: "\"active\""
  –¢–µ–∫—É—â–∏–π output: "{\"status\":\"active\""

–®–∞–≥ 5: –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ
  –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ç–æ–∫–µ–Ω—ã: [","]  (count –µ—â—ë required)
  –í—ã–±—Ä–∞–Ω–æ: ","
  –¢–µ–∫—É—â–∏–π output: "{\"status\":\"active\","

–®–∞–≥ 6: –í—Ç–æ—Ä–æ–π –∫–ª—é—á (–æ—Å—Ç–∞–ª–æ—Å—å: count)
  –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ç–æ–∫–µ–Ω—ã: ["\"count\""]
  –í—ã–±—Ä–∞–Ω–æ: "\"count\""
  –¢–µ–∫—É—â–∏–π output: "{\"status\":\"active\",\"count\""

–®–∞–≥ 7: –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∏ –∑–Ω–∞—á–µ–Ω–∏–µ
  –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ç–æ–∫–µ–Ω—ã: [":"] –∑–∞—Ç–µ–º [—Ü–∏—Ñ—Ä—ã 0-9]
  ...

–®–∞–≥ 8: –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–±—ä–µ–∫—Ç–∞
  –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ç–æ–∫–µ–Ω—ã: ["}"]
  –¢–µ–∫—É—â–∏–π output: "{\"status\":\"active\",\"count\":42}"
```

**–ö–ª—é—á–µ–≤–æ–π –∏–Ω—Å–∞–π—Ç**: –ù–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –º–æ–¥–µ–ª—å –≤—Å—ë –µ—â—ë –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–≤–æ–∏—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π, –Ω–æ –≤—ã–±–æ—Ä –æ–≥—Ä–∞–Ω–∏—á–µ–Ω —Ç–æ–ª—å–∫–æ —Ç–µ–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–µ–¥—É—Ç –∫ –≤–∞–ª–∏–¥–Ω–æ–º—É JSON –ø–æ —Å—Ö–µ–º–µ. –≠—Ç–æ –∫–∞–∫ –ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç, –∏–º–µ—è —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –±—É–∫–≤—ã –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ.

### OpenAI: –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –°–ø–æ—Å–æ–± 1: response_format —Å json_schema

```python
from openai import OpenAI

client = OpenAI()

response = client.chat.completions.create(
    model="gpt-4o-2024-08-06",
    messages=[
        {"role": "user", "content": "Solve 8x + 7 = -23"}
    ],
    response_format={
        "type": "json_schema",
        "json_schema": {
            "name": "math_reasoning",
            "schema": {
                "type": "object",
                "properties": {
                    "steps": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "explanation": {"type": "string"},
                                "output": {"type": "string"}
                            },
                            "required": ["explanation", "output"],
                            "additionalProperties": False
                        }
                    },
                    "final_answer": {"type": "string"}
                },
                "required": ["steps", "final_answer"],
                "additionalProperties": False
            },
            "strict": True  # <-- –ö–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä!
        }
    }
)
```

#### –°–ø–æ—Å–æ–± 2: Pydantic model —á–µ—Ä–µ–∑ SDK

```python
from openai import OpenAI
from pydantic import BaseModel
from typing import List

class Step(BaseModel):
    explanation: str
    output: str

class MathReasoning(BaseModel):
    steps: List[Step]
    final_answer: str

client = OpenAI()

# SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç Pydantic ‚Üí JSON Schema
response = client.beta.chat.completions.parse(
    model="gpt-4o",
    messages=[
        {"role": "user", "content": "Solve 8x + 7 = -23"}
    ],
    response_format=MathReasoning
)

# –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ parsed –æ–±—ä–µ–∫—Ç—É
reasoning = response.choices[0].message.parsed
print(reasoning.final_answer)  # "-3.75"
```

### Anthropic: Tool Use –¥–ª—è Structured Outputs (2025 Beta)

Anthropic –¥–æ–±–∞–≤–∏–ª –Ω–∞—Ç–∏–≤–Ω—ã–µ structured outputs –≤ –Ω–æ—è–±—Ä–µ 2025:

```python
from pydantic import BaseModel
from anthropic import Anthropic

class ContactInfo(BaseModel):
    name: str
    email: str
    plan_interest: str

client = Anthropic()

# –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ parse() —Å beta header
response = client.beta.messages.parse(
    model="claude-sonnet-4-5-20250929",
    max_tokens=1024,
    betas=["structured-outputs-2025-11-13"],  # Beta feature
    messages=[
        {"role": "user", "content": "Extract info: John Smith, john@email.com, interested in Pro plan"}
    ],
    output_format=ContactInfo,
)

contact = response.parsed_output
print(contact.name)  # "John Smith"
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —á–µ—Ä–µ–∑ Tool Use:**

```python
from pydantic import BaseModel, Field
from typing import List
from anthropic import Anthropic

class TextAnalysis(BaseModel):
    sentiment: str = Field(description="Overall sentiment of the text")
    main_topics: List[str] = Field(description="List of main topics")
    word_count: int = Field(description="Total word count")

client = Anthropic()

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º JSON Schema –∏–∑ Pydantic –º–æ–¥–µ–ª–∏
text_analysis_schema = TextAnalysis.model_json_schema()

tools = [
    {
        "name": "build_text_analysis_result",
        "description": "Build the text analysis object with extracted information",
        "input_schema": text_analysis_schema
    }
]

message = client.messages.create(
    model="claude-sonnet-4-5-20250929",
    max_tokens=1200,
    tools=tools,
    # –ó–∞—Å—Ç–∞–≤–ª—è–µ–º Claude –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç tool
    tool_choice={"type": "tool", "name": "build_text_analysis_result"},
    messages=[
        {"role": "user", "content": "Analyze this text: ..."}
    ]
)

# –ò–∑–≤–ª–µ–∫–∞–µ–º structured data –∏–∑ tool call
for block in message.content:
    if block.type == "tool_use":
        analysis = TextAnalysis(**block.input)
        print(analysis.sentiment)
```

### Google Gemini: JSON Schema Support

```python
import google.generativeai as genai
from typing import TypedDict

class Product(TypedDict):
    name: str
    price: float
    currency: str

model = genai.GenerativeModel("gemini-2.0-flash")

response = model.generate_content(
    "Extract: iPhone 15 Pro costs $999",
    generation_config={
        "response_mime_type": "application/json",
        "response_schema": Product
    }
)

import json
product = json.loads(response.text)
```

> **–í–∞–∂–Ω–æ**: –í –Ω–æ—è–±—Ä–µ 2025 Google –¥–æ–±–∞–≤–∏–ª –ø–æ–¥–¥–µ—Ä–∂–∫—É JSON Schema keywords `anyOf`, `$ref` –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –∫–ª—é—á–µ–π –¥–ª—è Gemini 2.5 –º–æ–¥–µ–ª–µ–π.

### JSON Schema: –ß—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

OpenAI Structured Outputs –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ JSON Schema:

**–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:**
```python
from pydantic import BaseModel, Field
from typing import Optional, List, Literal
from enum import Enum

class Status(str, Enum):
    ACTIVE = "active"
    INACTIVE = "inactive"

class Address(BaseModel):
    street: str
    city: str
    country: str = "USA"  # default –∑–Ω–∞—á–µ–Ω–∏—è

class Person(BaseModel):
    # –ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ —Ç–∏–ø—ã
    name: str
    age: int
    score: float
    is_active: bool

    # Optional (nullable)
    nickname: Optional[str] = None

    # Enum —á–µ—Ä–µ–∑ Literal
    role: Literal["admin", "user", "guest"]

    # Enum —á–µ—Ä–µ–∑ Enum class
    status: Status

    # –ú–∞—Å—Å–∏–≤—ã
    tags: List[str]

    # –í–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
    address: Address

    # –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
    friends: List["Person"] = []

    # Field —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º (–ø–æ–º–æ–≥–∞–µ—Ç –º–æ–¥–µ–ª–∏ –ø–æ–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç)
    bio: str = Field(description="–ö—Ä–∞—Ç–∫–∞—è –±–∏–æ–≥—Ä–∞—Ñ–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
```

**–ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (–ø–æ–∫–∞):**
```python
# –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
from typing import Union, Any, Dict

class Invalid(BaseModel):
    # Union types (–∫—Ä–æ–º–µ Optional)
    value: Union[str, int]  # –û—à–∏–±–∫–∞!

    # Any type
    data: Any  # –û—à–∏–±–∫–∞!

    # –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ dict
    metadata: Dict[str, Any]  # –û—à–∏–±–∫–∞!

    # –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ)
    # –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤, –Ω–æ –Ω–µ –¥–ª—è –≥–ª—É–±–æ–∫–æ–π —Ä–µ–∫—É—Ä—Å–∏–∏
```

---

## Tool Use: –†—É–∫–∏ –¥–ª—è LLM

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è: –ó–∞—á–µ–º LLM –Ω—É–∂–Ω—ã "—Ä—É–∫–∏"

LLM ‚Äî —ç—Ç–æ –º–æ–∑–≥. –û—á–µ–Ω—å —É–º–Ω—ã–π –º–æ–∑–≥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, —Ä–∞—Å—Å—É–∂–¥–∞—Ç—å, –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç. –ù–æ —É –Ω–µ–≥–æ –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ **–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –º–∏—Ä–µ.

–ü—Ä–µ–¥—Å—Ç–∞–≤—å: —Ç—ã —Å–ø—Ä–∞—à–∏–≤–∞–µ—à—å LLM "–ö–∞–∫–∞—è —Å–µ–π—á–∞—Å –ø–æ–≥–æ–¥–∞ –≤ –ú–æ—Å–∫–≤–µ?". –ß—Ç–æ –æ–Ω–∞ –º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å?

```
–ë–µ–∑ tools:
"–Ø –Ω–µ –∏–º–µ—é –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –æ –ø–æ–≥–æ–¥–µ, —Ç–∞–∫ –∫–∞–∫ –º–æ–∏ –∑–Ω–∞–Ω–∏—è
–æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –¥–∞—Ç–æ–π –æ–±—É—á–µ–Ω–∏—è. –†–µ–∫–æ–º–µ–Ω–¥—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–≥–æ–¥—É –Ω–∞ weather.com."

–° tools:
1. LLM –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –Ω—É–∂–Ω—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
2. LLM —Ä–µ—à–∞–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é get_weather(city="Moscow")
3. –¢–≤–æ–π –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π API –∑–∞–ø—Ä–æ—Å
4. LLM –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {"temp": -5, "condition": "snow"}
5. LLM –æ—Ç–≤–µ—á–∞–µ—Ç: "–°–µ–π—á–∞—Å –≤ –ú–æ—Å–∫–≤–µ -5¬∞C, –∏–¥—ë—Ç —Å–Ω–µ–≥."
```

**Tools = —Ä—É–∫–∏ –¥–ª—è LLM**. –≠—Ç–æ —Å–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–∏—Ç—å —è–∑—ã–∫–æ–≤—É—é –º–æ–¥–µ–ª—å –∫ –≤–Ω–µ—à–Ω–µ–º—É –º–∏—Ä—É:
- API –∑–∞–ø—Ä–æ—Å—ã (–ø–æ–≥–æ–¥–∞, –Ω–æ–≤–æ—Å—Ç–∏, –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç)
- –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ø–æ–∏—Å–∫, CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏)
- –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (—á—Ç–µ–Ω–∏–µ, –∑–∞–ø–∏—Å—å)
- –î—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã (email, Slack, –∫–∞–ª–µ–Ω–¥–∞—Ä—å)
- –í—ã—á–∏—Å–ª–µ–Ω–∏—è (–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, code interpreter)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        TOOL USE ARCHITECTURE                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                       ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                     ‚îÇ
‚îÇ   ‚îÇ    User     ‚îÇ                                                     ‚îÇ
‚îÇ   ‚îÇ   Prompt    ‚îÇ                                                     ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                     ‚îÇ
‚îÇ          ‚îÇ                                                            ‚îÇ
‚îÇ          ‚ñº                                                            ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                          ‚îÇ
‚îÇ   ‚îÇ    Your      ‚îÇ      ‚îÇ  Tool Schemas   ‚îÇ                          ‚îÇ
‚îÇ   ‚îÇ    Code      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  (JSON Schema)  ‚îÇ                          ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                          ‚îÇ
‚îÇ          ‚îÇ                      ‚îÇ                                     ‚îÇ
‚îÇ          ‚îÇ                      ‚ñº                                     ‚îÇ
‚îÇ          ‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                            ‚îÇ
‚îÇ          ‚îÇ              ‚îÇ      LLM      ‚îÇ                            ‚îÇ
‚îÇ          ‚îÇ              ‚îÇ  (–ê–Ω–∞–ª–∏–∑ +    ‚îÇ                            ‚îÇ
‚îÇ          ‚îÇ              ‚îÇ   –†–µ—à–µ–Ω–∏–µ)    ‚îÇ                            ‚îÇ
‚îÇ          ‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                            ‚îÇ
‚îÇ          ‚îÇ                      ‚îÇ                                     ‚îÇ
‚îÇ          ‚îÇ         –î–≤–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—É—Ç–∏:                               ‚îÇ
‚îÇ          ‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                       ‚îÇ
‚îÇ          ‚îÇ         ‚ñº                         ‚ñº                        ‚îÇ
‚îÇ          ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ
‚îÇ          ‚îÇ   ‚îÇ  Text    ‚îÇ            ‚îÇ  Tool Call  ‚îÇ                 ‚îÇ
‚îÇ          ‚îÇ   ‚îÇ Response ‚îÇ            ‚îÇ  Request    ‚îÇ                 ‚îÇ
‚îÇ          ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ
‚îÇ          ‚îÇ        ‚îÇ                         ‚îÇ                         ‚îÇ
‚îÇ          ‚îÇ        ‚ñº                         ‚ñº                         ‚îÇ
‚îÇ          ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ
‚îÇ          ‚îÇ   ‚îÇ  Return  ‚îÇ            ‚îÇ Your Code   ‚îÇ                 ‚îÇ
‚îÇ          ‚îÇ   ‚îÇ  to User ‚îÇ            ‚îÇ Executes    ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ –≠–¢–û –í–ê–ñ–ù–û! ‚îÇ
‚îÇ          ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ Function    ‚îÇ     LLM –Ω–µ     ‚îÇ
‚îÇ          ‚îÇ                           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     –≤—ã–ø–æ–ª–Ω—è–µ—Ç   ‚îÇ
‚îÇ          ‚îÇ                                  ‚îÇ            —Ñ—É–Ω–∫—Ü–∏—é     ‚îÇ
‚îÇ          ‚îÇ                                  ‚ñº                         ‚îÇ
‚îÇ          ‚îÇ                           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ
‚îÇ          ‚îÇ                           ‚îÇ   Result    ‚îÇ                 ‚îÇ
‚îÇ          ‚îÇ                           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ
‚îÇ          ‚îÇ                                  ‚îÇ                         ‚îÇ
‚îÇ          ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îÇ
‚îÇ          ‚îÇ                                                            ‚îÇ
‚îÇ          ‚îÇ  –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ LLM                     ‚îÇ
‚îÇ          ‚ñº                                                            ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                   ‚îÇ
‚îÇ   ‚îÇ     LLM      ‚îÇ                                                   ‚îÇ
‚îÇ   ‚îÇ  –§–æ—Ä–º–∏—Ä—É–µ—Ç   ‚îÇ                                                   ‚îÇ
‚îÇ   ‚îÇ   –æ—Ç–≤–µ—Ç      ‚îÇ                                                   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                   ‚îÇ
‚îÇ          ‚îÇ                                                            ‚îÇ
‚îÇ          ‚ñº                                                            ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                   ‚îÇ
‚îÇ   ‚îÇ   Final      ‚îÇ                                                   ‚îÇ
‚îÇ   ‚îÇ   Response   ‚îÇ                                                   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                   ‚îÇ
‚îÇ                                                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å**: LLM **–ù–ï –í–´–ü–û–õ–ù–Ø–ï–¢** —Ñ—É–Ω–∫—Ü–∏–∏. LLM —Ç–æ–ª—å–∫–æ:
1. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –†–µ—à–∞–µ—Ç, –∫–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω—É–∂–Ω–∞
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π "–∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–∑–æ–≤"

**–¢–≤–æ–π –∫–æ–¥** –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:
1. –ü–æ–ª—É—á–µ–Ω–∏–µ tool_call –æ—Ç LLM
2. –í–∞–ª–∏–¥–∞—Ü–∏—é –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ (security!)
3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
4. –û—Ç–ø—Ä–∞–≤–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–±—Ä–∞—Ç–Ω–æ LLM

### –ê–Ω–∞—Ç–æ–º–∏—è Tool Definition

```python
# Tool ‚Äî —ç—Ç–æ JSON Schema, –æ–ø–∏—Å—ã–≤–∞—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—é

tool_definition = {
    # –¢–∏–ø tool (–ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ "function")
    "type": "function",

    "function": {
        # –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî LLM –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –≤—ã–∑–æ–≤–∞
        # –õ—É—á—à–µ: –≥–ª–∞–≥–æ–ª + —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ (search_products, get_weather)
        "name": "search_products",

        # –û–ø–∏—Å–∞–Ω–∏–µ ‚Äî –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!
        # LLM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è, –∫–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
        # –ß–µ–º –ª—É—á—à–µ –æ–ø–∏—Å–∞–Ω–∏–µ, —Ç–µ–º —Ç–æ—á–Ω–µ–µ –≤—ã–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–∏
        "description": """
        –ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–ª–∏ —Ü–µ–Ω–æ–≤–æ–º—É –¥–∏–∞–ø–∞–∑–æ–Ω—É.

        –ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –∫–æ–≥–¥–∞:
        - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—â–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç
        - –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –±—é–¥–∂–µ—Ç

        –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –¥–ª—è:
        - –ü–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–π get_product_details)
        - –û—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ (–∏—Å–ø–æ–ª—å–∑—É–π create_order)
        """,

        # strict: true ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ (OpenAI)
        "strict": True,

        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏ –∫–∞–∫ JSON Schema
        "parameters": {
            "type": "object",

            "properties": {
                "query": {
                    "type": "string",
                    "description": "–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å (–Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞)"
                },

                "category": {
                    "type": "string",
                    # Enum –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≤—ã–±–æ—Ä
                    "enum": ["electronics", "clothing", "books", "home"],
                    "description": "–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏"
                },

                "min_price": {
                    "type": "number",
                    "description": "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –≤ USD"
                },

                "max_price": {
                    "type": "number",
                    "description": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –≤ USD"
                },

                "in_stock_only": {
                    "type": "boolean",
                    "description": "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏",
                    # Default –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ description
                    "default": True
                }
            },

            # Required –ø–æ–ª—è ‚Äî LLM –æ–±—è–∑–∞–Ω–∞ –∏—Ö –∑–∞–ø–æ–ª–Ω–∏—Ç—å
            "required": ["query"],

            # additionalProperties: false ‚Äî –∑–∞–ø—Ä–µ—â–∞–µ—Ç –ª–∏—à–Ω–∏–µ –ø–æ–ª—è
            # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è strict mode!
            "additionalProperties": False
        }
    }
}
```

### Parallel Tool Calls: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

LLM –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ tool calls –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å. –≠—Ç–æ –º–æ—â–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

```
User: "–°—Ä–∞–≤–Ω–∏ –ø–æ–≥–æ–¥—É –≤ –ú–æ—Å–∫–≤–µ –∏ –ü–∞—Ä–∏–∂–µ, –∏ –∫—É—Ä—Å –µ–≤—Ä–æ –∫ —Ä—É–±–ª—é"

–ë–µ–∑ parallel calls:
  Request 1 ‚Üí get_weather("Moscow")   ‚Üí Response 1
  Request 2 ‚Üí get_weather("Paris")    ‚Üí Response 2
  Request 3 ‚Üí get_exchange_rate()     ‚Üí Response 3
  Request 4 ‚Üí Final response

  –ò—Ç–æ–≥–æ: 4 API calls, ~8 —Å–µ–∫—É–Ω–¥

–° parallel calls:
  Request 1 ‚Üí [
    get_weather("Moscow"),
    get_weather("Paris"),
    get_exchange_rate()
  ]

  –¢–≤–æ–π –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –í–°–ï –¢–†–ò –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (asyncio, threading)

  Request 2 ‚Üí Final response (—Å —Ç—Ä–µ–º—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏)

  –ò—Ç–æ–≥–æ: 2 API calls, ~3 —Å–µ–∫—É–Ω–¥—ã
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è parallel execution:**

```python
import asyncio
from typing import List, Dict, Any

async def execute_tool(name: str, args: dict) -> dict:
    """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ tool call"""
    if name == "get_weather":
        return await weather_api.get(args["city"])
    elif name == "get_exchange_rate":
        return await forex_api.get(args["from"], args["to"])
    # ... –¥—Ä—É–≥–∏–µ tools

async def execute_tools_parallel(tool_calls: List[dict]) -> List[dict]:
    """
    –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö tool calls.

    –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:
    1. –í—Å–µ –≤—ã–∑–æ–≤—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
    2. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ
    3. –ö–∞–∂–¥—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–≤—è–∑–∞–Ω —Å tool_call_id
    """
    tasks = [
        execute_tool(tc["function"]["name"], tc["function"]["arguments"])
        for tc in tool_calls
    ]

    results = await asyncio.gather(*tasks, return_exceptions=True)

    return [
        {
            "tool_call_id": tc["id"],
            "result": result if not isinstance(result, Exception) else {"error": str(result)}
        }
        for tc, result in zip(tool_calls, results)
    ]
```

---

## Constrained Decoding: –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

### Finite State Machine (FSM) –ø–æ–¥—Ö–æ–¥

Constrained decoding –¥–ª—è structured outputs —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º–∞–ª–∏–∑–º –∫–æ–Ω–µ—á–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤. JSON Schema —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≤ FSM, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

```
JSON Schema ‚Üí Regular Expression ‚Üí Finite State Machine

–ü—Ä–∏–º–µ—Ä –¥–ª—è enum ["active", "inactive"]:

     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ                                       ‚îÇ
     ‚îÇ    ‚îå‚îÄ‚îÄ‚îê  'a'   ‚îå‚îÄ‚îÄ‚îê  'c'   ‚îå‚îÄ‚îÄ‚îê      ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇS1‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇS2‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇS3‚îÇ ...  ‚îÇ
     ‚îÇ    ‚îî‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îò      ‚îÇ
     ‚îÇ                                       ‚îÇ
     ‚îÇ    ‚îå‚îÄ‚îÄ‚îê  'i'   ‚îå‚îÄ‚îÄ‚îê  'n'   ‚îå‚îÄ‚îÄ‚îê      ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇS4‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇS5‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇS6‚îÇ ...  ‚îÇ
          ‚îî‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îò
```

–ù–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM
2. –ü–æ–ª—É—á–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (—Ç–æ–∫–µ–Ω–æ–≤)
3. –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å–∫—É –∫ logits (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º —Ç–æ–∫–µ–Ω–æ–≤)
4. –ú–æ–¥–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–∫–µ–Ω —Ç–æ–ª—å–∫–æ –∏–∑ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### XGrammar (MLC-AI)

XGrammar ‚Äî default backend –¥–ª—è vLLM, SGLang, TensorRT-LLM —Å –¥–µ–∫–∞–±—Ä—è 2024.

```python
# XGrammar –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç context-free grammars —á–µ—Ä–µ–∑ pushdown automaton
# –≠—Ç–æ –º–æ—â–Ω–µ–µ —á–µ–º FSM ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å vLLM
from vllm import LLM, SamplingParams

llm = LLM(model="meta-llama/Llama-3.1-8B-Instruct")

# JSON Schema constraint
sampling_params = SamplingParams(
    temperature=0.7,
    guided_decoding_backend="xgrammar",  # –∏–ª–∏ "outlines"
    guided_json={
        "type": "object",
        "properties": {
            "name": {"type": "string"},
            "age": {"type": "integer"}
        },
        "required": ["name", "age"]
    }
)

output = llm.generate(["Extract: John is 30 years old"], sampling_params)
```

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å XGrammar:**
- –î–æ **100x** —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏
- –î–æ **3.5x** –±—ã—Å—Ç—Ä–µ–µ Outlines –Ω–∞ JSON workloads
- –î–æ **10x** –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ CFG-guided generation
- –ü–æ—á—Ç–∏ –Ω—É–ª–µ–≤–æ–π overhead –≤ end-to-end LLM serving

#### Outlines (dottxt-ai)

Outlines ‚Äî pioneer –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è constrained generation, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ FSM:

```python
from outlines import models, generate
from pydantic import BaseModel

# –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å
model = models.transformers("mistralai/Mistral-7B-v0.1")

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ö–µ–º—É
class Character(BaseModel):
    name: str
    age: int
    occupation: str

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ö–µ–º–µ
generator = generate.json(model, Character)
result = generator("Create a character for a story:")
print(result)  # Character(name="...", age=..., occupation="...")
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
- JSON Schema / Pydantic models
- Regular expressions
- Context-free grammars (EBNF)
- –ü—Ä–æ—Å—Ç—ã–µ —Ç–∏–ø—ã (int, float, bool, datetime)
- Choices / Literals

```python
from outlines import generate

# Regex constraint
phone_generator = generate.regex(model, r"\d{3}-\d{3}-\d{4}")
phone = phone_generator("Generate a US phone number:")  # "555-123-4567"

# Choice constraint
sentiment = generate.choice(model, ["positive", "negative", "neutral"])
result = sentiment("The movie was great!")  # "positive"
```

#### LM Format Enforcer

LM Format Enforcer –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É constraint-–æ–≤ –≤–º–µ—Å—Ç–æ precomputation:

```python
from lmformatenforcer import JsonSchemaParser
from lmformatenforcer.integrations.vllm import build_vllm_logits_processor

# –°–æ–∑–¥–∞—ë–º parser –∏–∑ JSON Schema
schema = {
    "type": "object",
    "properties": {
        "answer": {"type": "string"},
        "confidence": {"type": "number", "minimum": 0, "maximum": 1}
    }
}
parser = JsonSchemaParser(schema)

# –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º —Å vLLM
logits_processor = build_vllm_logits_processor(parser)
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ì–∏–±–∫–æ—Å—Ç—å: –º–æ–¥–µ–ª—å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç whitespace –∏ –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ schemaless JSON mode
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Transformers, vLLM, llama.cpp, ExLlamaV2

#### Microsoft Guidance (llguidance)

Microsoft Guidance –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–º–µ—à–∏–≤–∞—Ç—å generation –∏ control flow:

```python
from guidance import models, gen

# –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å
lm = models.LlamaCpp("path/to/model.gguf")

# –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å constraints
program = lm + f"""\
Extract information from the text.

Text: {text}

Name: {gen('name', stop='\n')}
Age: {gen('age', regex='[0-9]+')}
City: {gen('city', stop='\n')}
"""

print(program['name'], program['age'], program['city'])
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- **50% reduction** –≤ runtime —á–µ—Ä–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é KV-cache
- Python-native —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Å constraints
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ conditionals, loops, tool use –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

---

## –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏

### Instructor: –õ–∏–¥–µ—Ä —Ä—ã–Ω–∫–∞

**Instructor** ‚Äî —Å–∞–º–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–∞—è Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è structured outputs (3M+ downloads/month, 11k+ stars).

```python
import instructor
from openai import OpenAI
from pydantic import BaseModel, Field
from typing import List

# –ü–∞—Ç—á–∏–º –∫–ª–∏–µ–Ω—Ç
client = instructor.from_openai(OpenAI())

class ReviewAnalysis(BaseModel):
    """–ê–Ω–∞–ª–∏–∑ –æ—Ç–∑—ã–≤–∞ –æ –ø—Ä–æ–¥—É–∫—Ç–µ."""
    sentiment: str = Field(description="positive, negative, or neutral")
    rating: int = Field(ge=1, le=5, description="Rating from 1 to 5")
    pros: List[str] = Field(description="List of positive aspects")
    cons: List[str] = Field(description="List of negative aspects")

# –û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –¥–ª—è structured extraction
analysis = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[
        {"role": "user", "content": f"Analyze this review: {review_text}"}
    ],
    response_model=ReviewAnalysis,
    max_retries=3  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ retry –ø—Ä–∏ validation errors
)

print(analysis.sentiment)  # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤–∞–ª–∏–¥–Ω—ã–π —Ç–∏–ø
```

**–ö–ª—é—á–µ–≤—ã–µ features:**
- **15+ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤**: OpenAI, Anthropic, Google, Mistral, Cohere, Ollama, etc.
- **Automatic retries**: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **Streaming**: `create_partial()` –¥–ª—è partial results
- **Hooks**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ logging

```python
# Hooks –¥–ª—è observability
client.on("completion:kwargs", lambda **kw: print(f"Request: {kw}"))
client.on("completion:response", lambda r: print(f"Response: {r}"))
client.on("completion:error", lambda e: log_error(e))

# Streaming partial results
for partial in client.chat.completions.create_partial(
    model="gpt-4o",
    messages=[...],
    response_model=LargeModel
):
    # –ü–æ–ª—É—á–∞–µ–º —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å
    print(f"Progress: {partial}")
```

### Pydantic AI: –û—Ç —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π Pydantic

**Pydantic AI** ‚Äî agent framework –æ—Ç –∫–æ–º–∞–Ω–¥—ã Pydantic, –∏–¥–µ–∞–ª—å–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–æ structured outputs:

```python
from pydantic_ai import Agent
from pydantic import BaseModel

class CityInfo(BaseModel):
    name: str
    country: str
    population: int

# Agent —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º output
agent = Agent(
    'openai:gpt-4o',
    output_type=CityInfo,  # Structured output
    instructions="You are a geography expert."
)

result = agent.run_sync("Tell me about Tokyo")
print(result.output)  # CityInfo(name="Tokyo", country="Japan", population=...)
```

**Tool definitions —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã:**

```python
from pydantic_ai import Agent

agent = Agent('anthropic:claude-sonnet-4-0')

@agent.tool
def get_weather(city: str) -> dict:
    """Get current weather for a city.

    Args:
        city: The city name to look up weather for
    """
    # Docstring —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–ø–∏—Å–∞–Ω–∏–µ–º –¥–ª—è LLM
    return {"temp": 20, "condition": "sunny"}

result = agent.run_sync("What's the weather in Paris?")
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Pydantic
- Type-safe tools —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
- Dependency injection
- Async support
- Observability —á–µ—Ä–µ–∑ Logfire

### BAML (Boundary ML): Schema-Aligned Parsing

**BAML** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –≤–º–µ—Å—Ç–æ constrained decoding –ø–∞—Ä—Å–∏—Ç "—Å–ª–æ–º–∞–Ω–Ω—ã–π" JSON:

```baml
// schema.baml
function ExtractResume(resume_text: string) -> Resume {
  client GPT4
  prompt #"
    Extract information from the resume.

    Resume:
    {{ resume_text }}
  "#
}

class Resume {
  name string
  email string
  skills string[]
  experience Experience[]
}

class Experience {
  company string
  role string
  years int
}
```

```python
# Python usage
from baml_client import b

result = b.ExtractResume(resume_text="...")
print(result.name)
```

**–§–∏–ª–æ—Å–æ—Ñ–∏—è BAML:**
- Structured outputs –º–æ–≥—É—Ç —Å–Ω–∏–∂–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ reasoning (–º–æ–¥–µ–ª—å —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ñ–æ—Ä–º–∞—Ç–µ)
- –õ—É—á—à–µ –¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –ø–∏—Å–∞—Ç—å naturally, –ø–æ—Ç–æ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å
- SAP (Schema-Aligned Parsing) —É–º–µ–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å:
  - Markdown –≤–Ω—É—Ç—Ä–∏ JSON
  - Chain-of-thought –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º
  - –ù–µ–±–æ–ª—å—à–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

### LangChain: with_structured_output

LangChain –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API –¥–ª—è structured outputs:

```python
from langchain_openai import ChatOpenAI
from pydantic import BaseModel

class Joke(BaseModel):
    setup: str
    punchline: str

llm = ChatOpenAI(model="gpt-4o")
structured_llm = llm.with_structured_output(Joke)

result = structured_llm.invoke("Tell me a joke about programming")
print(result.setup)     # str
print(result.punchline) # str
```

**–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:**
- `function_calling`: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç tool calling API
- `json_mode`: JSON –±–µ–∑ strict schema
- `json_schema`: Strict schema (default –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –º–æ–¥–µ–ª–µ–π)

```python
# –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞
structured_llm = llm.with_structured_output(
    Joke,
    method="json_schema",  # –∏–ª–∏ "function_calling", "json_mode"
    strict=True
)
```

### LlamaIndex: Structured Extraction

LlamaIndex –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è extraction:

```python
from llama_index.core import VectorStoreIndex
from llama_index.core.output_parsers import PydanticOutputParser
from pydantic import BaseModel
from typing import List

class ProductInfo(BaseModel):
    name: str
    price: float
    features: List[str]

# –°–æ–∑–¥–∞—ë–º query engine —Å structured output
index = VectorStoreIndex.from_documents(documents)
query_engine = index.as_query_engine(
    output_parser=PydanticOutputParser(ProductInfo)
)

result = query_engine.query("What are the main features of Product X?")
# result.response ‚Äî —ç—Ç–æ ProductInfo object
```

### Marvin: AI Functions

Marvin –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ AI operations:

```python
import marvin

# Extraction
names = marvin.extract(
    "I met John and Sarah at the conference",
    target=str,
    instructions="Extract person names"
)
# ["John", "Sarah"]

# Classification
sentiment = marvin.classify(
    "This product is amazing!",
    labels=["positive", "negative", "neutral"]
)
# "positive"

# Cast (type conversion —á–µ—Ä–µ–∑ LLM)
@marvin.fn
def analyze_sentiment(text: str) -> Literal["positive", "negative", "neutral"]:
    """Analyze the sentiment of the given text."""

result = analyze_sentiment("I love this!")  # "positive"
```

### –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –§–æ–∫—É—Å | –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã | Retries | Streaming | Complexity |
|------------|-------|------------|---------|-----------|------------|
| **Instructor** | Extraction | 15+ | –î–∞ | –î–∞ | –ù–∏–∑–∫–∞—è |
| **Pydantic AI** | Agents | Major | –î–∞ | –î–∞ | –ù–∏–∑–∫–∞—è |
| **BAML** | Schema parsing | All | –ù–µ—Ç | –ù–µ—Ç | –°—Ä–µ–¥–Ω—è—è |
| **LangChain** | Orchestration | Major | –î–∞ | –î–∞ | –í—ã—Å–æ–∫–∞—è |
| **LlamaIndex** | RAG + Extraction | Major | –î–∞ | –î–∞ | –°—Ä–µ–¥–Ω—è—è |
| **Outlines** | Constrained gen | Local | –ù–µ—Ç | –î–∞ | –°—Ä–µ–¥–Ω—è—è |
| **Marvin** | AI functions | OpenAI | –ù–µ—Ç | –ù–µ—Ç | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è |

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### OpenAI: –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

```python
"""
–ü–æ–ª–Ω—ã–π production-ready –ø—Ä–∏–º–µ—Ä Function Calling —Å OpenAI.

–í–∫–ª—é—á–∞–µ—Ç:
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ tools —Å strict mode
- –û–±—Ä–∞–±–æ—Ç–∫–∞ parallel tool calls
- Error handling –∏ fallbacks
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è debugging
"""

import json
import logging
from typing import Callable, Dict, Any
from openai import OpenAI
from pydantic import BaseModel

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

client = OpenAI()

# ============ TOOL DEFINITIONS ============

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º tools –∫–∞–∫ Python —Ñ—É–Ω–∫—Ü–∏–∏ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
def get_weather(city: str, units: str = "celsius") -> dict:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É –≤ –≥–æ—Ä–æ–¥–µ.

    –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã API call –∫ weather service.
    """
    # –°–∏–º—É–ª—è—Ü–∏—è API response
    weather_data = {
        "Moscow": {"temp": -5, "condition": "snow", "humidity": 85},
        "Paris": {"temp": 8, "condition": "cloudy", "humidity": 70},
        "Tokyo": {"temp": 15, "condition": "sunny", "humidity": 60},
    }

    data = weather_data.get(city, {"temp": 20, "condition": "unknown", "humidity": 50})

    if units == "fahrenheit":
        data["temp"] = data["temp"] * 9/5 + 32

    return {**data, "city": city, "units": units}


def search_restaurants(
    location: str,
    cuisine: str | None = None,
    price_range: str | None = None,
    rating_min: float = 0.0
) -> list:
    """
    –ü–æ–∏—Å–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º.
    """
    # –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–∏—Å–∫–∞
    restaurants = [
        {"name": "Sakura", "cuisine": "japanese", "rating": 4.5, "price": "$$"},
        {"name": "La Maison", "cuisine": "french", "rating": 4.8, "price": "$$$"},
        {"name": "Pizza Roma", "cuisine": "italian", "rating": 4.2, "price": "$"},
    ]

    # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    results = restaurants
    if cuisine:
        results = [r for r in results if r["cuisine"] == cuisine]
    if rating_min:
        results = [r for r in results if r["rating"] >= rating_min]

    return results[:5]  # Limit results


# –†–µ–µ—Å—Ç—Ä —Ñ—É–Ω–∫—Ü–∏–π ‚Äî —Å–≤—è–∑—ã–≤–∞–µ—Ç –∏–º–µ–Ω–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
TOOL_REGISTRY: Dict[str, Callable] = {
    "get_weather": get_weather,
    "search_restaurants": search_restaurants,
}

# JSON Schema –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
TOOLS = [
    {
        "type": "function",
        "function": {
            "name": "get_weather",
            "description": "–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ –ø–æ–≥–æ–¥–µ, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ, –æ—Å–∞–¥–∫–∞—Ö.",
            "strict": True,
            "parameters": {
                "type": "object",
                "properties": {
                    "city": {
                        "type": "string",
                        "description": "–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: Moscow, Paris, Tokyo)"
                    },
                    "units": {
                        "type": "string",
                        "enum": ["celsius", "fahrenheit"],
                        "description": "–ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã"
                    }
                },
                "required": ["city", "units"],
                "additionalProperties": False
            }
        }
    },
    {
        "type": "function",
        "function": {
            "name": "search_restaurants",
            "description": "–ü–æ–∏—Å–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –º–µ—Å—Ç–µ. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—â–µ—Ç –≥–¥–µ –ø–æ–µ—Å—Ç—å, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, –∫–∞—Ñ–µ.",
            "strict": True,
            "parameters": {
                "type": "object",
                "properties": {
                    "location": {
                        "type": "string",
                        "description": "–ì–æ—Ä–æ–¥ –∏–ª–∏ —Ä–∞–π–æ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞"
                    },
                    "cuisine": {
                        "type": "string",
                        "enum": ["italian", "japanese", "french", "chinese", "mexican"],
                        "description": "–¢–∏–ø –∫—É—Ö–Ω–∏"
                    },
                    "price_range": {
                        "type": "string",
                        "enum": ["$", "$$", "$$$"],
                        "description": "–¶–µ–Ω–æ–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω"
                    },
                    "rating_min": {
                        "type": "number",
                        "description": "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ (0-5)"
                    }
                },
                "required": ["location"],
                "additionalProperties": False
            }
        }
    }
]


# ============ EXECUTION ENGINE ============

def execute_tool_call(tool_call) -> str:
    """
    –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ tool call —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫.

    Returns:
        JSON string —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∏–ª–∏ –æ—à–∏–±–∫–æ–π
    """
    function_name = tool_call.function.name

    try:
        # –ü–∞—Ä—Å–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã
        arguments = json.loads(tool_call.function.arguments)
        logger.info(f"Executing {function_name} with args: {arguments}")

        # –ü–æ–ª—É—á–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞
        if function_name not in TOOL_REGISTRY:
            return json.dumps({"error": f"Unknown function: {function_name}"})

        func = TOOL_REGISTRY[function_name]

        # –í—ã–ø–æ–ª–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é
        result = func(**arguments)

        logger.info(f"Result from {function_name}: {result}")
        return json.dumps(result, ensure_ascii=False)

    except json.JSONDecodeError as e:
        logger.error(f"Failed to parse arguments: {e}")
        return json.dumps({"error": f"Invalid arguments JSON: {e}"})

    except TypeError as e:
        # –ù–µ–≤–µ—Ä–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏
        logger.error(f"Invalid function arguments: {e}")
        return json.dumps({"error": f"Invalid arguments: {e}"})

    except Exception as e:
        # –õ—é–±–∞—è –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞
        logger.exception(f"Error executing {function_name}")
        return json.dumps({"error": f"Execution failed: {e}"})


def chat_with_tools(user_message: str, max_iterations: int = 5) -> str:
    """
    –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—â–µ–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π tool calls.

    Args:
        user_message: –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        max_iterations: –ú–∞–∫—Å–∏–º—É–º –∏—Ç–µ—Ä–∞—Ü–∏–π (–∑–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤)

    Returns:
        –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
    """
    messages = [
        {
            "role": "system",
            "content": """–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º.
            –ò—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.
            –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ."""
        },
        {"role": "user", "content": user_message}
    ]

    for iteration in range(max_iterations):
        logger.info(f"Iteration {iteration + 1}")

        # –ó–∞–ø—Ä–æ—Å –∫ LLM
        response = client.chat.completions.create(
            model="gpt-4o",
            messages=messages,
            tools=TOOLS,
            tool_choice="auto"  # LLM —Å–∞–º —Ä–µ—à–∞–µ—Ç, –Ω—É–∂–Ω—ã –ª–∏ tools
        )

        assistant_message = response.choices[0].message

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ tool calls
        if not assistant_message.tool_calls:
            # –ù–µ—Ç tool calls ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
            logger.info("No tool calls, returning text response")
            return assistant_message.content

        # –ï—Å—Ç—å tool calls ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ–º –∏—Ö
        logger.info(f"Got {len(assistant_message.tool_calls)} tool calls")

        # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é
        messages.append(assistant_message)

        # –í—ã–ø–æ–ª–Ω—è–µ–º –∫–∞–∂–¥—ã–π tool call
        for tool_call in assistant_message.tool_calls:
            result = execute_tool_call(tool_call)

            # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
            messages.append({
                "role": "tool",
                "tool_call_id": tool_call.id,
                "content": result
            })

    # –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∏—Ç–µ—Ä–∞—Ü–∏–π
    logger.warning("Max iterations reached")
    return "–ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–ø—Ä–æ—Å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å."


# ============ USAGE ============

if __name__ == "__main__":
    # –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –ø–æ–≥–æ–¥—ã
    print("=" * 50)
    result = chat_with_tools("–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –≤ –ú–æ—Å–∫–≤–µ?")
    print(f"Response: {result}")

    # –ü—Ä–∏–º–µ—Ä 2: Parallel tool calls
    print("=" * 50)
    result = chat_with_tools("–°—Ä–∞–≤–Ω–∏ –ø–æ–≥–æ–¥—É –≤ –ú–æ—Å–∫–≤–µ –∏ –ü–∞—Ä–∏–∂–µ")
    print(f"Response: {result}")

    # –ü—Ä–∏–º–µ—Ä 3: –ü–æ–∏—Å–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
    print("=" * 50)
    result = chat_with_tools("–ù–∞–π–¥–∏ —Ö–æ—Ä–æ—à–∏–µ —è–ø–æ–Ω—Å–∫–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã –≤ —Ü–µ–Ω—Ç—Ä–µ")
    print(f"Response: {result}")

    # –ü—Ä–∏–º–µ—Ä 4: –ë–µ–∑ tools (LLM –æ—Ç–≤–µ—á–∞–µ—Ç —Å–∞–º)
    print("=" * 50)
    result = chat_with_tools("–ß—Ç–æ —Ç–∞–∫–æ–µ –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ?")
    print(f"Response: {result}")
```

### Anthropic: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å Claude

Claude –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –¥—Ä—É–≥–æ–π API, –Ω–æ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è —Ç–∞ –∂–µ.

```python
"""
Tool Use —Å Anthropic Claude.

–ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è –æ—Ç OpenAI:
1. input_schema –≤–º–µ—Å—Ç–æ parameters
2. –î—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç tool results
3. stop_reason –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è tool use
"""

import anthropic
import json
from typing import Dict, Any

client = anthropic.Anthropic()

# ============ TOOL DEFINITIONS (Anthropic format) ============

TOOLS = [
    {
        "name": "get_weather",
        # Anthropic –∏—Å–ø–æ–ª—å–∑—É–µ—Ç input_schema, –∞ –Ω–µ parameters
        "description": "–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É –≤ –≥–æ—Ä–æ–¥–µ",
        "input_schema": {
            "type": "object",
            "properties": {
                "city": {
                    "type": "string",
                    "description": "–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞"
                },
                "units": {
                    "type": "string",
                    "enum": ["celsius", "fahrenheit"]
                }
            },
            "required": ["city"]
        }
    },
    {
        "name": "calculate",
        "description": "–í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è",
        "input_schema": {
            "type": "object",
            "properties": {
                "expression": {
                    "type": "string",
                    "description": "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2 + 2 * 3)"
                }
            },
            "required": ["expression"]
        }
    }
]

# –†–µ–µ—Å—Ç—Ä —Ñ—É–Ω–∫—Ü–∏–π
def get_weather(city: str, units: str = "celsius") -> dict:
    weather_data = {
        "Moscow": {"temp": -5, "condition": "snow"},
        "Paris": {"temp": 8, "condition": "cloudy"},
    }
    return weather_data.get(city, {"temp": 20, "condition": "unknown"})

def calculate(expression: str) -> dict:
    try:
        # –í–ù–ò–ú–ê–ù–ò–ï: –í production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π eval!
        # –≠—Ç–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        import ast
        # –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π eval —á–µ—Ä–µ–∑ AST
        result = eval(compile(ast.parse(expression, mode='eval'), '', 'eval'))
        return {"result": result, "expression": expression}
    except Exception as e:
        return {"error": str(e)}

TOOL_REGISTRY = {
    "get_weather": get_weather,
    "calculate": calculate,
}


def chat_with_claude(user_message: str) -> str:
    """
    –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—â–µ–Ω–∏—è —Å Claude –∏ tool use.
    """
    messages = [{"role": "user", "content": user_message}]

    while True:
        # –ó–∞–ø—Ä–æ—Å –∫ Claude
        response = client.messages.create(
            model="claude-sonnet-4-5-20250929",
            max_tokens=1024,
            tools=TOOLS,
            messages=messages
        )

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º stop_reason
        # "tool_use" –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Claude —Ö–æ—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
        if response.stop_reason != "tool_use":
            # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
            for block in response.content:
                if hasattr(block, "text"):
                    return block.text
            return "No response generated"

        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º tool use
        tool_results = []

        for block in response.content:
            if block.type == "tool_use":
                # –í—ã–ø–æ–ª–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é
                func = TOOL_REGISTRY.get(block.name)
                if func:
                    result = func(**block.input)
                else:
                    result = {"error": f"Unknown tool: {block.name}"}

                # –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ Anthropic
                tool_results.append({
                    "type": "tool_result",
                    "tool_use_id": block.id,
                    "content": json.dumps(result, ensure_ascii=False)
                })

        # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∏—Å—Ç–æ—Ä–∏—é
        messages.append({"role": "assistant", "content": response.content})
        messages.append({"role": "user", "content": tool_results})


if __name__ == "__main__":
    # –¢–µ—Å—Ç
    result = chat_with_claude("–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –≤ –ú–æ—Å–∫–≤–µ –∏ —Å–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 15 * 7 + 23?")
    print(result)
```

### Instructor: –£–ø—Ä–æ—â–∞–µ–º –≤—Å—ë

Instructor ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –∞–±—Å—Ç—Ä–∞–≥–∏—Ä—É–µ—Ç boilerplate –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç Pydantic validation.

```python
"""
Instructor ‚Äî —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ structured outputs.

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
1. Pydantic models –≤–º–µ—Å—Ç–æ JSON Schema
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ retries –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏
3. –ï–¥–∏–Ω—ã–π API –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
4. Type safety –∏ IDE autocomplete
"""

import instructor
from openai import OpenAI
from anthropic import Anthropic
from pydantic import BaseModel, Field, field_validator
from typing import List, Optional
from enum import Enum

# ============ PYDANTIC MODELS ============

class Sentiment(str, Enum):
    POSITIVE = "positive"
    NEGATIVE = "negative"
    NEUTRAL = "neutral"

class ReviewAnalysis(BaseModel):
    """–ê–Ω–∞–ª–∏–∑ –æ—Ç–∑—ã–≤–∞ –æ –ø—Ä–æ–¥—É–∫—Ç–µ."""

    sentiment: Sentiment = Field(
        description="–û–±—â–∞—è —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç–∑—ã–≤–∞"
    )

    rating: int = Field(
        ge=1, le=5,
        description="–û—Ü–µ–Ω–∫–∞ –æ—Ç 1 –¥–æ 5"
    )

    pros: List[str] = Field(
        description="–°–ø–∏—Å–æ–∫ –ø–ª—é—Å–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–∞",
        min_length=0,
        max_length=5
    )

    cons: List[str] = Field(
        description="–°–ø–∏—Å–æ–∫ –º–∏–Ω—É—Å–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–∞",
        min_length=0,
        max_length=5
    )

    summary: str = Field(
        max_length=200,
        description="–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –æ—Ç–∑—ã–≤–∞ –≤ 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö"
    )

    @field_validator("summary")
    @classmethod
    def summary_not_empty(cls, v: str) -> str:
        if len(v.strip()) < 10:
            raise ValueError("Summary too short")
        return v


class ExtractedEntity(BaseModel):
    """–ò–∑–≤–ª–µ—á—ë–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å –∏–∑ —Ç–µ–∫—Å—Ç–∞."""

    text: str = Field(description="–¢–µ–∫—Å—Ç —Å—É—â–Ω–æ—Å—Ç–∏ –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ")
    entity_type: str = Field(description="–¢–∏–ø: PERSON, ORG, LOCATION, DATE, MONEY")
    confidence: float = Field(ge=0, le=1, description="–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –æ—Ç 0 –¥–æ 1")


class NERResult(BaseModel):
    """–†–µ–∑—É–ª—å—Ç–∞—Ç Named Entity Recognition."""
    entities: List[ExtractedEntity]

    @property
    def persons(self) -> List[ExtractedEntity]:
        return [e for e in self.entities if e.entity_type == "PERSON"]

    @property
    def organizations(self) -> List[ExtractedEntity]:
        return [e for e in self.entities if e.entity_type == "ORG"]


# ============ INSTRUCTOR SETUP ============

# –ü–∞—Ç—á–∏–º –∫–ª–∏–µ–Ω—Ç ‚Äî —ç—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç response_model –ø–æ–¥–¥–µ—Ä–∂–∫—É
openai_client = instructor.from_openai(OpenAI())
anthropic_client = instructor.from_anthropic(Anthropic())


def analyze_review(review_text: str) -> ReviewAnalysis:
    """
    –ê–Ω–∞–ª–∏–∑ –æ—Ç–∑—ã–≤–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ retries.

    Instructor –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    1. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç Pydantic model –≤ JSON Schema
    2. –ü–∞—Ä—Å–∏—Ç –æ—Ç–≤–µ—Ç LLM
    3. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ Pydantic
    4. Retries –µ—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è failed
    """
    return openai_client.chat.completions.create(
        model="gpt-4o-mini",  # –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—à—ë–≤—É—é –º–æ–¥–µ–ª—å
        messages=[
            {
                "role": "system",
                "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É –æ—Ç–∑—ã–≤–æ–≤. –ò–∑–≤–ª–µ–∫–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é."
            },
            {
                "role": "user",
                "content": f"–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –æ—Ç–∑—ã–≤:\n\n{review_text}"
            }
        ],
        response_model=ReviewAnalysis,
        max_retries=3  # –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–æ 3 —Ä–∞–∑ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
    )


def extract_entities(text: str) -> NERResult:
    """
    Named Entity Recognition —á–µ—Ä–µ–∑ LLM.

    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LLM –¥–ª—è –∑–∞–¥–∞—á NLP.
    """
    return openai_client.chat.completions.create(
        model="gpt-4o",
        messages=[
            {
                "role": "system",
                "content": """–ò–∑–≤–ª–µ–∫–∏ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞.
                –¢–∏–ø—ã: PERSON, ORG (–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏), LOCATION, DATE, MONEY.
                –£–∫–∞–∑—ã–≤–∞–π confidence –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞."""
            },
            {
                "role": "user",
                "content": text
            }
        ],
        response_model=NERResult
    )


# ============ STREAMING ============

def stream_analysis(text: str):
    """
    Streaming partial results.

    –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è:
    - –ü–æ–∫–∞–∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    - –î–ª–∏–Ω–Ω—ã—Ö –∏–∑–≤–ª–µ—á–µ–Ω–∏–π
    - –£–ª—É—á—à–µ–Ω–∏—è UX
    """
    for partial in openai_client.chat.completions.create_partial(
        model="gpt-4o-mini",
        messages=[
            {"role": "user", "content": f"Analyze: {text}"}
        ],
        response_model=ReviewAnalysis
    ):
        # partial ‚Äî —ç—Ç–æ —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
        # –ü–æ–ª—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        print(f"Current state: {partial}")

        if partial.sentiment:
            print(f"  Sentiment detected: {partial.sentiment}")
        if partial.pros:
            print(f"  Pros so far: {partial.pros}")


# ============ USAGE ============

if __name__ == "__main__":
    # –ê–Ω–∞–ª–∏–∑ –æ—Ç–∑—ã–≤–∞
    review = """
    –ö—É–ø–∏–ª iPhone 15 Pro –º–µ—Å—è—Ü –Ω–∞–∑–∞–¥. –ö–∞–º–µ—Ä–∞ –ø—Ä–æ—Å—Ç–æ –æ–≥–æ–Ω—å - —Å–Ω–∏–º–∫–∏
    –∫–∞–∫ —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ç–æ–∞–ø–ø–∞—Ä–∞—Ç–∞! –ë–∞—Ç–∞—Ä–µ—è –¥–µ—Ä–∂–∏—Ç –≤–µ—Å—å –¥–µ–Ω—å.
    –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–∏–Ω—É—Å - —Ü–µ–Ω–∞ –∫—É—Å–∞–µ—Ç—Å—è, –∏ –∑–∞—Ä—è–¥–∫–∞ –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ –Ω–µ –∏–¥—ë—Ç.
    –í —Ü–µ–ª–æ–º –¥–æ–≤–æ–ª–µ–Ω –ø–æ–∫—É–ø–∫–æ–π, —Ä–µ–∫–æ–º–µ–Ω–¥—É—é!
    """

    analysis = analyze_review(review)
    print(f"Sentiment: {analysis.sentiment.value}")
    print(f"Rating: {analysis.rating}/5")
    print(f"Pros: {analysis.pros}")
    print(f"Cons: {analysis.cons}")
    print(f"Summary: {analysis.summary}")

    # NER
    text = """
    –ò–ª–æ–Ω –ú–∞—Å–∫ –æ–±—ä—è–≤–∏–ª, —á—Ç–æ Tesla –æ—Ç–∫—Ä–æ–µ—Ç –Ω–æ–≤—ã–π –∑–∞–≤–æ–¥ –≤ –ë–µ—Ä–ª–∏–Ω–µ
    –≤ –º–∞—Ä—Ç–µ 2024 –≥–æ–¥–∞. –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ —Å–æ—Å—Ç–∞–≤—è—Ç $5 –º–ª—Ä–¥.
    """

    ner_result = extract_entities(text)
    print(f"\nPersons: {[e.text for e in ner_result.persons]}")
    print(f"Organizations: {[e.text for e in ner_result.organizations]}")
```

---

## –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å

### –û—à–∏–±–∫–∞ 1: –ü–ª–æ—Ö–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è tools

**–ü—Ä–æ–±–ª–µ–º–∞**: LLM –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö.

```python
# –ü–õ–û–•–û: –ù–µ–ø–æ–Ω—è—Ç–Ω–æ –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
{
    "name": "search",
    "description": "Search function",
    "parameters": {
        "properties": {
            "q": {"type": "string"}
        }
    }
}

# –•–û–†–û–®–û: –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
{
    "name": "search_knowledge_base",
    "description": """
    –ü–æ–∏—Å–∫ –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –∫–æ–º–ø–∞–Ω–∏–∏.

    –ò–°–ü–û–õ–¨–ó–£–ô –∫–æ–≥–¥–∞:
    - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ –ø–æ–ª–∏—Ç–∏–∫–∞—Ö –∫–æ–º–ø–∞–Ω–∏–∏
    - –ù—É–∂–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö
    - –í–æ–ø—Ä–æ—Å—ã –æ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö –∫–æ–º–ø–∞–Ω–∏–∏

    –ù–ï –ò–°–ü–û–õ–¨–ó–£–ô –¥–ª—è:
    - –û–±—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (–ø–æ–≥–æ–¥–∞, –Ω–æ–≤–æ—Å—Ç–∏)
    - –í–æ–ø—Ä–æ—Å–æ–≤ –æ –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–∞–Ω–∏—è—Ö

    –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:
    - "–ö–∞–∫–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –æ—Ç–ø—É—Å–∫–æ–≤?" ‚Üí query: "vacation policy"
    - "–ö–∞–∫ –ø–æ–¥–∞—Ç—å expense report?" ‚Üí query: "expense report process"
    """,
    "parameters": {
        "properties": {
            "query": {
                "type": "string",
                "description": "–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, 2-5 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤"
            }
        }
    }
}
```

### –û—à–∏–±–∫–∞ 2: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ tools

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ tools (>10-15) –º–æ–¥–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—É—Ç–∞—Ç—å—Å—è.

```python
# –ü–õ–û–•–û: 30 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö tools
tools = [
    {"name": "get_user_profile", ...},
    {"name": "update_user_name", ...},
    {"name": "update_user_email", ...},
    {"name": "update_user_phone", ...},
    {"name": "delete_user", ...},
    # ... –µ—â—ë 25 tools
]

# –•–û–†–û–®–û: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏–ª–∏ RAG-based selection
# –í–∞—Ä–∏–∞–Ω—Ç 1: –û–¥–∏–Ω tool —Å actions
{
    "name": "manage_user",
    "description": "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
    "parameters": {
        "properties": {
            "action": {
                "type": "string",
                "enum": ["get", "update", "delete"]
            },
            "user_id": {"type": "string"},
            "updates": {
                "type": "object",
                "description": "–ü–æ–ª—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–¥–ª—è action=update)"
            }
        }
    }
}

# –í–∞—Ä–∏–∞–Ω—Ç 2: RAG-based tool selection
async def select_relevant_tools(user_query: str, all_tools: list) -> list:
    """–í—ã–±—Ä–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ tools —á–µ—Ä–µ–∑ semantic search."""
    query_embedding = await embed(user_query)
    tool_embeddings = await embed_tools(all_tools)

    similarities = cosine_similarity(query_embedding, tool_embeddings)
    top_indices = similarities.argsort()[-5:]  # Top 5 tools

    return [all_tools[i] for i in top_indices]
```

> **Anthropic Tool Search Tool (2025)**: Anthropic –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª Tool Search Tool, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç Claude —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç—ã—Å—è—á–∞–º–∏ tools –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –≤ context window. Tools –ø–æ–º–µ—á–∞—é—Ç—Å—è `defer_loading: true`, –∏ Claude –Ω–∞—Ö–æ–¥–∏—Ç –Ω—É–∂–Ω—ã–µ —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫.

### –û—à–∏–±–∫–∞ 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: Blind trust –∫ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º –æ—Ç LLM = security —Ä–∏—Å–∫.

```python
# –ü–õ–û–•–û: –ù–∏–∫–∞–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
def execute_sql(query: str) -> dict:
    return db.execute(query)  # SQL Injection!

# –ü–õ–û–•–û: eval –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏
def calculate(expression: str) -> dict:
    return {"result": eval(expression)}  # Code Injection!

# –•–û–†–û–®–û: –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
from pydantic import BaseModel, field_validator
import re

class SQLQuery(BaseModel):
    table: str
    columns: list[str]
    where: dict | None = None
    limit: int = 100

    @field_validator("table")
    @classmethod
    def validate_table(cls, v: str) -> str:
        allowed_tables = {"users", "products", "orders"}
        if v not in allowed_tables:
            raise ValueError(f"Table {v} not allowed")
        return v

    @field_validator("limit")
    @classmethod
    def validate_limit(cls, v: int) -> int:
        if v > 1000:
            raise ValueError("Limit too high")
        return v

def safe_query(query: SQLQuery) -> dict:
    """–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π SQL —á–µ—Ä–µ–∑ ORM –∏–ª–∏ prepared statements."""
    return db.session.query(query.table).filter(**query.where).limit(query.limit).all()


class MathExpression(BaseModel):
    expression: str

    @field_validator("expression")
    @classmethod
    def validate_expression(cls, v: str) -> str:
        # –¢–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
        if not re.match(r'^[\d\s\+\-\*\/\(\)\.]+$', v):
            raise ValueError("Invalid characters in expression")
        return v

def safe_calculate(expr: MathExpression) -> dict:
    """–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ ast.literal_eval –∏–ª–∏ numexpr."""
    import ast
    return {"result": ast.literal_eval(expr.expression)}
```

### –û—à–∏–±–∫–∞ 4: –û–≥—Ä–æ–º–Ω—ã–µ tool results

**–ü—Ä–æ–±–ª–µ–º–∞**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã tools –ø–µ—Ä–µ–ø–æ–ª–Ω—è—é—Ç context window.

```python
# –ü–õ–û–•–û: –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å—ë
def search_database(query: str) -> dict:
    results = db.search(query)  # 10,000 –∑–∞–ø–∏—Å–µ–π
    return {"results": results}  # –£–±—å—ë—Ç context window

# –•–û–†–û–®–û: –õ–∏–º–∏—Ç—ã –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è
def search_database(
    query: str,
    limit: int = 10,
    offset: int = 0
) -> dict:
    results = db.search(query, limit=limit, offset=offset)
    total = db.count(query)

    return {
        "results": results,
        "total": total,
        "has_more": total > offset + limit,
        "next_offset": offset + limit if total > offset + limit else None
    }

# –•–û–†–û–®–û: –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –±–æ–ª—å—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
def get_document(doc_id: str) -> dict:
    doc = db.get_document(doc_id)

    if len(doc["content"]) > 5000:
        # –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –¥–ª–∏–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        summary = summarize(doc["content"])
        return {
            "id": doc_id,
            "title": doc["title"],
            "summary": summary,
            "full_content_available": True,
            "note": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ get_document_full()"
        }

    return doc
```

### –û—à–∏–±–∫–∞ 5: –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞**: LLM –Ω–µ –∑–Ω–∞–µ—Ç, —á—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∏ –Ω–µ –º–æ–∂–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è.

```python
# –ü–õ–û–•–û: –ú–æ–ª—á–∞–ª–∏–≤—ã–π fail
def execute_tool(name: str, args: dict) -> str:
    try:
        result = REGISTRY[name](**args)
        return json.dumps(result)
    except Exception:
        return json.dumps({})  # LLM –ø–æ–ª—É—á–∏—Ç –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è

# –•–û–†–û–®–û: –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—à–∏–±–∫–∏
def execute_tool(name: str, args: dict) -> str:
    try:
        result = REGISTRY[name](**args)
        return json.dumps({"success": True, "data": result})

    except KeyError:
        return json.dumps({
            "success": False,
            "error": "unknown_function",
            "message": f"Function '{name}' not found. Available: {list(REGISTRY.keys())}"
        })

    except TypeError as e:
        return json.dumps({
            "success": False,
            "error": "invalid_arguments",
            "message": f"Invalid arguments: {e}",
            "hint": "Check parameter names and types"
        })

    except PermissionError:
        return json.dumps({
            "success": False,
            "error": "permission_denied",
            "message": "This action requires elevated permissions"
        })

    except Exception as e:
        logging.exception(f"Unexpected error in {name}")
        return json.dumps({
            "success": False,
            "error": "internal_error",
            "message": "An unexpected error occurred. Please try again."
        })
```

### –û—à–∏–±–∫–∞ 6: Format restrictions —Å–Ω–∏–∂–∞—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ reasoning

**–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ strict format constraints –º–æ–≥—É—Ç —Å–Ω–∏–∂–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ reasoning.

```python
# –ü–õ–û–•–û: –§–æ—Ä—Å–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ä–∞–∑—É –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –∑–∞–¥–∞—á–∏
response = client.chat.completions.create(
    model="gpt-4o",
    messages=[
        {"role": "user", "content": "Solve this complex math problem..."}
    ],
    response_format=SolutionSchema  # –ú–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Ä–µ—à–µ–Ω–∏—è
)

# –•–û–†–û–®–û: –î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–¥—Ö–æ–¥
# –®–∞–≥ 1: –°–≤–æ–±–æ–¥–Ω–æ–µ reasoning
reasoning = client.chat.completions.create(
    model="gpt-4o",
    messages=[
        {"role": "user", "content": "Solve this problem step by step..."}
    ]
)

# –®–∞–≥ 2: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
structured = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[
        {"role": "user", "content": f"Extract solution from: {reasoning.content}"}
    ],
    response_format=SolutionSchema
)
```

> **BAML –ø–æ–¥—Ö–æ–¥**: BAML –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Schema-Aligned Parsing, –ø–æ–∑–≤–æ–ª—è—è –º–æ–¥–µ–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å naturally, –∞ –∑–∞—Ç–µ–º –ø–∞—Ä—Å–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –≠—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ reasoning.

---

## Best Practices

### 1. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Tool API

```
–ü–†–ò–ù–¶–ò–ü–´ –•–û–†–û–®–ï–ì–û TOOL API:

1. –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å
   –ö–∞–∂–¥—ã–π tool –¥–µ–ª–∞–µ—Ç –æ–¥–Ω—É –≤–µ—â—å —Ö–æ—Ä–æ—à–æ

   –ü–õ–û–•–û: manage_everything(action, entity, ...)
   –•–û–†–û–®–û: get_user(), update_user(), delete_user()

2. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
   –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ —Å —Ç–µ–º–∏ –∂–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –¥–∞—ë—Ç —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

   –•–û–†–û–®–û: get_weather("Moscow") ‚Üí –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç

3. –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –∏–º–µ–Ω–∞
   –ì–ª–∞–≥–æ–ª + —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ, snake_case

   –•–û–†–û–®–û: search_products, get_weather, send_email
   –ü–õ–û–•–û: doSearch, weatherGetter, email

4. –ü–æ–Ω—è—Ç–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è
   –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –æ—Ç–≤–µ—á–∞—Ç—å:
   - –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è?
   - –ö–æ–≥–¥–∞ –µ—ë –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?
   - –ß—Ç–æ –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç?
   - –ö–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è?

5. Reasonable defaults
   –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å —Ä–∞–∑—É–º–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

   –•–û–†–û–®–û: search(query, limit=10, offset=0)
```

### 2. Human-in-the-Loop –¥–ª—è –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

```python
from enum import Enum
from typing import Callable

class RiskLevel(str, Enum):
    SAFE = "safe"           # –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    MODERATE = "moderate"   # –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    DANGEROUS = "dangerous" # –£–¥–∞–ª–µ–Ω–∏–µ, –ø–ª–∞—Ç–µ–∂–∏, —Ä–∞—Å—Å—ã–ª–∫–∏

# –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è tools –ø–æ —É—Ä–æ–≤–Ω—é —Ä–∏—Å–∫–∞
TOOL_RISK_LEVELS = {
    "get_weather": RiskLevel.SAFE,
    "search_products": RiskLevel.SAFE,
    "update_profile": RiskLevel.MODERATE,
    "send_email": RiskLevel.MODERATE,
    "delete_account": RiskLevel.DANGEROUS,
    "process_payment": RiskLevel.DANGEROUS,
    "send_mass_email": RiskLevel.DANGEROUS,
}


class HumanApprovalRequired(Exception):
    """–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è."""
    def __init__(self, tool_name: str, arguments: dict, reason: str):
        self.tool_name = tool_name
        self.arguments = arguments
        self.reason = reason


def execute_with_approval(
    tool_name: str,
    arguments: dict,
    approval_callback: Callable[[str, dict], bool] | None = None
) -> dict:
    """
    –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ tool —Å —É—á—ë—Ç–æ–º —É—Ä–æ–≤–Ω—è —Ä–∏—Å–∫–∞.

    Args:
        tool_name: –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏
        arguments: –ê—Ä–≥—É–º–µ–Ω—Ç—ã
        approval_callback: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–¥–æ–±—Ä–µ–Ω–∏—è (UI, Slack, etc.)
    """
    risk_level = TOOL_RISK_LEVELS.get(tool_name, RiskLevel.MODERATE)

    if risk_level == RiskLevel.SAFE:
        # –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ–º —Å—Ä–∞–∑—É
        return TOOL_REGISTRY[tool_name](**arguments)

    elif risk_level == RiskLevel.MODERATE:
        # –£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–∏—Å–∫ ‚Äî –ª–æ–≥–∏—Ä—É–µ–º, –Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º
        logging.info(f"MODERATE RISK: {tool_name} with {arguments}")
        return TOOL_REGISTRY[tool_name](**arguments)

    elif risk_level == RiskLevel.DANGEROUS:
        # –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ ‚Äî —Ç—Ä–µ–±—É–µ–º –æ–¥–æ–±—Ä–µ–Ω–∏–µ
        if approval_callback is None:
            raise HumanApprovalRequired(
                tool_name=tool_name,
                arguments=arguments,
                reason=f"Dangerous operation requires human approval"
            )

        # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ–¥–æ–±—Ä–µ–Ω–∏–µ
        approved = approval_callback(tool_name, arguments)

        if approved:
            logging.warning(f"APPROVED DANGEROUS: {tool_name}")
            return TOOL_REGISTRY[tool_name](**arguments)
        else:
            return {"error": "Operation rejected by user"}
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ Observability

```python
import time
from dataclasses import dataclass
from typing import Any

@dataclass
class ToolMetrics:
    tool_name: str
    arguments: dict
    result: Any
    duration_ms: float
    success: bool
    error: str | None = None

# –ö–æ–ª–ª–µ–∫—Ç–æ—Ä –º–µ—Ç—Ä–∏–∫ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Prometheus, DataDog, etc.)
class MetricsCollector:
    def __init__(self):
        self.metrics: list[ToolMetrics] = []

    def record(self, metric: ToolMetrics):
        self.metrics.append(metric)

        # –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—É
        if not metric.success:
            logging.error(f"Tool failed: {metric.tool_name} - {metric.error}")

        if metric.duration_ms > 5000:
            logging.warning(f"Slow tool: {metric.tool_name} took {metric.duration_ms}ms")

collector = MetricsCollector()


def execute_with_metrics(tool_name: str, arguments: dict) -> dict:
    """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ tool —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏."""
    start_time = time.perf_counter()
    error = None
    success = True

    try:
        result = TOOL_REGISTRY[tool_name](**arguments)
    except Exception as e:
        result = {"error": str(e)}
        error = str(e)
        success = False

    duration_ms = (time.perf_counter() - start_time) * 1000

    collector.record(ToolMetrics(
        tool_name=tool_name,
        arguments=arguments,
        result=result,
        duration_ms=duration_ms,
        success=success,
        error=error
    ))

    return result
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Tools

```python
import pytest
from unittest.mock import patch, MagicMock

# ============ UNIT TESTS ============

def test_weather_tool_returns_correct_format():
    """Tool –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –æ–∂–∏–¥–∞–µ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ."""
    result = get_weather("Moscow", "celsius")

    assert "temp" in result
    assert "condition" in result
    assert isinstance(result["temp"], (int, float))


def test_weather_tool_handles_unknown_city():
    """Tool –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –≥–æ—Ä–æ–¥."""
    result = get_weather("UnknownCity123")

    # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∞ –Ω–µ —É–ø–∞—Å—Ç—å
    assert "temp" in result


# ============ INTEGRATION TESTS ============

@pytest.mark.integration
def test_llm_selects_correct_tool():
    """LLM –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π tool –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞."""
    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[{"role": "user", "content": "What's the weather in Tokyo?"}],
        tools=TOOLS,
        tool_choice="auto"
    )

    assert response.choices[0].message.tool_calls is not None
    assert response.choices[0].message.tool_calls[0].function.name == "get_weather"


@pytest.mark.integration
def test_llm_extracts_correct_arguments():
    """LLM –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã."""
    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[{"role": "user", "content": "–ü–æ–≥–æ–¥–∞ –≤ –ü–∞—Ä–∏–∂–µ –≤ —Ñ–∞—Ä–µ–Ω–≥–µ–π—Ç–∞—Ö"}],
        tools=TOOLS,
    )

    tool_call = response.choices[0].message.tool_calls[0]
    args = json.loads(tool_call.function.arguments)

    assert args["city"] == "Paris"
    assert args["units"] == "fahrenheit"


# ============ ADVERSARIAL TESTS ============

@pytest.mark.security
def test_tool_rejects_injection_attempt():
    """Tool –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ –∏–Ω—ä–µ–∫—Ü–∏–∏."""
    with pytest.raises(ValueError):
        # –ü–æ–ø—ã—Ç–∫–∞ SQL injection
        safe_query(SQLQuery(
            table="users; DROP TABLE users;--",
            columns=["*"]
        ))


@pytest.mark.security
def test_calculator_rejects_code_execution():
    """Calculator –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∫–æ–¥."""
    with pytest.raises(ValueError):
        safe_calculate(MathExpression(
            expression="__import__('os').system('rm -rf /')"
        ))
```

### 5. –í—ã–±–æ—Ä –ø–æ–¥—Ö–æ–¥–∞: Decision Tree

```
–ù—É–∂–µ–Ω structured output –æ—Ç LLM?
‚îÇ
‚îú‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—à—å hosted API (OpenAI, Anthropic, Google)?
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ –ü—Ä–æ—Å—Ç–∞—è extraction (1-2 –ø–æ–ª—è)?
‚îÇ   ‚îÇ   ‚îî‚îÄ Prompt engineering + JSON Mode –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ –°–ª–æ–∂–Ω–∞—è —Å—Ö–µ–º–∞, –Ω—É–∂–Ω—ã –≥–∞—Ä–∞–Ω—Ç–∏–∏?
‚îÇ   ‚îÇ   ‚îî‚îÄ Structured Outputs (strict: true)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ –ù—É–∂–Ω—ã retries, streaming, multi-provider?
‚îÇ       ‚îî‚îÄ Instructor
‚îÇ
‚îú‚îÄ Self-hosted –º–æ–¥–µ–ª–∏ (vLLM, SGLang)?
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ –ü—Ä–æ—Å—Ç—ã–µ schemas?
‚îÇ   ‚îÇ   ‚îî‚îÄ XGrammar (default –≤ vLLM 0.8+)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ –°–ª–æ–∂–Ω—ã–µ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏, regex?
‚îÇ       ‚îî‚îÄ Outlines –∏–ª–∏ lm-format-enforcer
‚îÇ
‚îî‚îÄ –ù—É–∂–Ω—ã agents —Å tools?
    ‚îÇ
    ‚îú‚îÄ Full framework –Ω—É–∂–µ–Ω?
    ‚îÇ   ‚îî‚îÄ LangChain / LangGraph
    ‚îÇ
    ‚îú‚îÄ Pydantic-native, type-safe?
    ‚îÇ   ‚îî‚îÄ Pydantic AI
    ‚îÇ
    ‚îî‚îÄ Minimal, just extraction?
        ‚îî‚îÄ Instructor –∏–ª–∏ Marvin
```

---

## –ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è

### –í–æ–ø—Ä–æ—Å 1: –ß—Ç–æ —Ç–∞–∫–æ–µ Constrained Decoding?

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**Constrained Decoding** ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–∏–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

–í–º–µ—Å—Ç–æ –≤—ã–±–æ—Ä–∞ –∏–∑ –≤—Å–µ—Ö 50,000+ —Ç–æ–∫–µ–Ω–æ–≤ —Å–ª–æ–≤–∞—Ä—è, –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ —Ç–æ–∫–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–µ–¥—É—Ç –∫ –≤–∞–ª–∏–¥–Ω–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ.

**–ü—Ä–∏–º–µ—Ä –¥–ª—è JSON:**
- –ü–æ—Å–ª–µ `{` –¥–æ–ø—É—Å—Ç–∏–º—ã —Ç–æ–ª—å–∫–æ: `"`, `}`, whitespace
- –ü–æ—Å–ª–µ `"name":` –¥–æ–ø—É—Å—Ç–∏–º—ã: `"`, `null`, —Ü–∏—Ñ—Ä—ã (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ö–µ–º—ã)
- –î–ª—è enum `["USD", "EUR"]` –ø–æ—Å–ª–µ `"` –¥–æ–ø—É—Å—Ç–∏–º—ã —Ç–æ–ª—å–∫–æ: `U`, `E`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- **XGrammar**: Pushdown automaton, –¥–æ 100x —É—Å–∫–æ—Ä–µ–Ω–∏–µ
- **Outlines**: FSM-based, pioneer –≤ open source
- **LM Format Enforcer**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- **llguidance (Microsoft)**: ~50Œºs per token

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç 100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ inference.

</details>

### –í–æ–ø—Ä–æ—Å 2: –ü–æ—á–µ–º—É LLM –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏ Function Calling?

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

–ü–æ—Ç–æ–º—É —á—Ç–æ LLM ‚Äî —ç—Ç–æ —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å, —Ä–∞–±–æ—Ç–∞—é—â–∞—è –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ. –û–Ω–∞:

1. **–ù–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞** –∫ –≤–Ω–µ—à–Ω–∏–º —Å–∏—Å—Ç–µ–º–∞–º (API, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Ñ–∞–π–ª—ã)
2. **–ù–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥** ‚Äî —Ç–æ–ª—å–∫–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
3. **–°—Ç–∞—Ç–∏—á–Ω–∞** ‚Äî –µ—ë –≤–µ—Å–∞ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ inference

LLM –ø—Ä–∏ Function Calling:
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω—É–∂–Ω–∞
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JSON —Å –∏–º–µ–Ω–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç—Ç–æ—Ç JSON –∫–∞–∫ —á–∞—Å—Ç—å –æ—Ç–≤–µ—Ç–∞

**–¢–≤–æ–π –∫–æ–¥** –¥–æ–ª–∂–µ–Ω:
- –†–∞—Å–ø–∞—Ä—Å–∏—Ç—å tool_call
- –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
- –í–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ LLM

–≠—Ç–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ ‚Äî –∫–ª—é—á–µ–≤–æ–π –∞—Å–ø–µ–∫—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

</details>

### –í–æ–ø—Ä–æ—Å 3: –ß–µ–º JSON Mode –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç Structured Outputs?

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

| –ê—Å–ø–µ–∫—Ç | JSON Mode | Structured Outputs |
|--------|-----------|-------------------|
| –í–∞–ª–∏–¥–Ω—ã–π JSON —Å–∏–Ω—Ç–∞–∫—Å–∏—Å | –î–∞ | –î–∞ |
| –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ | –ù–µ—Ç | –î–∞ |
| Required –ø–æ–ª—è | –ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ | –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö | –ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã | –¢–æ—á–Ω–æ –ø–æ —Å—Ö–µ–º–µ |
| Enum –∑–Ω–∞—á–µ–Ω–∏—è | –õ—é–±—ã–µ | –¢–æ–ª—å–∫–æ –∏–∑ —Å–ø–∏—Å–∫–∞ |
| –ú–µ—Ö–∞–Ω–∏–∑–º | Constrained decoding –¥–ª—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ | Constrained decoding –¥–ª—è —Å—Ö–µ–º—ã |
| Success rate –¥–ª—è —Å—Ö–µ–º—ã | ~90-95% | 100% |

**JSON Mode** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ `{...}` ‚Äî –≤–∞–ª–∏–¥–Ω—ã–π JSON.
**Structured Outputs** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç `{"name": str, "age": int}` ‚Äî —Ç–æ—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

</details>

### –í–æ–ø—Ä–æ—Å 4: –ß—Ç–æ –¥–µ–ª–∞–µ—Ç Instructor –∏ –ø–æ—á–µ–º—É –æ–Ω –ø–æ–ø—É–ª—è—Ä–µ–Ω?

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**Instructor** ‚Äî Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (3M+ downloads/month) –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ structured outputs.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç Pydantic models –≤ JSON Schema –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. –ü–∞—Ç—á–∏—Ç API –∫–ª–∏–µ–Ω—Ç—ã (OpenAI, Anthropic, etc.) –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ `response_model`
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ Pydantic
4. –†–µ—Ç—Ä–∞–∏—Ç –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏
5. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç streaming partial results

**–ü–æ—á–µ–º—É –ø–æ–ø—É–ª—è—Ä–µ–Ω:**
- –ï–¥–∏–Ω—ã–π API –¥–ª—è 15+ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- –ú–∏–Ω–∏–º—É–º boilerplate –∫–æ–¥–∞
- Type safety –∏ IDE autocomplete
- –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ automatic retries
- –ê–∫—Ç–∏–≤–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

```python
# –ë–µ–∑ Instructor: ~50 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
# –° Instructor: 5 —Å—Ç—Ä–æ–∫
result = client.chat.completions.create(
    model="gpt-4o",
    messages=[...],
    response_model=MyPydanticModel
)
```

</details>

### –í–æ–ø—Ä–æ—Å 5: –ö–∞–∫–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å tools?

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

1. **–ü–ª–æ—Ö–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è tools**
   - LLM –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
   - –†–µ—à–µ–Ω–∏–µ: –¥–µ—Ç–∞–ª—å–Ω—ã–µ descriptions —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

2. **–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ tools (>15)**
   - LLM –ø—É—Ç–∞–µ—Ç—Å—è –≤ –≤—ã–±–æ—Ä–µ
   - –†–µ—à–µ–Ω–∏–µ: –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞, RAG-based selection, Tool Search Tool

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤**
   - Security —Ä–∏—Å–∫–∏ (injection)
   - –†–µ—à–µ–Ω–∏–µ: Pydantic validation, allowlists

4. **–û–≥—Ä–æ–º–Ω—ã–µ tool results**
   - –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ context window
   - –†–µ—à–µ–Ω–∏–µ: –ø–∞–≥–∏–Ω–∞—Ü–∏—è, —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è

5. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫**
   - LLM –Ω–µ –º–æ–∂–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è
   - –†–µ—à–µ–Ω–∏–µ: –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ error messages

6. **Strict format —Å–Ω–∏–∂–∞–µ—Ç reasoning quality**
   - –ú–æ–¥–µ–ª—å —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ñ–æ—Ä–º–∞—Ç–µ
   - –†–µ—à–µ–Ω–∏–µ: –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (reasoning ‚Üí structuring)

</details>

### –í–æ–ø—Ä–æ—Å 6: –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É?

<details>
<summary>–û—Ç–≤–µ—Ç</summary>

**Instructor**: Extraction –∏–∑ hosted –º–æ–¥–µ–ª–µ–π (OpenAI, Anthropic). –ù—É–∂–Ω—ã retries, streaming, multi-provider.

**Pydantic AI**: Agents —Å type-safe tools. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Pydantic ecosystem.

**Outlines**: Self-hosted –º–æ–¥–µ–ª–∏. Regex, grammar constraints. Research/experimentation.

**XGrammar**: Production vLLM/SGLang. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

**BAML**: –°–ª–æ–∂–Ω—ã–µ schemas, –≥–¥–µ format constraints —Å–Ω–∏–∂–∞—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ. Multi-language support.

**LangChain**: Full agentic framework. –ú–Ω–æ–≥–æ integrations. Enterprise features.

**Marvin**: –ü—Ä–æ—Å—Ç—ã–µ AI functions. Minimal code. –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å.

</details>

---

## –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å 2024-2025

| –¢—Ä–µ–Ω–¥ | –°—Ç–∞—Ç—É—Å | –ß—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å |
|-------|--------|-----------------|
| **OpenAI Structured Outputs** | ‚úÖ GA (Aug 2024) | 100% schema compliance vs 35.9% —Å prompt engineering |
| **Anthropic Tool Use** | ‚úÖ Production | –ß–µ—Ä–µ–∑ tools API, –Ω–µ—Ç native JSON mode, prefilling –ø–æ–º–æ–≥–∞–µ—Ç |
| **Claude Extended Thinking** | üÜï 2025 | Reasoning + structured output = –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ |
| **Instructor 1.x** | üî• 3M+ downloads/mo | –ï–¥–∏–Ω—ã–π API –¥–ª—è 15+ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤, retries, streaming |
| **XGrammar** | üÜï Performance | –î–æ 100x –±—ã—Å—Ç—Ä–µ–µ regex-based constrained decoding |
| **MCP (Model Context Protocol)** | üî• Anthropic standard | –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è tool definitions, cross-platform |
| **Gemini JSON Schema** | ‚úÖ Native | –ü–æ—Ö–æ–∂–µ –Ω–∞ OpenAI Structured Outputs |
| **vLLM/SGLang structured** | ‚úÖ Production | Server-side enforcement –¥–ª—è self-hosted –º–æ–¥–µ–ª–µ–π |

### Provider Comparison 2025

| Provider | Native Structured Outputs | Reliability | Approach |
|----------|--------------------------|-------------|----------|
| **OpenAI** | ‚úÖ Structured Outputs API | 100% schema | Constrained decoding |
| **Google Gemini** | ‚úÖ responseSchema | High | Schema enforcement |
| **Anthropic** | ‚ö†Ô∏è Tools only | ~80-86% | Tool use + prefilling |
| **AWS Bedrock** | ‚ö†Ô∏è Depends on model | Varies | No native support |
| **Mistral** | ‚ö†Ô∏è JSON mode | Medium | No strict schema |

### Community Sentiment

**–ß—Ç–æ —Ö–≤–∞–ª—è—Ç:**
- OpenAI Structured Outputs: "100% reliability ‚Äî game changer –¥–ª—è production"
- Instructor: "Must-have –¥–ª—è –ª—é–±–æ–π extraction –∑–∞–¥–∞—á–∏"
- Pydantic AI: "Type-safe tools + agents = beautiful DX"

**–ß—Ç–æ –∫—Ä–∏—Ç–∏–∫—É—é—Ç:**
- Anthropic: "–ù–µ—Ç native JSON mode ‚Äî –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å tool use workaround"
- Strict mode: "–ò–Ω–æ–≥–¥–∞ —Å–Ω–∏–∂–∞–µ—Ç reasoning quality ‚Äî –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –ª—É—á—à–µ"
- JSON Mode: "50% –±–æ–ª—å—à–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ —á–µ–º Tool Calling –ø—Ä–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ –ø–æ–ª–µ–π"

**Best Practice:**
> "–í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π—Ç–µ Structured Outputs –≤–º–µ—Å—Ç–æ JSON Mode. Structured Outputs ‚Äî —ç–≤–æ–ª—é—Ü–∏—è JSON mode —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ö–µ–º–µ." ‚Äî OpenAI Docs

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [[llm-fundamentals]] ‚Äî –û—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã LLM
- [[prompt-engineering-masterclass]] ‚Äî –ü—Ä–æ–º–ø—Ç –∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥
- [[ai-agents-advanced]] ‚Äî –ê–≥–µ–Ω—Ç—ã —Å tool use
- [[mcp-model-context-protocol]] ‚Äî MCP –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏ tools
- [[local-llms-self-hosting]] ‚Äî Self-hosted LLM —Å constrained decoding

---

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏

| # | –ò—Å—Ç–æ—á–Ω–∏–∫ | –¢–∏–ø | –í–∫–ª–∞–¥ |
|---|----------|-----|-------|
| 1 | [OpenAI Structured Outputs](https://platform.openai.com/docs/guides/structured-outputs) | Docs | API, strict mode, 100% compliance |
| 2 | [OpenAI Function Calling](https://platform.openai.com/docs/guides/function-calling) | Docs | Tool definitions, parallel calls |
| 3 | [Anthropic Tool Use](https://docs.anthropic.com/en/docs/build-with-claude/tool-use) | Docs | Claude tools API, input_schema |
| 4 | [Anthropic Advanced Tool Use](https://www.anthropic.com/engineering/advanced-tool-use) | Guide | Computer use, MCP integration |
| 5 | [Gemini Structured Outputs](https://ai.google.dev/gemini-api/docs/structured-output) | Docs | responseSchema, native support |
| 6 | [Instructor Docs](https://python.useinstructor.com/) | Library | Multi-provider, retries, streaming |
| 7 | [Pydantic AI](https://ai.pydantic.dev/) | Library | Type-safe tools, agents |
| 8 | [Outlines](https://github.com/dottxt-ai/outlines) | Library | Regex, grammar constraints |
| 9 | [XGrammar Paper](https://arxiv.org/abs/2411.15100) | Paper | 100x faster constrained decoding |
| 10 | [BAML](https://github.com/BoundaryML/baml) | Library | Schema-first, multi-language |
| 11 | [LangChain Structured](https://python.langchain.com/docs/concepts/structured_outputs/) | Docs | with_structured_output API |
| 12 | [Agenta Guide](https://agenta.ai/blog/the-guide-to-structured-outputs-and-function-calling-with-llms) | Guide | Comprehensive comparison |
| 13 | [Martin Fowler: Function Calling](https://martinfowler.com/articles/function-call-LLM.html) | Article | Architecture patterns |
| 14 | [Boundary ML: False Confidence](https://boundaryml.com/blog/structured-outputs-create-false-confidence) | Article | Format ‚â† correctness |
| 15 | [vLLM Structured](https://docs.vllm.ai/en/stable/features/structured_outputs.html) | Docs | Server-side enforcement |

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2024-12-28*

---

[[ai-engineering-moc|‚Üê AI Engineering MOC]] | [[prompt-engineering-masterclass|‚Üê Prompts]] | [[ai-agents-advanced|Agents ‚Üí]]

---

## –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ —Ç–µ–º–∞–º–∏

**[[ai-api-integration]]** ‚Äî Structured outputs –∏ function calling —è–≤–ª—è—é—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ LLM —á–µ—Ä–µ–∑ API. –ï—Å–ª–∏ API-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç ¬´–∫–∞–∫¬ª –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –º–æ–¥–µ–ª–∏, —Ç–æ structured outputs –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç ¬´–≤ –∫–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ¬ª –º–æ–¥–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ. JSON mode, response_format –∏ tool definitions ‚Äî –≤—Å—ë —ç—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã API, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç —Å–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

**[[mcp-model-context-protocol]]** ‚Äî Model Context Protocol —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä—É–µ—Ç —Ç–æ, –∫–∞–∫ LLM –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏, –∞ structured outputs –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å —ç—Ç–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è. MCP –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, –∞ structured outputs –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ–∂–∏–¥–∞–µ–º—ã–º —Å—Ö–µ–º–∞–º. –í–º–µ—Å—Ç–µ –æ–Ω–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –Ω–∞–¥—ë–∂–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–µ–∂–¥—É –º–æ–¥–µ–ª—å—é –∏ –≤–Ω–µ—à–Ω–∏–º –º–∏—Ä–æ–º.

**[[type-systems-theory]]** ‚Äî –¢–µ–æ—Ä–∏—è —Å–∏—Å—Ç–µ–º —Ç–∏–ø–æ–≤ –¥–∞—ë—Ç —Ñ–æ—Ä–º–∞–ª—å–Ω—É—é –æ—Å–Ω–æ–≤—É –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è structured outputs. JSON Schema, Pydantic-–º–æ–¥–µ–ª–∏ –∏ TypeScript-—Ç–∏–ø—ã ‚Äî —ç—Ç–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏—Ö –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ —Ä–∞–Ω—Ç–∞–π–º–∞. –ü–æ–Ω–∏–º–∞–Ω–∏–µ variance, generics –∏ type inference –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å—Ö–µ–º—ã –¥–ª—è LLM-–æ—Ç–≤–µ—Ç–æ–≤.

---

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–µ —á—Ç–µ–Ω–∏–µ

- **Russell S., Norvig P. (2020). Artificial Intelligence: A Modern Approach. 4th edition.** ‚Äî —Ä–∞–∑–¥–µ–ª—ã –æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –∑–Ω–∞–Ω–∏–π –∏ –ª–æ–≥–∏—á–µ—Å–∫–æ–º –≤—ã–≤–æ–¥–µ –¥–∞—é—Ç —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫—É—é –±–∞–∑—É –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ñ–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ LLM-–æ—Ç–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ —Å—Ö–µ–º—ã –∏ —Ç–∏–ø—ã
- **Huyen C. (2022). Designing Machine Learning Systems. O'Reilly.** ‚Äî –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ML-–º–æ–¥–µ–ª–µ–π –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω-—Å–∏—Å—Ç–µ–º—ã, –≤–∫–ª—é—á–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫, –ø—Ä–∏–º–µ–Ω–∏–º—ã–µ –∫ structured outputs

---

*–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: 2026-01-09*
