---
title: "RAG: ะัะพะดะฒะธะฝัััะต ัะตัะฝะธะบะธ"
created: 2025-12-24
updated: 2025-12-24
author: AI Assistant
level: advanced
type: guide
topics:
  - RAG
  - retrieval
  - agentic-rag
  - self-rag
  - graphrag
  - evaluation
status: published
tags:
  - topic/ai-ml
  - type/guide
  - level/advanced
related:
  - "[[agentic-rag]]"
  - "[[vector-databases-guide]]"
  - "[[embeddings-complete-guide]]"
---

# RAG: ะัะพะดะฒะธะฝัััะต ัะตัะฝะธะบะธ

## Prerequisites

ะัะตะถะดะต ัะตะผ ะธะทััะฐัั ะฟัะพะดะฒะธะฝัััะต ัะตัะฝะธะบะธ RAG, ัะตะบะพะผะตะฝะดัะตััั ะฟะพะฝะธะผะฐัั:

| ะขะตะผะฐ | ะะฐัะตะผ ะฝัะถะฝะพ | ะะดะต ะธะทััะธัั |
|------|-------------|-------------|
| **ะงัะพ ัะฐะบะพะต RAG (ะฑะฐะทะพะฒัะน ััะพะฒะตะฝั)** | ะะพะฝะธะผะฐะฝะธะต retrieve-augment-generate ัะธะบะปะฐ | [[llm-fundamentals]] |
| **Embeddings ะธ Vector Search** | RAG ะพัะฝะพะฒะฐะฝ ะฝะฐ semantic similarity | [[embeddings-complete-guide]] |
| **Prompt Engineering** | ะะฐัะตััะฒะพ ะฟัะพะผะฟัะพะฒ ะบัะธัะธัะฝะพ ะดะปั RAG | [[prompt-engineering-masterclass]] |
| **LangChain/LlamaIndex ะพัะฝะพะฒั** | ะัะธะผะตัั ะธัะฟะพะปัะทััั ััะธ ััะตะนะผะฒะพัะบะธ | ะะพะบัะผะตะฝัะฐัะธั ััะตะนะผะฒะพัะบะพะฒ |
| **ะะฐะทะพะฒัะน Python ะธ async** | ะะพะด ะฟัะธะผะตัั ะธัะฟะพะปัะทััั asyncio | โ |

**ะะปั ะบะพะณะพ ััะพั ะผะฐัะตัะธะฐะป?**
- **ะฃะถะต ะทะฝะฐะบะพะผัะต ั ะฑะฐะทะพะฒัะผ RAG** โ ะฒั ะฟะพะฝะธะผะฐะตัะต embed โ retrieve โ generate, ะฝะพ ัะพัะธัะต ัะปัััะธัั ะบะฐัะตััะฒะพ
- **ะะฐะทัะฐะฑะพััะธะบะธ LLM-ะฟัะธะปะพะถะตะฝะธะน** โ ัััะพะธัะต production RAG ะธ ััะฐะปะบะธะฒะฐะตัะตัั ั ะณะฐะปะปััะธะฝะฐัะธัะผะธ, ะฟะปะพัะธะผ retrieval
- **ะััะธัะตะบัะพัั AI-ัะธััะตะผ** โ ะฒัะฑะธัะฐะตัะต ะผะตะถะดั Agentic RAG, GraphRAG, Self-RAG

---

## ะขะตัะผะธะฝะพะปะพะณะธั

| ะขะตัะผะธะฝ | ะะฝะฐัะตะฝะธะต | ะะฝะฐะปะพะณะธั |
|--------|----------|----------|
| **RAG** | Retrieval-Augmented Generation โ ะดะพะฟะพะปะฝะตะฝะธะต ะฟัะพะผะฟัะฐ ัะตะปะตะฒะฐะฝัะฝัะผะธ ะดะพะบัะผะตะฝัะฐะผะธ | ะะฐัั ัะบัะฟะตััั ัะฟัะฐะฒะพัะฝัะต ะผะฐัะตัะธะฐะปั ะฟะตัะตะด ะพัะฒะตัะพะผ |
| **Chunk** | ะคัะฐะณะผะตะฝั ะดะพะบัะผะตะฝัะฐ ะดะปั ะธะฝะดะตะบัะฐัะธะธ (ะพะฑััะฝะพ 500-1000 ัะพะบะตะฝะพะฒ) | ะกััะฐะฝะธัะฐ ะธะท ะบะฝะธะณะธ |
| **Retrieval** | ะะพะธัะบ ัะตะปะตะฒะฐะฝัะฝัั ัะฐะฝะบะพะฒ ะฟะพ ะทะฐะฟัะพัั | ะะพะธัะบ ะฒ ะฑะธะฑะปะธะพัะตะบะต |
| **Vector Search** | ะะพะธัะบ ะฟะพ semantic similarity ัะตัะตะท embeddings | ะะฐะนัะธ "ะฟะพัะพะถะตะต ะฟะพ ัะผััะปั" |
| **BM25** | Keyword-based ะฟะพะธัะบ (ะบะฐะบ Google ะดะพ neural search) | ะะฐะนัะธ "ัะพัะฝะพะต ัะพะฒะฟะฐะดะตะฝะธะต ัะปะพะฒ" |
| **Hybrid Search** | ะะพะผะฑะธะฝะฐัะธั Vector + BM25 | ะ ะฟะพ ัะผััะปั, ะธ ะฟะพ ะบะปััะตะฒัะผ ัะปะพะฒะฐะผ |
| **Reranking** | ะะตัะตะพัะตะฝะบะฐ ัะตะปะตะฒะฐะฝัะฝะพััะธ ะฟะพัะปะต retrieval | ะัะพะฒะตัะธัั ะธ ะพััะพััะธัะพะฒะฐัั ัะตะทัะปััะฐัั |
| **Query Decomposition** | ะะฐะทะฑะธะตะฝะธะต ัะปะพะถะฝะพะณะพ ะทะฐะฟัะพัะฐ ะฝะฐ ะฟะพะดะทะฐะฟัะพัั | ะะฐะทะฑะธัั ะทะฐะดะฐัั ะฝะฐ ะฟะพะดะทะฐะดะฐัะธ |
| **Agentic RAG** | RAG ั ะฐะฒัะพะฝะพะผะฝัะผ ะฐะณะตะฝัะพะผ (planning, self-correction) | ะััะปะตะดะพะฒะฐัะตะปั, ะบะพัะพััะน ัะฐะผ ัะตัะฐะตั ะบะฐะบ ะธัะบะฐัั |
| **Self-RAG** | RAG ั self-reflection ัะพะบะตะฝะฐะผะธ ะดะปั ัะฐะผะพะฟัะพะฒะตัะบะธ | ะกััะดะตะฝั, ะบะพัะพััะน ะฟัะพะฒะตััะตั ัะฒะพะธ ะพัะฒะตัั |
| **CRAG** | Corrective RAG โ fallback ะฝะฐ web search ะฟัะธ ะฟะปะพัะพะผ retrieval | ะะปะฐะฝ ะ, ะตัะปะธ ะฝะต ะฝะฐััะป ะฒ ะฑะฐะทะต |
| **GraphRAG** | RAG ั knowledge graph ะดะปั thematic ะฒะพะฟัะพัะพะฒ | ะะฐััะฐ ัะฒัะทะตะน ะผะตะถะดั ะบะพะฝัะตะฟัะฐะผะธ |
| **Contextual Retrieval** | ะะพะฑะฐะฒะปะตะฝะธะต ะบะพะฝัะตะบััะฐ ะบ ัะฐะฝะบะฐะผ ะฟะตัะตะด embedding | ะะพะดะฟะธัะฐัั ัััะฐะฝะธัั: "ััะพ ะธะท ะพััััะฐ Apple ะทะฐ Q2" |
| **Faithfulness** | ะะตััะธะบะฐ: ะพัะฒะตั ะพัะฝะพะฒะฐะฝ ะฝะฐ ะบะพะฝัะตะบััะต, ะฝะตั ะณะฐะปะปััะธะฝะฐัะธะน | "ะะพะฒะพัั ัะพะปัะบะพ ัะพ, ััะพ ะฟัะพัะธัะฐะป" |
| **RAGAS** | ะคัะตะนะผะฒะพัะบ ะดะปั ะพัะตะฝะบะธ ะบะฐัะตััะฒะฐ RAG | ะญะบะทะฐะผะตะฝ ะดะปั RAG-ัะธััะตะผั |

---

## TL;DR

> **Advanced RAG** ะฒััะพะดะธั ะทะฐ ัะฐะผะบะธ ะฟัะพััะพะณะพ "retrieve + generate". ะะบะปััะฐะตั: Query Decomposition (ัะฐะทะฑะธะตะฝะธะต ัะปะพะถะฝัั ะทะฐะฟัะพัะพะฒ), Agentic RAG (ะฐะณะตะฝัั ั ัะฐะผะพะบะพััะตะบัะธะตะน), Self-RAG (reflection tokens), GraphRAG (knowledge graphs), Contextual Retrieval (Anthropic). ะัะตะฝะบะฐ ัะตัะตะท RAGAS metrics.

---

## ะะฐัะตะผ ััะพ ะฝัะถะฝะพ

### ะัะพะฑะปะตะผะฐ: Naive RAG โ ััะพ ัะพะปัะบะพ ะฝะฐัะฐะปะพ

| ะกะธะผะฟัะพะผ | ะัะธัะธะฝะฐ | ะะพัะปะตะดััะฒะธั |
|---------|---------|-------------|
| **"ะัะฒะตั ะฝะต ะฟะพ ัะตะผะต"** | Vector search ะฝะฐัะพะดะธั "ะฟะพัะพะถะธะน" ัะตะบัั, ะฐ ะฝะต ัะตะปะตะฒะฐะฝัะฝัะน | ะะฐะปะปััะธะฝะฐัะธะธ, ะฟะพัะตัั ะดะพะฒะตัะธั |
| **"ะะต ะพัะฒะตัะฐะตั ะฝะฐ ัะปะพะถะฝัะต ะฒะพะฟัะพัั"** | Multi-aspect ะทะฐะฟัะพัั ััะตะฑััั ัะฐะทะฝัั ะธััะพัะฝะธะบะพะฒ | ะะตะฟะพะปะฝัะต ะพัะฒะตัั |
| **"ะะฐะฑะพัะฐะตั ะฝะฐ ัะตััะฐั, ะปะพะผะฐะตััั ะฒ production"** | ะะตั self-correction ะธ fallback | 30-50% ะพัะธะฑะพะบ ะฝะฐ ัะตะฐะปัะฝัั ะดะฐะฝะฝัั |
| **"ะะต ะฒะธะดะธั ะบะฐััะธะฝั ัะตะปะธะบะพะผ"** | Vector search โ needle, ะฐ ะฝะต haystack | ะะตะฒะพะทะผะพะถะฝะพ ะพัะฒะตัะฐัั ะฝะฐ "ะะฐะบะธะต ัะตะผั?" |

### ะญะฒะพะปััะธั RAG: 2020 โ 2025

```
2020: Naive RAG       โ embed + retrieve + generate
2023: Advanced RAG    โ + reranking, hybrid search, better chunking
2024: Agentic RAG     โ + planning, self-correction, multi-source
2025: ะกะฟะตัะธะฐะปะธะทะฐัะธั   โ GraphRAG, Self-RAG, Contextual Retrieval
```

**ะะตะทัะปััะฐัั ะฟัะพะดะฒะธะฝัััั ัะตัะฝะธะบ:**
- Self-RAG: **+40% accuracy** ะทะฐ ัััั self-reflection
- GraphRAG: **+76%** ะฝะฐ ัะปะพะถะฝัั reasoning ะทะฐะดะฐัะฐั
- Contextual Retrieval: **-49% ะพัะธะฑะพะบ** ะฟัะธ ะฟะพะธัะบะต
- Agentic RAG: **60-75% ัะฝะธะถะตะฝะธะต ะทะฐััะฐั** + 90% cache hit rates

---

## ะะบััะฐะปัะฝะพััั 2024-2025

| ะขะตัะฝะธะบะฐ | ะกัะฐััั | ะงัะพ ะฒะฐะถะฝะพ ะทะฝะฐัั |
|---------|--------|-----------------|
| **Agentic RAG** | ๐ฅ Mainstream 2024 | LangGraph, CrewAI โ ะฐะณะตะฝัั ั self-correction ะพะฑัะทะฐัะตะปัะฝั |
| **GraphRAG** | โ Production-ready | Microsoft Open Source โ ะดะปั ะฒะพะฟัะพัะพะฒ ะพ ัะตะผะฐั/ััะตะฝะดะฐั |
| **Contextual Retrieval** | ๐ Anthropic 2024 | Prompt caching ะดะตะปะฐะตั ัะบะพะฝะพะผะธัะฝัะผ (-90% ััะพะธะผะพััะธ ะธะฝะดะตะบัะฐัะธะธ) |
| **Self-RAG / CRAG** | โ ะัะพะฒะตัะตะฝะพ | Reflection tokens, web search fallback |
| **Hybrid Search** | โ Must-have | Vector + BM25 โ ะฑะฐะทะพะฒัะน ััะฐะฝะดะฐัั production RAG |
| **RAGAS Evaluation** | โ ะกัะฐะฝะดะฐัั | LLM-as-a-Judge, Faithfulness > 0.9 โ ะบัะธัะธัะตัะบะฐั ะผะตััะธะบะฐ |

### ะะปััะตะฒัะต ะธะทะผะตะฝะตะฝะธั 2024-2025

1. **ะั pipeline ะบ ะฐะณะตะฝัะฐะผ**: Agentic RAG ะทะฐะผะตะฝัะตั ะถัััะบะธะต pipeline
2. **Long context**: 200K-2M ัะพะบะตะฝะพะฒ ะผะตะฝัะตั ะฐััะธัะตะบัััั (ะฝะพ "lost in the middle" ะพััะฐัััั)
3. **Structured outputs**: JSON mode + function calling ะดะปั ะฝะฐะดัะถะฝะพะณะพ parsing
4. **Evaluation-first**: RAGAS ะฒ CI/CD ะพะฑัะทะฐัะตะปะตะฝ ะดะปั production

---

## ะะณะปะฐะฒะปะตะฝะธะต

1. [ะััะพัะธั: ะะฐะบ ะผั ะดะพัะปะธ ะดะพ RAG](#ะธััะพัะธั-ะบะฐะบ-ะผั-ะดะพัะปะธ-ะดะพ-rag)
2. [ะัะพะฑะปะตะผะฐ ะฟัะพัััะผ ัะทัะบะพะผ](#ะฟัะพะฑะปะตะผะฐ-ะฟัะพัััะผ-ัะทัะบะพะผ)
3. [Query Decomposition](#query-decomposition)
4. [Agentic RAG](#agentic-rag)
5. [Self-RAG ะธ Corrective RAG](#self-rag-ะธ-corrective-rag)
6. [Contextual Retrieval](#contextual-retrieval)
7. [GraphRAG](#graphrag)
8. [ะัะตะฝะบะฐ RAG (RAGAS)](#ะพัะตะฝะบะฐ-rag-ragas)
9. [ะขะธะฟะธัะฝัะต ะพัะธะฑะบะธ ะธ ะบะฐะบ ะธั ะธะทะฑะตะถะฐัั](#ัะธะฟะธัะฝัะต-ะพัะธะฑะบะธ-ะธ-ะบะฐะบ-ะธั-ะธะทะฑะตะถะฐัั)
10. [ะะพะณะดะฐ ััะพ ะธัะฟะพะปัะทะพะฒะฐัั](#ะบะพะณะดะฐ-ััะพ-ะธัะฟะพะปัะทะพะฒะฐัั)
11. [ะัะพะฒะตัั ัะตะฑั](#ะฟัะพะฒะตัั-ัะตะฑั)

---

## ะััะพัะธั: ะะฐะบ ะผั ะดะพัะปะธ ะดะพ RAG

### ะัะตะดัััะพัะธั: ะผะธั ะดะพ RAG

ะัะตะดััะฐะฒั ัะตะฑะต 2022 ะณะพะด. ChatGPT ัะพะปัะบะพ ะฟะพัะฒะธะปัั ะธ ะฟะพัะฐะทะธะป ะผะธั ัะฒะพะธะผะธ ัะฟะพัะพะฑะฝะพัััะผะธ. ะะพ ั ะฝะตะณะพ ะฑัะปะฐ ะพะดะฝะฐ ะพะณัะพะผะฝะฐั ะฟัะพะฑะปะตะผะฐ: **ะพะฝ ะฝะต ะทะฝะฐะป ะฝะธัะตะณะพ ะฟะพัะปะต ัะฒะพะตะน ะดะฐัั ะพะฑััะตะฝะธั**. ะกะฟัะพัะธ ะตะณะพ ะฟัะพ ะฒัะตัะฐัะฝะธะต ะฝะพะฒะพััะธ - ะธ ะพะฝ ะฒัะดะฐัั ัะฒะตัะตะฝะฝัั, ะฝะพ ะฟะพะปะฝะพัััั ะฒัะดัะผะฐะฝะฝัั ะธััะพัะธั.

ะะพะผะฟะฐะฝะธะธ ัะผะพััะตะปะธ ะฝะฐ ััั ัะตัะฝะพะปะพะณะธั ะธ ะดัะผะฐะปะธ: "ะะฐะบ ะผั ะผะพะถะตะผ ะธัะฟะพะปัะทะพะฒะฐัั ััะพ ะดะปั ะฝะฐัะธั ะดะฐะฝะฝัั? ะฃ ะฝะฐั ัะตัะฐะฑะฐะนัั ะดะพะบัะผะตะฝัะฐัะธะธ, ะฟะพะปะธัะธะบ, FAQ - ะธ ะผั ัะพัะธะผ, ััะพะฑั AI ะพัะฒะตัะฐะป ะฝะฐ ะฒะพะฟัะพัั ะฟะพ ะฝะธะผ".

ะัะปะพ ะฝะตัะบะพะปัะบะพ ะพัะตะฒะธะดะฝัั ะฟะพะดัะพะดะพะฒ, ะธ ะฒัะต ะพะฝะธ ะธะผะตะปะธ ะบัะธัะธัะตัะบะธะต ะฝะตะดะพััะฐัะบะธ:

**ะะพะดัะพะด 1: Fine-tuning** - ะดะพะพะฑััะธัั ะผะพะดะตะปั ะฝะฐ ัะฒะพะธั ะดะฐะฝะฝัั.
- ะัะพะฑะปะตะผะฐ: ะดะพัะพะณะพ, ะดะพะปะณะพ, ะฟัะธ ะพะฑะฝะพะฒะปะตะฝะธะธ ะดะฐะฝะฝัั ะฝัะถะฝะพ ะฟะตัะตะพะฑััะฐัั ะทะฐะฝะพะฒะพ. ะ ะผะพะดะตะปั ะฒัะต ัะฐะฒะฝะพ ะผะพะถะตั ะณะฐะปะปััะธะฝะธัะพะฒะฐัั "ัะฒะพะธะผะธ" ัะฐะบัะฐะผะธ.

**ะะพะดัะพะด 2: ะะฐะฟะธัะฝััั ะฒัะต ะฒ ะบะพะฝัะตะบัั** - ะฟัะพััะพ ะพัะฟัะฐะฒะปััั ะฒัะต ะดะพะบัะผะตะฝัั ะฒะผะตััะต ั ะฒะพะฟัะพัะพะผ.
- ะัะพะฑะปะตะผะฐ: context window ะพะณัะฐะฝะธัะตะฝ (ัะพะณะดะฐ - 4K ัะพะบะตะฝะพะฒ), ััะพะธะผะพััั ัะฐััะตั ะปะธะฝะตะนะฝะพ, ะผะพะดะตะปั ัะตััะตััั ะฒ ะดะปะธะฝะฝะพะผ ัะตะบััะต.

**ะะพะดัะพะด 3: ะะปะฐััะธัะตัะบะธะน ะฟะพะธัะบ** - ะฝะฐะนัะธ ัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั ะธ ะฟะพะบะฐะทะฐัั ะฟะพะปัะทะพะฒะฐัะตะปั.
- ะัะพะฑะปะตะผะฐ: ััะพ ะฝะต AI, ะฟะพะปัะทะพะฒะฐัะตะปั ัะฐะผ ะดะพะปะถะตะฝ ัะธัะฐัั ะธ ะฝะฐัะพะดะธัั ะพัะฒะตั.

### ะะพะถะดะตะฝะธะต RAG: ัะตะฝััะฑัั 2020

ะะตะฒะพะปััะธั ะฟัะพะธะทะพัะปะฐ ะฒ ััะฐััะต "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks" ะพั Facebook AI Research (ัะตะฟะตัั Meta AI). ะะฒัะพัั ะฟัะตะดะปะพะถะธะปะธ ัะปะตะณะฐะฝัะฝัั ะธะดะตั: **ะพะฑัะตะดะธะฝะธัั retrieval ะธ generation**.

ะกััั ะฑัะปะฐ ะณะตะฝะธะฐะปัะฝะพ ะฟัะพััะพะน:

```
ะะพะฟัะพั ะฟะพะปัะทะพะฒะฐัะตะปั
       |
       v
[ะะพะธัะบ ะฟะพัะพะถะธั ะดะพะบัะผะตะฝัะพะฒ ะฒ ะฑะฐะทะต]
       |
       v
[ะะฑัะตะดะธะฝะตะฝะธะต: ะฒะพะฟัะพั + ะฝะฐะนะดะตะฝะฝัะต ะดะพะบัะผะตะฝัั]
       |
       v
[LLM ะณะตะฝะตัะธััะตั ะพัะฒะตั]
       |
       v
ะัะฒะตั ั ะธััะพัะฝะธะบะฐะผะธ
```

ะะพัะตะผั ััะพ ะฑัะปะพ ัะตะฒะพะปััะธะตะน:
1. **ะะบััะฐะปัะฝะพััั**: ะดะฐะฝะฝัะต ะผะพะถะฝะพ ะพะฑะฝะพะฒะปััั ะฑะตะท ะฟะตัะตะพะฑััะตะฝะธั ะผะพะดะตะปะธ
2. **ะะตัะธัะธัะธััะตะผะพััั**: ะพัะฒะตั ะพัะฝะพะฒะฐะฝ ะฝะฐ ะบะพะฝะบัะตัะฝัั ะดะพะบัะผะตะฝัะฐั, ะบะพัะพััะต ะผะพะถะฝะพ ะฟะพะบะฐะทะฐัั
3. **ะะฐัััะฐะฑะธััะตะผะพััั**: ะผะพะถะฝะพ ัะฐะฑะพัะฐัั ั ะผะธะปะปะธะพะฝะฐะผะธ ะดะพะบัะผะตะฝัะพะฒ
4. **ะญะบะพะฝะพะผะธัะฝะพััั**: ะฝะต ะฝัะถะตะฝ ะดะพัะพะณะพะน fine-tuning

### ะญะฒะพะปััะธั: ะพั Naive ะบ Agentic

ะก 2020 ะฟะพ 2025 ะณะพะด RAG ะฟัะพัะตะป ัะตัะตะท ััะธ ัะฟะพัะธ:

**2020-2023: Naive RAG**
ะัะพััะตะนัะฐั ััะตะผะฐ: embed ะฒะพะฟัะพั -> ะฝะฐะนะดะธ top-k ะฟะพัะพะถะธั ัะฐะฝะบะพะฒ -> ะพัะฟัะฐะฒั ะฒ LLM.
ะะฐะฑะพัะฐะปะพ, ะฝะพ ัะฐััะพ ะฟะปะพัะพ. ะกะปะพะถะฝัะต ะฒะพะฟัะพัั ััะฐะฒะธะปะธ ัะธััะตะผั ะฒ ััะฟะธะบ.

**2023-2024: Advanced RAG**
ะะฝะถะตะฝะตัั ะฝะฐัะฐะปะธ ะดะพะฑะฐะฒะปััั ะพะฟัะธะผะธะทะฐัะธะธ: query rewriting, hybrid search (vector + BM25), reranking. ะะฐัะตััะฒะพ ะฒััะพัะปะพ, ะฝะพ ัะธััะตะผะฐ ะฒัะต ะตัะต ะฑัะปะฐ "ััะฟะพะน" - ะพะฝะฐ ะฟัะพััะพ ะฒัะฟะพะปะฝัะปะฐ ะทะฐะดะฐะฝะฝัะน pipeline.

**2024-2025: Agentic RAG**
ะะฐััะพััะธะน ะฟัะพััะฒ: RAG ััะฐะป ัะผะฝัะผ ะฐะณะตะฝัะพะผ. ะขะตะฟะตัั ัะธััะตะผะฐ ัะฐะผะฐ ัะตัะฐะตั, ะบะฐะบ ะปัััะต ะพัะฒะตัะธัั ะฝะฐ ะฒะพะฟัะพั. ะะฐะทะฑะธะฒะฐะตั ัะปะพะถะฝัะต ะทะฐะฟัะพัั ะฝะฐ ะฟัะพัััะต. ะัะพะฒะตััะตั ะบะฐัะตััะฒะพ ะฝะฐะนะดะตะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ. ะัะปะธ ัะตะทัะปััะฐัั ะฟะปะพัะธะต - ะฟะตัะตัะพัะผัะปะธััะตั ะทะฐะฟัะพั ะธ ะธัะตั ัะฝะพะฒะฐ. ะะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัั ัะฐะทะฝัะต ะธััะพัะฝะธะบะธ ะดะฐะฝะฝัั.

ะะตะทัะปััะฐัั ัะปัััะตะฝะธะน ะฒะฟะตัะฐัะปััั:
- **Self-RAG**: +40% accuracy ะทะฐ ััะตั ัะฐะผะพะฟัะพะฒะตัะบะธ
- **GraphRAG**: +76% ะฝะฐ ัะปะพะถะฝัั reasoning ะทะฐะดะฐัะฐั
- **Contextual Retrieval**: -49% ะพัะธะฑะพะบ ะฟัะธ ะฟะพะธัะบะต
- **Production Agentic RAG**: 60-75% ัะฝะธะถะตะฝะธะต ะทะฐััะฐั + 90%+ cache hit rates

---

## ะัะพะฑะปะตะผะฐ ะฟัะพัััะผ ัะทัะบะพะผ

### ะะฝะฐะปะพะณะธั: ัะบัะฟะตัั ั ัััะฐัะตะฒัะตะน ัะฝัะธะบะปะพะฟะตะดะธะตะน

ะัะตะดััะฐะฒั, ััะพ ัั ะฝะฐะฝัะป ะณะตะฝะธะฐะปัะฝะพะณะพ ัะบัะฟะตััะฐ. ะะฝ ะทะฝะฐะตั ะฒัะต ะฒ ะผะธัะต - ะธััะพัะธั, ะฝะฐัะบั, ะฑะธะทะฝะตั. ะะพ ะตััั ะฟัะพะฑะปะตะผะฐ: **ะตะณะพ ัะฝัะธะบะปะพะฟะตะดะธั ะดะฐัะธัะพะฒะฐะฝะฐ ัะฝะฒะฐัะตะผ 2024 ะณะพะดะฐ**. ะัะต, ััะพ ะฟัะพะธะทะพัะปะพ ะฟะพัะปะต - ะดะปั ะฝะตะณะพ ะฝะต ัััะตััะฒัะตั.

ะขั ัะฟัะฐัะธะฒะฐะตัั: "ะะฐะบะธะต ะธะทะผะตะฝะตะฝะธั ะฒ ะฝะฐัะตะน ะบะพัะฟะพัะฐัะธะฒะฝะพะน ะฟะพะปะธัะธะบะต ะพัะฟััะบะพะฒ ะฟัะพะธะทะพัะปะธ ะฒ ััะพะผ ะณะพะดั?"

ะญะบัะฟะตัั ัะฒะตัะตะฝะฝะพ ะพัะฒะตัะฐะตั: "ะกะพะณะปะฐัะฝะพ ััะฐะฝะดะฐััะฝัะผ ะฟัะฐะบัะธะบะฐะผ, ะพะฑััะฝะพ ะบะพะผะฟะฐะฝะธะธ ะฟัะตะดะพััะฐะฒะปััั..." - ะธ ะฝะตัะตั ะบะฐะบัั-ัะพ ะพะฑััั ะธะฝัะพัะผะฐัะธั, ะฝะต ะธะผะตัััั ะพัะฝะพัะตะฝะธั ะบ ะขะะะะ ะบะพะผะฟะฐะฝะธะธ.

**RAG ัะตัะฐะตั ััั ะฟัะพะฑะปะตะผั ัะปะตะณะฐะฝัะฝะพ**: ะฟะตัะตะด ัะตะผ ะบะฐะบ ัะบัะฟะตัั ะฝะฐัะฝะตั ะพัะฒะตัะฐัั, ะผั ะดะฐะตะผ ะตะผั ะฟัะพัะธัะฐัั ะฐะบััะฐะปัะฝัะต ะดะพะบัะผะตะฝัั. ะขะตะฟะตัั ะพะฝ ะพัะฒะตัะฐะตั ะฝะต ะธะท ัะฒะพะตะน ัััะฐัะตะฒัะตะน ะฟะฐะผััะธ, ะฐ ะฝะฐ ะพัะฝะพะฒะต ัะฒะตะถะธั ะดะฐะฝะฝัั.

### ะะพัะตะผั Naive RAG ะฝะตะดะพััะฐัะพัะฝะพ

ะัะตะดััะฐะฒั ะฑะพะปะตะต ัะปะพะถะฝัะน ััะตะฝะฐัะธะน. ะะปะธะตะฝั ัะฟัะฐัะธะฒะฐะตั:

> "ะกัะฐะฒะฝะธัะต ััะปะพะฒะธั ะบัะตะดะธัะพะฒะฐะฝะธั ะดะปั ะผะฐะปะพะณะพ ะฑะธะทะฝะตัะฐ ะฒ ะฒะฐัะธั ะฟัะพะดัะบัะฐั Premium, Standard ะธ Basic, ะธ ะพะฑัััะฝะธัะต, ะบะฐะบะพะน ะปัััะต ะฟะพะดัะพะดะธั ะดะปั ัะตะทะพะฝะฝะพะณะพ ะฑะธะทะฝะตัะฐ ั ะฝะตัะฐะฒะฝะพะผะตัะฝัะผ cash flow"

Naive RAG ัะดะตะปะฐะตั ะฟัะพััะพะน vector search ะฟะพ ััะพะผั ะทะฐะฟัะพัั. ะัะพะฑะปะตะผะฐ: **ะฝะตั ะพะดะฝะพะณะพ ะดะพะบัะผะตะฝัะฐ, ะบะพัะพััะน ะพัะฒะตัะฐะตั ะฝะฐ ััะพั ะฒะพะฟัะพั**. ะะฝัะพัะผะฐัะธั ะพ Premium - ะฒ ะพะดะฝะพะผ ะดะพะบัะผะตะฝัะต. ะ Standard - ะฒ ะดััะณะพะผ. ะ ัะตะทะพะฝะฝะพะผ ะฑะธะทะฝะตัะต - ะฒ ััะตััะตะผ. ะ ะพะฝะธ ะฒัะต ะฝะต ะฟะพัะพะถะธ ัะตะผะฐะฝัะธัะตัะบะธ ะฝะฐ ะธััะพะดะฝัะน ะทะฐะฟัะพั.

ะะตะทัะปััะฐั: ัะธััะตะผะฐ ะฝะฐะนะดะตั ััะพ-ัะพ ะพัะดะฐะปะตะฝะฝะพ ะฟะพัะพะถะตะต ะธ ัะณะตะฝะตัะธััะตั ะฝะตะฟะพะปะฝัะน ะธะปะธ ะฝะตัะพัะฝัะน ะพัะฒะตั.

ะัะพะดะฒะธะฝัััะต ัะตัะฝะธะบะธ RAG ะฑัะปะธ ัะพะทะดะฐะฝั ะธะผะตะฝะฝะพ ะดะปั ัะฐะบะธั ัะปััะฐะตะฒ.

---

## Query Decomposition

### ะะตะฐะปัะฝัะน ััะตะฝะฐัะธะน

ะะพะฟัััะธะผ, ัั ัะฐะฑะพัะฐะตัั ะฒ ัะตัะฟะพะดะดะตัะถะบะต ะฑะฐะฝะบะฐ. ะัะธัะพะดะธั ะทะฐะฟัะพั ะพั ะบะปะธะตะฝัะฐ:

> "ะฃ ะผะตะฝั ะฑะธะทะฝะตั-ะบะฐััะฐ Premium. ะ ะฟัะพัะปะพะผ ะผะตัััะต ะฑัะปะฐ ััะฐะฝะทะฐะบัะธั ะฝะฐ 50000, ะบะพัะพััั ั ะฝะต ัะพะฒะตััะฐะป. ะัะธ ััะพะผ ั ะผะตะฝั ะฝะฐัััะพะตะฝ SMS-ะพะฟะพะฒะตัะตะฝะธั, ะฝะพ ั ะฝะธัะตะณะพ ะฝะต ะฟะพะปััะธะป. ะฅะพัั ะฟะพะฝััั: ะบะฐะบ ัะฐะบะพะต ะผะพะณะปะพ ะฟัะพะธะทะพะนัะธ, ะบะฐะบะฐั ั ะฒะฐั ะฟะพะปะธัะธะบะฐ ะฟะพ ัะฟะพัะฝัะผ ััะฐะฝะทะฐะบัะธัะผ, ะธ ะผะพะณั ะปะธ ั ะฟะพะปััะธัั ะฒะพะทะฒัะฐั?"

ะญัะพั ะฒะพะฟัะพั ะฝะฐ ัะฐะผะพะผ ะดะตะปะต ัะพะดะตัะถะธั **ััะธ ัะฐะทะฝัั ะฟะพะดะฒะพะฟัะพัะฐ**:
1. ะะฐะบ ัะฐะฑะพัะฐัั SMS-ะพะฟะพะฒะตัะตะฝะธั ะธ ะฟะพัะตะผั ะพะฝะธ ะผะพะณะปะธ ะฝะต ะฟัะธะนัะธ?
2. ะะฐะบะฐั ะฟะพะปะธัะธะบะฐ ะฑะฐะฝะบะฐ ะฟะพ ัะฟะพัะฝัะผ ััะฐะฝะทะฐะบัะธัะผ?
3. ะะฐะบะพะฒ ะฟัะพัะตัั ะฒะพะทะฒัะฐัะฐ ััะตะดััะฒ?

Naive RAG ะฟะพะฟััะฐะตััั ะฝะฐะนัะธ ะพะดะธะฝ ะดะพะบัะผะตะฝั, ะบะพัะพััะน ะพัะฒะตัะฐะตั ะฝะฐ ะฒัะต ััะฐะทั. ะขะฐะบะพะณะพ ะดะพะบัะผะตะฝัะฐ ะฝะต ัััะตััะฒัะตั.

### ะะฐะบ ัะฐะฑะพัะฐะตั Query Decomposition

ะขะตัะฝะธะบะฐ ะฟัะพััะฐ ะธ ะณะตะฝะธะฐะปัะฝะฐ: **ะฟะพะฟัะพัะธัั LLM ัะฐะทะฑะธัั ัะปะพะถะฝัะน ะฒะพะฟัะพั ะฝะฐ ะฟัะพัััะต, ะพัะฒะตัะธัั ะฝะฐ ะบะฐะถะดัะน ะพัะดะตะปัะฝะพ, ะฐ ะฟะพัะพะผ ัะธะฝัะตะทะธัะพะฒะฐัั ัะธะฝะฐะปัะฝัะน ะพัะฒะตั**.

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    QUERY DECOMPOSITION                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                     โ
โ   ะะกะฅะะะะซะ ะะะะะะก:                                                  โ
โ   "ะกัะฐะฒะฝะธัะต AI-ัััะฐัะตะณะธะธ Google, Microsoft ะธ OpenAI,               โ
โ    ะธ ะบะฐะบ ะบะฐะถะดะฐั ะฒะปะธัะตั ะฝะฐ ะธั ะพะฑะปะฐัะฝัะน ะฑะธะทะฝะตั"                      โ
โ                                                                     โ
โ                           |                                         โ
โ                           v                                         โ
โ                    [LLM: DECOMPOSE]                                 โ
โ                           |                                         โ
โ          +----------------+----------------+                        โ
โ          |                |                |                        โ
โ          v                v                v                        โ
โ   โโโโโโโโโโโโโโ   โโโโโโโโโโโโโโ   โโโโโโโโโโโโโโ                 โ
โ   โ ะะพะดะฒะพะฟัะพั 1โ   โ ะะพะดะฒะพะฟัะพั 2โ   โ ะะพะดะฒะพะฟัะพั 3โ                 โ
โ   โ "AI-       โ   โ "AI-       โ   โ "AI-       โ                 โ
โ   โ  ัััะฐัะตะณะธั โ   โ  ัััะฐัะตะณะธั โ   โ  ัััะฐัะตะณะธั โ                 โ
โ   โ  Google?"  โ   โ  Microsoft?โ   โ  OpenAI?"  โ                 โ
โ   โโโโโโโฌโโโโโโโ   โโโโโโโฌโโโโโโโ   โโโโโโโฌโโโโโโโ                 โ
โ         |                |                |                         โ
โ         v                v                v                         โ
โ   [RETRIEVE]       [RETRIEVE]       [RETRIEVE]                     โ
โ         |                |                |                         โ
โ         v                v                v                         โ
โ   [ANSWER]         [ANSWER]         [ANSWER]                       โ
โ         |                |                |                         โ
โ         +----------------+----------------+                         โ
โ                           |                                         โ
โ                           v                                         โ
โ                    [LLM: SYNTHESIZE]                                โ
โ                           |                                         โ
โ                           v                                         โ
โ                   ะคะะะะะฌะะซะ ะะขะะะข                                   โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะพัะตะผั ััะพ ัะฐะฑะพัะฐะตั

1. **ะคะพะบััะธัะพะฒะบะฐ ะฟะพะธัะบะฐ**: ะะผะตััะพ ะพะดะฝะพะณะพ ัะฐะทะผััะพะณะพ ะทะฐะฟัะพัะฐ - ะฝะตัะบะพะปัะบะพ ัะพัะฝัั. ะะฐะถะดัะน ะฟะพะดะทะฐะฟัะพั ะธะผะตะตั ะฑะพะปััะต ัะฐะฝัะพะฒ ะฝะฐะนัะธ ัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั.

2. **ะะฐัะฐะปะปะตะปะธะทะฐัะธั**: ะะพะดะทะฐะฟัะพัั ะผะพะถะฝะพ ะพะฑัะฐะฑะฐััะฒะฐัั ะฟะฐัะฐะปะปะตะปัะฝะพ, ััะพ ััะบะพััะตั ะพะฑัะตะต ะฒัะตะผั ะพัะฒะตัะฐ.

3. **ะะฐัะตััะฒะพ ัะธะฝัะตะทะฐ**: LLM ะพัะปะธัะฝะพ ัะฟัะฐะฒะปัะตััั ั ะพะฑัะตะดะธะฝะตะฝะธะตะผ ะฝะตัะบะพะปัะบะธั ัะตัะบะธั ะพัะฒะตัะพะฒ ะฒ ะพะดะธะฝ ัะฒัะทะฝัะน.

### ะะพะด ั ะฟะพะดัะพะฑะฝัะผะธ ะฟะพััะฝะตะฝะธัะผะธ

```python
from langchain_openai import ChatOpenAI
from langchain.prompts import ChatPromptTemplate
from langchain_core.output_parsers import StrOutputParser
import asyncio

# ะะฝะธัะธะฐะปะธะทะธััะตะผ ะผะพะดะตะปั. gpt-4o-mini - ัะพัะพัะธะน ะฑะฐะปะฐะฝั ัะตะฝั ะธ ะบะฐัะตััะฒะฐ
# ะดะปั ะทะฐะดะฐั decomposition ะธ synthesis
llm = ChatOpenAI(model="gpt-4o-mini")

# ะจะะ 1: ะัะพะผะฟั ะดะปั ัะฐะทะฑะธะตะฝะธั ะฒะพะฟัะพัะฐ
# ะะปััะตะฒะพะน ะผะพะผะตะฝั: ะฟัะพัะธะผ ะฒะตัะฝััั ะขะะะฌะะ ะฟะพะดะฒะพะฟัะพัั, ะฑะตะท ะปะธัะฝะตะณะพ ัะตะบััะฐ.
# ะญัะพ ะฒะฐะถะฝะพ ะดะปั ะฟะฐััะธะฝะณะฐ - ะผั ะฑัะดะตะผ split ะฟะพ newline.
decomposition_prompt = ChatPromptTemplate.from_template("""
ะขั ัะบัะฟะตัั ะฒ ะฐะฝะฐะปะธะทะต ัะปะพะถะฝัั ะฒะพะฟัะพัะพะฒ. ะขะฒะพั ะทะฐะดะฐัะฐ - ัะฐะทะฑะธัั
ะบะพะผะฟะปะตะบัะฝัะน ะฒะพะฟัะพั ะฝะฐ 2-4 ะฟัะพัััั ะฟะพะดะฒะพะฟัะพัะฐ.

ะััะพะดะฝัะน ะฒะพะฟัะพั: {question}

ะัะฐะฒะธะปะฐ:
1. ะะฐะถะดัะน ะฟะพะดะฒะพะฟัะพั ะดะพะปะถะตะฝ ะฑััั ัะฐะผะพะดะพััะฐัะพัะฝัะผ
2. ะะพะดะฒะพะฟัะพัั ะฒะผะตััะต ะดะพะปะถะฝั ะฟะพะปะฝะพัััั ะฟะพะบััะฒะฐัั ะธััะพะดะฝัะน ะฒะพะฟัะพั
3. ะะทะฑะตะณะฐะน ะดัะฑะปะธัะพะฒะฐะฝะธั ะธะฝัะพัะผะฐัะธะธ ะผะตะถะดั ะฟะพะดะฒะพะฟัะพัะฐะผะธ

ะะตัะฝะธ ะขะะะฌะะ ะฟะพะดะฒะพะฟัะพัั, ะบะฐะถะดัะน ะฝะฐ ะฝะพะฒะพะน ัััะพะบะต, ะฑะตะท ะฝัะผะตัะฐัะธะธ.
""")

# ะจะะ 2: ะัะพะผะฟั ะดะปั ะพัะฒะตัะฐ ะฝะฐ ะฟะพะดะฒะพะฟัะพั
# ะะฐะถะฝะพ: ะฟัะพัะธะผ ะบัะฐัะบะธะน ะพัะฒะตั, ััะพะฑั ะฝะต ัะฐะทะดัะฒะฐัั ะบะพะฝัะตะบัั ะดะปั ัะธะฝัะตะทะฐ
answer_prompt = ChatPromptTemplate.from_template("""
ะัะฒะตัั ะฝะฐ ะฒะพะฟัะพั, ะพัะฝะพะฒัะฒะฐััั ะขะะะฌะะ ะฝะฐ ะฟัะตะดะพััะฐะฒะปะตะฝะฝะพะผ ะบะพะฝัะตะบััะต.
ะัะปะธ ะฒ ะบะพะฝัะตะบััะต ะฝะตั ะธะฝัะพัะผะฐัะธะธ - ัะตััะฝะพ ัะบะฐะถะธ ะพะฑ ััะพะผ.

ะะพะฟัะพั: {sub_question}

ะะพะฝัะตะบัั ะธะท ะฑะฐะทั ะทะฝะฐะฝะธะน:
{context}

ะะฐะน ะบัะฐัะบะธะน, ัะฐะบัะพะปะพะณะธัะตัะบะธะน ะพัะฒะตั (2-3 ะฟัะตะดะปะพะถะตะฝะธั).
""")

# ะจะะ 3: ะัะพะผะฟั ะดะปั ัะธะฝัะตะทะฐ
# ะะดะตัั LLM ะฟะพะปััะฐะตั ะฒัะต ะพัะฒะตัั ะธ ัะพะทะดะฐะตั ัะฒัะทะฝัะน ะธัะพะณะพะฒัะน ัะตะบัั
synthesis_prompt = ChatPromptTemplate.from_template("""
ะััะพะดะฝัะน ะฒะพะฟัะพั ะบะปะธะตะฝัะฐ: {original_question}

ะะตะทัะปััะฐัั ะธััะปะตะดะพะฒะฐะฝะธั:
{sub_answers}

ะะฐ ะพัะฝะพะฒะต ััะธั ะดะฐะฝะฝัั ััะพัะผะธััะน ะฟะพะปะฝัะน, ัะฒัะทะฝัะน ะพัะฒะตั ะฝะฐ ะธััะพะดะฝัะน ะฒะพะฟัะพั.
ะกัััะบัััะธััะน ะพัะฒะตั ะปะพะณะธัะตัะบะธ. ะัะปะธ ะบะฐะบะธะต-ัะพ ะฐัะฟะตะบัั ะฝะต ะฑัะปะธ ะฝะฐะนะดะตะฝั ะฒ
ะฑะฐะทะต ะทะฝะฐะฝะธะน - ัะบะฐะถะธ ััะพ.
""")

async def decompose_and_answer(question: str, retriever):
    """
    ะะพะปะฝัะน pipeline Query Decomposition.

    Args:
        question: ะกะปะพะถะฝัะน ะฒะพะฟัะพั ะฟะพะปัะทะพะฒะฐัะตะปั
        retriever: LangChain retriever ะดะปั ะฟะพะธัะบะฐ ะดะพะบัะผะตะฝัะพะฒ

    Returns:
        ะกะธะฝัะตะทะธัะพะฒะฐะฝะฝัะน ะพัะฒะตั ะฝะฐ ะพัะฝะพะฒะต ะฟะพะดะฒะพะฟัะพัะพะฒ
    """

    # ะจะะ 1: ะะฐะทะฑะธะฒะฐะตะผ ะฒะพะฟัะพั
    # chain = prompt | llm | parser - ััะฐะฝะดะฐััะฝัะน ะฟะฐััะตัะฝ LangChain
    decomposition_chain = decomposition_prompt | llm | StrOutputParser()
    sub_questions_text = await decomposition_chain.ainvoke({"question": question})

    # ะะฐััะธะผ ัะตะทัะปััะฐั: ัะฑะธัะฐะตะผ ะฟััััะต ัััะพะบะธ ะธ ะฟัะพะฑะตะปั
    sub_questions = [q.strip() for q in sub_questions_text.split("\n") if q.strip()]

    print(f"ะะฐะทะฑะธะปะธ ะฝะฐ {len(sub_questions)} ะฟะพะดะฒะพะฟัะพัะพะฒ:")
    for i, q in enumerate(sub_questions, 1):
        print(f"  {i}. {q}")

    # ะจะะ 2: ะัะฒะตัะฐะตะผ ะฝะฐ ะบะฐะถะดัะน ะฟะพะดะฒะพะฟัะพั ะะะะะะะะะฌะะ
    # asyncio.gather ะฟะพะทะฒะพะปัะตั ะทะฐะฟัััะธัั ะฒัะต ะทะฐะฟัะพัั ะพะดะฝะพะฒัะตะผะตะฝะฝะพ
    async def answer_subq(sub_q: str) -> str:
        # ะัะตะผ ัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั ะดะปั ััะพะณะพ ะบะพะฝะบัะตัะฝะพะณะพ ะฟะพะดะฒะพะฟัะพัะฐ
        docs = await retriever.aget_relevant_documents(sub_q)
        context = "\n".join([doc.page_content for doc in docs])

        # ะะตะฝะตัะธััะตะผ ะพัะฒะตั
        answer_chain = answer_prompt | llm | StrOutputParser()
        answer = await answer_chain.ainvoke({
            "sub_question": sub_q,
            "context": context
        })
        return f"ะะพะฟัะพั: {sub_q}\nะัะฒะตั: {answer}"

    # ะะฐะฟััะบะฐะตะผ ะฒัะต ะฟะพะดะทะฐะฟัะพัั ะฟะฐัะฐะปะปะตะปัะฝะพ - ััะพ ะบัะธัะธัะฝะพ ะดะปั latency
    sub_answers = await asyncio.gather(*[answer_subq(q) for q in sub_questions])

    # ะจะะ 3: ะกะธะฝัะตะทะธััะตะผ ัะธะฝะฐะปัะฝัะน ะพัะฒะตั
    synthesis_chain = synthesis_prompt | llm | StrOutputParser()
    final_answer = await synthesis_chain.ainvoke({
        "original_question": question,
        "sub_answers": "\n\n---\n\n".join(sub_answers)
    })

    return final_answer
```

### Multi-Hop Reasoning: ะพัะพะฑัะน ัะปััะฐะน

ะะฝะพะณะดะฐ ะฟะพะดะฒะพะฟัะพัั ะทะฐะฒะธััั ะดััะณ ะพั ะดััะณะฐ. ะัะธะผะตั:

> "ะัะพ CEO ะบะพะผะฟะฐะฝะธะธ, ะบะพัะพัะฐั ะฟัะธะพะฑัะตะปะฐ Instagram?"

ะะดะตัั ะฝะตะปัะทั ะฟะฐัะฐะปะปะตะปัะฝะพ ะธัะบะฐัั ะพัะฒะตัั. ะัะถะฝะฐ **ัะตะฟะพัะบะฐ**:
1. ะกะฝะฐัะฐะปะฐ: "ะะฐะบะฐั ะบะพะผะฟะฐะฝะธั ะฟัะธะพะฑัะตะปะฐ Instagram?" -> Facebook (Meta)
2. ะะพัะพะผ: "ะัะพ CEO Meta?" -> Mark Zuckerberg

Naive RAG ะฟัะพะฒะฐะปะธััั: ะฝะตั ะดะพะบัะผะตะฝัะฐ, ะณะดะต ะฝะฐะฟะธัะฐะฝะพ "CEO ะบะพะผะฟะฐะฝะธะธ, ะบัะฟะธะฒัะตะน Instagram - ะฆัะบะตัะฑะตัะณ".

```
Multi-Hop ะฟัะธะผะตั:

ะะพะฟัะพั: "ะัะพ CEO ะบะพะผะฟะฐะฝะธะธ, ะบะพัะพัะฐั ะฟัะธะพะฑัะตะปะฐ Instagram?"

HOP 1: "ะะฐะบะฐั ะบะพะผะฟะฐะฝะธั ะฟัะธะพะฑัะตะปะฐ Instagram?"
       -> Retrieve -> Answer: "Facebook (Meta)"

HOP 2: "ะัะพ CEO Facebook/Meta?"  <- ะธัะฟะพะปัะทัะตะผ ัะตะทัะปััะฐั HOP 1
       -> Retrieve -> Answer: "Mark Zuckerberg"

ะคะะะะ: "Mark Zuckerberg ัะฒะปัะตััั CEO Meta,
        ะบะพัะพัะฐั ะฟัะธะพะฑัะตะปะฐ Instagram ะฒ 2012 ะณะพะดั."
```

### ะขะธะฟะธัะฝัะต ะพัะธะฑะบะธ ะฒ Query Decomposition

| ะัะธะฑะบะฐ | ะะพัะตะผั ะฟะปะพัะพ | ะะฐะบ ะธัะฟัะฐะฒะธัั |
|--------|--------------|---------------|
| ะกะปะธัะบะพะผ ะผะฝะพะณะพ ะฟะพะดะฒะพะฟัะพัะพะฒ (>5) | ะฃะฒะตะปะธัะธะฒะฐะตั latency ะธ ััะพะธะผะพััั, ัััะดัะฐะตั ัะธะฝัะตะท | ะะณัะฐะฝะธัั ะดะพ 2-4 ะฟะพะดะฒะพะฟัะพัะพะฒ |
| ะัะฑะปะธััััะธะต ะฟะพะดะฒะพะฟัะพัั | ะะทะฑััะพัะฝะฐั ัะฐะฑะพัะฐ, ะทะฐะฟััะฐะฝะฝัะน ัะธะฝัะตะท | ะฏะฒะฝะพ ัะบะฐะถะธ ะฒ ะฟัะพะผะฟัะต ะธะทะฑะตะณะฐัั ะดัะฑะปะธัะพะฒะฐะฝะธั |
| ะกะปะธัะบะพะผ ะฐะฑัััะฐะบัะฝัะต ะฟะพะดะฒะพะฟัะพัั | Retrieval ะฝะต ะฝะฐัะพะดะธั ัะตะปะตะฒะฐะฝัะฝัั ะดะพะบัะผะตะฝัะพะฒ | ะัะพัะธ ะบะพะฝะบัะตัะฝัะต, ะฟะพะธัะบะพะฒัะต ัะพัะผัะปะธัะพะฒะบะธ |
| ะะตั ะพะฑัะฐะฑะพัะบะธ ะฟััััั ัะตะทัะปััะฐัะพะฒ | ะะฐะปะปััะธะฝะฐัะธะธ ะฒ ะพัะฒะตัะต | ะะพะฑะฐะฒั fallback: "ะธะฝัะพัะผะฐัะธั ะฝะต ะฝะฐะนะดะตะฝะฐ" |

### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั vs ะบะพะณะดะฐ ะฝะตั

**ะัะฟะพะปัะทัะน Query Decomposition ะบะพะณะดะฐ:**
- ะะพะฟัะพั ัะพะดะตัะถะธั ะฝะตัะบะพะปัะบะพ ะฐัะฟะตะบัะพะฒ ("ััะฐะฒะฝะธ X, Y ะธ Z")
- ะัะถะฝะพ ัะพะฑัะฐัั ะธะฝัะพัะผะฐัะธั ะธะท ัะฐะทะฝัั ะธััะพัะฝะธะบะพะฒ
- Multi-hop reasoning (ะพัะฒะตั ะฝะฐ ะพะดะธะฝ ะฒะพะฟัะพั ะฝัะถะตะฝ ะดะปั ะดััะณะพะณะพ)

**ะะต ะธัะฟะพะปัะทัะน ะบะพะณะดะฐ:**
- ะัะพััะพะน factual ะฒะพะฟัะพั ("ะะฐะบะพะน ั ะฝะฐั ะฐะดัะตั ะพัะธัะฐ?")
- ะัะตะผั ะบัะธัะธัะฝะพ (ะดะพะฑะฐะฒะปัะตั 1-2 LLM ะฒัะทะพะฒะฐ)
- ะะพะฟัะพั ัะถะต ะฐัะพะผะฐัะฝัะน

---

## Agentic RAG

### ะัะพะฑะปะตะผะฐ: ะบะพะณะดะฐ ะฟัะพััะพะณะพ retrieval ะฝะตะดะพััะฐัะพัะฝะพ

ะัะตะดััะฐะฒั ัะปัะถะฑั ะฟะพะดะดะตัะถะบะธ ะฐะฒะธะฐะบะพะผะฟะฐะฝะธะธ. ะะปะธะตะฝั ัะฟัะฐัะธะฒะฐะตั:

> "ะะพะน ัะตะนั SU1234 ะทะฐะฒััะฐ, ะฝะพ ั ะฒะธะถั ะฝะฐ ัะฐะนัะต, ััะพ ะพะฝ ะทะฐะดะตัะถะฐะฝ. ะะฐะบะธะต ั ะผะตะฝั ะฒะฐัะธะฐะฝัั? ะะพะณั ะปะธ ั ะฟะตัะตะฑัะพะฝะธัะพะฒะฐัั ะฝะฐ ัะตะณะพะดะฝั ะธะปะธ ะฟะพะปััะธัั ะบะพะผะฟะตะฝัะฐัะธั?"

ะงัะพะฑั ะพัะฒะตัะธัั ะฝะฐ ััะพั ะฒะพะฟัะพั, ัะธััะตะผะฐ ะดะพะปะถะฝะฐ:
1. ะัะพะฒะตัะธัั ััะฐััั ัะตะนัะฐ SU1234 ะฒ real-time API
2. ะะฐะนัะธ ะฟะพะปะธัะธะบั ะบะพะผะฟะฐะฝะธะธ ะฟะพ ะทะฐะดะตัะถะบะฐะผ
3. ะัะพะฒะตัะธัั ะดะพัััะฟะฝะพััั ะฐะปััะตัะฝะฐัะธะฒะฝัั ัะตะนัะพะฒ
4. ะะฐะนัะธ ะธะฝัะพัะผะฐัะธั ะพ ะบะพะผะฟะตะฝัะฐัะธัั ะดะปั ะดะฐะฝะฝะพะณะพ ะบะปะฐััะฐ ะฑะธะปะตัะฐ

ะญัะพ ะฝะต ะฟัะพััะพ "ะฝะฐะนะดะธ ะดะพะบัะผะตะฝั ะธ ะพัะฒะตัั". ะัะถะตะฝ **ะฐะณะตะฝั**, ะบะพัะพััะน ะผะพะถะตั:
- ะะปะฐะฝะธัะพะฒะฐัั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะดะตะนััะฒะธะน
- ะัะฟะพะปัะทะพะฒะฐัั ัะฐะทะฝัะต ะธะฝััััะผะตะฝัั (API, ะฑะฐะทั ะดะฐะฝะฝัั, vector search)
- ะัะพะฒะตัััั ะบะฐัะตััะฒะพ ัะฒะพะธั ัะตะทัะปััะฐัะพะฒ
- ะะพััะตะบัะธัะพะฒะฐัั ัััะฐัะตะณะธั ะฝะฐ ัะพะดั

### ะััะธัะตะบัััะฐ Agentic RAG

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     AGENTIC RAG ARCHITECTURE                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                     โ
โ                         [QUERY]                                     โ
โ                            |                                        โ
โ                            v                                        โ
โ                     โโโโโโโโโโโโโโโโโ                               โ
โ                     โ    PLANNER    โ                               โ
โ                     โ  "ะะฐะบ ะปัััะต   โ                               โ
โ                     โ   ะพัะฒะตัะธัั?"  โ                               โ
โ                     โโโโโโโโโฌโโโโโโโโ                               โ
โ                             |                                       โ
โ              +--------------+--------------+                        โ
โ              |              |              |                        โ
โ              v              v              v                        โ
โ        โโโโโโโโโโโโ   โโโโโโโโโโโโ   โโโโโโโโโโโโ                  โ
โ        โ VectorDB โ   โ  SQL DB  โ   โ Web/API  โ                  โ
โ        โ (docs)   โ   โ (struct) โ   โ (live)   โ                  โ
โ        โโโโโโฌโโโโโโ   โโโโโโฌโโโโโโ   โโโโโโฌโโโโโโ                  โ
โ             |              |              |                         โ
โ             +-------+------+------+-------+                         โ
โ                     |                                               โ
โ                     v                                               โ
โ              โโโโโโโโโโโโโโโโโโโ                                    โ
โ              โ    EVALUATOR    โ<----------+                        โ
โ              โ "ะะพััะฐัะพัะฝะพ ะปะธ  โ           |                        โ
โ              โ  ะธะฝัะพัะผะฐัะธะธ?"   โ           |                        โ
โ              โโโโโโโโโโฌโโโโโโโโโ           |                        โ
โ                       |                    |                        โ
โ              +--------+--------+           |                        โ
โ              |                 |           |                        โ
โ           YES: OK           NO: retry     |                        โ
โ              |                 |           |                        โ
โ              v                 v           |                        โ
โ        โโโโโโโโโโโโ     โโโโโโโโโโโโโ     |                        โ
โ        โ GENERATE โ     โ  REFINER  โ-----+                        โ
โ        โ  Answer  โ     โ New query โ                               โ
โ        โโโโโโโโโโโโ     โโโโโโโโโโโโโ                               โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะปััะตะฒัะต ะฟะฐััะตัะฝั Agentic RAG

**1. Conditional Retrieval: ะฝัะถะตะฝ ะปะธ ะฒะพะพะฑัะต ะฟะพะธัะบ?**

ะะต ะบะฐะถะดัะน ะฒะพะฟัะพั ััะตะฑัะตั retrieval:
- "ะกะบะพะปัะบะพ ะฑัะดะตั 2+2?" -> ะะต ะฝัะถะตะฝ retrieval
- "ะะฐะบะฐั ะฟะพะณะพะดะฐ ะฒ ะะพัะบะฒะต?" -> ะัะถะตะฝ web search
- "ะะฐะบะฐั ะฝะฐัะฐ ะฟะพะปะธัะธะบะฐ ะพัะฟััะบะพะฒ?" -> ะัะถะตะฝ vector search

ะะณะตะฝั ัะฝะฐัะฐะปะฐ ะบะปะฐััะธัะธัะธััะตั ะฒะพะฟัะพั ะธ ะฒัะฑะธัะฐะตั ัััะฐัะตะณะธั.

**2. Router: ะฒัะฑะพั ะธััะพัะฝะธะบะฐ ะดะฐะฝะฝัั**

ะะฐะทะฝัะต ะฒะพะฟัะพัั ััะตะฑััั ัะฐะทะฝัั ะธััะพัะฝะธะบะพะฒ:
- ะกะตะผะฐะฝัะธัะตัะบะธะน ะฟะพะธัะบ -> VectorDB
- ะกัััะบัััะธัะพะฒะฐะฝะฝัะต ะดะฐะฝะฝัะต ("ะฒััััะบะฐ ะทะฐ Q3") -> SQL
- ะะบััะฐะปัะฝัะต ัะพะฑััะธั -> Web search
- Real-time ะดะฐะฝะฝัะต -> API

**3. Self-Reflection Loop: ัะฐะผะพะฟัะพะฒะตัะบะฐ**

ะะณะตะฝั ะฟะพััะพัะฝะฝะพ ัะฟัะฐัะธะฒะฐะตั ัะตะฑั:
1. "ะะฐัะตะป ะปะธ ั ัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั?"
2. "ะัะปะธ ะฝะตั - ะบะฐะบ ะฟะตัะตัะพัะผัะปะธัะพะฒะฐัั ะทะฐะฟัะพั?"
3. "ะัะฒะตั ะฟะพะปััะธะปัั ัะพัะพัะธะผ?"
4. "ะัะถะฝะพ ะปะธ ะธัะบะฐัั ะดะพะฟะพะปะฝะธัะตะปัะฝัั ะธะฝัะพัะผะฐัะธั?"

### ะะพัะตะผั ััะพ ัะฐะฑะพัะฐะตั

1. **ะะดะฐะฟัะธะฒะฝะพััั**: ัะธััะตะผะฐ ะฟะพะดัััะฐะธะฒะฐะตััั ะฟะพะด ะบะพะฝะบัะตัะฝัะน ะฒะพะฟัะพั, ะฐ ะฝะต ัะปะตะฟะพ ัะปะตะดัะตั pipeline

2. **ะกะฐะผะพะธัะฟัะฐะฒะปะตะฝะธะต**: ะตัะปะธ ะฟะตัะฒะฐั ะฟะพะฟััะบะฐ ะฝะตัะดะฐัะฝะฐ, ะฐะณะตะฝั ะฟัะพะฑัะตั ะดััะณะพะน ะฟะพะดัะพะด

3. **ะัะปััะธะผะพะดะฐะปัะฝะพััั**: ะผะพะถะตั ะบะพะผะฑะธะฝะธัะพะฒะฐัั ัะฐะทะฝัะต ะธััะพัะฝะธะบะธ ะดะฐะฝะฝัั

4. **ะะณัะฐะฝะธัะตะฝะฝัะต ัะธะบะปั**: ั max retries ัะธััะตะผะฐ ะฝะต ะทะฐะฒะธัะฝะตั ะฒ ะฑะตัะบะพะฝะตัะฝะพะผ ะฟะพะธัะบะต

### ะะตะฐะปะธะทะฐัะธั ั LangGraph

LangGraph - ััะพ ะฑะธะฑะปะธะพัะตะบะฐ ะดะปั ะฟะพัััะพะตะฝะธั stateful ะฐะณะตะฝัะพะฒ. ะะฝะฐ ะฟะพะทะฒะพะปัะตั ะพะฟะธัะฐัั ะณัะฐั ัะพััะพัะฝะธะน ะธ ะฟะตัะตัะพะดะพะฒ.

```python
from langgraph.graph import StateGraph, END
from typing import TypedDict, List, Annotated
import operator

# ะจะะ 1: ะะฟัะตะดะตะปัะตะผ ััััะบัััั ัะพััะพัะฝะธั ะฐะณะตะฝัะฐ
# TypedDict ะดะฐะตั ะฝะฐะผ type hints ะธ ะฟัะพะฒะตัะบั ััััะบัััั
class AgentState(TypedDict):
    question: str                                    # ะััะพะดะฝัะน ะฒะพะฟัะพั (ะผะพะถะตั ะผะตะฝััััั ะฟัะธ rewrite)
    documents: Annotated[List[str], operator.add]    # ะะฐะนะดะตะฝะฝัะต ะดะพะบัะผะตะฝัั (ะฝะฐะบะฐะฟะปะธะฒะฐัััั)
    generation: str                                  # ะกะณะตะฝะตัะธัะพะฒะฐะฝะฝัะน ะพัะฒะตั
    retrieval_grade: str                             # ะัะตะฝะบะฐ ะบะฐัะตััะฒะฐ retrieval: "good" ะธะปะธ "poor"
    answer_grade: str                                # ะัะตะฝะบะฐ ะบะฐัะตััะฒะฐ ะพัะฒะตัะฐ
    retries: int                                     # ะกัะตััะธะบ ะฟะพะฟััะพะบ (ะทะฐัะธัะฐ ะพั ะฑะตัะบะพะฝะตัะฝะพะณะพ ัะธะบะปะฐ)


# ะจะะ 2: ะะฟัะตะดะตะปัะตะผ ะฝะพะดั ะณัะฐัะฐ
# ะะฐะถะดะฐั ะฝะพะดะฐ - ััะพ ััะฝะบัะธั, ะบะพัะพัะฐั ะฟัะธะฝะธะผะฐะตั ัะพััะพัะฝะธะต ะธ ะฒะพะทะฒัะฐัะฐะตั ะพะฑะฝะพะฒะปะตะฝะธั

def retrieve(state: AgentState) -> AgentState:
    """
    ะะพะดะฐ retrieval: ะธัะตั ะดะพะบัะผะตะฝัั ะฟะพ ัะตะบััะตะผั ะฒะพะฟัะพัั.

    ะะพัะตะผั ััะพ ะพัะดะตะปัะฝะฐั ะฝะพะดะฐ: ะฟะพะทะฒะพะปัะตั ะฟะตัะตะธัะฟะพะปัะทะพะฒะฐัั
    ะฟะพัะปะต query rewriting ะฑะตะท ะดัะฑะปะธัะพะฒะฐะฝะธั ะบะพะดะฐ.
    """
    question = state["question"]

    # ะัะฟะพะปัะทัะตะผ similarity_search ะดะปั semantic ะฟะพะธัะบะฐ
    # k=5 - ัะฐะทัะผะฝัะน ะฑะฐะปะฐะฝั ะผะตะถะดั ะฟะพะปะฝะพัะพะน ะธ ัะพะบััะพะผ
    documents = vectorstore.similarity_search(question, k=5)

    return {"documents": [doc.page_content for doc in documents]}


def grade_documents(state: AgentState) -> AgentState:
    """
    ะะพะดะฐ ะพัะตะฝะบะธ: ะฟัะพะฒะตััะตั ัะตะปะตะฒะฐะฝัะฝะพััั ะบะฐะถะดะพะณะพ ะดะพะบัะผะตะฝัะฐ.

    ะญัะพ ะบัะธัะธัะตัะบะธ ะฒะฐะถะฝะพ! ะะตะท ััะพะน ะฟัะพะฒะตัะบะธ ะผั ะผะพะถะตะผ ะฟะพะปััะธัั
    ะบัะฐัะธะฒัะน, ะฝะพ ะณะฐะปะปััะธะฝะธัะพะฒะฐะฝะฝัะน ะพัะฒะตั ะฝะฐ ะพัะฝะพะฒะต ะฝะตัะตะปะตะฒะฐะฝัะฝัั ะดะพะบัะผะตะฝัะพะฒ.
    """
    question = state["question"]
    documents = state["documents"]

    # ะัะพะผะฟั ะดะปั LLM-as-a-judge
    # ะัะพัะธะผ ะฑะธะฝะฐัะฝัะน ะพัะฒะตั ะดะปั ะฟัะพััะพัั ะฟะฐััะธะฝะณะฐ
    grader_prompt = """
    ะะพะฟัะพั ะฟะพะปัะทะพะฒะฐัะตะปั: {question}

    ะะพะบัะผะตะฝั ะธะท ะฑะฐะทั ะทะฝะฐะฝะธะน:
    {document}

    ะกะพะดะตัะถะธั ะปะธ ััะพั ะดะพะบัะผะตะฝั ะธะฝัะพัะผะฐัะธั, ะฟะพะปะตะทะฝัั ะดะปั ะพัะฒะตัะฐ ะฝะฐ ะฒะพะฟัะพั?
    ะัะฒะตัั ะขะะะฌะะ 'yes' ะธะปะธ 'no'.
    """

    relevant_docs = []
    for doc in documents:
        response = llm.invoke(grader_prompt.format(
            question=question,
            document=doc
        ))
        if "yes" in response.content.lower():
            relevant_docs.append(doc)

    # ะะพัะพะณ: ะฝัะถะฝะพ ะผะธะฝะธะผัะผ 2 ัะตะปะตะฒะฐะฝัะฝัั ะดะพะบัะผะตะฝัะฐ
    # ะญัะพ ัะผะฟะธัะธัะตัะบะธะน ะฒัะฑะพั - ะผะพะถะฝะพ ะฝะฐัััะฐะธะฒะฐัั
    grade = "good" if len(relevant_docs) >= 2 else "poor"

    print(f"ะะฐะนะดะตะฝะพ ัะตะปะตะฒะฐะฝัะฝัั ะดะพะบัะผะตะฝัะพะฒ: {len(relevant_docs)}/{len(documents)}")

    return {"documents": relevant_docs, "retrieval_grade": grade}


def decide_to_generate(state: AgentState) -> str:
    """
    Conditional edge: ัะตัะฐะตั, ะณะตะฝะตัะธัะพะฒะฐัั ะพัะฒะตั ะธะปะธ ะฟะตัะตัะพัะผัะปะธัะพะฒะฐัั ะทะฐะฟัะพั.

    ะะพะทะฒัะฐัะฐะตั ะธะผั ัะปะตะดัััะตะน ะฝะพะดั.
    """
    if state["retrieval_grade"] == "good":
        return "generate"
    elif state["retries"] < 3:
        # ะะต ัะดะฐะตะผัั ััะฐะทั - ะฟัะพะฑัะตะผ ะฟะตัะตัะพัะผัะปะธัะพะฒะฐัั
        return "transform_query"
    else:
        # ะะพัะปะต 3 ะฟะพะฟััะพะบ ะณะตะฝะตัะธััะตะผ ั ัะตะผ ััะพ ะตััั
        # ะัััะต ัะฐััะธัะฝัะน ะพัะฒะตั, ัะตะผ ะฒะตัะฝัะน ัะธะบะป
        print("ะะพััะธะณะฝัั ะปะธะผะธั ะฟะพะฟััะพะบ, ะณะตะฝะตัะธััะตะผ ั ะดะพัััะฟะฝัะผะธ ะดะฐะฝะฝัะผะธ")
        return "generate"


def transform_query(state: AgentState) -> AgentState:
    """
    ะะพะดะฐ ะฟะตัะตัะพัะผัะปะธัะพะฒะฐะฝะธั: ะฟััะฐะตััั ัะปัััะธัั ะทะฐะฟัะพั ะดะปั ะปัััะตะณะพ retrieval.

    ะขะธะฟะธัะฝัะต ัะปัััะตะฝะธั:
    - ะะพะปะตะต ะบะพะฝะบัะตัะฝัะต ัะตัะผะธะฝั
    - ะกะธะฝะพะฝะธะผั
    - ะะฐะทะฑะธะตะฝะธะต ะฝะฐ ัะฐััะธ
    - ะฃะดะฐะปะตะฝะธะต "ััะผะฐ"
    """
    question = state["question"]

    rewrite_prompt = """
    ะััะพะดะฝัะน ะฒะพะฟัะพั ะฝะต ะดะฐะป ัะพัะพัะธั ัะตะทัะปััะฐัะพะฒ ะฟะพะธัะบะฐ.

    ะััะพะดะฝัะน ะฒะพะฟัะพั: {question}

    ะะตัะตัะพัะผัะปะธััะน ะตะณะพ ัะฐะบ, ััะพะฑั ะพะฝ ะปัััะต ะฟะพะดัะพะดะธะป ะดะปั ะฟะพะธัะบะฐ ะฒ ะฑะฐะทะต ะทะฝะฐะฝะธะน.
    ะัะฟะพะปัะทัะน ะฑะพะปะตะต ะบะพะฝะบัะตัะฝัะต ัะตัะผะธะฝั, ะฒะพะทะผะพะถะฝะพ ัะธะฝะพะฝะธะผั.

    ะะตัะตัะพัะผัะปะธัะพะฒะฐะฝะฝัะน ะฒะพะฟัะพั:
    """

    response = llm.invoke(rewrite_prompt.format(question=question))
    new_question = response.content.strip()

    print(f"ะะตัะตัะพัะผัะปะธัะพะฒะบะฐ: '{question}' -> '{new_question}'")

    return {
        "question": new_question,
        "retries": state["retries"] + 1
    }


def generate(state: AgentState) -> AgentState:
    """
    ะะพะดะฐ ะณะตะฝะตัะฐัะธะธ: ัะพะทะดะฐะตั ัะธะฝะฐะปัะฝัะน ะพัะฒะตั ะฝะฐ ะพัะฝะพะฒะต ะฝะฐะนะดะตะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ.
    """
    question = state["question"]
    documents = state["documents"]

    # ะะฑัะตะดะธะฝัะตะผ ะดะพะบัะผะตะฝัั ะฒ ะบะพะฝัะตะบัั
    context = "\n\n---\n\n".join(documents)

    generation_prompt = f"""
    ะัะฒะตัั ะฝะฐ ะฒะพะฟัะพั ะฟะพะปัะทะพะฒะฐัะตะปั, ะพัะฝะพะฒัะฒะฐััั ะขะะะฌะะ ะฝะฐ ะฟัะตะดะพััะฐะฒะปะตะฝะฝะพะผ ะบะพะฝัะตะบััะต.
    ะัะปะธ ะธะฝัะพัะผะฐัะธะธ ะฝะตะดะพััะฐัะพัะฝะพ - ัะตััะฝะพ ัะบะฐะถะธ ะพะฑ ััะพะผ.

    ะะพะฝัะตะบัั ะธะท ะฑะฐะทั ะทะฝะฐะฝะธะน:
    {context}

    ะะพะฟัะพั: {question}

    ะัะฒะตั:
    """

    response = llm.invoke(generation_prompt)
    return {"generation": response.content}


# ะจะะ 3: ะกะพะฑะธัะฐะตะผ ะณัะฐั
workflow = StateGraph(AgentState)

# ะะพะฑะฐะฒะปัะตะผ ะฝะพะดั
workflow.add_node("retrieve", retrieve)
workflow.add_node("grade_documents", grade_documents)
workflow.add_node("transform_query", transform_query)
workflow.add_node("generate", generate)

# ะะฟัะตะดะตะปัะตะผ ะฟะตัะตัะพะดั
workflow.set_entry_point("retrieve")                    # ะะฐัะธะฝะฐะตะผ ั retrieval
workflow.add_edge("retrieve", "grade_documents")        # ะะพัะปะต retrieval - ะพัะตะฝะบะฐ
workflow.add_conditional_edges(                          # ะะพัะปะต ะพัะตะฝะบะธ - ัะตัะตะฝะธะต
    "grade_documents",
    decide_to_generate,
    {
        "generate": "generate",
        "transform_query": "transform_query"
    }
)
workflow.add_edge("transform_query", "retrieve")        # ะะพัะปะต rewrite - ัะฝะพะฒะฐ retrieval
workflow.add_edge("generate", END)                      # ะะพัะปะต ะณะตะฝะตัะฐัะธะธ - ะบะพะฝะตั

# ะะพะผะฟะธะปะธััะตะผ ะณัะฐั ะฒ ะธัะฟะพะปะฝัะตะผะพะต ะฟัะธะปะพะถะตะฝะธะต
app = workflow.compile()

# ะัะฟะพะปัะทะพะฒะฐะฝะธะต
result = app.invoke({
    "question": "ะะฐะบะธะต ะธะทะผะตะฝะตะฝะธั ะฒ AI-ัะตะณัะปะธัะพะฒะฐะฝะธะธ ะฒ ะะก ะฟัะพะธะทะพัะปะธ ะฒ 2024?",
    "documents": [],
    "retries": 0
})

print(result["generation"])
```

### ะขะธะฟะธัะฝัะต ะพัะธะฑะบะธ ะฒ Agentic RAG

| ะัะธะฑะบะฐ | ะะพัะปะตะดััะฒะธั | ะะตัะตะฝะธะต |
|--------|-------------|---------|
| ะะตั ะปะธะผะธัะฐ ะฟะพะฟััะพะบ | ะะตัะบะพะฝะตัะฝัะน ัะธะบะป, ะพะณัะพะผะฝัะต ะทะฐััะฐัั | `retries < 3` ั fallback |
| ะกะปะธัะบะพะผ ัััะพะณะธะน grading | ะัะฑัะฐััะฒะฐะตั ะฟะพะปะตะทะฝัะต ะดะพะบัะผะตะฝัั | ะะฐะปะธะฑัะพะฒะฐัั threshold, ะดะพะฑะฐะฒะธัั partial relevance |
| ะะตั ะปะพะณะธัะพะฒะฐะฝะธั ัะตัะตะฝะธะน | ะะตะฒะพะทะผะพะถะฝะพ ะดะตะฑะฐะถะธัั | ะะพะณะธัะพะฒะฐัั ะบะฐะถะดะพะต ัะตัะตะฝะธะต ะฐะณะตะฝัะฐ |
| ะะฐะดะฝัะน retrieval | ะกะปะธัะบะพะผ ะผะฝะพะณะพ ะดะพะบัะผะตะฝัะพะฒ, ัะตััะตััั ัะพะบัั | k=5-10, reranking |
| ะะตั timeout | ะะฐะฒะธัะฐะฝะธะต ะฝะฐ ะฒะฝะตัะฝะธั API | asyncio.timeout ะธะปะธ deadline |

### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั Agentic RAG

**ะัะฟะพะปัะทัะน ะบะพะณะดะฐ:**
- ะะพะฟัะพัั ััะตะฑััั multi-hop reasoning
- ะัะถะฝะพ ะบะพะผะฑะธะฝะธัะพะฒะฐัั ัะฐะทะฝัะต ะธััะพัะฝะธะบะธ ะดะฐะฝะฝัั
- ะะฐัะตััะฒะพ ะพัะฒะตัะฐ ะบัะธัะธัะฝะพ (ะปัััะต ะดะพะปััะต, ะฝะพ ัะพัะฝะตะต)
- ะััั ัะตััััั ะฝะฐ ะดะพะฟะพะปะฝะธัะตะปัะฝัะต LLM ะฒัะทะพะฒั

**ะะต ะธัะฟะพะปัะทัะน ะบะพะณะดะฐ:**
- ะัะพัััะต FAQ-ะฒะพะฟัะพัั
- Latency ะบัะธัะธัะฝะฐ (ะบะฐะถะดัะน retry = +2-5 ัะตะบัะฝะด)
- ะะณัะฐะฝะธัะตะฝะฝัะน ะฑัะดะถะตั ะฝะฐ LLM
- ะะฐะฝะฝัะต ะธ ัะฐะบ ะฒััะพะบะพะณะพ ะบะฐัะตััะฒะฐ

---

## Self-RAG ะธ Corrective RAG

### ะัะพะฑะปะตะผะฐ: ะฐะณะตะฝั, ะบะพัะพััะน ะฝะต ัะพะผะฝะตะฒะฐะตััั ะฒ ัะตะฑะต

ะัะตะดััะฐะฒั ัััะดะตะฝัะฐ, ะบะพัะพััะน ะพัะฒะตัะฐะตั ะฝะฐ ัะบะทะฐะผะตะฝะต. ะะฑััะฝัะน ัััะดะตะฝั: ะฟัะพัะธัะฐะป ะฒะพะฟัะพั -> ะฒัะฟะพะผะฝะธะป ััะพ-ัะพ ะฟะพัะพะถะตะต -> ะฝะฐะฟะธัะฐะป ะพัะฒะตั. ะัะปะธ ะฟะพะฒะตะทะปะพ - ะพัะฒะตั ะฟัะฐะฒะธะปัะฝัะน. ะัะปะธ ะฝะตั - ัะฒะตัะตะฝะฝะพ ะฝะฐะฟะธัะฐะป ัััั.

ะัะปะธัะฝัะน ัััะดะตะฝั ะดะตะนััะฒัะตั ะธะฝะฐัะต:
1. "ะัะถะฝะพ ะปะธ ะผะฝะต ะฒะพะพะฑัะต ะธัะบะฐัั ะธะฝัะพัะผะฐัะธั, ะธะปะธ ั ัะพัะฝะพ ััะพ ะทะฝะฐั?"
2. "ะขะพ, ััะพ ั ะฝะฐัะตะป - ััะพ ะดะตะนััะฒะธัะตะปัะฝะพ ัะตะปะตะฒะฐะฝัะฝะพ?"
3. "ะะพะน ะพัะฒะตั ัะตะฐะปัะฝะพ ะฟะพะดะดะตัะถะธะฒะฐะตััั ัะตะผ, ััะพ ั ะฟัะพัะธัะฐะป?"
4. "ะะฐัะบะพะปัะบะพ ะผะพะน ะพัะฒะตั ะฟะพะปะตะทะตะฝ ะดะปั ัะฟัะฐัะธะฒะฐััะตะณะพ?"

Self-RAG ะธ CRAG - ััะพ ัะตัะฝะธะบะธ, ะบะพัะพััะต ะทะฐััะฐะฒะปััั RAG-ัะธััะตะผั ะทะฐะดะฐะฒะฐัั ัะตะฑะต ััะธ ะฒะพะฟัะพัั.

### Self-RAG: Reflection Tokens

Self-RAG ะธัะฟะพะปัะทัะตั ัะฟะตัะธะฐะปัะฝัะต "ัะพะบะตะฝั ัะตัะปะตะบัะธะธ" - ััะพ ะบะฐะบ ะฒะฝัััะตะฝะฝะธะน ะณะพะปะพั, ะบะพัะพััะน ะบะพะผะผะตะฝัะธััะตั ะบะฐะถะดัะน ัะฐะณ.

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         SELF-RAG                                    โ
โ                 Reflection Tokens                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                     โ
โ   [Retrieve] - ะะตัะตะฝะธะต ะพ ะฝะตะพะฑัะพะดะธะผะพััะธ retrieval:                   โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                  โ
โ   โข "yes"      โ ะฝัะถะตะฝ retrieval, ะธัะตะผ                              โ
โ   โข "no"       โ ะผะพะถะตะผ ะพัะฒะตัะธัั ะธะท ะทะฝะฐะฝะธะน ะผะพะดะตะปะธ                    โ
โ   โข "continue" โ ะฝัะถะฝะพ ะฑะพะปััะต ะบะพะฝัะตะบััะฐ                             โ
โ                                                                     โ
โ   ะัะธะผะตั:                                                           โ
โ   "ะกะบะพะปัะบะพ ะฑัะดะตั 2+2?" โ [Retrieve: no] โ ััะฐะทั ะพัะฒะตัะฐะตะผ           โ
โ   "ะะพะณะดะฐ ะพัะฝะพะฒะฐะฝะฐ ะฒะฐัะฐ ะบะพะผะฟะฐะฝะธั?" โ [Retrieve: yes] โ ะธัะตะผ         โ
โ                                                                     โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                     โ
โ   [ISREL] - ะะตะปะตะฒะฐะฝัะตะฝ ะปะธ ะดะพะบัะผะตะฝั?                                 โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                  โ
โ   โข "relevant"   โ ะดะพะบัะผะตะฝั ัะพะดะตัะถะธั ะฟะพะปะตะทะฝัั ะธะฝัะพัะผะฐัะธั           โ
โ   โข "irrelevant" โ ะฝะต ะพัะฝะพัะธััั ะบ ะฒะพะฟัะพัั                           โ
โ                                                                     โ
โ   ะญัะพ ัะธะปััั: ะฝะตัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั ะพัะฑัะฐััะฒะฐัััั ะะะะะ ะณะตะฝะตัะฐัะธะตะนโ
โ                                                                     โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                     โ
โ   [ISSUP] - ะะพะดะดะตัะถะธะฒะฐะตััั ะปะธ ะพัะฒะตั ะดะพะบัะผะตะฝัะฐะผะธ?                    โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                  โ
โ   โข "fully supported"     โ ะฒัะต claims ะฟะพะดัะฒะตัะถะดะตะฝั                 โ
โ   โข "partially supported" โ ัะฐััั ะธะฝัะพัะผะฐัะธะธ ะธะท ะดะพะบัะผะตะฝัะพะฒ          โ
โ   โข "no support"          โ ะพัะฒะตั ะฒัะดัะผะฐะฝ, ะณะฐะปะปััะธะฝะฐัะธั!           โ
โ                                                                     โ
โ   ะัะธัะธัะตัะบะธะน ะผะพะผะตะฝั: ะตัะปะธ "no support" โ ะฟะตัะตะณะตะฝะตัะธััะตะผ           โ
โ                                                                     โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                     โ
โ   [ISUSE] - ะะฐัะบะพะปัะบะพ ะฟะพะปะตะทะตะฝ ะพัะฒะตั?                                โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                  โ
โ   โข 5 โ ะพัะตะฝั ะฟะพะปะตะทะตะฝ, ะฟะพะปะฝะพัััั ะพัะฒะตัะฐะตั                           โ
โ   โข 4 โ ัะพัะพัะพ, ะฝะพ ะผะพะถะฝะพ ะปัััะต                                      โ
โ   โข 3 โ ััะตะดะฝะต, ัะฐััะธัะฝัะน ะพัะฒะตั                                     โ
โ   โข 2 โ ะฟะปะพัะพ, ะผะฐะปะพ ะฟะพะปะตะทะฝะพะน ะธะฝัะพัะผะฐัะธะธ                             โ
โ   โข 1 โ ะฑะตัะฟะพะปะตะทะตะฝ                                                  โ
โ                                                                     โ
โ   ะัะธ ะฝะธะทะบะพะน ะพัะตะฝะบะต โ ะธัะตะผ ะดะพะฟะพะปะฝะธัะตะปัะฝัะต ะดะพะบัะผะตะฝัั                 โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะฐะบ ัะฐะฑะพัะฐะตั Self-RAG Flow

```
ะะพะฟัะพั ะฟะพะปัะทะพะฒะฐัะตะปั
        |
        v
+---------------+
| [Retrieve?]   |-------- "no" --------> ะะตะฝะตัะธััะตะผ ะฝะฐะฟััะผัั
+-------+-------+                               |
        | "yes"                                 |
        v                                       |
+---------------+                               |
|   Retrieve    |                               |
|   Documents   |                               |
+-------+-------+                               |
        |                                       |
        v                                       |
+---------------+                               |
|   [ISREL]     |---- "irrelevant" ---> Retrieve more
+-------+-------+                               |
        | "relevant"                            |
        v                                       |
+---------------+<------------------------------+
|   Generate    |
|    Answer     |
+-------+-------+
        |
        v
+---------------+
|   [ISSUP]     |---- "no support" ---> Revise answer
+-------+-------+
        | "supported"
        v
+---------------+
|   [ISUSE]     |---- score < 3 ---> Retrieve more, retry
+-------+-------+
        | score >= 3
        v
   FINAL OUTPUT
```

### ะะพัะตะผั Self-RAG ัะฐะฑะพัะฐะตั

1. **On-demand retrieval**: ะฝะต ััะฐัะธั ัะตััััั ะฝะฐ retrieval ะดะปั ััะธะฒะธะฐะปัะฝัั ะฒะพะฟัะพัะพะฒ

2. **ะคะธะปัััะฐัะธั ััะผะฐ**: ะฝะตัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั ะพััะตะธะฒะฐัััั ะดะพ ะณะตะฝะตัะฐัะธะธ, ะฝะต ะทะฐะณััะทะฝััั ะบะพะฝัะตะบัั

3. **ะะฝัะธะณะฐะปะปััะธะฝะฐัะธั**: ะฟัะพะฒะตัะบะฐ [ISSUP] ะปะพะฒะธั ะฒัะดัะผะฐะฝะฝัะต ัะฐะบัั

4. **Quality gate**: [ISUSE] ะฝะต ะฟัะพะฟััะบะฐะตั ะฟะปะพัะธะต ะพัะฒะตัั ะบ ะฟะพะปัะทะพะฒะฐัะตะปั

**ะะตะทัะปััะฐั**: +40% accuracy ะฝะฐ ะฑะตะฝัะผะฐัะบะฐั ะฟะพ ััะฐะฒะฝะตะฝะธั ั ะพะฑััะฝัะผ RAG.

### Corrective RAG (CRAG): ัะพะบัั ะฝะฐ ะบะฐัะตััะฒะต retrieval

CRAG - ััะพ ะฑะพะปะตะต ะฟัะพััะฐั ัะตัะฝะธะบะฐ, ะบะพัะพัะฐั ัะพะบััะธััะตััั ะฝะฐ ะพะดะฝะพะน ะฟัะพะฑะปะตะผะต: **ััะพ ะดะตะปะฐัั, ะตัะปะธ retrieval ะฒะตัะฝัะป ะฟะปะพัะธะต ัะตะทัะปััะฐัั?**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                       CORRECTIVE RAG (CRAG)                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                     โ
โ   Query                                                             โ
โ     |                                                               โ
โ     v                                                               โ
โ   +------------------+                                              โ
โ   |     Retrieve     |                                              โ
โ   |    Documents     |                                              โ
โ   +---------+--------+                                              โ
โ             |                                                       โ
โ             v                                                       โ
โ   +--------------------+                                            โ
โ   |     EVALUATOR      |                                            โ
โ   |  (Relevance Score) |                                            โ
โ   +----------+---------+                                            โ
โ              |                                                      โ
โ     +--------+--------+---------+                                   โ
โ     |                 |         |                                   โ
โ     v                 v         v                                   โ
โ   CORRECT          AMBIGUOUS   INCORRECT                            โ
โ  (score > 0.7)    (0.3-0.7)   (score < 0.3)                        โ
โ     |                 |         |                                   โ
โ     |                 |         v                                   โ
โ     |                 |   +-----------+                             โ
โ     |                 |   | Web Search|                             โ
โ     |                 |   | for more  |                             โ
โ     |                 |   | context   |                             โ
โ     |                 |   +-----+-----+                             โ
โ     |                 |         |                                   โ
โ     |                 v         |                                   โ
โ     |          +-------------+  |                                   โ
โ     |          | Knowledge   |<-+                                   โ
โ     |          | Refinement  |                                      โ
โ     |          +------+------+                                      โ
โ     |                 |                                             โ
โ     +--------+--------+                                             โ
โ              |                                                      โ
โ              v                                                      โ
โ        +-----------+                                                โ
โ        |  GENERATE |                                                โ
โ        |   Answer  |                                                โ
โ        +-----------+                                                โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะพะณะธะบะฐ CRAG

1. **Retrieval**: ััะฐะฝะดะฐััะฝัะน ะฟะพะธัะบ ะดะพะบัะผะตะฝัะพะฒ

2. **Evaluation**: LLM ะพัะตะฝะธะฒะฐะตั ัะตะปะตะฒะฐะฝัะฝะพััั ะบะฐะถะดะพะณะพ ะดะพะบัะผะตะฝัะฐ ะฟะพ ัะบะฐะปะต 0-1

3. **ะขัะธ ะฟััะธ ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะพัะตะฝะบะธ**:
   - **CORRECT (>0.7)**: ะดะพะบัะผะตะฝัั ัะพัะพัะธะต, ะณะตะฝะตัะธััะตะผ ะพัะฒะตั
   - **INCORRECT (<0.3)**: ะดะพะบัะผะตะฝัั ะฟะปะพัะธะต, ะธะดะตะผ ะฒ web search
   - **AMBIGUOUS (0.3-0.7)**: ัะฐััะธัะฝะพ ัะตะปะตะฒะฐะฝัะฝะพ, ะบะพะผะฑะธะฝะธััะตะผ ั web search

4. **Knowledge Refinement**: ะพัะธัะฐะตะผ ะธ ััััะบัััะธััะตะผ ะฝะฐะนะดะตะฝะฝัั ะธะฝัะพัะผะฐัะธั

5. **Generation**: ะณะตะฝะตัะธััะตะผ ะพัะฒะตั ะฝะฐ ะพัะฝะพะฒะต ะพััะธะปัััะพะฒะฐะฝะฝัั ะดะฐะฝะฝัั

### ะกัะฐะฒะฝะตะฝะธะต Self-RAG ะธ CRAG

| ะัะฟะตะบั | Self-RAG | CRAG |
|--------|----------|------|
| **ะะพะณะดะฐ ะพัะตะฝะธะฒะฐะตั** | ะะพ ะฒัะตะผั ะณะตะฝะตัะฐัะธะธ | ะะพ ะณะตะฝะตัะฐัะธะธ |
| **ะขัะตะฑะพะฒะฐะฝะธั** | Fine-tuned ะผะพะดะตะปั ั ัะพะบะตะฝะฐะผะธ | ะัะฑะฐั LLM + ะพัะดะตะปัะฝัะน evaluator |
| **Retrieval** | On-demand (ะผะพะถะตั ะฟัะพะฟัััะธัั) | ะัะตะณะดะฐ, ั fallback ะฝะฐ web |
| **ะกะปะพะถะฝะพััั** | ะััะพะบะฐั (ัะฟะตั. ะผะพะดะตะปั) | ะกัะตะดะฝัั (ะฟัะพัะต ะธะฝัะตะณัะธัะพะฒะฐัั) |
| **ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั** | ะะฐะทะฝะฐั retrieval need | ะัะธัะธัะฝัะต ะบ ะบะฐัะตััะฒั ัะธััะตะผั |
| **Latency** | ะะพะถะตั ะฑััั ะฝะธะถะต (skip retrieval) | ะกัะฐะฑะธะปัะฝะฐั |

### ะัะฐะบัะธัะตัะบะธะน ะฒัะฑะพั

**Self-RAG ะฟะพะดัะพะดะธั ะบะพะณะดะฐ:**
- ะฃ ะฒะฐั ะตััั ะฒะพะทะผะพะถะฝะพััั fine-tune ะผะพะดะตะปั
- ะะฝะพะณะพ ะฒะพะฟัะพัะพะฒ ะฝะต ััะตะฑััั retrieval
- ะะฐะถะฝะฐ ะผะธะฝะธะผะธะทะฐัะธั ะทะฐััะฐั (ะผะตะฝััะต retrieval)

**CRAG ะฟะพะดัะพะดะธั ะบะพะณะดะฐ:**
- ะัะถะฝะพ ะฑััััะพ ะฒะฝะตะดัะธัั ะฒ ัััะตััะฒััััั ัะธััะตะผั
- ะััั web search ะบะฐะบ fallback
- ะัะต ะฒะพะฟัะพัั ััะตะฑััั retrieval ะธะท ะฑะฐะทั

---

## Contextual Retrieval

### ะัะพะฑะปะตะผะฐ: ะฟะพัะตัั ะบะพะฝัะตะบััะฐ ะฟัะธ chunking

ะัะตะดััะฐะฒั, ััะพ ัั ัะธัะฐะตัั ัะธะฝะฐะฝัะพะฒัะน ะพััะตั ะบะพะผะฟะฐะฝะธะธ. ะะฐ ัััะฐะฝะธัะต 47 ะฝะฐะฟะธัะฐะฝะพ:

> "ะััััะบะฐ ะฒััะพัะปะฐ ะฝะฐ 3% ะฟะพ ััะฐะฒะฝะตะฝะธั ั ะฟัะตะดัะดััะธะผ ะบะฒะฐััะฐะปะพะผ."

ะญัะฐ ััะฐะทะฐ ะฟะพะฝััะฝะฐ ะฒ ะบะพะฝัะตะบััะต ะดะพะบัะผะตะฝัะฐ: ัั ะทะฝะฐะตัั, ััะพ ััะพ ะพััะตั Apple ะทะฐ Q2 2024, ะธ ััะพ ะฟัะตะดัะดััะธะน ะบะฒะฐััะฐะป ะธะผะตะป ะฒััััะบั $94.8 ะผะปัะด.

ะะพ ะบะพะณะดะฐ ะผั ัะตะถะตะผ ะดะพะบัะผะตะฝั ะฝะฐ ัะฐะฝะบะธ ะดะปั RAG, ััะฐ ััะฐะทะฐ ััะฐะฝะพะฒะธััั **ัะธัะพัะพะน**: ะบะฐะบะฐั ะบะพะผะฟะฐะฝะธั? ะบะฐะบะพะน ะบะฒะฐััะฐะป? ะบะฐะบะฐั ะฑะฐะทะฐ ะดะปั ััะฐะฒะฝะตะฝะธั?

### ะะฐะบ ัะฐะฑะพัะฐะตั Contextual Retrieval (Anthropic)

ะะดะตั ะฟัะพััะฐ ะธ ัะปะตะณะฐะฝัะฝะฐ: **ะฟะตัะตะด embed ะดะพะฑะฐะฒะธัั ะบ ะบะฐะถะดะพะผั ัะฐะฝะบั ะพะฑัััะฝะตะฝะธะต ะตะณะพ ะบะพะฝัะตะบััะฐ**.

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   CONTEXTUAL RETRIEVAL                              โ
โ                     (Anthropic, 2024)                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                     โ
โ   ะะะะะะะะ:                                                         โ
โ   โโโโโโโโโ                                                         โ
โ   Chunk: "ะััััะบะฐ ะฒััะพัะปะฐ ะฝะฐ 3% ะฟะพ ััะฐะฒะฝะตะฝะธั ั                     โ
โ           ะฟัะตะดัะดััะธะผ ะบะฒะฐััะฐะปะพะผ."                                    โ
โ                                                                     โ
โ   ะะพะฟัะพั: ะะฐะบะฐั ะบะพะผะฟะฐะฝะธั? ะะฐะบะพะน ะฟะตัะธะพะด? ะญัะพ ัะพัะพัะพ ะธะปะธ ะฟะปะพัะพ?      โ
โ   ะะพะฝัะตะบัั ะฟะพัะตััะฝ ะฟัะธ chunking!                                    โ
โ                                                                     โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                     โ
โ   ะะะจะะะะ:                                                          โ
โ   โโโโโโโโ                                                          โ
โ                                                                     โ
โ   ะะพะบัะผะตะฝั + Chunk  โโโบ  Claude  โโโบ  Contextual Chunk             โ
โ                                                                     โ
โ   ะัะพะผะฟั ะดะปั Claude:                                               โ
โ   "ะะพั ะฟะพะปะฝัะน ะดะพะบัะผะตะฝั: {document}                                 โ
โ    ะะพั ะพัะดะตะปัะฝัะน ัะฐะฝะบ ะธะท ะฝะตะณะพ: {chunk}                             โ
โ    ะะฐะน ะบัะฐัะบะธะน ะบะพะฝัะตะบัั (1-2 ะฟัะตะดะปะพะถะตะฝะธั), ะบะพัะพััะน ะฟะพะผะพะถะตั         โ
โ    ะฟะพะฝััั ััะพั ัะฐะฝะบ ะฒ ะพัััะฒะต ะพั ะดะพะบัะผะตะฝัะฐ."                        โ
โ                                                                     โ
โ   ะะะะฃะะฌะขะะข:                                                        โ
โ   โโโโโโโโโโ                                                        โ
โ   "ะญัะพั ัะฐะฝะบ ะธะท SEC-ะพััะตัะฐ Apple ะทะฐ Q2 2024. ะ ะฟัะตะดัะดััะตะผ          โ
โ   ะบะฒะฐััะฐะปะต (Q1 2024) ะฒััััะบะฐ ัะพััะฐะฒะธะปะฐ $94.8 ะผะปัะด.                 โ
โ   ะััััะบะฐ ะฒััะพัะปะฐ ะฝะฐ 3% ะฟะพ ััะฐะฒะฝะตะฝะธั ั ะฟัะตะดัะดััะธะผ ะบะฒะฐััะฐะปะพะผ."      โ
โ                                                                     โ
โ   ะขะตะฟะตัั ะฟะพะธัะบ ะฟะพ "ัะพัั ะฒััััะบะธ Apple" ะฝะฐะนะดะตั ััะพั ัะฐะฝะบ!           โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะพัะตะผั ััะพ ัะฐะฑะพัะฐะตั

1. **Semantic enrichment**: ัะฐะฝะบ ะฟะพะปััะฐะตั ะบะปััะตะฒัะต ัะปะพะฒะฐ ะธ ะบะพะฝัะตะบัั, ะบะพัะพััะต ัะฒะตะปะธัะธะฒะฐัั ะฒะตัะพััะฝะพััั ัะพะฒะฟะฐะดะตะฝะธั ะฟัะธ ะฟะพะธัะบะต

2. **Disambiguation**: ะตัะปะธ ะฒ ะบะพัะฟััะต 10 ะบะพะผะฟะฐะฝะธะน ั ััะฐะทะพะน "ะฒััััะบะฐ ะฒััะพัะปะฐ", ะบะพะฝัะตะบัั ะฟะพะผะพะณะฐะตั ะฝะฐะนัะธ ะฝัะถะฝัั

3. **Self-contained chunks**: ะบะฐะถะดัะน ัะฐะฝะบ ััะฐะฝะพะฒะธััั ะฟะพะปะฝะพัะตะฝะฝัะผ ะธััะพัะฝะธะบะพะผ ะธะฝัะพัะผะฐัะธะธ

### ะะตะทัะปััะฐัั (ะธะท ััะฐััะธ Anthropic)

```
Failure Rate (Top-20 Chunk Retrieval):

Baseline (ัะพะปัะบะพ embeddings):      5.7%
+ Contextual Embeddings:           3.7%  (-35%)
+ Contextual Embeddings + BM25:    2.9%  (-49%)
+ Reranking:                       1.9%  (-67%)
```

### ะะตะฐะปะธะทะฐัะธั ั Prompt Caching

ะะฐะธะฒะฝะฐั ัะตะฐะปะธะทะฐัะธั ะฑัะปะฐ ะฑั ะพัะตะฝั ะดะพัะพะณะพะน: ะดะปั ะบะฐะถะดะพะณะพ ัะฐะฝะบะฐ ะพัะฟัะฐะฒะปััั ะฒะตัั ะดะพะบัะผะตะฝั. ะัะธ ะดะพะบัะผะตะฝัะต ะฒ 50K ัะพะบะตะฝะพะฒ ะธ 100 ัะฐะฝะบะฐั ััะพ 5M ัะพะบะตะฝะพะฒ!

ะะตัะตะฝะธะต - **Prompt Caching**: ะดะพะบัะผะตะฝั ะบััะธััะตััั ะฟัะธ ะฟะตัะฒะพะผ ะทะฐะฟัะพัะต, ะฟะพัะปะตะดัััะธะต ะทะฐะฟัะพัั ั ัะตะผ ะถะต ะดะพะบัะผะตะฝัะพะผ ััะพัั ะฒ 10 ัะฐะท ะดะตัะตะฒะปะต.

```python
import anthropic

client = anthropic.Anthropic()

def add_context_to_chunks(document: str, chunks: list[str]) -> list[str]:
    """
    ะะพะฑะฐะฒะปัะตั ะบะพะฝัะตะบััะฝัั ะธะฝัะพัะผะฐัะธั ะบ ะบะฐะถะดะพะผั ัะฐะฝะบั.

    ะัะฟะพะปัะทัะตั prompt caching ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ััะพะธะผะพััะธ:
    - ะะตัะฒัะน ัะฐะฝะบ: ะฟะพะปะฝะฐั ััะพะธะผะพััั (ะดะพะบัะผะตะฝั ะบััะธััะตััั)
    - ะะพัะปะตะดัััะธะต ัะฐะฝะบะธ: ~90% ัะบะพะฝะพะผะธั (ะดะพะบัะผะตะฝั ะธะท ะบััะฐ)

    Args:
        document: ะะพะปะฝัะน ัะตะบัั ะดะพะบัะผะตะฝัะฐ
        chunks: ะกะฟะธัะพะบ ัะฐะฝะบะพะฒ ะดะพะบัะผะตะฝัะฐ

    Returns:
        ะกะฟะธัะพะบ ัะฐะฝะบะพะฒ ั ะดะพะฑะฐะฒะปะตะฝะฝัะผ ะบะพะฝัะตะบััะพะผ
    """

    contextualized = []

    for i, chunk in enumerate(chunks):
        response = client.messages.create(
            model="claude-sonnet-4-20250514",
            max_tokens=200,  # ะะพะฝัะตะบัั ะดะพะปะถะตะฝ ะฑััั ะบัะฐัะบะธะผ
            messages=[
                {
                    "role": "user",
                    "content": [
                        {
                            # ะะะะะ: ะดะพะบัะผะตะฝั ะธะดะตั ะฟะตัะฒัะผ ะธ ะบััะธััะตััั
                            "type": "text",
                            "text": f"<document>\n{document}\n</document>",
                            "cache_control": {"type": "ephemeral"}  # ะะบะปััะฐะตะผ ะบััะธัะพะฒะฐะฝะธะต
                        },
                        {
                            # ะงะฐะฝะบ ะธะดะตั ะฒัะพััะผ - ะพะฝ ะผะตะฝัะตััั ะดะปั ะบะฐะถะดะพะณะพ ะทะฐะฟัะพัะฐ
                            "type": "text",
                            "text": f"""
<chunk>
{chunk}
</chunk>

ะะฐะน ะบัะฐัะบะธะน ะบะพะฝัะตะบัั (1-2 ะฟัะตะดะปะพะถะตะฝะธั), ะบะพัะพััะน ะพะฑัััะฝัะตั ะผะตััะพ ััะพะณะพ
ัะฐะฝะบะฐ ะฒ ะพะฑัะตะผ ะดะพะบัะผะตะฝัะต. ะะบะปััะธ: ะฝะฐะทะฒะฐะฝะธะต ะดะพะบัะผะตะฝัะฐ/ะธััะพัะฝะธะบะฐ,
ะฒัะตะผะตะฝะฝะพะน ะฟะตัะธะพะด (ะตัะปะธ ะตััั), ะบะปััะตะฒัะต ัััะฝะพััะธ (ะบะพะผะฟะฐะฝะธะธ, ะปัะดะธ, ะฟัะพะดัะบัั).

ะัะฒะตัั ะขะะะฌะะ ะบะพะฝัะตะบััะพะผ, ะฑะตะท ะฟะพััะฝะตะฝะธะน.
"""
                        }
                    ]
                }
            ]
        )

        context = response.content[0].text

        # ะะฑัะตะดะธะฝัะตะผ ะบะพะฝัะตะบัั ะธ ะพัะธะณะธะฝะฐะปัะฝัะน ัะฐะฝะบ
        contextualized_chunk = f"{context}\n\n{chunk}"
        contextualized.append(contextualized_chunk)

        # ะะฟัะธะพะฝะฐะปัะฝะพ: ะปะพะณะธััะตะผ ะฟัะพะณัะตัั
        if (i + 1) % 10 == 0:
            print(f"ะะฑัะฐะฑะพัะฐะฝะพ ัะฐะฝะบะพะฒ: {i + 1}/{len(chunks)}")

    return contextualized


# ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั
document = """
Apple Inc. Q2 2024 Financial Report
...
[ัะตะบัั ะดะพะบัะผะตะฝัะฐ]
...
"""

chunks = [
    "ะััััะบะฐ ะฒััะพัะปะฐ ะฝะฐ 3% ะฟะพ ััะฐะฒะฝะตะฝะธั ั ะฟัะตะดัะดััะธะผ ะบะฒะฐััะฐะปะพะผ.",
    "ะะฐััะพะดั ะฝะฐ R&D ัะฒะตะปะธัะธะปะธัั ะฝะฐ 15%.",
    # ... ะพััะฐะปัะฝัะต ัะฐะฝะบะธ
]

contextualized_chunks = add_context_to_chunks(document, chunks)

# ะขะตะฟะตัั ะผะพะถะฝะพ embed ะธ ะทะฐะณััะทะธัั ะฒ vector store
for chunk in contextualized_chunks:
    embedding = embed(chunk)
    vector_store.add(embedding, chunk)
```

### Late Chunking vs Contextual Retrieval

ะััั ะฐะปััะตัะฝะฐัะธะฒะฝัะน ะฟะพะดัะพะด ะพั Jina AI - **Late Chunking**:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ          LATE CHUNKING VS CONTEXTUAL RETRIEVAL                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                    โ
โ   LATE CHUNKING (Jina AI):                                         โ
โ   โโโโโโโโโโโโโโโโโโโโโโ                                           โ
โ   1. ะะตัั ะดะพะบัะผะตะฝั โ Embedding Model (long-context)                โ
โ   2. Transformer ะฒัะดะฐะตั ัะพะบะตะฝ embeddings ะดะปั ะฒัะตะณะพ ะดะพะบัะผะตะฝัะฐ       โ
โ   3. Chunking ะะะกะะ transformer layers                              โ
โ   4. Mean pooling ะฝะฐ ััะพะฒะฝะต ะบะฐะถะดะพะณะพ ัะฐะฝะบะฐ                          โ
โ                                                                    โ
โ   ะะปััั:                                                           โ
โ   + ะััะธัะปะธัะตะปัะฝะพ ัััะตะบัะธะฒะฝะตะต (1 ะฟัะพัะพะด)                           โ
โ   + ะะตั ะดะพะฟะพะปะฝะธัะตะปัะฝัั LLM ะฒัะทะพะฒะพะฒ                                  โ
โ                                                                    โ
โ   ะะธะฝััั:                                                          โ
โ   - ะขัะตะฑัะตั long-context embedding model                            โ
โ   - ะะตะฝะตะต ะธะฝัะตัะฟัะตัะธััะตะผะพ                                          โ
โ                                                                    โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                    โ
โ   CONTEXTUAL RETRIEVAL (Anthropic):                                โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                โ
โ   1. Chunking ะดะพะบัะผะตะฝัะฐ                                            โ
โ   2. LLM ะณะตะฝะตัะธััะตั ะบะพะฝัะตะบัั ะดะปั ะบะฐะถะดะพะณะพ ัะฐะฝะบะฐ                     โ
โ   3. ะะพะฝัะตะบัั + ัะฐะฝะบ โ ะปัะฑะฐั embedding model                       โ
โ                                                                    โ
โ   ะะปััั:                                                           โ
โ   + ะะฐะฑะพัะฐะตั ั ะปัะฑะพะน embedding model                                โ
โ   + ะะพะฝัะตะบัั ัะธัะฐะตะผัะน, ะผะพะถะฝะพ ะดะตะฑะฐะถะธัั                               โ
โ   + ะก prompt caching - ัะบะพะฝะพะผะธัะฝะพ                                   โ
โ                                                                    โ
โ   ะะธะฝััั:                                                          โ
โ   - ะขัะตะฑัะตั LLM ะฒัะทะพะฒั ะฟัะธ ะธะฝะดะตะบัะฐัะธะธ                               โ
โ   - ะะพัะพะถะต ะฑะตะท caching                                              โ
โ                                                                    โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                    โ
โ   ะะะะะะะะะะฆะะฏ:                                                    โ
โ   โโโโโโโโโโโโโ                                                    โ
โ   โข < 200K ัะพะบะตะฝะพะฒ โ ะะบะปััะธ ะฒะตัั ะดะพะบัะผะตะฝั ะฒ prompt                 โ
โ   โข Production + ะฑัะดะถะตั โ Contextual Retrieval + caching           โ
โ   โข Self-hosted โ Late Chunking ั long-context model               โ
โ                                                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะขะธะฟะธัะฝัะต ะพัะธะฑะบะธ ะฒ Contextual Retrieval

| ะัะธะฑะบะฐ | ะะพัะปะตะดััะฒะธั | ะะตัะตะฝะธะต |
|--------|-------------|---------|
| ะกะปะธัะบะพะผ ะดะปะธะฝะฝัะน ะบะพะฝัะตะบัั | ะฃะฒะตะปะธัะธะฒะฐะตั ัะฐะทะผะตั embeddings, ัะฐะทะผัะฒะฐะตั ัะตะผะฐะฝัะธะบั | ะะณัะฐะฝะธัั ะดะพ 1-2 ะฟัะตะดะปะพะถะตะฝะธะน |
| ะะตั prompt caching | ะะณัะพะผะฝัะต ะทะฐััะฐัั ะฝะฐ ะธะฝะดะตะบัะฐัะธั | ะัะตะณะดะฐ ะฒะบะปััะฐะน cache_control |
| ะะพะฝัะตะบัั ะฟะพะฒัะพััะตั ัะฐะฝะบ | ะะต ะดะพะฑะฐะฒะปัะตั ัะตะฝะฝะพััะธ | ะฏะฒะฝะพ ะฟัะพัะธ "ะดะพะฟะพะปะฝะธัะตะปัะฝัั" ะธะฝัะพัะผะฐัะธั |
| ะะตั ะฟะฐะบะตัะฝะพะน ะพะฑัะฐะฑะพัะบะธ | ะะตะดะปะตะฝะฝะฐั ะธะฝะดะตะบัะฐัะธั | ะะฐัะฐะปะปะตะปัะฝัะต ะทะฐะฟัะพัั (ะพััะพัะพะถะฝะพ ั rate limits) |

---

## GraphRAG

### ะัะพะฑะปะตะผะฐ: ะฒะพะฟัะพัั ะพ "ะปะตัะต", ะฐ ะฝะต ะพ "ะดะตัะตะฒััั"

ะัะตะดััะฐะฒั, ััะพ ั ัะตะฑั ะตััั 10,000 ะฝะพะฒะพััะฝัั ััะฐัะตะน ะพ ัะตัะฝะพะปะพะณะธัะตัะบะพะน ะธะฝะดััััะธะธ. ะะพะปัะทะพะฒะฐัะตะปั ัะฟัะฐัะธะฒะฐะตั:

> "ะะฐะบะธะต ะพัะฝะพะฒะฝัะต ัะตะผั ะธ ััะตะฝะดั ะพะฑััะถะดะฐัััั ะฒ ััะธั ััะฐัััั?"

Naive RAG ะฟะพะปะฝะพัััั ะฟัะพะฒะฐะปะธััั:
- Vector search ะธัะตั ะฟะพัะพะถะธะต ัะฐะฝะบะธ ะบ ะทะฐะฟัะพัั
- ะะตั ะบะพะฝะบัะตัะฝะพะณะพ ัะฐะฝะบะฐ ะฟัะพ "ะพัะฝะพะฒะฝัะต ัะตะผั"
- ะกะธััะตะผะฐ ะฒะตัะฝะตั ัะปััะฐะนะฝัะต ััะฐััะธ

ะญัะพ ะบะฐะบ ัะฟัะพัะธัั "ะบะฐะบะธะต ัะตะผั ะฒ ะฑะธะฑะปะธะพัะตะบะต" ะธ ะฟะพะปััะธัั ะฒ ะพัะฒะตั ัะปััะฐะนะฝัั ัััะฐะฝะธัั ะธะท ัะปััะฐะนะฝะพะน ะบะฝะธะณะธ.

### ะะฐะบ ัะฐะฑะพัะฐะตั GraphRAG (Microsoft)

GraphRAG ัััะพะธั **ะณัะฐั ะทะฝะฐะฝะธะน** ะธะท ะฒัะตะณะพ ะบะพัะฟััะฐ ะดะพะบัะผะตะฝัะพะฒ:

1. **Entity Extraction**: LLM ะธะทะฒะปะตะบะฐะตั ัััะฝะพััะธ ะธ ะธั ะพัะฝะพัะตะฝะธั ะธะท ะบะฐะถะดะพะณะพ ะดะพะบัะผะตะฝัะฐ

2. **Knowledge Graph**: ัััะฝะพััะธ ััะฐะฝะพะฒัััั ะฝะพะดะฐะผะธ, ะพัะฝะพัะตะฝะธั - ัะตะฑัะฐะผะธ ะณัะฐัะฐ

3. **Community Detection**: ะฐะปะณะพัะธัะผ Leiden ะฝะฐัะพะดะธั "ัะพะพะฑัะตััะฒะฐ" ัะฒัะทะฐะฝะฝัั ัััะฝะพััะตะน

4. **Community Summaries**: LLM ัะพะทะดะฐะตั ะพะฟะธัะฐะฝะธะต ะบะฐะถะดะพะณะพ ัะพะพะฑัะตััะฒะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         GRAPHRAG                                    โ
โ                    (Microsoft Research)                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                     โ
โ   ะจะะ 1: ENTITY EXTRACTION                                          โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโ                                        โ
โ                                                                     โ
โ   ะะพะบัะผะตะฝั: "Apple ะพะฑััะฒะธะปะฐ ะพ ะฒัะฟััะบะต iPhone 15 ั ัะธะฟะพะผ A17"        โ
โ                                                                     โ
โ   LLM ะธะทะฒะปะตะบะฐะตั:                                                    โ
โ   โข Entities: [Apple, iPhone 15, A17, ัะธะฟ]                          โ
โ   โข Relations:                                                      โ
โ     - Apple --ะฟัะพะธะทะฒะพะดะธั--> iPhone 15                               โ
โ     - iPhone 15 --ัะพะดะตัะถะธั--> A17                                   โ
โ     - A17 --ัะฒะปัะตััั--> ัะธะฟ                                         โ
โ                                                                     โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                     โ
โ   ะจะะ 2: KNOWLEDGE GRAPH                                            โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโ                                          โ
โ                                                                     โ
โ        โโโโโโโโโโโ                                                 โ
โ        โ  Apple  โโโโโโโ ะฟัะพะธะทะฒะพะดะธั โโโโโโโบโโโโโโโโโโโ             โ
โ        โโโโโโโโโโโ                         โiPhone 15โ             โ
โ             โ                              โโโโโโฌโโโโโ             โ
โ             โ                                   โ                   โ
โ        ะบะพะฝะบััะธััะตั                          ัะพะดะตัะถะธั               โ
โ             โ                                   โ                   โ
โ             โผ                                   โผ                   โ
โ        โโโโโโโโโโโ                         โโโโโโโโโโ              โ
โ        โ Samsung โ                         โ  A17   โ              โ
โ        โโโโโโโโโโโ                         โโโโโโโโโโ              โ
โ                                                                     โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                     โ
โ   ะจะะ 3: COMMUNITY DETECTION                                        โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                      โ
โ                                                                     โ
โ   Leiden algorithm ะฝะฐัะพะดะธั ะบะปะฐััะตัั:                                โ
โ                                                                     โ
โ   Community 1: [Apple, Samsung, Google] - Tech Giants               โ
โ   Community 2: [iPhone, Galaxy, Pixel] - Smartphones                โ
โ   Community 3: [A17, Snapdragon, Tensor] - Mobile Chips             โ
โ                                                                     โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                     โ
โ   ะจะะ 4: COMMUNITY SUMMARIES                                        โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                      โ
โ                                                                     โ
โ   LLM ะณะตะฝะตัะธััะตั summary ะดะปั ะบะฐะถะดะพะณะพ community:                     โ
โ                                                                     โ
โ   "Community 1 ะพะฑัะตะดะธะฝัะตั ะบััะฟะฝะตะนัะธะต ัะตัะฝะพะปะพะณะธัะตัะบะธะต ะบะพะผะฟะฐะฝะธะธ:     โ
โ    Apple ะปะธะดะธััะตั ะฒ premium-ัะตะณะผะตะฝัะต, Samsung ะดะพะผะธะฝะธััะตั           โ
โ    ะฒ Android-ัะบะพัะธััะตะผะต, Google ัะพะบััะธััะตััั ะฝะฐ AI..."             โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะกััะฐัะตะณะธะธ ะฟะพะธัะบะฐ ะฒ GraphRAG

GraphRAG ะฟัะตะดะปะฐะณะฐะตั ัะฐะทะฝัะต ัััะฐัะตะณะธะธ ะดะปั ัะฐะทะฝัั ัะธะฟะพะฒ ะฒะพะฟัะพัะพะฒ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                 GRAPHRAG SEARCH STRATEGIES                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                    โ
โ   1. LOCAL SEARCH                                                  โ
โ   โโโโโโโโโโโโโโโ                                                  โ
โ   ะะปั ะบะพะฝะบัะตัะฝัั ะฒะพะฟัะพัะพะฒ ะพ ัััะฝะพัััั                              โ
โ                                                                    โ
โ   ะะพะฟัะพั: "ะะฐะบะธะต ะฟัะพะดัะบัั ะฒัะฟััะบะฐะตั Apple?"                        โ
โ                                                                    โ
โ   ะะปะณะพัะธัะผ:                                                        โ
โ   1. ะะฐะนัะธ entity "Apple" ะฒ ะณัะฐัะต                                  โ
โ   2. ะะพะปััะธัั ัะฒัะทะฐะฝะฝัะต entities (iPhone, Mac, iPad...)            โ
โ   3. ะกะพะฑัะฐัั ะบะพะฝัะตะบัั ะธะท ัะฒัะทะฐะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ                      โ
โ   4. ะกะณะตะฝะตัะธัะพะฒะฐัั ะพัะฒะตั                                           โ
โ                                                                    โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                    โ
โ   2. GLOBAL SEARCH                                                 โ
โ   โโโโโโโโโโโโโโ                                                   โ
โ   ะะปั ะฒะพะฟัะพัะพะฒ ะพ ะฒัะตะผ ะบะพัะฟััะต (ัะตะผั, ััะตะฝะดั)                       โ
โ                                                                    โ
โ   ะะพะฟัะพั: "ะะฐะบะธะต ะพัะฝะพะฒะฝัะต ัะตะผั ะฒ ััะธั ะดะพะบัะผะตะฝัะฐั?"                 โ
โ                                                                    โ
โ   ะะปะณะพัะธัะผ (Map-Reduce):                                           โ
โ   MAP:   ะะฐะถะดัะน community summary โ ัะฐััะธัะฝัะน ะพัะฒะตั                โ
โ   REDUCE: ะะฑัะตะดะธะฝะธัั ัะฐััะธัะฝัะต ะพัะฒะตัั โ ัะธะฝะฐะปัะฝัะน ะพัะฒะตั            โ
โ                                                                    โ
โ   ะญัะพ ัะฐะฑะพัะฐะตั ะฟะพัะพะผั ััะพ community summaries ัะถะต ัะพะดะตัะถะฐั         โ
โ   ะฐะณัะตะณะธัะพะฒะฐะฝะฝัั ะธะฝัะพัะผะฐัะธั ะพ ัะตะผะฐั!                               โ
โ                                                                    โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                    โ
โ   3. DRIFT SEARCH                                                  โ
โ   โโโโโโโโโโโโโโ                                                   โ
โ   ะะปั exploratory ะฒะพะฟัะพัะพะฒ                                         โ
โ                                                                    โ
โ   ะะพะฟัะพั: "ะะฐััะบะฐะถะธ ะฟัะพ ัะบะพัะธััะตะผั Apple"                          โ
โ                                                                    โ
โ   ะะปะณะพัะธัะผ:                                                        โ
โ   1. ะะฐัะฐัั ั entity "Apple"                                       โ
โ   2. "ะัะตะนัะพะฒะฐัั" ะฟะพ ัะฒัะทัะผ ะณัะฐัะฐ                                  โ
โ   3. ะกะพะฑะธัะฐัั ะธะฝัะตัะตัะฝัะต ัะฐะบัั ะฟะพ ะฟััะธ                             โ
โ   4. ะกะธะฝัะตะทะธัะพะฒะฐัั narrative                                       โ
โ                                                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะพัะตะผั GraphRAG ัะฐะฑะพัะฐะตั ะดะปั thematic ะฒะพะฟัะพัะพะฒ

1. **Pre-computed aggregation**: Community summaries ัะถะต ัะพะดะตัะถะฐั ะฐะณัะตะณะธัะพะฒะฐะฝะฝัั ะธะฝัะพัะผะฐัะธั. ะะพะฟัะพั ะพ "ัะตะผะฐั" ะฝะฐัะพะดะธั ะณะพัะพะฒัะน ะพัะฒะตั ะฒ summaries.

2. **ะกัััะบัััะฐ ะฒะผะตััะพ ัะตะผะฐะฝัะธะบะธ**: ะฒะผะตััะพ ะฟะพะธัะบะฐ "ะฟะพัะพะถะตะณะพ ัะตะบััะฐ" ะผั ะธัะฟะพะปัะทัะตะผ ัะตะฐะปัะฝัะต ัะฒัะทะธ ะผะตะถะดั ะบะพะฝัะตะฟัะฐะผะธ.

3. **ะะตัะฐััะธั**: communities ะพัะณะฐะฝะธะทะพะฒะฐะฝั ะธะตัะฐััะธัะตัะบะธ - ะพั ะบััะฟะฝัั ัะตะผ ะดะพ ะผะตะปะบะธั ะฟะพะดัะตะผ.

4. **Completeness**: Map-Reduce ะฟะพ ะฒัะตะผ communities ะณะฐัะฐะฝัะธััะตั, ััะพ ะผั ะฝะต ะฟัะพะฟัััะธะผ ะฒะฐะถะฝัั ัะตะผั.

### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั GraphRAG

| ะกัะตะฝะฐัะธะน | GraphRAG | ะะฑััะฝัะน RAG |
|----------|----------|-------------|
| ะะพะธัะบ ะบะพะฝะบัะตัะฝะพะณะพ ัะฐะบัะฐ | O | X (ะปัััะต) |
| "ะะฐะบะธะต ัะตะผั ะฒ ะดะพะบัะผะตะฝัะฐั?" | X (ะปัััะต) | O |
| ะกะฒัะทะธ ะผะตะถะดั ัััะฝะพัััะผะธ | X (ะปัััะต) | O |
| Multi-hop reasoning | X (ะปัััะต) | O |
| Simple QA | O | X (ะปัััะต) |
| Real-time ะพะฑะฝะพะฒะปะตะฝะธั | O (ะดะพัะพะณะพ) | X (ะปัััะต) |

### ะฆะตะฝะฐ GraphRAG

GraphRAG ััะตะฑัะตั ะทะฝะฐัะธัะตะปัะฝัั ัะตััััะพะฒ:

- **ะะฝะดะตะบัะฐัะธั**: ~$5-10 ะฝะฐ 1000 ะดะพะบัะผะตะฝัะพะฒ (entity extraction + summarization)
- **ะัะตะผั**: ะธะฝะดะตะบัะฐัะธั ะผะพะถะตั ะทะฐะฝััั ัะฐัั ะดะปั ะฑะพะปััะธั ะบะพัะฟััะพะฒ
- **ะะฑะฝะพะฒะปะตะฝะธั**: ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ะดะพะบัะผะตะฝัะพะฒ ะฝัะถะฝะพ ะฟะตัะตัััะฐะธะฒะฐัั ะณัะฐั

ะญัะพ ะพะฟัะฐะฒะดะฐะฝะพ ะบะพะณะดะฐ:
- ะะพัะฟัั ะพัะฝะพัะธัะตะปัะฝะพ ััะฐัะธัะตะฝ
- ะะฝะพะณะพ ะฒะพะฟัะพัะพะฒ ะพ ัะตะผะฐั ะธ ััะตะฝะดะฐั
- Multi-hop reasoning ะบัะธัะธัะตะฝ
- ะััั ะฑัะดะถะตั ะฝะฐ ะธะฝะดะตะบัะฐัะธั

---

## ะัะตะฝะบะฐ RAG (RAGAS)

### ะัะพะฑะปะตะผะฐ: ะบะฐะบ ะฟะพะฝััั, ััะพ RAG ัะฐะฑะพัะฐะตั ัะพัะพัะพ?

ะขั ะฟะพัััะพะธะป RAG-ัะธััะตะผั. ะะฝะฐ ะพัะฒะตัะฐะตั ะฝะฐ ะฒะพะฟัะพัั. ะะพ ะบะฐะบ ะฟะพะฝััั, ัะพัะพัะพ ะปะธ ะพะฝะฐ ัะฐะฑะพัะฐะตั?

ะะตะปัะทั ะถะต ะฟัะพะฒะตัััั ะบะฐะถะดัะน ะพัะฒะตั ะฒัััะฝัั. ะ ััะฐะดะธัะธะพะฝะฝัะต ะผะตััะธะบะธ NLP (BLEU, ROUGE) ะฟะปะพัะพ ัะฐะฑะพัะฐัั ะดะปั ะณะตะฝะตัะฐัะธะฒะฝัั ะทะฐะดะฐั - ะดะฒะฐ ัะฐะทะฝัั ัะตะบััะฐ ะผะพะณัั ะฑััั ะพะดะธะฝะฐะบะพะฒะพ ะฟัะฐะฒะธะปัะฝัะผะธ.

### RAGAS: LLM-as-a-Judge

RAGAS (Retrieval Augmented Generation Assessment) ะธัะฟะพะปัะทัะตั LLM ะดะปั ะพัะตะฝะบะธ ะบะฐัะตััะฒะฐ RAG. ะญัะพ ัะฐะฑะพัะฐะตั ะฟะพัะพะผั ััะพ LLM ัะพัะพัะพ ะฟะพะฝะธะผะฐะตั ัะตะผะฐะฝัะธะบั ะธ ะผะพะถะตั ััะดะธัั ะพ ะบะฐัะตััะฒะต ะพัะฒะตัะพะฒ.

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        RAGAS METRICS                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                     โ
โ   RETRIEVAL METRICS (ะบะฐัะตััะฒะพ ะฟะพะธัะบะฐ):                              โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                              โ
โ                                                                     โ
โ   Context Precision                                                โ
โ   โข ะะพะฟัะพั: ะะฐะบะฐั ะดะพะปั ะฝะฐะนะดะตะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ ัะตะฐะปัะฝะพ ัะตะปะตะฒะฐะฝัะฝะฐ?    โ
โ   โข High score = ะผะฐะปะพ "ะผััะพัะฐ" ะฒ ะบะพะฝัะตะบััะต                         โ
โ   โข ะคะพัะผัะปะฐ: relevant_docs / total_retrieved_docs                   โ
โ                                                                     โ
โ   Context Recall                                                   โ
โ   โข ะะพะฟัะพั: ะะฐัะปะธ ะปะธ ะผั ะะกะฎ ะฝัะถะฝัั ะธะฝัะพัะผะฐัะธั?                     โ
โ   โข High score = ะฝะต ะฟัะพะฟัััะธะปะธ ะฒะฐะถะฝัะต ะดะพะบัะผะตะฝัั                    โ
โ   โข ะขัะตะฑัะตั ground truth (ะบะฐะบะธะต ะดะพะบัะผะตะฝัั ะะะะะะซ ะฑััั ะฝะฐะนะดะตะฝั)     โ
โ                                                                     โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                     โ
โ   GENERATION METRICS (ะบะฐัะตััะฒะพ ะพัะฒะตัะฐ):                             โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                            โ
โ                                                                     โ
โ   Faithfulness (ะะตัะฝะพััั)                                          โ
โ   โข ะะพะฟัะพั: ะัะต ะปะธ ััะฒะตัะถะดะตะฝะธั ะฒ ะพัะฒะตัะต ะฟะพะดัะฒะตัะถะดะตะฝั ะบะพะฝัะตะบััะพะผ?   โ
โ   โข High score = ะฝะตั ะณะฐะปะปััะธะฝะฐัะธะน                                  โ
โ   โข ะญัะพ ะะะะะะะฏ ะผะตััะธะบะฐ ะดะปั production RAG                          โ
โ   โข LLM ัะฐะทะฑะธะฒะฐะตั ะพัะฒะตั ะฝะฐ claims ะธ ะฟัะพะฒะตััะตั ะบะฐะถะดัะน               โ
โ                                                                     โ
โ   Answer Relevancy (ะะตะปะตะฒะฐะฝัะฝะพััั ะพัะฒะตัะฐ)                          โ
โ   โข ะะพะฟัะพั: ะัะฒะตั ัะตะฐะปัะฝะพ ะพัะฒะตัะฐะตั ะฝะฐ ะทะฐะดะฐะฝะฝัะน ะฒะพะฟัะพั?             โ
โ   โข High score = ะพัะฒะตั ะฟะพ ัะตะผะต, ะฝะต ััะพะดะธั ะฒ ััะพัะพะฝั                โ
โ   โข LLM ะณะตะฝะตัะธััะตั ะฒะพะฟัะพัั ะธะท ะพัะฒะตัะฐ ะธ ััะฐะฒะฝะธะฒะฐะตั ั ะธััะพะดะฝัะผ       โ
โ                                                                     โ
โ   Answer Correctness (ะัะฐะฒะธะปัะฝะพััั)                                โ
โ   โข ะะพะฟัะพั: ะัะฒะตั ัะฐะบัะธัะตัะบะธ ะฟัะฐะฒะธะปัะฝัะน?                           โ
โ   โข ะขัะตะฑัะตั ground truth ะพัะฒะตัะฐ                                    โ
โ   โข ะะพะผะฑะธะฝะฐัะธั semantic similarity + factual overlap               โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### RAG Triad: ััะธ ะธะทะผะตัะตะฝะธั ะบะฐัะตััะฒะฐ

```
                        โโโโโโโโโโโโโ
                        โ  ะะะะะะก   โ
                        โโโโโโโฌโโโโโโ
                              โ
             Context          โ         Answer
             Relevance        โ         Relevancy
                โ             โ            โ
         โโโโโโโโโโโโโ        โ      โโโโโโโโโโโโโ
         โ  ะะะะขะะะกะข โโโโโโโโโโดโโโโโโบโ   ะะขะะะข   โ
         โโโโโโโฌโโโโโโ               โโโโโโโฌโโโโโโ
               โ                           โ
               โโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                           โ
                     Groundedness
                     (Faithfulness)
```

ะขัะธ ะบะปััะตะฒัั ะธะทะผะตัะตะฝะธั:

1. **Context Relevance**: ะะพะฝัะตะบัั ัะตะปะตะฒะฐะฝัะตะฝ ะฒะพะฟัะพัั?
2. **Answer Relevancy**: ะัะฒะตั ัะตะปะตะฒะฐะฝัะตะฝ ะฒะพะฟัะพัั?
3. **Groundedness**: ะัะฒะตั ะพัะฝะพะฒะฐะฝ ะฝะฐ ะบะพะฝัะตะบััะต (ะฝะต ะฒัะดัะผะฐะฝ)?

ะฅะพัะพัะธะน RAG ะพะฟัะธะผะธะทะธััะตั ะฒัะต ััะธ.

### ะัะฐะบัะธัะตัะบะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต RAGAS

```python
from ragas import evaluate
from ragas.metrics import (
    faithfulness,
    answer_relevancy,
    context_precision,
    context_recall,
)
from datasets import Dataset

# ะจะะ 1: ะะพะดะณะพัะพะฒะบะฐ ะดะฐะฝะฝัั ะดะปั ะพัะตะฝะบะธ
# ะัะถะฝั: ะฒะพะฟัะพัั, ะพัะฒะตัั RAG, ะบะพะฝัะตะบััั, ะธ (ะพะฟัะธะพะฝะฐะปัะฝะพ) ground truth

data = {
    "question": [
        "ะงัะพ ัะฐะบะพะต machine learning?",
        "ะัะพ ะธะทะพะฑัะตะป ััะฐะฝััะพัะผะตัั?"
    ],
    "answer": [
        "Machine learning - ััะพ ะฟะพะดัะฐะทะดะตะป AI, ะบะพัะพััะน ะฟะพะทะฒะพะปัะตั ัะธััะตะผะฐะผ ััะธัััั ะฝะฐ ะดะฐะฝะฝัั.",
        "ะััะธัะตะบัััะฐ ััะฐะฝััะพัะผะตัะพะฒ ะฑัะปะฐ ะฟัะตะดััะฐะฒะปะตะฝะฐ ะฒ ััะฐััะต 'Attention is All You Need'."
    ],
    "contexts": [
        ["Machine learning (ML) - ััะพ ัะธะฟ ะธัะบััััะฒะตะฝะฝะพะณะพ ะธะฝัะตะปะปะตะบัะฐ, ะบะพัะพััะน ะฟะพะทะฒะพะปัะตั..."],
        ["ะขัะฐะฝััะพัะผะตั ะฑัะป ะฟัะตะดััะฐะฒะปะตะฝ ะฒ 2017 ะณะพะดั Vaswani et al. ะฒ ััะฐััะต..."]
    ],
    # Ground truth ะฝัะถะตะฝ ัะพะปัะบะพ ะดะปั ะฝะตะบะพัะพััั ะผะตััะธะบ (recall, correctness)
    "ground_truth": [
        "Machine learning - ััะพ ะพะฑะปะฐััั AI, ะณะดะต ัะธััะตะผั ััะฐััั ะฝะฐ ะดะฐะฝะฝัั.",
        "ะขัะฐะฝััะพัะผะตัั ะฑัะปะธ ะธะทะพะฑัะตัะตะฝั Vaswani et al. ะฒ Google."
    ]
}

dataset = Dataset.from_dict(data)

# ะจะะ 2: ะะฐะฟััะบ ะพัะตะฝะบะธ
# RAGAS ะธัะฟะพะปัะทัะตั LLM (ะฟะพ ัะผะพะปัะฐะฝะธั OpenAI) ะดะปั ะพัะตะฝะบะธ

result = evaluate(
    dataset,
    metrics=[
        faithfulness,       # ะะปะฐะฒะฝะฐั ะผะตััะธะบะฐ: ะฝะตั ะปะธ ะณะฐะปะปััะธะฝะฐัะธะน?
        answer_relevancy,   # ะัะฒะตั ะฟะพ ัะตะผะต?
        context_precision,  # ะะพะฝัะตะบัั ะฑะตะท ะผััะพัะฐ?
        context_recall,     # ะะตัั ะฝัะถะฝัะน ะบะพะฝัะตะบัั ะฝะฐะนะดะตะฝ?
    ],
)

# ะจะะ 3: ะะฝะฐะปะธะท ัะตะทัะปััะฐัะพะฒ
print(result)
# {'faithfulness': 0.92, 'answer_relevancy': 0.88,
#  'context_precision': 0.85, 'context_recall': 0.90}

# ะะฝัะตัะฟัะตัะฐัะธั:
# - faithfulness 0.92: 8% ะพัะฒะตัะพะฒ ัะพะดะตัะถะฐั ะฝะตะฟัะพะฒะตัะตะฝะฝัะต ััะฒะตัะถะดะตะฝะธั
# - answer_relevancy 0.88: ะพัะฒะตัั ะฒ ัะตะปะพะผ ะฟะพ ัะตะผะต, ะฝะพ ะตััั ััะพะดั ะฒ ััะพัะพะฝั
# - context_precision 0.85: 15% ะฝะฐะนะดะตะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ - ะฝะตัะตะปะตะฒะฐะฝัะฝัะน ััะผ
# - context_recall 0.90: 10% ะฝัะถะฝะพะน ะธะฝัะพัะผะฐัะธะธ ะฝะต ะฝะฐัะพะดะธััั
```

### ะฆะตะปะตะฒัะต ะผะตััะธะบะธ ะดะปั production

| ะะตััะธะบะฐ | Target | ะะพัะตะผั ะฒะฐะถะฝะพ |
|---------|--------|--------------|
| Faithfulness | > 0.9 | ะะปะฐะฒะฝะพะต: ะฝะตั ะณะฐะปะปััะธะฝะฐัะธะน |
| Context Precision | > 0.8 | ะะตะฝััะต ััะผะฐ ะฒ ะบะพะฝัะตะบััะต |
| Answer Relevancy | > 0.85 | ะัะฒะตัั ะฟะพ ัะตะผะต |
| Latency (p95) | < 3s | UX |
| Hallucination rate | < 5% | ะะพะฒะตัะธะต ะฟะพะปัะทะพะฒะฐัะตะปะตะน |

### ะะฐะบ ัะปัััะฐัั ะผะตััะธะบะธ

```
ะัะพะฑะปะตะผะฐ                    ะะตััะธะบะฐ                ะะตัะตะฝะธะต
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ะะธะทะบะฐั faithfulness      โ Reranking, ัะธะปัััะฐัะธั ะบะพะฝัะตะบััะฐ
                         โ ะฃะปัััะธัั prompt ("only use context")
                         โ Self-RAG / CRAG

ะะธะทะบะฐั context precision โ Reranking
                         โ ะฃะผะตะฝััะธัั k ะฒ retrieval
                         โ ะฃะปัััะธัั chunking

ะะธะทะบะฐั context recall    โ ะฃะฒะตะปะธัะธัั k
                         โ Hybrid search (vector + BM25)
                         โ Query expansion

ะะธะทะบะฐั answer relevancy  โ ะฃะปัััะธัั system prompt
                         โ Chain-of-thought
                         โ Query decomposition
```

---

## ะขะธะฟะธัะฝัะต ะพัะธะฑะบะธ ะธ ะบะฐะบ ะธั ะธะทะฑะตะถะฐัั

### ะัะธะฑะบะฐ 1: "ะะพะปััะต ะดะพะบัะผะตะฝัะพะฒ = ะปัััะต"

**ะัะพะฑะปะตะผะฐ**: ะะฐะทัะฐะฑะพััะธะบ ััะฐะฒะธั k=50 ะดะปั retrieval, ะฝะฐะดะตััั "ัะพัะฝะพ ะฝะฐะนัะธ ะฝัะถะฝะพะต".

**ะะพัะตะผั ะฟะปะพัะพ**:
- LLM ัะตััะตััั ะฒ ะดะปะธะฝะฝะพะผ ะบะพะฝัะตะบััะต ("lost in the middle")
- ะะตัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั ะฒะฝะพััั ััะผ
- ะฃะฒะตะปะธัะธะฒะฐะตััั latency ะธ ััะพะธะผะพััั
- Context precision ะฟะฐะดะฐะตั

**ะะตัะตะฝะธะต**: k=5-10 ั quality > quantity. ะัััะต reranking, ัะตะผ ะผะฝะพะณะพ ะดะพะบัะผะตะฝัะพะฒ.

### ะัะธะฑะบะฐ 2: ะะณะฝะพัะธัะพะฒะฐะฝะธะต hybrid search

**ะัะพะฑะปะตะผะฐ**: ะัะฟะพะปัะทััั ัะพะปัะบะพ vector search.

**ะะพัะตะผั ะฟะปะพัะพ**:
- Vector search ะฟะปะพัะพ ัะฐะฑะพัะฐะตั ั ัะพัะฝัะผะธ ัะตัะผะธะฝะฐะผะธ (product codes, IDs)
- ะัะพะฟััะบะฐะตั ะดะพะบัะผะตะฝัั ั ัะพัะฝัะผ keyword match
- ะขะตััะตั edge cases

**ะะตัะตะฝะธะต**: ะัะตะณะดะฐ ะบะพะผะฑะธะฝะธััะน vector + BM25 (keyword). ะะพะปััะธะฝััะฒะพ production ัะธััะตะผ ะธัะฟะพะปัะทััั hybrid.

### ะัะธะฑะบะฐ 3: Chunking ะฑะตะท overlap

**ะัะพะฑะปะตะผะฐ**: ะะตะถัั ะดะพะบัะผะตะฝัั ะฝะฐ ัะฐะฝะบะธ ะฑะตะท ะฟะตัะตะบัััะธั.

**ะะพัะตะผั ะฟะปะพัะพ**:
- ะะฝัะพัะผะฐัะธั ะฝะฐ ะณัะฐะฝะธัะต ัะฐะฝะบะพะฒ ัะตััะตััั
- "ะััััะบะฐ ะบะพะผะฟะฐะฝะธะธ ัะพััะฐะฒะธะปะฐ" ะฒ ะพะดะฝะพะผ ัะฐะฝะบะต, "500 ะผะธะปะปะธะพะฝะพะฒ" ะฒ ัะปะตะดัััะตะผ
- Retrieval ะผะพะถะตั ะฝะฐะนัะธ ัะพะปัะบะพ ะฟะพะปะพะฒะธะฝั ะพัะฒะตัะฐ

**ะะตัะตะฝะธะต**: 10-20% overlap ะผะตะถะดั ัะฐะฝะบะฐะผะธ. ะะปะธ semantic chunking.

### ะัะธะฑะบะฐ 4: ะะตั fallback ัััะฐัะตะณะธะธ

**ะัะพะฑะปะตะผะฐ**: ะัะปะธ retrieval ะฝะต ะฝะฐัะตะป ะฝะธัะตะณะพ ัะตะปะตะฒะฐะฝัะฝะพะณะพ, ัะธััะตะผะฐ ะฒัะต ัะฐะฒะฝะพ ะณะตะฝะตัะธััะตั ะพัะฒะตั.

**ะะพัะตะผั ะฟะปะพัะพ**:
- ะะฐัะฐะฝัะธัะพะฒะฐะฝะฝัะต ะณะฐะปะปััะธะฝะฐัะธะธ
- ะฃะฒะตัะตะฝะฝะพ ะฝะตะฟัะฐะฒะธะปัะฝัะต ะพัะฒะตัั ััะถะต, ัะตะผ ัะตััะฝะพะต "ะฝะต ะทะฝะฐั"
- ะะพะดััะฒะฐะตั ะดะพะฒะตัะธะต ะฟะพะปัะทะพะฒะฐัะตะปะตะน

**ะะตัะตะฝะธะต**:
- ะัะพะฒะตัััั relevance score ะฝะฐะนะดะตะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ
- ะัะปะธ ะฝะธะถะต threshold: "ะฏ ะฝะต ะฝะฐัะตะป ะธะฝัะพัะผะฐัะธะธ ะฟะพ ััะพะผั ะฒะพะฟัะพัั ะฒ ะฑะฐะทะต ะทะฝะฐะฝะธะน"
- ะะฟัะธะพะฝะฐะปัะฝะพ: fallback ะฝะฐ web search ะธะปะธ escalation

### ะัะธะฑะบะฐ 5: ะะณะฝะพัะธัะพะฒะฐะฝะธะต evaluation

**ะัะพะฑะปะตะผะฐ**: ะะพัััะพะธะปะธ RAG, ะฒัััะฝัั ะฟัะพะฒะตัะธะปะธ 10 ะฒะพะฟัะพัะพะฒ, ะทะฐะดะตะฟะปะพะธะปะธ.

**ะะพัะตะผั ะฟะปะพัะพ**:
- ะะตั baseline ะดะปั ััะฐะฒะฝะตะฝะธั ะธะทะผะตะฝะตะฝะธะน
- ะะตะณัะตััะธะธ ะพััะฐัััั ะฝะตะทะฐะผะตัะตะฝะฝัะผะธ
- ะะตั ะฟะพะฝะธะผะฐะฝะธั ัะตะฐะปัะฝะพะณะพ ะบะฐัะตััะฒะฐ

**ะะตัะตะฝะธะต**:
- RAGAS evaluation ะฒ CI/CD
- ะขะตััะพะฒัะน ะฝะฐะฑะพั 50-100 ะฒะพะฟัะพัะพะฒ ั ground truth
- ะะพะฝะธัะพัะธะฝะณ ะผะตััะธะบ ะฒ production

### ะัะธะฑะบะฐ 6: ะะดะธะฝ prompt ะดะปั ะฒัะตั ะฒะพะฟัะพัะพะฒ

**ะัะพะฑะปะตะผะฐ**: ะัะฟะพะปัะทััั ะพะดะธะฝ ะธ ัะพั ะถะต prompt ะฝะตะทะฐะฒะธัะธะผะพ ะพั ัะธะฟะฐ ะฒะพะฟัะพัะฐ.

**ะะพัะตะผั ะฟะปะพัะพ**:
- Factual ะฒะพะฟัะพัั ะธ conversational ััะตะฑััั ัะฐะทะฝะพะณะพ ะฟะพะดัะพะดะฐ
- Comparison ะฒะพะฟัะพัั ะฝัะถะฝะพ ะพะฑัะฐะฑะฐััะฒะฐัั ะธะฝะฐัะต
- ะขะตััะตััั ะบะฐัะตััะฒะพ ะฝะฐ edge cases

**ะะตัะตะฝะธะต**:
- ะะปะฐััะธัะธะบะฐัะธั ัะธะฟะฐ ะฒะพะฟัะพัะฐ
- ะะฐะทะฝัะต prompt templates ะดะปั ัะฐะทะฝัั ัะธะฟะพะฒ
- Routing ะฝะฐ ัะฐะทะฝัะต pipelines

### ะัะธะฑะบะฐ 7: ะะตั ะพะฑัะฐะฑะพัะบะธ ะดะปะธะฝะฝะพะณะพ ะบะพะฝัะตะบััะฐ

**ะัะพะฑะปะตะผะฐ**: ะะฐะนะดะตะฝะฝัะต ะดะพะบัะผะตะฝัั ะฟัะตะฒััะฐัั context window ะผะพะดะตะปะธ.

**ะะพัะตะผั ะฟะปะพัะพ**:
- Truncation ัะตััะตั ะธะฝัะพัะผะฐัะธั
- ะัะธะฑะบะธ API
- ะะตะฟัะตะดัะบะฐะทัะตะผะพะต ะฟะพะฒะตะดะตะฝะธะต

**ะะตัะตะฝะธะต**:
- ะะธะผะธั ะฝะฐ ััะผะผะฐัะฝัะน ัะฐะทะผะตั ะบะพะฝัะตะบััะฐ
- Reranking + take top-N ััะพ ะฒะปะตะทะฐะตั
- Summarization ะตัะปะธ ะบะพะฝัะตะบัั ัะปะธัะบะพะผ ะฑะพะปััะพะน

### ะัะธะฑะบะฐ 8: Sync ะฒะผะตััะพ async

**ะัะพะฑะปะตะผะฐ**: Sequential ะพะฑัะฐะฑะพัะบะฐ ะทะฐะฟัะพัะพะฒ.

**ะะพัะตะผั ะฟะปะพัะพ**:
- Latency = sum ะฒัะตั ัะฐะณะพะฒ
- ะะปะพัะพ ะผะฐัััะฐะฑะธััะตััั
- ะะพะปัะทะพะฒะฐัะตะปะธ ะถะดัั

**ะะตัะตะฝะธะต**:
- asyncio ะดะปั I/O-bound ะพะฟะตัะฐัะธะน
- Parallel retrieval ะธะท ัะฐะทะฝัั ะธััะพัะฝะธะบะพะฒ
- Streaming ะพัะฒะตัะพะฒ

---

## ะะพะณะดะฐ ััะพ ะธัะฟะพะปัะทะพะฒะฐัั

### Decision Tree

```
ะะฐัะฐะปะพ: ะะฐะบะพะน ัะธะฟ RAG ะธัะฟะพะปัะทะพะฒะฐัั?
              โ
              โผ
     โโโโโโโโโโโโโโโโโโ
     โ ะัะพัััะต FAQ    โโโโโ ะะ โโโโบ Advanced RAG
     โ ะฒะพะฟัะพัั?       โ              (Hybrid + Rerank)
     โโโโโโโโโโฌโโโโโโโโ
              โ ะะะข
              โผ
     โโโโโโโโโโโโโโโโโโ
     โ Multi-hop      โโโโโ ะะ โโโโบ Agentic RAG
     โ reasoning?     โ              (LangGraph)
     โ ะกะปะพะถะฝัะต ัะฒัะทะธ? โ
     โโโโโโโโโโฌโโโโโโโโ
              โ ะะะข
              โผ
     โโโโโโโโโโโโโโโโโโ
     โ ะะพะฟัะพัั ะพ      โโโโโ ะะ โโโโบ GraphRAG
     โ ัะตะผะฐั/ััะตะฝะดะฐั? โ              (Microsoft)
     โ ะะตัั ะบะพัะฟัั?   โ
     โโโโโโโโโโฌโโโโโโโโ
              โ ะะะข
              โผ
     โโโโโโโโโโโโโโโโโโ
     โ ะะพัะตัั         โโโโโ ะะ โโโโบ Contextual Retrieval
     โ ะบะพะฝัะตะบััะฐ ะฟัะธ  โ              (Anthropic)
     โ chunking?      โ
     โโโโโโโโโโฌโโโโโโโโ
              โ ะะะข
              โผ
     โโโโโโโโโโโโโโโโโโ
     โ ะัะถะฝะฐ          โโโโโ ะะ โโโโบ Self-RAG / CRAG
     โ ัะฐะผะพะฟัะพะฒะตัะบะฐ?  โ
     โ ะัะธัะธัะฝะพ       โ
     โ ะบะฐัะตััะฒะพ?      โ
     โโโโโโโโโโฌโโโโโโโโ
              โ ะะะข
              โผ
        Advanced RAG
        (ะฑะฐะทะพะฒัะน ะฒัะฑะพั)
```

### ะกะฒะพะดะฝะฐั ัะฐะฑะปะธัะฐ

| ะขะตัะฝะธะบะฐ | ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั | ะะพะณะดะฐ ะะ ะธัะฟะพะปัะทะพะฒะฐัั | ะะพะฑะฐะฒะพัะฝะฐั ััะพะธะผะพััั |
|---------|-------------------|----------------------|---------------------|
| **Query Decomposition** | ะกะปะพะถะฝัะต multi-aspect ะฒะพะฟัะพัั | ะัะพัััะต factual ะฒะพะฟัะพัั | +1-2 LLM calls |
| **Agentic RAG** | Multi-hop, ัะฐะทะฝัะต ะธััะพัะฝะธะบะธ | ะัะพัััะต ะฒะพะฟัะพัั, tight latency | +2-5 LLM calls |
| **Self-RAG** | ะะฐะทะฝะฐั retrieval need, fine-tune ะฒะพะทะผะพะถะตะฝ | ะะตั ัะตััััะพะฒ ะฝะฐ fine-tune | ะกะฟะตั. ะผะพะดะตะปั |
| **CRAG** | ะัะถะตะฝ fallback, web search ะดะพัััะฟะตะฝ | ะะฐะบััััะน ะบะพะฝััั, ะฝะตั web | +1 LLM call |
| **Contextual Retrieval** | ะะพัะตัั ะบะพะฝัะตะบััะฐ ะฟัะธ chunking | ะะพัะพัะบะธะต ะดะพะบัะผะตะฝัั | LLM ะฟัะธ ะธะฝะดะตะบัะฐัะธะธ |
| **GraphRAG** | ะขะตะผั, ััะตะฝะดั, entity relations | ะัะพัััะต lookups, real-time updates | ะะพัะพะณะฐั ะธะฝะดะตะบัะฐัะธั |

### ะัะฐะบัะธัะตัะบะฐั ัััะฐัะตะณะธั ะฒะฝะตะดัะตะฝะธั

**ะคะฐะทะฐ 1: Baseline (1-2 ะฝะตะดะตะปะธ)**
- ะัะพััะพะน RAG: embed + vector search + generate
- ะัะตะฝะบะฐ ั RAGAS
- ะะพะฝะธะผะฐะฝะธะต baseline ะผะตััะธะบ

**ะคะฐะทะฐ 2: Advanced (2-4 ะฝะตะดะตะปะธ)**
- Hybrid search (vector + BM25)
- Reranking
- ะฃะปัััะตะฝะฝัะน chunking
- ะะฐะผะตัั ัะปัััะตะฝะธะน

**ะคะฐะทะฐ 3: Agentic (ะตัะปะธ ะฝัะถะฝะพ)**
- Query decomposition ะดะปั ัะปะพะถะฝัั ะฒะพะฟัะพัะพะฒ
- Self-correction loops
- Multi-source retrieval
- ะขัะฐัะตะปัะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต

**ะคะฐะทะฐ 4: Specialized (ะฟะพ ะฝะตะพะฑัะพะดะธะผะพััะธ)**
- GraphRAG ะดะปั thematic questions
- Contextual Retrieval ะดะปั ะดะปะธะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ
- Fine-tuned Self-RAG ะดะปั ะบัะธัะธัะฝัั ัะธััะตะผ

---

## ะัะพะฒะตัั ัะตะฑั

### ะะพะฟัะพั 1
**ะงะตะผ Agentic RAG ะพัะปะธัะฐะตััั ะพั Advanced RAG?**

<details>
<summary>ะัะฒะตั</summary>

**Advanced RAG** ัะปัััะฐะตั quality ัะตัะตะท:
- Query rewriting
- Hybrid search
- Reranking
- Better chunking

ะะพ ะพััะฐะตััั "ััะฟัะผ" pipeline - ะฒัะตะณะดะฐ ะฒัะฟะพะปะฝัะตั ะพะดะฝะธ ะธ ัะต ะถะต ัะฐะณะธ.

**Agentic RAG** ะดะพะฑะฐะฒะปัะตั ะฐะฒัะพะฝะพะผะฝะพััั:
- Planing ะธ query decomposition (ัะฐะผ ัะตัะฐะตั ะบะฐะบ ัะฐะทะฑะธัั ะฒะพะฟัะพั)
- Conditional retrieval (ัะตัะฐะตั, ะฝัะถะตะฝ ะปะธ retrieval ะฒะพะพะฑัะต)
- Self-reflection ะธ correction loops (ะฟัะพะฒะตััะตั ัะตะฑั, ะฟัะพะฑัะตั ัะฝะพะฒะฐ)
- Multi-source retrieval (ะฒัะฑะธัะฐะตั ะธััะพัะฝะธะบ ะดะฐะฝะฝัั)
- Tool use (web search, APIs)

Agentic RAG = Advanced RAG + autonomous agent capabilities.
</details>

### ะะพะฟัะพั 2
**ะงัะพ ัะฐะบะพะต Self-RAG reflection tokens ะธ ะทะฐัะตะผ ะพะฝะธ ะฝัะถะฝั?**

<details>
<summary>ะัะฒะตั</summary>

Self-RAG ะธัะฟะพะปัะทัะตั ัะฟะตัะธะฐะปัะฝัะต ัะพะบะตะฝั ะดะปั self-evaluation ะฝะฐ ะบะฐะถะดะพะผ ัะฐะณะต:

- **[Retrieve]**: ะะตัะฐะตั, ะฝัะถะตะฝ ะปะธ retrieval (ะผะพะถะตั ะฟัะพะฟัััะธัั ะดะปั ะฟัะพัััั ะฒะพะฟัะพัะพะฒ)
- **[ISREL]**: ะัะตะฝะธะฒะฐะตั ัะตะปะตะฒะฐะฝัะฝะพััั ะบะฐะถะดะพะณะพ ะดะพะบัะผะตะฝัะฐ
- **[ISSUP]**: ะัะพะฒะตััะตั, ะฟะพะดะดะตัะถะธะฒะฐะตััั ะปะธ ะพัะฒะตั ะบะพะฝัะตะบััะพะผ (ะฐะฝัะธะณะฐะปะปััะธะฝะฐัะธั)
- **[ISUSE]**: ะัะตะฝะธะฒะฐะตั ะฟะพะปะตะทะฝะพััั ะพัะฒะตัะฐ ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั

ะะฐัะตะผ:
- ะญะบะพะฝะพะผะธั ะฝะฐ ะฝะตะฝัะถะฝะพะผ retrieval
- ะคะธะปัััะฐัะธั ะฝะตัะตะปะตะฒะฐะฝัะฝัั ะดะพะบัะผะตะฝัะพะฒ ะะ ะณะตะฝะตัะฐัะธะธ
- ะะตัะตะบัะธั ะณะฐะปะปััะธะฝะฐัะธะน
- Quality gate ะฟะตัะตะด ะฒัะดะฐัะตะน ะพัะฒะตัะฐ

ะะตะทัะปััะฐั: +40% accuracy ะฝะฐ ะฝะตะบะพัะพััั benchmarks.
</details>

### ะะพะฟัะพั 3
**ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั GraphRAG ะฒะผะตััะพ ะพะฑััะฝะพะณะพ RAG?**

<details>
<summary>ะัะฒะตั</summary>

**GraphRAG ะปัััะต ะบะพะณะดะฐ:**
- ะะพะฟัะพัั ะพ ัะตะผะฐั, ะฟะฐััะตัะฝะฐั, ััะตะฝะดะฐั ("What are the main themes?")
- Multi-hop reasoning (ะฝัะถะฝะพ ัะฒัะทะฐัั ะฝะตัะบะพะปัะบะพ ัััะฝะพััะตะน)
- ะัะถะฝะพ ะฟะพะฝััั ััััะบัััั ะบะพัะฟััะฐ
- ะะพะฟัะพัั ะพะฑ ะพัะฝะพัะตะฝะธัั ะผะตะถะดั ัััะฝะพัััะผะธ
- Aggregation queries ("ัะบะพะปัะบะพ ะบะพะผะฟะฐะฝะธะน ัะฟะพะผะธะฝะฐะตััั")

**ะะฑััะฝัะน RAG ะปัััะต ะบะพะณะดะฐ:**
- ะัะพัััะต factual queries ("ะบะพะณะดะฐ ะพัะฝะพะฒะฐะฝะฐ ะบะพะผะฟะฐะฝะธั?")
- ะัะถะฝั real-time updates (GraphRAG ะดะพัะพะณะพ ะฟะตัะตัััะฐะธะฒะฐัั)
- ะะณัะฐะฝะธัะตะฝะฝัะน ะฑัะดะถะตั (GraphRAG ััะตะฑัะตั ะผะฝะพะณะพ LLM calls ะฟัะธ ะธะฝะดะตะบัะฐัะธะธ)
- Latency ะบัะธัะธัะฝะฐ (GraphRAG ะผะตะดะปะตะฝะฝะตะต ะฝะฐ global queries)
</details>

### ะะพะฟัะพั 4
**ะงัะพ ัะฐะบะพะต Contextual Retrieval ะธ ะบะฐะบะพะน ัะตะทัะปััะฐั?**

<details>
<summary>ะัะฒะตั</summary>

**Contextual Retrieval** (Anthropic) - ะดะพะฑะฐะฒะปะตะฝะธะต ะพะฑัััะฝัััะตะณะพ ะบะพะฝัะตะบััะฐ ะบ ะบะฐะถะดะพะผั ัะฐะฝะบั ะฟะตัะตะด embedding.

**ะัะพะฑะปะตะผะฐ ะบะพัะพััั ัะตัะฐะตั:**
Chunk "ะััััะบะฐ ะฒััะพัะปะฐ ะฝะฐ 3%" ัะตััะตั ะบะพะฝัะตะบัั: ะบะฐะบะฐั ะบะพะผะฟะฐะฝะธั? ะบะฐะบะพะน ะฟะตัะธะพะด?

**ะะตัะตะฝะธะต:**
LLM ะดะพะฑะฐะฒะปัะตั ะบะพะฝัะตะบัั: "ะญัะพ ะธะท SEC-ะพััะตัะฐ Apple ะทะฐ Q2 2024. ะัะตะดัะดััะธะน ะบะฒะฐััะฐะป: $94.8 ะผะปัะด. ะััััะบะฐ ะฒััะพัะปะฐ ะฝะฐ 3%"

**ะะตะทัะปััะฐัั (failure rate):**
- Baseline: 5.7%
- + Contextual Embeddings: 3.7% (-35%)
- + Contextual BM25: 2.9% (-49%)
- + Reranking: 1.9% (-67%)

ะก prompt caching ััะพะธะผะพััั ัะฝะธะถะฐะตััั ะฝะฐ ~90%.
</details>

### ะะพะฟัะพั 5
**ะะฐะบะธะต ะบะปััะตะฒัะต ะผะตััะธะบะธ RAGAS ะธ ััะพ ะพะฝะธ ะธะทะผะตัััั?**

<details>
<summary>ะัะฒะตั</summary>

**Retrieval metrics:**
- **Context Precision**: ะะฐะบะฐั ะดะพะปั retrieved docs ัะตะปะตะฒะฐะฝัะฝะฐ? (ะผะตะฝััะต ััะผะฐ)
- **Context Recall**: ะะฐะบะฐั ะดะพะปั ะฝัะถะฝะพะน ะธะฝัะพัะผะฐัะธะธ ะฝะฐะนะดะตะฝะฐ? (ะฟะพะปะฝะพัะฐ)

**Generation metrics:**
- **Faithfulness**: ะัะต ะปะธ claims ะฒ ะพัะฒะตัะต ะฟะพะดัะฒะตัะถะดะตะฝั ะบะพะฝัะตะบััะพะผ? (ะฐะฝัะธะณะฐะปะปััะธะฝะฐัะธั) - ะะะะะะะฏ ะะะขะะะะ
- **Answer Relevancy**: ะะฐัะบะพะปัะบะพ ะพัะฒะตั ะพัะฒะตัะฐะตั ะฝะฐ ะฒะพะฟัะพั? (ัะตะปะตะฒะฐะฝัะฝะพััั)

**Targets ะดะปั production:**
- Faithfulness > 0.9 (ะบัะธัะธัะฝะพ!)
- Context Precision > 0.8
- Answer Relevancy > 0.85
- Latency p95 < 3s
</details>

---

## ะกะฒัะทะฐะฝะฝัะต ะผะฐัะตัะธะฐะปั

- [[embeddings-complete-guide]] - ะะฐะบ ัะฐะฑะพัะฐัั embeddings
- [[vector-databases-guide]] - ะฅัะฐะฝะตะฝะธะต ะธ ะฟะพะธัะบ ะฒะตะบัะพัะพะฒ
- [[ai-agents-advanced]] - Agentic AI patterns
- [[llm-fundamentals]] - ะัะฝะพะฒั LLM

---

## ะััะพัะฝะธะบะธ

| # | ะััะพัะฝะธะบ | ะขะธะฟ | ะะบะปะฐะด |
|---|----------|-----|-------|
| 1 | [Agentic RAG with LangGraph](https://blog.langchain.com/agentic-rag-with-langgraph/) - LangChain | Tutorial | LangGraph ะฟะฐััะตัะฝั |
| 2 | [Self-RAG: Learning to Retrieve, Generate and Critique](https://selfrag.github.io/) | Paper | Reflection tokens |
| 3 | [Corrective RAG Tutorial](https://langchain-ai.github.io/langgraph/tutorials/rag/langgraph_crag/) - LangGraph | Tutorial | CRAG implementation |
| 4 | [Contextual Retrieval](https://www.anthropic.com/news/contextual-retrieval) - Anthropic | Blog | Chunk contextualization |
| 5 | [GraphRAG](https://github.com/microsoft/graphrag) - Microsoft | GitHub | Knowledge graphs ะดะปั RAG |
| 6 | [RAGAS Documentation](https://docs.ragas.io/) | Docs | LLM-as-a-Judge ะผะตััะธะบะธ |
| 7 | [Query Decomposition Cookbook](https://haystack.deepset.ai/cookbook/query_decomposition) - Haystack | Tutorial | Multi-hop decomposition |
| 8 | [Late Chunking](https://arxiv.org/abs/2409.04701) - Jina AI | Paper | ะะปััะตัะฝะฐัะธะฒะฐ Contextual Retrieval |
| 9 | [Original RAG Paper](https://arxiv.org/abs/2005.11401) - Lewis et al. 2020 | Paper | ะัะฝะพะฒะฐ RAG |
| 10 | [LangChain RAG Documentation](https://python.langchain.com/docs/tutorials/rag/) | Docs | ะัะฐะบัะธัะตัะบะธะต ะฟัะธะผะตัั |

---

*ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต: 2025-12-28*

---

## ะกะฒัะทั ั ะดััะณะธะผะธ ัะตะผะฐะผะธ

**[[agentic-rag]]** โ Agentic RAG ะฟัะตะดััะฐะฒะปัะตั ัะพะฑะพะน ัะฒะพะปััะธั ะบะปะฐััะธัะตัะบะพะณะพ RAG-ะฟะพะดัะพะดะฐ, ะณะดะต LLM-ะฐะณะตะฝั ัะฐะผะพััะพััะตะปัะฝะพ ัะตัะฐะตั, ะบะพะณะดะฐ ะธ ะบะฐะบ ะพะฑัะฐัะฐัััั ะบ ะฒะฝะตัะฝะธะผ ะดะฐะฝะฝัะผ. ะัะปะธ ะฟัะพะดะฒะธะฝัััะต RAG-ัะตัะฝะธะบะธ (self-RAG, corrective RAG) ะดะพะฑะฐะฒะปััั ะธะฝัะตะปะปะตะบั ะฝะฐ ััะพะฒะฝะต ะพัะดะตะปัะฝัั ััะฐะฟะพะฒ ะฟะฐะนะฟะปะฐะนะฝะฐ, ัะพ agentic RAG ะพะฑัะตะดะธะฝัะตั ััะธ ัะตัะฝะธะบะธ ะฟะพะด ัะฟัะฐะฒะปะตะฝะธะตะผ ะฐะณะตะฝัะฐ, ัะฟะพัะพะฑะฝะพะณะพ ะฟะปะฐะฝะธัะพะฒะฐัั ะผะฝะพะณะพัะฐะณะพะฒัะน ะฟะพะธัะบ, ะบะพะผะฑะธะฝะธัะพะฒะฐัั ะธััะพัะฝะธะบะธ ะธ ะธัะตัะฐัะธะฒะฝะพ ัะปัััะฐัั ะพัะฒะตั. ะะพะฝะธะผะฐะฝะธะต ะฟัะพะดะฒะธะฝัััั RAG-ะฟะฐััะตัะฝะพะฒ โ ะฝะตะพะฑัะพะดะธะผะฐั ะฑะฐะทะฐ ะดะปั ะฟะพัััะพะตะฝะธั ัััะตะบัะธะฒะฝัั ะฐะณะตะฝัะฝัั RAG-ัะธััะตะผ.

**[[vector-databases-guide]]** โ ะะตะบัะพัะฝัะต ะฑะฐะทั ะดะฐะฝะฝัั ัะฒะปััััั ะธะฝััะฐััััะบัััะฝะพะน ะพัะฝะพะฒะพะน ะปัะฑะพะณะพ RAG-ะฟะฐะนะฟะปะฐะนะฝะฐ. ะัะฑะพั ะฒะตะบัะพัะฝะพะน ะะ (Pinecone, Weaviate, Qdrant, Chroma) ะฝะฐะฟััะผัั ะฒะปะธัะตั ะฝะฐ ะบะฐัะตััะฒะพ retrieval-ััะฐะฟะฐ: ัะบะพัะพััั ะฟะพะธัะบะฐ, ะฟะพะดะดะตัะถะบะฐ ะณะธะฑัะธะดะฝะพะณะพ ะฟะพะธัะบะฐ, ะผะตัะฐะดะฐะฝะฝัะต ะดะปั ัะธะปัััะฐัะธะธ. ะัะพะดะฒะธะฝัััะต RAG-ัะตัะฝะธะบะธ, ัะฐะบะธะต ะบะฐะบ multi-index routing ะธะปะธ hierarchical retrieval, ััะตะฑััั ะฟะพะฝะธะผะฐะฝะธั ะธะฝะดะตะบัะพะฒ (HNSW, IVF) ะธ ะพัะพะฑะตะฝะฝะพััะตะน ะบะพะฝะบัะตัะฝัั ะฒะตะบัะพัะฝัั ะะ.

**[[embeddings-complete-guide]]** โ ะญะผะฑะตะดะดะธะฝะณะธ ะพะฟัะตะดะตะปััั ะบะฐัะตััะฒะพ ัะตะผะฐะฝัะธัะตัะบะพะณะพ ะฟะพะธัะบะฐ ะฒ RAG-ัะธััะตะผะต. ะัะฑะพั ะผะพะดะตะปะธ ัะผะฑะตะดะดะธะฝะณะพะฒ, ัััะฐัะตะณะธั ัะฐะฝะบะธะฝะณะฐ ะธ ะผะตัะพะดั ัะปัััะตะฝะธั (contextual retrieval, late chunking) ะบัะธัะธัะตัะบะธ ะฒะปะธััั ะฝะฐ recall ะธ precision ะฟะพะธัะบะฐ. ะัะพะดะฒะธะฝัััะต RAG-ัะตัะฝะธะบะธ, ัะฐะบะธะต ะบะฐะบ query decomposition ะธ hypothetical document embeddings (HyDE), ัะฐะฑะพัะฐัั ะธะผะตะฝะฝะพ ะฝะฐ ััะพะฒะฝะต ัะผะฑะตะดะดะธะฝะณะพะฒ, ััะฐะฝััะพัะผะธััั ะทะฐะฟัะพั ะธะปะธ ะดะพะบัะผะตะฝัั ะดะปั ัะปัััะตะฝะธั ัะตะผะฐะฝัะธัะตัะบะพะณะพ ัะพะพัะฒะตัััะฒะธั.

---

## ะััะพัะฝะธะบะธ ะธ ะดะฐะปัะฝะตะนัะตะต ััะตะฝะธะต

- **Jurafsky D., Martin J.H. (2023). Speech and Language Processing. 3rd edition.** โ ััะฝะดะฐะผะตะฝัะฐะปัะฝัะน ััะตะฑะฝะธะบ ะฟะพ NLP, ะฟะพะบััะฒะฐััะธะน ะธะฝัะพัะผะฐัะธะพะฝะฝัะน ะฟะพะธัะบ, ัะตะผะฐะฝัะธัะตัะบะพะต ััะพะดััะฒะพ ะธ ะผะพะดะตะปะธ ัะทัะบะฐ, ััะพ ะดะฐัั ัะตะพัะตัะธัะตัะบัั ะฑะฐะทั ะดะปั ะฟะพะฝะธะผะฐะฝะธั retrieval-ะบะพะผะฟะพะฝะตะฝัะพะฒ RAG
- **Huyen C. (2022). Designing Machine Learning Systems. O'Reilly.** โ ะฟัะฐะบัะธัะตัะบะพะต ััะบะพะฒะพะดััะฒะพ ะฟะพ ะฟัะพะตะบัะธัะพะฒะฐะฝะธั ML-ัะธััะตะผ ะฒ ะฟัะพะดะฐะบัะตะฝะต, ะฒะบะปััะฐั ะฟะฐััะตัะฝั ัะฐะฑะพัั ั ะดะฐะฝะฝัะผะธ, ะผะพะฝะธัะพัะธะฝะณ ะธ ะธัะตัะฐัะธะฒะฝะพะต ัะปัััะตะฝะธะต, ะฟัะธะผะตะฝะธะผัะต ะบ RAG-ะฟะฐะนะฟะปะฐะนะฝะฐะผ
- **Russell S., Norvig P. (2020). Artificial Intelligence: A Modern Approach. 4th edition.** โ ะบะปะฐััะธัะตัะบะธะน ััะตะฑะฝะธะบ, ะฟะพะบััะฒะฐััะธะน ะฟะพะธัะบ, ะฟัะตะดััะฐะฒะปะตะฝะธะต ะทะฝะฐะฝะธะน ะธ reasoning, ััะพ ะฒะฐะถะฝะพ ะดะปั ะฟะพะฝะธะผะฐะฝะธั ัะตะพัะตัะธัะตัะบะธั ะพัะฝะพะฒ multi-hop ะธ graph-based RAG

---

*ะัะพะฒะตัะตะฝะพ: 2026-01-09*
